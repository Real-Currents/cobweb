/* -*- Mode: JavaScript; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-
 *******************************************************************************
 *
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Copyright create3000, Scheffelstra√üe 31a, Leipzig, Germany 2011.
 *
 * All rights reserved. Holger Seelig <holger.seelig@yahoo.de>.
 *
 * The copyright notice above does not evidence any actual of intended
 * publication of such source code, and is an unpublished work by create3000.
 * This material contains CONFIDENTIAL INFORMATION that is the property of
 * create3000.
 *
 * No permission is granted to copy, distribute, or create derivative works from
 * the contents of this software, in whole or in part, without the prior written
 * permission of create3000.
 *
 * NON-MILITARY USE ONLY
 *
 * All create3000 software are effectively free software with a non-military use
 * restriction. It is free. Well commented source is provided. You may reuse the
 * source in any way you please with the exception anything that uses it must be
 * marked to indicate is contains 'non-military use only' components.
 *
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * Copyright 2015, 2016 Holger Seelig <holger.seelig@yahoo.de>.
 *
 * This file is part of the Cobweb Project.
 *
 * Cobweb is free software: you can redistribute it and/or modify it under the
 * terms of the GNU General Public License version 3 only, as published by the
 * Free Software Foundation.
 *
 * Cobweb is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License version 3 for more
 * details (a copy is included in the LICENSE file that accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version 3
 * along with Cobweb.  If not, see <http://www.gnu.org/licenses/gpl.html> for a
 * copy of the GPLv3 License.
 *
 * For Silvio, Joy and Adi.
 *
 ******************************************************************************/

(function(){var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.4",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!!(typeof window!=="undefined"&&navigator&&document),isWebWorker=!isBrowser&&typeof importScripts!=="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=false;function isFunction(it){return ostring.call(it)==="[object Function]"}function isArray(it){return ostring.call(it)==="[object Array]"}function each(ary,func){if(ary){var i;for(i=0;i<ary.length;i+=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1;i-=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj){if(hasProp(obj,prop)){if(func(obj[prop],prop)){break}}}}function mixin(target,source,force,deepStringMixin){if(source){eachProp(source,function(value,prop){if(force||!hasProp(target,prop)){if(deepStringMixin&&typeof value!=="string"){if(!target[prop]){target[prop]={}}mixin(target[prop],value,force,deepStringMixin)}else{target[prop]=value}}})}return target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(value){if(!value){return value}var g=global;each(value.split("."),function(part){g=g[part]});return g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);e.requireType=id;e.requireModules=requireModules;if(err){e.originalError=err}return e}if(typeof define!=="undefined"){return}if(typeof requirejs!=="undefined"){if(isFunction(requirejs)){return}cfg=requirejs;requirejs=undefined}if(typeof require!=="undefined"&&!isFunction(require)){cfg=require;require=undefined}function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},registry={},undefEvents={},defQueue=[],defined={},urlFetched={},requireCounter=1,unnormalizedCounter=1;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName,applyMap){var pkgName,pkgConfig,mapValue,nameParts,i,j,nameSegment,foundMap,foundI,foundStarMap,starI,baseParts=baseName&&baseName.split("/"),normalizedBaseParts=baseParts,map=config.map,starMap=map&&map["*"];if(name&&name.charAt(0)==="."){if(baseName){if(getOwn(config.pkgs,baseName)){normalizedBaseParts=baseParts=[baseName]}else{normalizedBaseParts=baseParts.slice(0,baseParts.length-1)}name=normalizedBaseParts.concat(name.split("/"));trimDots(name);pkgConfig=getOwn(config.pkgs,pkgName=name[0]);name=name.join("/");if(pkgConfig&&name===pkgName+"/"+pkgConfig.main){name=pkgName}}else if(name.indexOf("./")===0){name=name.substring(2)}}if(applyMap&&(baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=getOwn(map,baseParts.slice(0,j).join("/"));if(mapValue){mapValue=getOwn(mapValue,nameSegment);if(mapValue){foundMap=mapValue;foundI=i;break}}}}if(foundMap){break}if(!foundStarMap&&starMap&&getOwn(starMap,nameSegment)){foundStarMap=getOwn(starMap,nameSegment);starI=i}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/")}}return name}function removeScript(name){if(isBrowser){each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName){scriptNode.parentNode.removeChild(scriptNode);return true}})}}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1){removeScript(id);pathConfig.shift();context.require.undef(id);context.require([id]);return true}}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length)}return[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=true,normalizedName="";if(!name){isDefine=false;name="_@r"+(requireCounter+=1)}nameParts=splitPrefix(name);prefix=nameParts[0];name=nameParts[1];if(prefix){prefix=normalize(prefix,parentName,applyMap);pluginModule=getOwn(defined,prefix)}if(name){if(prefix){if(pluginModule&&pluginModule.normalize){normalizedName=pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap)})}else{normalizedName=normalize(name,parentName,applyMap)}}else{normalizedName=normalize(name,parentName,applyMap);nameParts=splitPrefix(normalizedName);prefix=nameParts[0];normalizedName=nameParts[1];isNormalized=true;url=context.nameToUrl(normalizedName)}}suffix=prefix&&!pluginModule&&!isNormalized?"_unnormalized"+(unnormalizedCounter+=1):"";return{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);if(!mod){mod=registry[id]=new context.Module(depMap)}return mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);if(hasProp(defined,id)&&(!mod||mod.defineEmitComplete)){if(name==="defined"){fn(defined[id])}}else{getModule(depMap).on(name,fn)}}function onError(err,errback){var ids=err.requireModules,notified=false;if(errback){errback(err)}else{each(ids,function(id){var mod=getOwn(registry,id);if(mod){mod.error=err;if(mod.events.error){notified=true;mod.emit("error",err)}}});if(!notified){req.onError(err)}}}function takeGlobalQueue(){if(globalDefQueue.length){apsp.apply(defQueue,[defQueue.length-1,0].concat(globalDefQueue));globalDefQueue=[]}}handlers={require:function(mod){if(mod.require){return mod.require}else{return mod.require=context.makeRequire(mod.map)}},exports:function(mod){mod.usingExports=true;if(mod.map.isDefine){if(mod.exports){return mod.exports}else{return mod.exports=defined[mod.map.id]={}}}},module:function(mod){if(mod.module){return mod.module}else{return mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return config.config&&getOwn(config.config,mod.map.id)||{}},exports:defined[mod.map.id]}}}};function cleanRegistry(id){delete registry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;if(mod.error){mod.emit("error",mod.error)}else{traced[id]=true;each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);if(dep&&!mod.depMatched[i]&&!processed[depId]){if(getOwn(traced,depId)){mod.defineDep(i,defined[depId]);mod.check()}else{breakCycle(dep,traced,processed)}}});processed[id]=true}}function checkLoaded(){var map,modId,err,usingPathFallback,waitInterval=config.waitSeconds*1e3,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=false,needCycleCheck=true;if(inCheckLoaded){return}inCheckLoaded=true;eachProp(registry,function(mod){map=mod.map;modId=map.id;if(!mod.enabled){return}if(!map.isDefine){reqCalls.push(mod)}if(!mod.error){if(!mod.inited&&expired){if(hasPathFallback(modId)){usingPathFallback=true;stillLoading=true}else{noLoads.push(modId);removeScript(modId)}}else if(!mod.inited&&mod.fetched&&map.isDefine){stillLoading=true;if(!map.prefix){return needCycleCheck=false}}}});if(expired&&noLoads.length){err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads);err.contextName=context.contextName;return onError(err)}if(needCycleCheck){each(reqCalls,function(mod){breakCycle(mod,{},{})})}if((!expired||usingPathFallback)&&stillLoading){if((isBrowser||isWebWorker)&&!checkLoadedTimeoutId){checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0;checkLoaded()},50)}}inCheckLoaded=false}Module=function(map){this.events=getOwn(undefEvents,map.id)||{};this.map=map;this.shim=getOwn(config.shim,map.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Module.prototype={init:function(depMaps,factory,errback,options){options=options||{};if(this.inited){return}this.factory=factory;if(errback){this.on("error",errback)}else if(this.events.error){errback=bind(this,function(err){this.emit("error",err)})}this.depMaps=depMaps&&depMaps.slice(0);this.errback=errback;this.inited=true;this.ignore=options.ignore;if(options.enabled||this.enabled){this.enable()}else{this.check()}},defineDep:function(i,depExports){if(!this.depMatched[i]){this.depMatched[i]=true;this.depCount-=1;this.depExports[i]=depExports}},fetch:function(){if(this.fetched){return}this.fetched=true;context.startTime=(new Date).getTime();var map=this.map;if(this.shim){context.makeRequire(this.map,{enableBuildCallback:true})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()}))}else{return map.prefix?this.callPlugin():this.load()}},load:function(){var url=this.map.url;if(!urlFetched[url]){urlFetched[url]=true;context.load(this.map.id,url)}},check:function(){if(!this.enabled||this.enabling){return}var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(!this.inited){this.fetch()}else if(this.error){this.emit("error",this.error)}else if(!this.defining){this.defining=true;if(this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error){try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}}else{exports=context.execCb(id,factory,depExports,exports)}if(this.map.isDefine){cjsModule=this.module;if(cjsModule&&cjsModule.exports!==undefined&&cjsModule.exports!==this.exports){exports=cjsModule.exports}else if(exports===undefined&&this.usingExports){exports=this.exports}}if(err){err.requireMap=this.map;err.requireModules=[this.map.id];err.requireType="define";return onError(this.error=err)}}else{exports=factory}this.exports=exports;if(this.map.isDefine&&!this.ignore){defined[id]=exports;if(req.onResourceLoad){req.onResourceLoad(context,this.map,this.depMaps)}}delete registry[id];this.defined=true}this.defining=false;if(this.defined&&!this.defineEmitted){this.defineEmitted=true;this.emit("defined",this.exports);this.defineEmitComplete=true}}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap);on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:true});if(this.map.unnormalized){if(plugin.normalize){name=plugin.normalize(name,function(name){return normalize(name,parentName,true)})||""}normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap);on(normalizedMap,"defined",bind(this,function(value){this.init([],function(){return value},null,{enabled:true,ignore:true})}));normalizedMod=getOwn(registry,normalizedMap.id);if(normalizedMod){this.depMaps.push(normalizedMap);if(this.events.error){normalizedMod.on("error",bind(this,function(err){this.emit("error",err)}))}normalizedMod.enable()}return}load=bind(this,function(value){this.init([],function(){return value},null,{enabled:true})});load.error=bind(this,function(err){this.inited=true;this.error=err;err.requireModules=[id];eachProp(registry,function(mod){if(mod.map.id.indexOf(id+"_unnormalized")===0){cleanRegistry(mod.map.id)}});onError(err)});load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;if(textAlt){text=textAlt}if(hasInteractive){useInteractive=false}getModule(moduleMap);if(hasProp(config.config,id)){config.config[moduleName]=config.config[id]}try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]))}if(hasInteractive){useInteractive=true}this.depMaps.push(moduleMap);context.completeLoad(moduleName);localRequire([moduleName],load)});plugin.load(map.name,localRequire,load,config)}));context.enable(pluginMap,this);this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){this.enabled=true;this.enabling=true;each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if(typeof depMap==="string"){depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,false,!this.skipMap);this.depMaps[i]=depMap;handler=getOwn(handlers,depMap.id);if(handler){this.depExports[i]=handler(this);return}this.depCount+=1;on(depMap,"defined",bind(this,function(depExports){this.defineDep(i,depExports);this.check()}));if(this.errback){on(depMap,"error",this.errback)}}id=depMap.id;mod=registry[id];if(!hasProp(handlers,id)&&mod&&!mod.enabled){context.enable(depMap,this)}}));eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);if(mod&&!mod.enabled){context.enable(pluginMap,this)}}));this.enabling=false;this.check()},on:function(name,cb){var cbs=this.events[name];if(!cbs){cbs=this.events[name]=[]}cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)});if(name==="error"){delete this.events[name]}}};function callGetModule(args){if(!hasProp(defined,args[0])){getModule(makeModuleMap(args[0],null,true)).init(args[1],args[2])}}function removeListener(node,func,name,ieName){if(node.detachEvent&&!isOpera){if(ieName){node.detachEvent(ieName,func)}}else{node.removeEventListener(name,func,false)}}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;removeListener(node,context.onScriptLoad,"load","onreadystatechange");removeListener(node,context.onScriptError,"error");return{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]))}else{callGetModule(args)}}}context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,configure:function(cfg){if(cfg.baseUrl){if(cfg.baseUrl.charAt(cfg.baseUrl.length-1)!=="/"){cfg.baseUrl+="/"}}var pkgs=config.pkgs,shim=config.shim,objs={paths:true,config:true,map:true};eachProp(cfg,function(value,prop){if(objs[prop]){if(prop==="map"){mixin(config[prop],value,true,true)}else{mixin(config[prop],value,true)}}else{config[prop]=value}});if(cfg.shim){eachProp(cfg.shim,function(value,id){if(isArray(value)){value={deps:value}}if((value.exports||value.init)&&!value.exportsFn){value.exportsFn=context.makeShimExports(value)}shim[id]=value});config.shim=shim}if(cfg.packages){each(cfg.packages,function(pkgObj){var location;pkgObj=typeof pkgObj==="string"?{name:pkgObj}:pkgObj;location=pkgObj.location;pkgs[pkgObj.name]={name:pkgObj.name,location:location||pkgObj.name,main:(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}});config.pkgs=pkgs}eachProp(registry,function(mod,id){if(!mod.inited&&!mod.map.unnormalized){mod.map=makeModuleMap(id)}});if(cfg.deps||cfg.callback){context.require(cfg.deps||[],cfg.callback)}},makeShimExports:function(value){function fn(){var ret;if(value.init){ret=value.init.apply(global,arguments)}return ret||value.exports&&getGlobal(value.exports)}return fn},makeRequire:function(relMap,options){options=options||{};function localRequire(deps,callback,errback){var id,map,requireMod;if(options.enableBuildCallback&&callback&&isFunction(callback)){callback.__requireJsBuild=true}if(typeof deps==="string"){if(isFunction(callback)){return onError(makeError("requireargs","Invalid require call"),errback)}if(relMap&&hasProp(handlers,deps)){return handlers[deps](registry[relMap.id])}if(req.get){return req.get(context,deps,relMap)}map=makeModuleMap(deps,relMap,false,true);id=map.id;if(!hasProp(defined,id)){return onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))}return defined[id]}intakeDefines();context.nextTick(function(){intakeDefines();requireMod=getModule(makeModuleMap(null,relMap));requireMod.skipMap=options.skipMap;requireMod.init(deps,callback,errback,{enabled:true});checkLoaded()});return localRequire}mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,url,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative=segment==="."||segment==="..";if(index!==-1&&(!isRelative||index>1)){ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length);moduleNamePlusExt=moduleNamePlusExt.substring(0,index)}url=context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,true),ext||".fake");return ext?url:url.substring(0,url.length-5)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,false,true).id)},specified:function(id){id=makeModuleMap(id,relMap,false,true).id;return hasProp(defined,id)||hasProp(registry,id)}});if(!relMap){localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,true),mod=getOwn(registry,id);delete defined[id];delete urlFetched[map.url];delete undefEvents[id];if(mod){if(mod.events.defined){undefEvents[id]=mod.events}cleanRegistry(id)}}}return localRequire},enable:function(depMap){var mod=getOwn(registry,depMap.id);if(mod){getModule(depMap).enable()}},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){args[0]=moduleName;if(found){break}found=true}else if(args[0]===moduleName){found=true}callGetModule(args)}mod=getOwn(registry,moduleName);if(!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(config.enforceDefine&&(!shExports||!getGlobal(shExports))){if(hasPathFallback(moduleName)){return}else{return onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]))}}else{callGetModule([moduleName,shim.deps||[],shim.exportsFn])}}checkLoaded()},nameToUrl:function(moduleName,ext){var paths,pkgs,pkg,pkgPath,syms,i,parentModule,url,parentPath;if(req.jsExtRegExp.test(moduleName)){url=moduleName+(ext||"")}else{paths=config.paths;pkgs=config.pkgs;syms=moduleName.split("/");for(i=syms.length;i>0;i-=1){parentModule=syms.slice(0,i).join("/");pkg=getOwn(pkgs,parentModule);parentPath=getOwn(paths,parentModule);if(parentPath){if(isArray(parentPath)){parentPath=parentPath[0]}syms.splice(0,i,parentPath);break}else if(pkg){if(moduleName===pkg.name){pkgPath=pkg.location+"/"+pkg.main}else{pkgPath=pkg.location}syms.splice(0,i,pkgPath);break}}url=syms.join("/");url+=ext||(/\?/.test(url)?"":".js");url=(url.charAt(0)==="/"||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs?url+((url.indexOf("?")===-1?"?":"&")+config.urlArgs):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if(evt.type==="load"||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){return onError(makeError("scripterror","Script error",evt,[data.id]))}}};context.require=context.makeRequire();return context}req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;if(!isArray(deps)&&typeof deps!=="string"){config=deps;if(isArray(callback)){deps=callback;callback=errback;errback=optional}else{deps=[]}}if(config&&config.context){contextName=config.context}context=getOwn(contexts,contextName);if(!context){context=contexts[contextName]=req.s.newContext(contextName)}if(config){context.configure(config)}return context.require(deps,callback,errback)};req.config=function(config){return req(config)};req.nextTick=typeof setTimeout!=="undefined"?function(fn){setTimeout(fn,4)}:function(fn){fn()};if(!require){require=req}req.version=version;req.jsExtRegExp=/^\/|:|\?|\.js$/;req.isBrowser=isBrowser;s=req.s={contexts:contexts,newContext:newContext};req({});each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}});if(isBrowser){head=s.head=document.getElementsByTagName("head")[0];baseElement=document.getElementsByTagName("base")[0];if(baseElement){head=s.head=baseElement.parentNode}}req.onError=function(err){throw err};req.load=function(context,moduleName,url){var config=context&&context.config||{},node;if(isBrowser){node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");node.type=config.scriptType||"text/javascript";node.charset="utf-8";node.async=true;node.setAttribute("data-requirecontext",context.contextName);node.setAttribute("data-requiremodule",moduleName);if(node.attachEvent&&!(node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0)&&!isOpera){useInteractive=true;node.attachEvent("onreadystatechange",context.onScriptLoad)}else{node.addEventListener("load",context.onScriptLoad,false);node.addEventListener("error",context.onScriptError,false)}node.src=url;currentlyAddingScript=node;if(baseElement){head.insertBefore(node,baseElement)}else{head.appendChild(node)}currentlyAddingScript=null;return node}else if(isWebWorker){importScripts(url);context.completeLoad(moduleName)}};function getInteractiveScript(){if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}eachReverse(scripts(),function(script){if(script.readyState==="interactive"){return interactiveScript=script}});return interactiveScript}if(isBrowser){eachReverse(scripts(),function(script){if(!head){head=script.parentNode}dataMain=script.getAttribute("data-main");if(dataMain){if(!cfg.baseUrl){src=dataMain.split("/");mainScript=src.pop();subPath=src.length?src.join("/")+"/":"./";cfg.baseUrl=subPath;dataMain=mainScript}dataMain=dataMain.replace(jsSuffixRegExp,"");cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain];return true}})}define=function(name,deps,callback){var node,context;if(typeof name!=="string"){callback=deps;deps=name;name=null}if(!isArray(deps)){callback=deps;deps=[]}if(!deps.length&&isFunction(callback)){if(callback.length){callback.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(match,dep){deps.push(dep)});deps=(callback.length===1?["require"]:["require","exports","module"]).concat(deps)}}if(useInteractive){node=currentlyAddingScript||getInteractiveScript();if(node){if(!name){name=node.getAttribute("data-requiremodule")}context=contexts[node.getAttribute("data-requirecontext")]}}(context?context.defQueue:globalDefQueue).push([name,deps,callback])};define.amd={jQuery:true};req.exec=function(text){return eval(text)};req(cfg)})(this);define("requireLib",function(){});var jam={packages:[{name:"jquery",location:"jam/jquery",main:"dist/jquery.js"},{name:"jquery-mousewheel",location:"jam/jquery-mousewheel",main:"jquery.mousewheel.js"},{name:"require",location:"jam/require",main:"require.min.js"},{name:"text",location:"jam/text",main:"text.js"}],version:"0.2.17",shim:{}};if(typeof require!=="undefined"&&require.config){require.config({packages:[{name:"jquery",location:"jam/jquery",main:"dist/jquery.js"},{name:"jquery-mousewheel",location:"jam/jquery-mousewheel",main:"jquery.mousewheel.js"},{name:"require",location:"jam/require",main:"require.min.js"},{name:"text",location:"jam/text",main:"text.js"}],shim:{}})}else{var require={packages:[{name:"jquery",location:"jam/jquery",main:"dist/jquery.js"},{name:"jquery-mousewheel",location:"jam/jquery-mousewheel",main:"jquery.mousewheel.js"},{name:"require",location:"jam/require",main:"require.min.js"},{name:"text",location:"jam/text",main:"text.js"}],shim:{}}}if(typeof exports!=="undefined"&&typeof module!=="undefined"){module.exports=jam}define("jam/require.config",function(){});(function(window,undefined){var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.0",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];
if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&length-1 in obj)}rootjQuery=jQuery(document);(function(window,undefined){var i,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,support={},dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(){return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"boolean":new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,funescape=function(_,escaped){var high="0x"+escaped-65536;return high!==high?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function isNative(fn){return rnative.test(fn+"")}function createCache(){var cache,keys=[];return cache=function(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key]=value}}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=isNative(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=isNative(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=isNative(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||contains(preferredDoc,a)){return-1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return document};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&fn(elem,name,!documentIsHTML);return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};function siblingCheck(a,b){var cur=b&&a,diff=cur&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function boolHandler(elem,name,isXML){var val;return isXML?undefined:(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}function interpolationHandler(elem,name,isXML){var val;return isXML?undefined:val=elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;node=elem[i];i++){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[4]){match[2]=match[4]}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1)).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1;if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}Expr.pseudos["nth"]=Expr.pseudos["eq"];function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;support.sortStable=expando.split("").sort(sortOrder).join("")===expando;setDocument();[0,0].sort(sortOrder);support.detectDuplicates=hasDuplicate;assert(function(div){div.innerHTML="<a href='#'></a>";if(div.firstChild.getAttribute("href")!=="#"){var attrs="type|href|height|width".split("|"),i=attrs.length;while(i--){Expr.attrHandle[attrs[i]]=interpolationHandler}}});assert(function(div){if(div.getAttribute("disabled")!=null){var attrs=booleans.split("|"),i=attrs.length;while(i--){Expr.attrHandle[attrs[i]]=boolHandler}}});jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains
})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));if(!input.type){return support}input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;support.reliableMarginRight=true;support.boxSizingReliable=true;support.pixelPosition=false;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment.appendChild(input);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.focusinBubbles="onfocusin"in window;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="";div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}body.removeChild(container)});return support}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=function(owner){return owner.nodeType?owner.nodeType===1||owner.nodeType===9:true};Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){this.cache[unlock]=data}else{for(prop in data){cache[prop]=data[prop]}}}},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){if(key===undefined||key&&typeof key==="string"&&value===undefined){return this.get(owner,key)}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{if(key in cache){name=[key]}else{name=jQuery.camelCase(key);name=name in cache?[name]:name.match(core_rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){delete this.cache[this.key(owner)]}};data_user=new Data;data_priv=new Data;jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name])}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}hooks.cur=fn;if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.match(core_rnotwhite)||[];while(className=classNames[i++]){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className)}}else if(type===core_strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,self.val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.boolean.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.boolean.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.boolean.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}});if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)
}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var self,matched,i,l=this.length;if(typeof selector!=="string"){self=this;return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<l;i++){if(jQuery.contains(self[i],this)){return true}}}))}matched=[];for(i=0;i<l;i++){jQuery.find(selector,this[i],matched)}matched=this.pushStack(l>1?jQuery.unique(matched):matched);matched.selector=(this.selector?this.selector+" ":"")+selector;return matched},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return!!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return core_indexOf.call(jQuery(elem),this[0])}return core_indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(name[0]==="p"){matched.reverse()}}return this.pushStack(matched)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return core_indexOf.call(qualifier,elem)>=0!==not})}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.col=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!jQuery.support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.firstChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,type,l=elems.length,i=0,special=jQuery.event.special;for(;i<l;i++){elem=elems[i];if(jQuery.acceptData(elem)){data=data_priv.access(elem);if(data){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}}data_user.discard(elem);data_priv.discard(elem)}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"text",async:false,global:false,success:jQuery.globalEval})}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var l=elems.length,i=0;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=jQuery.extend({},pdataOld);events=pdataOld.events;data_priv.set(dest,pdataCur);if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){var bool=typeof state==="boolean";return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret};function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());
s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}xhrCallbacks=undefined})}jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;jQuery.support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(jQuery.support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,id,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status||404,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id=xhrId++]=callback("abort");xhr.send(options.hasContent&&options.data||null)},abort:function(){if(callback){callback()}}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return}}})}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,toggle,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}dataShow=data_priv.get(elem,"fxshow");for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow!==undefined&&dataShow[index]!==undefined){hidden=true}else{continue}}handled.push(index)}}length=handled.length;if(length){dataShow=data_priv.get(elem,"fxshow")||data_priv.access(elem,"fxshow",{});if("hidden"in dataShow){hidden=dataShow.hidden}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);doAnimation.finish=function(){anim.stop(true)};if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.cur&&hooks.cur.finish){hooks.cur.finish.call(this)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}if(typeof window==="object"&&typeof window.document==="object"){window.jQuery=window.$=jQuery}})(window);define("jquery/dist/jquery",function(){});define("cobweb/Error",["jquery"],function($){function Error(error,fallbacks){$(function(){var elements=$("X3D");elements.each(function(){Error.fallback($(this))});for(var i=0;i<fallbacks.length;++i){var fallback=fallbacks[i];if(typeof fallback==="function")fallback(elements,error)}})}function fallback(elements){elements.addClass("cobweb-fallback")}Error.fallback=fallback;return Error});define("cobweb/Basic/X3DFieldDefinition",[],function(){function X3DFieldDefinition(accessType,name,value,userDefined){this.accessType=accessType;this.dataType=value.getType();this.name=name;this.value=value;this.userDefined=userDefined}X3DFieldDefinition.prototype.constructor=X3DFieldDefinition;return X3DFieldDefinition});define("cobweb/Basic/FieldDefinitionArray",["jquery"],function($){var handler={get:function(target,key){if(key in target)return target[key];return target.array[key]},set:function(target,key,value){return false}};function FieldDefinitionArray(value){this.array=value;return new Proxy(this,handler)}$.extend(FieldDefinitionArray.prototype,{constructor:FieldDefinitionArray,getValue:function(){return this.array}});return FieldDefinitionArray});define("cobweb/Base/X3DObject",[],function(){var id=0;function getId(){return this.id}function X3DObject(){}X3DObject.prototype={constructor:X3DObject,id:0,name:"",tainted:false,interests:{},getId:function(){this.getId=getId;return this.id=++id},setName:function(value){this.name=value},getName:function(){return this.name},setTainted:function(value){this.tainted=value},getTainted:function(){return this.tainted},addInterest:function(object,callback){if(!this.hasOwnProperty("interests"))this.interests={};var args=Array.prototype.slice.call(arguments,0);args[1]=this;this.interests[object.getId()+callback]=Function.prototype.bind.apply(object[callback],args)},removeInterest:function(object,callback){delete this.interests[object.getId()+callback]},getInterests:function(){return this.interests},processInterests:function(){var interests=this.interests;for(var key in interests)interests[key]()}};return X3DObject});define("cobweb/Base/X3DChildObject",["jquery","cobweb/Base/X3DObject"],function($,X3DObject){function X3DChildObject(){X3DObject.call(this);this.parents={}}X3DChildObject.prototype=$.extend(Object.create(X3DObject.prototype),{constructor:X3DChildObject,addParent:function(parent){this.parents[parent.getId()]=parent},removeParent:function(parent){delete this.parents[parent.getId()]},getParents:function(){return this.parents}});return X3DChildObject});define("cobweb/Bits/X3DConstants",[],function(){var loadState=0,fieldType=0,nodeType=0;var X3DConstants={NOT_STARTED_STATE:loadState++,IN_PROGRESS_STATE:loadState++,COMPLETE_STATE:loadState++,FAILED_STATE:loadState++,initializeOnly:parseInt("001",2),inputOnly:parseInt("010",2),outputOnly:parseInt("100",2),inputOutput:parseInt("111",2),SFBool:fieldType++,SFColor:fieldType++,SFColorRGBA:fieldType++,SFDouble:fieldType++,SFFloat:fieldType++,SFImage:fieldType++,SFInt32:fieldType++,SFMatrix3d:fieldType++,SFMatrix3f:fieldType++,SFMatrix4d:fieldType++,SFMatrix4f:fieldType++,SFNode:fieldType++,SFRotation:fieldType++,SFString:fieldType++,SFTime:fieldType++,SFVec2d:fieldType++,SFVec2f:fieldType++,SFVec3d:fieldType++,SFVec3f:fieldType++,SFVec4d:fieldType++,SFVec4f:fieldType++,VrmlMatrix:fieldType++,MFBool:fieldType++,MFColor:fieldType++,MFColorRGBA:fieldType++,MFDouble:fieldType++,MFFloat:fieldType++,MFImage:fieldType++,MFInt32:fieldType++,MFMatrix3d:fieldType++,MFMatrix3f:fieldType++,MFMatrix4d:fieldType++,MFMatrix4f:fieldType++,MFNode:fieldType++,MFRotation:fieldType++,MFString:fieldType++,MFTime:fieldType++,MFVec2d:fieldType++,MFVec2f:fieldType++,MFVec3d:fieldType++,MFVec3f:fieldType++,MFVec4d:fieldType++,MFVec4f:fieldType++,Anchor:nodeType++,Appearance:nodeType++,Arc2D:nodeType++,ArcClose2D:nodeType++,AudioClip:nodeType++,Background:nodeType++,BallJoint:nodeType++,Billboard:nodeType++,BooleanFilter:nodeType++,BooleanSequencer:nodeType++,BooleanToggle:nodeType++,BooleanTrigger:nodeType++,BoundedPhysicsModel:nodeType++,Box:nodeType++,CADAssembly:nodeType++,CADFace:nodeType++,CADLayer:nodeType++,CADPart:nodeType++,Circle2D:nodeType++,ClipPlane:nodeType++,CollidableOffset:nodeType++,CollidableShape:nodeType++,Collision:nodeType++,CollisionCollection:nodeType++,CollisionSensor:nodeType++,CollisionSpace:nodeType++,Color:nodeType++,ColorChaser:nodeType++,ColorDamper:nodeType++,ColorInterpolator:nodeType++,ColorRGBA:nodeType++,ComposedCubeMapTexture:nodeType++,ComposedShader:nodeType++,ComposedTexture3D:nodeType++,Cone:nodeType++,ConeEmitter:nodeType++,Contact:nodeType++,Contour2D:nodeType++,ContourPolyline2D:nodeType++,Coordinate:nodeType++,CoordinateChaser:nodeType++,CoordinateDamper:nodeType++,CoordinateDouble:nodeType++,CoordinateInterpolator:nodeType++,CoordinateInterpolator2D:nodeType++,Cylinder:nodeType++,CylinderSensor:nodeType++,DISEntityManager:nodeType++,DISEntityTypeMapping:nodeType++,DirectionalLight:nodeType++,Disk2D:nodeType++,DoubleAxisHingeJoint:nodeType++,EaseInEaseOut:nodeType++,ElevationGrid:nodeType++,EspduTransform:nodeType++,ExplosionEmitter:nodeType++,Extrusion:nodeType++,FillProperties:nodeType++,FloatVertexAttribute:nodeType++,Fog:nodeType++,FogCoordinate:nodeType++,FontStyle:nodeType++,ForcePhysicsModel:nodeType++,GeneratedCubeMapTexture:nodeType++,GeoCoordinate:nodeType++,GeoElevationGrid:nodeType++,GeoLOD:nodeType++,GeoLocation:nodeType++,GeoMetadata:nodeType++,GeoOrigin:nodeType++,GeoPositionInterpolator:nodeType++,GeoProximitySensor:nodeType++,GeoTouchSensor:nodeType++,GeoTransform:nodeType++,GeoViewpoint:nodeType++,Group:nodeType++,HAnimDisplacer:nodeType++,HAnimHumanoid:nodeType++,HAnimJoint:nodeType++,HAnimSegment:nodeType++,HAnimSite:nodeType++,ImageCubeMapTexture:nodeType++,ImageTexture:nodeType++,ImageTexture3D:nodeType++,IndexedFaceSet:nodeType++,IndexedLineSet:nodeType++,IndexedQuadSet:nodeType++,IndexedTriangleFanSet:nodeType++,IndexedTriangleSet:nodeType++,IndexedTriangleStripSet:nodeType++,Inline:nodeType++,IntegerSequencer:nodeType++,IntegerTrigger:nodeType++,KeySensor:nodeType++,LOD:nodeType++,Layer:nodeType++,LayerSet:nodeType++,Layout:nodeType++,LayoutGroup:nodeType++,LayoutLayer:nodeType++,LinePickSensor:nodeType++,LineProperties:nodeType++,LineSet:nodeType++,LoadSensor:nodeType++,LocalFog:nodeType++,Material:nodeType++,Matrix3VertexAttribute:nodeType++,Matrix4VertexAttribute:nodeType++,MetadataBoolean:nodeType++,MetadataDouble:nodeType++,MetadataFloat:nodeType++,MetadataInteger:nodeType++,MetadataSet:nodeType++,MetadataString:nodeType++,MotorJoint:nodeType++,MovieTexture:nodeType++,MultiTexture:nodeType++,MultiTextureCoordinate:nodeType++,MultiTextureTransform:nodeType++,NavigationInfo:nodeType++,Normal:nodeType++,NormalInterpolator:nodeType++,NurbsCurve:nodeType++,NurbsCurve2D:nodeType++,NurbsOrientationInterpolator:nodeType++,NurbsPatchSurface:nodeType++,NurbsPositionInterpolator:nodeType++,NurbsSet:nodeType++,NurbsSurfaceInterpolator:nodeType++,NurbsSweptSurface:nodeType++,NurbsSwungSurface:nodeType++,NurbsTextureCoordinate:nodeType++,NurbsTrimmedSurface:nodeType++,OrientationChaser:nodeType++,OrientationDamper:nodeType++,OrientationInterpolator:nodeType++,OrthoViewpoint:nodeType++,PackagedShader:nodeType++,ParticleSystem:nodeType++,PickableGroup:nodeType++,PixelTexture:nodeType++,PixelTexture3D:nodeType++,PlaneSensor:nodeType++,PointEmitter:nodeType++,PointLight:nodeType++,PointPickSensor:nodeType++,PointSet:nodeType++,Polyline2D:nodeType++,PolylineEmitter:nodeType++,Polypoint2D:nodeType++,PositionChaser:nodeType++,PositionChaser2D:nodeType++,PositionDamper:nodeType++,PositionDamper2D:nodeType++,PositionInterpolator:nodeType++,PositionInterpolator2D:nodeType++,PrimitivePickSensor:nodeType++,ProgramShader:nodeType++,ProximitySensor:nodeType++,QuadSet:nodeType++,ReceiverPdu:nodeType++,Rectangle2D:nodeType++,RigidBody:nodeType++,RigidBodyCollection:nodeType++,ScalarChaser:nodeType++,ScalarDamper:nodeType++,ScalarInterpolator:nodeType++,ScreenFontStyle:nodeType++,ScreenGroup:nodeType++,Script:nodeType++,ShaderPart:nodeType++,ShaderProgram:nodeType++,Shape:nodeType++,SignalPdu:nodeType++,SingleAxisHingeJoint:nodeType++,SliderJoint:nodeType++,Sound:nodeType++,Sphere:nodeType++,SphereSensor:nodeType++,SplinePositionInterpolator:nodeType++,SplinePositionInterpolator2D:nodeType++,SplineScalarInterpolator:nodeType++,SpotLight:nodeType++,SquadOrientationInterpolator:nodeType++,StaticGroup:nodeType++,StringSensor:nodeType++,SurfaceEmitter:nodeType++,Switch:nodeType++,TexCoordChaser2D:nodeType++,TexCoordDamper2D:nodeType++,Text:nodeType++,TextureBackground:nodeType++,TextureCoordinate:nodeType++,TextureCoordinate3D:nodeType++,TextureCoordinate4D:nodeType++,TextureCoordinateGenerator:nodeType++,TextureProperties:nodeType++,TextureTransform:nodeType++,TextureTransform3D:nodeType++,TextureTransformMatrix3D:nodeType++,TimeSensor:nodeType++,TimeTrigger:nodeType++,TouchGroup:nodeType++,TouchSensor:nodeType++,Transform:nodeType++,TransformSensor:nodeType++,TransmitterPdu:nodeType++,TriangleFanSet:nodeType++,TriangleSet:nodeType++,TriangleSet2D:nodeType++,TriangleStripSet:nodeType++,TwoSidedMaterial:nodeType++,UniversalJoint:nodeType++,Viewpoint:nodeType++,ViewpointGroup:nodeType++,Viewport:nodeType++,VisibilitySensor:nodeType++,VolumeEmitter:nodeType++,VolumePickSensor:nodeType++,WindPhysicsModel:nodeType++,WorldInfo:nodeType++,X3DBaseNode:nodeType++,X3DAppearanceChildNode:nodeType++,X3DAppearanceNode:nodeType++,X3DBackgroundNode:nodeType++,X3DBindableNode:nodeType++,X3DBoundedObject:nodeType++,X3DChaserNode:nodeType++,X3DChildNode:nodeType++,X3DColorNode:nodeType++,X3DComposedGeometryNode:nodeType++,X3DCoordinateNode:nodeType++,X3DDamperNode:nodeType++,X3DDragSensorNode:nodeType++,X3DEnvironmentTextureNode:nodeType++,X3DEnvironmentalSensorNode:nodeType++,X3DFogObject:nodeType++,X3DFollowerNode:nodeType++,X3DFontStyleNode:nodeType++,X3DGeometricPropertyNode:nodeType++,X3DGeometryNode:nodeType++,X3DGeospatialObject:nodeType++,X3DGroupingNode:nodeType++,X3DInfoNode:nodeType++,X3DInterpolatorNode:nodeType++,X3DKeyDeviceSensorNode:nodeType++,X3DLayerNode:nodeType++,X3DLayoutNode:nodeType++,X3DLightNode:nodeType++,X3DMaterialNode:nodeType++,X3DMetadataObject:nodeType++,X3DNBodyCollidableNode:nodeType++,X3DNBodyCollisionSpaceNode:nodeType++,X3DNetworkSensorNode:nodeType++,X3DNode:nodeType++,X3DNormalNode:nodeType++,X3DNurbsControlCurveNode:nodeType++,X3DNurbsSurfaceGeometryNode:nodeType++,X3DParametricGeometryNode:nodeType++,X3DParticleEmitterNode:nodeType++,X3DParticlePhysicsModelNode:nodeType++,X3DPickSensorNode:nodeType++,X3DPickableObject:nodeType++,X3DPointingDeviceSensorNode:nodeType++,X3DProductStructureChildNode:nodeType++,X3DProgrammableShaderObject:nodeType++,X3DPrototypeInstance:nodeType++,X3DRigidJointNode:nodeType++,X3DScriptNode:nodeType++,X3DSensorNode:nodeType++,X3DSequencerNode:nodeType++,X3DShaderNode:nodeType++,X3DShapeNode:nodeType++,X3DSoundNode:nodeType++,X3DSoundSourceNode:nodeType++,X3DTexture2DNode:nodeType++,X3DTexture3DNode:nodeType++,X3DTextureCoordinateNode:nodeType++,X3DTextureNode:nodeType++,X3DTextureTransformNode:nodeType++,X3DTimeDependentNode:nodeType++,X3DTouchSensorNode:nodeType++,X3DTransformMatrix4DNode:nodeType++,X3DTransformNode:nodeType++,X3DTriggerNode:nodeType++,X3DUrlObject:nodeType++,X3DVertexAttributeNode:nodeType++,X3DViewpointNode:nodeType++,X3DViewpointObject:nodeType++,X3DViewportNode:nodeType++,X3DProtoDeclarationNode:nodeType++,X3DProtoDeclaration:nodeType++,X3DExternProtoDeclaration:nodeType++};
Object.preventExtensions(X3DConstants);Object.freeze(X3DConstants);Object.seal(X3DConstants);return X3DConstants});define("cobweb/Base/Event",["jquery"],function($){var Event={stack:[],create:function(field){if(this.stack.length){var event=this.stack.pop();event.field=field;return event}return{field:field,sources:{}}},copy:function(event){if(this.stack.length){var copy=this.stack.pop();copy.field=event.field;$.extend(copy.sources,event.sources);return copy}return{field:event.field,sources:$.extend({},event.sources)}},push:function(event){var sources=event.sources;for(var id in sources)delete event.sources[id];this.stack.push(event)}};return Event});define("cobweb/Basic/X3DField",["jquery","cobweb/Base/X3DChildObject","cobweb/Bits/X3DConstants","cobweb/Base/Event"],function($,X3DChildObject,X3DConstants,Event){function X3DField(value){X3DChildObject.call(this);this.value_=value;return this}X3DField.prototype=$.extend(Object.create(X3DChildObject.prototype),{constructor:X3DField,fieldValue:null,accessType:X3DConstants.initializeOnly,references:{},fieldInterests:{},fieldCallbacks:{},clone:function(){return this.copy()},equals:function(value){return this.getValue()==value.valueOf()},setValue:function(value){this.set(value instanceof this.constructor?value.getValue():value);this.addEvent()},set:function(value){this.value_=value},setFieldValue:function(value){return this.fieldValue=value},getFieldValue:function(){return this.fieldValue},getValue:function(){return this.value_},setAccessType:function(value){this.accessType=value},getAccessType:function(){return this.accessType},isReadable:function(){return this.accessType!==X3DConstants.inputOnly},isWritable:function(){return this.accessType!==X3DConstants.initializeOnly},isInput:function(){return this.accessType&X3DConstants.inputOnly},isOutput:function(){return this.accessType&X3DConstants.outputOnly},hasReferences:function(){if(this.hasOwnProperty("references"))return!$.isEmptyObject(this.references);return false},addReference:function(reference){var references=this.getReferences();if(references[reference.getId()])return;references[reference.getId()]=reference;switch(this.accessType&reference.getAccessType()){case X3DConstants.initializeOnly:this.set(reference.getValue());return;case X3DConstants.inputOnly:reference.addFieldInterest(this);return;case X3DConstants.outputOnly:this.addFieldInterest(reference);return;case X3DConstants.inputOutput:reference.addFieldInterest(this);this.addFieldInterest(reference);this.set(reference.getValue());return}},getReferences:function(){if(!this.hasOwnProperty("references"))this.references={};return this.references},updateReferences:function(){if(this.hasOwnProperty("references")){for(var id in this.references){var reference=this.references[id];switch(this.accessType&reference.getAccessType()){case X3DConstants.inputOnly:case X3DConstants.outputOnly:continue;case X3DConstants.initializeOnly:case X3DConstants.inputOutput:this.set(reference.getValue());continue}}}},addFieldInterest:function(field){if(!this.hasOwnProperty("fieldInterests"))this.fieldInterests={};this.fieldInterests[field.getId()]=field},removeFieldInterest:function(field){delete this.fieldInterests[field.getId()]},addFieldCallback:function(string,object){if(!this.hasOwnProperty("fieldCallbacks"))this.fieldCallbacks={};this.fieldCallbacks[string]=object},removeFieldCallback:function(string){delete this.fieldCallbacks[string]},addEvent:function(){var parents=this.getParents();for(var key in parents)parents[key].addEvent(this)},addEventObject:function(field,event){var parents=this.getParents();for(var key in parents)parents[key].addEventObject(this,event)},processEvent:function(event){if(event.sources.hasOwnProperty(this.getId()))return;event.sources[this.getId()]=true;this.setTainted(false);if(event.field!==this)this.set(event.field.getValue());this.processInterests();var fieldInterests=this.fieldInterests,first=true;for(var key in fieldInterests){if(first){first=false;fieldInterests[key].addEventObject(this,event)}else fieldInterests[key].addEventObject(this,Event.copy(event))}if(first)Event.push(event);var fieldCallbacks=this.fieldCallbacks;for(var key in fieldCallbacks)fieldCallbacks[key](this.valueOf())},valueOf:function(){return this}});return X3DField});define("cobweb/InputOutput/Generator",["jquery"],function($){return{indent:"",indentChar:"  ",Indent:function(){return this.indent},IncIndent:function(){this.indent+=this.indentChar},DecIndent:function(){this.indent=this.indent.substr(0,this.indent.length-this.indentChar.length)}}});define("cobweb/Basic/X3DArrayField",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants","cobweb/InputOutput/Generator"],function($,X3DField,X3DConstants,Generator){var handler={get:function(target,key){try{if(key in target)return target[key];var array=target.getValue();if(key>=array.length)target.resize(key+1);return array[key].valueOf()}catch(error){console.log(target,key,error)}},set:function(target,key,value){try{if(key in target){target[key]=value;return true}var array=target.getValue(),index=parseInt(key);if(index>=array.length)target.resize(index+1);array[index].setValue(value);return true}catch(error){console.log(target,key,error);return false}},has:function(target,key){return key in target.getValue()},enumerate:function(target){var array=target.getValue(),keys=[];for(var i=0,length=array.length;i<length;++i)keys.push(i);return keys[Symbol.iterator]()}};function X3DArrayField(value){X3DField.call(this,[]);if(value[0]instanceof Array)value=value[0];for(var i=0,length=value.length;i<length;++i)this.push(value[i]);return new Proxy(this,handler)}X3DArrayField.prototype=$.extend(new X3DField([]),{constructor:X3DArrayField,copy:function(){var copy=new this.constructor,array=this.getValue();for(var i=0,length=array.length;i<length;++i)copy.push(array[i]);return copy},setValue:function(value){this.set(value instanceof X3DArrayField?value.getValue():value);this.addEvent()},set:function(value){this.resize(value.length,undefined,true);var array=this.getValue();for(var i=0,length=value.length;i<length;++i)array[i].set(value[i]instanceof X3DField?value[i].getValue():value[i])},unshift:function(value){var array=this.getValue(),field=new this.valueType_;field.setValue(value);field.addParent(this);this.addEvent();return array.unshift(field)},shift:function(){var array=this.getValue();if(array.length){var field=array.shift();field.removeParent(this);this.addEvent();return field.valueOf()}},push:function(value){var array=this.getValue(),field=new this.valueType_;field.setValue(value);field.addParent(this);this.addEvent();return array.push(field)},pop:function(){var array=this.getValue();if(array.length){var field=array.pop();field.removeParent(this);this.addEvent();return field.valueOf()}},insert:function(index,array,first,last){var args=[index,0];for(var i=first;i<last;++i){var field=new this.valueType_;field.setValue(array[i]);field.addParent(this);args.push(field)}Array.prototype.splice.apply(this.getValue(),args);this.addEvent()},erase:function(first,last){var values=this.getValue().splice(first,last-first);for(var i=0,length=values.length;i<length;++i)values[i].removeParent(this);this.addEvent()},resize:function(size,value,silent){var array=this.getValue();if(size<array.length){for(var i=size,length=array.length;i<length;++i)array[i].removeParent(this);array.length=size;if(!silent)this.addEvent()}else if(size>array.length){for(var i=array.length;i<size;++i){var field=new this.valueType_;if(value!==undefined)field.setValue(value);field.addParent(this);array.push(field)}if(!silent)this.addEvent()}},toString:function(){var array=this.getValue(),string="";switch(array.length){case 0:{string+="[ ]";break}case 1:{string+=array[0].toString();break}default:{string+="[\n";Generator.IncIndent();for(var i=0,length=array.length-1;i<length;++i){string+=Generator.Indent();string+=array[i].toString();string+=",\n"}string+=Generator.Indent();string+=array[length].toString();string+="\n";Generator.DecIndent();string+=Generator.Indent();string+="]";break}}return string}});Object.defineProperty(X3DArrayField.prototype,"length",{get:function(){return this.getValue().length},set:function(value){this.resize(value)},enumerable:false,configurable:false});return X3DArrayField});define("cobweb/Fields/SFBool",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){function SFBool(value){if(this instanceof SFBool)return X3DField.call(this,Boolean(value));return X3DField.call(Object.create(SFBool.prototype),Boolean(value))}SFBool.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFBool,copy:function(){return new SFBool(this.getValue())},set:function(value){X3DField.prototype.set.call(this,Boolean(value))},valueOf:function(){return this.getValue()},getTypeName:function(){return"SFBool"},getType:function(){return X3DConstants.SFBool},valueOf:X3DField.prototype.getValue,toString:function(){return this.getValue()?"TRUE":"FALSE"}});return SFBool});define("standard/Math/Algorithm",["require"],function(Vector3){var Algorithm={radians:function(value){return value*(Math.PI/180)},degrees:function(value){return value*(180/Math.PI)},clamp:function(value,min,max){return value<min?min:value>max?max:value},interval:function(value,low,high){if(value>=high)return(value-low)%(high-low)+low;if(value<low)return(value-high)%(high-low)+high;return value},lerp:function(source,destination,t){return source+t*(destination-source)},slerp:function(source,destination,t){var cosom=source.dot(destination);if(cosom<=-1)throw new Error("slerp is not possible: vectors are inverse collinear.");if(cosom>=1)return source;if(cosom<0){cosom=-cosom;destination.negate()}var omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega),scale1=Math.sin(t*omega);return source.multiply(scale0).add(destination.multiply(scale1)).divide(sinom)},isPowerOfTwo:function(n){return(n-1&n)===0},nextPowerOfTwo:function(n){--n;for(var k=1;!(k&1<<4+1);k<<=1)n|=n>>k;return++n},less:function(lhs,rhs){return lhs<rhs},greater:function(lhs,rhs){return lhs>rhs},lowerBound:function(array,first,last,value,comp){var index=0,step=0,count=last-first;while(count>0){step=count>>>1;index=first+step;if(comp(array[index],value)){first=++index;count-=step+1}else count=step}return first},upperBound:function(array,first,last,value,comp){var index=0,step=0,count=last-first;while(count>0){step=count>>>1;index=first+step;if(comp(value,array[index]))count=step;else{first=++index;count-=step+1}}return first},set_difference:function(lhs,rhs,result){for(var key in lhs){if(key in rhs)continue;result[key]=lhs[key]}return result}};Object.preventExtensions(Algorithm);Object.freeze(Algorithm);Object.seal(Algorithm);return Algorithm});define("standard/Math/Numbers/Color3",["jquery","standard/Math/Algorithm"],function($,Algorithm){var clamp=Algorithm.clamp;function Color3(r,g,b){if(arguments.length){this.r_=clamp(r,0,1);this.g_=clamp(g,0,1);this.b_=clamp(b,0,1)}else{this.r_=0;this.g_=0;this.b_=0}}$.extend(Color3,{HSV:function(h,s,v){var color=new Color3;color.setHSV(h,s,v);return color}});Color3.prototype={constructor:Color3,length:3,copy:function(){var copy=Object.create(Color3.prototype);copy.r_=this.r_;copy.g_=this.g_;copy.b_=this.b_;return copy},assign:function(color){this.r_=color.r_;this.g_=color.g_;this.b_=color.b_},set:function(r,g,b){this.r_=clamp(r,0,1);this.g_=clamp(g,0,1);this.b_=clamp(b,0,1)},equals:function(color){return this.r_===vector.r_&&this.g_===vector.g_&&this.b_===vector.b_},getHSV:function(){var h,s,v;var min=Math.min(this.r_,this.g_,this.b_);var max=Math.max(this.r_,this.g_,this.b_);v=max;var delta=max-min;if(max!==0&&delta!==0){s=delta/max;if(this.r_===max)h=(this.g_-this.b_)/delta;else if(this.g_===max)h=2+(this.b_-this.r_)/delta;else h=4+(this.r_-this.g_)/delta;h*=Math.PI/3;if(h<0)h+=Math.PI*2}else s=h=0;return[h,s,v]},setHSV:function(h,s,v){s=clamp(s,0,1),v=clamp(v,0,1);if(s===0){this.r_=this.g_=this.b_=v}else{var w=Algorithm.degrees(Algorithm.interval(h,0,Math.PI*2))/60;var i=Math.floor(w);var f=w-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));switch(i%6){case 0:this.r_=v;this.g_=t;this.b_=p;break;case 1:this.r_=q;this.g_=v;this.b_=p;break;case 2:this.r_=p;this.g_=v;this.b_=t;break;case 3:this.r_=p;this.g_=q;this.b_=v;break;case 4:this.r_=t;this.g_=p;this.b_=v;break;default:this.r_=v;this.g_=p;this.b_=q;break}}},toString:function(){return this.r_+" "+this.g_+" "+this.b_}};Object.defineProperty(Color3.prototype,"r",{get:function(){return this.r_},set:function(value){this.r_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color3.prototype,"0",{get:function(){return this.r_},set:function(value){this.r_=clamp(value,0,1)},enumerable:false,configurable:false});Object.defineProperty(Color3.prototype,"g",{get:function(){return this.g_},set:function(value){this.g_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color3.prototype,"1",{get:function(){return this.g_},set:function(value){this.g_=clamp(value,0,1)},enumerable:false,configurable:false});Object.defineProperty(Color3.prototype,"b",{get:function(){return this.b_},set:function(value){this.b_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color3.prototype,"2",{get:function(){return this.b_},set:function(value){this.b_=clamp(value,0,1)},enumerable:false,configurable:false});$.extend(Color3,{HSV:function(h,s,v){var color=new Color3(0,0,0);color.setHSV(h,s,v);return color},lerp:function(a,b,t,r){var range=Math.abs(b[0]-a[0]);if(range<=Math.PI){r[0]=Algorithm.lerp(a[0],b[0],t);r[1]=Algorithm.lerp(a[1],b[1],t);r[2]=Algorithm.lerp(a[2],b[2],t);return r}var PI2=Math.PI*2,step=(PI2-range)*t;h=a[0]<b[0]?a[0]-step:a[0]+step;if(h<0)h+=PI2;else if(h>PI2)h-=PI2;r[0]=h;r[1]=Algorithm.lerp(a[1],b[1],t);r[2]=Algorithm.lerp(a[2],b[2],t);return r}});return Color3});define("cobweb/Fields/SFColor",["jquery","standard/Math/Numbers/Color3","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,Color3,X3DField,X3DConstants){function SFColor(r,g,b){if(this instanceof SFColor){if(arguments.length){if(arguments[0]instanceof Color3)return X3DField.call(this,arguments[0]);else return X3DField.call(this,new Color3(+r,+g,+b))}return X3DField.call(this,new Color3)}return SFColor.apply(Object.create(SFColor.prototype),arguments)}SFColor.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFColor,copy:function(){return new SFColor(this.getValue().copy())},getTypeName:function(){return"SFColor"},getType:function(){return X3DConstants.SFColor},equals:function(color){return this.getValue().equals(color.getValue())},set:function(value){this.getValue().assign(value)},getHSV:function(){return this.getValue().getHSV()},setHSV:function(h,s,v){this.getValue().setHSV(h,s,v);this.addEvent()},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFColor.prototype,"r",{get:function(){return this.getValue().r},set:function(value){this.getValue().r=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColor.prototype,"0",{get:function(){return this.getValue().r},set:function(value){this.getValue().r=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFColor.prototype,"g",{get:function(){return this.getValue().g},set:function(value){this.getValue().g=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColor.prototype,"1",{get:function(){return this.getValue().g},set:function(value){this.getValue().g=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFColor.prototype,"b",{get:function(){return this.getValue().b},set:function(value){this.getValue().b=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColor.prototype,"2",{get:function(){return this.getValue().b},set:function(value){this.getValue().b=value;this.addEvent()},enumerable:false,configurable:false});return SFColor});define("standard/Math/Numbers/Color4",["jquery","standard/Math/Algorithm"],function($,Algorithm){var clamp=Algorithm.clamp;function Color4(r,g,b,a){if(arguments.length){this.r_=clamp(r,0,1);this.g_=clamp(g,0,1);this.b_=clamp(b,0,1);this.a_=clamp(a,0,1)}else{this.r_=0;this.g_=0;this.b_=0;this.a_=0}}$.extend(Color4,{HSVA:function(h,s,v,a){var color=new Color3(0,0,0,a);color.setHSV(h,s,v);return color}});Color4.prototype={constructor:Color4,length:4,copy:function(){var copy=Object.create(Color4.prototype);copy.r_=this.r_;copy.g_=this.g_;copy.b_=this.b_;copy.a_=this.a_;return copy},assign:function(color){this.r_=color.r_;this.g_=color.g_;this.b_=color.b_;this.a_=color.a_},set:function(r,g,b,a){this.r_=clamp(r,0,1);this.g_=clamp(g,0,1);this.b_=clamp(b,0,1);this.a_=clamp(a,0,1)},equals:function(color){return this.r_===color.r_&&this.g_===color.g_&&this.b_===color.b_&&this.a_===color.a_},getHSV:function(){var h,s,v;var min=Math.min(this.r_,this.g_,this.b_);var max=Math.max(this.r_,this.g_,this.b_);v=max;var delta=max-min;if(max!==0&&delta!==0){s=delta/max;if(this.r===max)h=(this.g_-this.b_)/delta;else if(this.g_==max)h=2+(this.b_-this.r_)/delta;else h=4+(this.r_-this.g_)/delta;h*=Math.PI/3;if(h<0)h+=Math.PI*2}else s=h=0;return[h,s,v]},setHSV:function(h,s,v){s=clamp(s,0,1),v=clamp(v,0,1);if(s===0){this.r_=this.g_=this.b_=v}else{var w=Algorithm.degrees(Algorithm.interval(h,0,Math.PI*2))/60;var i=Math.floor(w);var f=w-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));switch(i%6){case 0:this.r_=v;this.g_=t;this.b_=p;break;case 1:this.r_=q;this.g_=v;this.b_=p;break;case 2:this.r_=p;this.g_=v;this.b_=t;break;case 3:this.r_=p;this.g_=q;this.b_=v;break;case 4:this.r_=t;this.g_=p;this.b_=v;break;default:this.r_=v;this.g_=p;this.b_=q;break}}},toString:function(){return this.r_+" "+this.g_+" "+this.b_+" "+this.a_}};Object.defineProperty(Color4.prototype,"r",{get:function(){return this.r_},set:function(value){this.r_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color4.prototype,"0",{get:function(){return this.r_},set:function(value){this.r_=clamp(value,0,1)},enumerable:false,configurable:false});Object.defineProperty(Color4.prototype,"g",{get:function(){return this.g_},set:function(value){this.g_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color4.prototype,"1",{get:function(){return this.g_},set:function(value){this.g_=clamp(value,0,1)},enumerable:false,configurable:false});Object.defineProperty(Color4.prototype,"b",{get:function(){return this.b_},set:function(value){this.b_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color4.prototype,"2",{get:function(){return this.b_},set:function(value){this.b_=clamp(value,0,1)},enumerable:false,configurable:false});Object.defineProperty(Color4.prototype,"a",{get:function(){return this.a_},set:function(value){this.a_=clamp(value,0,1)},enumerable:true,configurable:false});Object.defineProperty(Color4.prototype,"3",{get:function(){return this.a_},set:function(value){this.a_=clamp(value,0,1)},enumerable:false,configurable:false});Color4.HSVA=function(h,s,v,a){var color=new Color4(0,0,0,a);color.setHSV(h,s,v);return color};return Color4});define("cobweb/Fields/SFColorRGBA",["jquery","standard/Math/Numbers/Color4","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,Color4,X3DField,X3DConstants){function SFColorRGBA(r,g,b,a){if(this instanceof SFColorRGBA){if(arguments.length){if(arguments[0]instanceof Color4)return X3DField.call(this,arguments[0]);else return X3DField.call(this,new Color4(+r,+g,+b,+a))}return X3DField.call(this,new Color4)}return SFColorRGBA.apply(Object.create(SFColorRGBA.prototype),arguments)}SFColorRGBA.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFColorRGBA,copy:function(){return new SFColorRGBA(this.getValue().copy())},getTypeName:function(){return"SFColorRGBA"},getType:function(){return X3DConstants.SFColorRGBA},equals:function(color){return this.getValue().equals(color.getValue())},set:function(value){this.getValue().assign(value)},getHSV:function(){return this.getValue().getHSV()},setHSV:function(h,s,v){this.getValue().setHSV(h,s,v);this.addEvent()},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFColorRGBA.prototype,"r",{get:function(){return this.getValue().r},set:function(value){this.getValue().r=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"0",{get:function(){return this.getValue().r},set:function(value){this.getValue().r=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"g",{get:function(){return this.getValue().g},set:function(value){this.getValue().g=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"1",{get:function(){return this.getValue().g},set:function(value){this.getValue().g=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"b",{get:function(){return this.getValue().b},set:function(value){this.getValue().b=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"2",{get:function(){return this.getValue().b},set:function(value){this.getValue().b=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"a",{get:function(){return this.getValue().a},set:function(value){this.getValue().a=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFColorRGBA.prototype,"3",{get:function(){return this.getValue().a},set:function(value){this.getValue().a=value;this.addEvent()},enumerable:false,configurable:false});return SFColorRGBA});define("cobweb/Fields/SFDouble",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){function SFDouble(value){if(this instanceof SFDouble)return X3DField.call(this,arguments.length?+value:0);return X3DField.call(Object.create(SFDouble.prototype),arguments.length?+value:0)}SFDouble.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFDouble,copy:function(){return new SFDouble(this.getValue())},getTypeName:function(){return"SFDouble"},getType:function(){return X3DConstants.SFDouble},set:function(value){X3DField.prototype.set.call(this,+value)},valueOf:X3DField.prototype.getValue,toString:function(){return String(this.getValue())}});return SFDouble});define("cobweb/Fields/SFFloat",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){function SFFloat(value){if(this instanceof SFFloat)return X3DField.call(this,arguments.length?+value:0);return X3DField.call(Object.create(SFFloat.prototype),arguments.length?+value:0)}SFFloat.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFFloat,copy:function(){return new SFFloat(this.getValue())},getTypeName:function(){return"SFFloat"},getType:function(){return X3DConstants.SFFloat},set:function(value){X3DField.prototype.set.call(this,+value)},valueOf:X3DField.prototype.getValue,toString:function(){return String(this.getValue())}});return SFFloat});define("cobweb/Fields/SFInt32",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){function SFInt32(value){if(this instanceof SFInt32)return X3DField.call(this,~~value);return X3DField.call(Object.create(SFInt32.prototype),~~value)}SFInt32.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFInt32,copy:function(){return new SFInt32(this.getValue())},getTypeName:function(){return"SFInt32"},getType:function(){return X3DConstants.SFInt32},set:function(value){X3DField.prototype.set.call(this,~~value)},valueOf:X3DField.prototype.getValue,toString:function(){return String(this.getValue())}});return SFInt32});define("standard/Math/Numbers/Vector2",["jquery","standard/Math/Algorithm"],function($,Algorithm){function Vector2(x,y){this.x=x;this.y=y}Vector2.prototype={constructor:Vector2,length:2,copy:function(){var copy=Object.create(Vector2.prototype);copy.x=this.x;copy.y=this.y;return copy},assign:function(vector){this.x=vector.x;this.y=vector.y;return this},set:function(x,y){this.x=x;this.y=y;return this},equals:function(vector){return this.x===vector.x&&this.y===vector.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},add:function(vector){this.x+=vector.x;this.y+=vector.y;return this},subtract:function(vector){this.x-=vector.x;this.y-=vector.y;return this},multiply:function(value){this.x*=value;this.y*=value;return this},multVec:function(vector){this.x*=vector.x;this.y*=vector.y;return this},divide:function(value){this.x/=value;this.y/=value;return this},divVec:function(vector){this.x/=vector.x;this.y/=vector.y;return this},normalize:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y);if(length){length=1/length;this.x*=length;this.y*=length}return this},dot:function(vector){return this.x*vector.x+this.y*vector.y},norm:function(){return this.x*this.x+this.y*this.y},abs:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lerp:function(dest,t){this.x=Algorithm.lerp(this.x,dest.x,t);this.y=Algorithm.lerp(this.y,dest.y,t);return this},min:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.min(this.x,vector.x);this.y=Math.min(this.y,vector.y)}return this},max:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.max(this.x,vector.x);this.y=Math.max(this.y,vector.y)}return this},toString:function(){return this.x+" "+this.y}};Object.defineProperty(Vector2.prototype,"0",{get:function(){return this.x},set:function(value){this.x=value},enumerable:false,configurable:false});Object.defineProperty(Vector2.prototype,"1",{get:function(){return this.y},set:function(value){this.y=value},enumerable:false,configurable:false});$.extend(Vector2,{Zero:new Vector2(0,0),One:new Vector2(1,1),negate:function(vector){var copy=Object.create(this.prototype);copy.x=-vector.x;copy.y=-vector.y;return copy},add:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x+rhs.x;copy.y=lhs.y+rhs.y;return copy},subtract:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x-rhs.x;copy.y=lhs.y-rhs.y;return copy},multiply:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs;copy.y=lhs.y*rhs;return copy},multVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs.x;copy.y=lhs.y*rhs.y;return copy},divide:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs;copy.y=lhs.y/rhs;return copy},divVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs.x;copy.y=lhs.y/rhs.y;return copy},normalize:function(vector){var copy=Object.create(this.prototype),x=vector.x,y=vector.y,length=Math.sqrt(x*x+y*y);if(length){length=1/length;copy.x=x*length;copy.y=y*length}else{copy.x=0;copy.y=0}return copy},dot:function(lhs,rhs){return lhs.dot(rhs)},lerp:function(source,dest,t){return new Vector2(Algorithm.lerp(source.x,dest.x,t),Algorithm.lerp(source.y,dest.y,t))},min:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.min(x,vector.x);y=Math.min(y,vector.y)}return new Vector2(x,y)},max:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.max(x,vector.x);y=Math.max(y,vector.y)}return new Vector2(x,y)}});return Vector2});define("cobweb/Fields/SFVec2",["jquery","standard/Math/Numbers/Vector2","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,Vector2,X3DField,X3DConstants){function SFVec2(v){if(v.length){if(v[0]instanceof Vector2)return X3DField.call(this,v[0]);return X3DField.call(this,new Vector2(+v[0],+v[1]))}return X3DField.call(this,new Vector2(0,0))}SFVec2.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFVec2,copy:function(){return new this.constructor(this.getValue().copy())},equals:function(vector){return this.getValue().equals(vector.getValue())},set:function(value){this.getValue().assign(value)},negate:function(){return new this.constructor(Vector2.negate(this.getValue().copy()))},add:function(vector){return new this.constructor(Vector2.add(this.getValue(),vector.getValue()))},subtract:function(vector){return new this.constructor(Vector2.subtract(this.getValue(),vector.getValue()))},multiply:function(value){return new this.constructor(Vector2.multiply(this.getValue(),value))},divide:function(value){return new this.constructor(Vector2.divide(this.getValue(),value))},dot:function(vector){return new this.constructor(this.getValue().dot(vector.getValue()))},normalize:function(vector){return new this.constructor(Vector2.normalize(this.getValue()))},length:function(vector){return new this.constructor(this.getValue().abs())},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFVec2.prototype,"x",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec2.prototype,"0",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec2.prototype,"y",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec2.prototype,"1",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:false,configurable:false});function SFVec2d(x,y){if(this instanceof SFVec2d)return SFVec2.call(this,arguments);return SFVec2.call(Object.create(SFVec2d.prototype),arguments)}SFVec2d.prototype=$.extend(Object.create(SFVec2.prototype),{constructor:SFVec2d,getTypeName:function(){return"SFVec2d"},getType:function(){return X3DConstants.SFVec2d}});function SFVec2f(x,y){if(this instanceof SFVec2f)return SFVec2.call(this,arguments);return SFVec2.call(Object.create(SFVec2f.prototype),arguments)}SFVec2f.prototype=$.extend(Object.create(SFVec2.prototype),{constructor:SFVec2f,getTypeName:function(){return"SFVec2f"},getType:function(){return X3DConstants.SFVec2f}});return{SFVec2d:SFVec2d,SFVec2f:SFVec2f}});define("standard/Math/Numbers/Vector3",["jquery","standard/Math/Algorithm"],function($,Algorithm){function Vector3(x,y,z){this.x=x;this.y=y;this.z=z}Vector3.prototype={constructor:Vector3,length:3,copy:function(){var copy=Object.create(Vector3.prototype);copy.x=this.x;copy.y=this.y;copy.z=this.z;return copy},assign:function(vector){this.x=vector.x;this.y=vector.y;this.z=vector.z;return this},set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},equals:function(vector){return this.x===vector.x&&this.y===vector.y&&this.z===vector.z},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},add:function(vector){this.x+=vector.x;this.y+=vector.y;this.z+=vector.z;return this},subtract:function(vector){this.x-=vector.x;this.y-=vector.y;this.z-=vector.z;return this},multiply:function(value){this.x*=value;this.y*=value;this.z*=value;return this},multVec:function(vector){this.x*=vector.x;this.y*=vector.y;this.z*=vector.z;return this},divide:function(value){this.x/=value;this.y/=value;this.z/=value;return this},divVec:function(vector){this.x/=vector.x;this.y/=vector.y;this.z/=vector.z;return this},cross:function(vector){var x=this.x,y=this.y,z=this.z;this.x=y*vector.z-z*vector.y;this.y=z*vector.x-x*vector.z;this.z=x*vector.y-y*vector.x;return this},normalize:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(length){length=1/length;this.x*=length;this.y*=length;this.z*=length}return this},dot:function(vector){return this.x*vector.x+this.y*vector.y+this.z*vector.z},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z},abs:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)
},lerp:function(dest,t){this.x=Algorithm.lerp(this.x,dest.x,t);this.y=Algorithm.lerp(this.y,dest.y,t);this.z=Algorithm.lerp(this.z,dest.z,t);return this},slerp:function(destination,t){return Algorithm.slerp(this,tmp.assign(destination),t)},min:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.min(this.x,vector.x);this.y=Math.min(this.y,vector.y);this.z=Math.min(this.z,vector.z)}return this},max:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.max(this.x,vector.x);this.y=Math.max(this.y,vector.y);this.z=Math.max(this.z,vector.z)}return this},toString:function(){return this.x+" "+this.y+" "+this.z}};Object.defineProperty(Vector3.prototype,"0",{get:function(){return this.x},set:function(value){this.x=value},enumerable:false,configurable:false});Object.defineProperty(Vector3.prototype,"1",{get:function(){return this.y},set:function(value){this.y=value},enumerable:false,configurable:false});Object.defineProperty(Vector3.prototype,"2",{get:function(){return this.z},set:function(value){this.z=value},enumerable:false,configurable:false});$.extend(Vector3,{Zero:new Vector3(0,0,0),One:new Vector3(1,1,1),negate:function(vector){var copy=Object.create(this.prototype);copy.x=-vector.x;copy.y=-vector.y;copy.z=-vector.z;return copy},add:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x+rhs.x;copy.y=lhs.y+rhs.y;copy.z=lhs.z+rhs.z;return copy},subtract:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x-rhs.x;copy.y=lhs.y-rhs.y;copy.z=lhs.z-rhs.z;return copy},multiply:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs;copy.y=lhs.y*rhs;copy.z=lhs.z*rhs;return copy},multVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs.x;copy.y=lhs.y*rhs.y;copy.z=lhs.z*rhs.z;return copy},divide:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs;copy.y=lhs.y/rhs;copy.z=lhs.z/rhs;return copy},divVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs.x;copy.y=lhs.y/rhs.y;copy.z=lhs.z/rhs.z;return copy},cross:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.y*rhs.z-lhs.z*rhs.y;copy.y=lhs.z*rhs.x-lhs.x*rhs.z;copy.z=lhs.x*rhs.y-lhs.y*rhs.x;return copy},normalize:function(vector){var copy=Object.create(this.prototype),x=vector.x,y=vector.y,z=vector.z,length=Math.sqrt(x*x+y*y+z*z);if(length){length=1/length;copy.x=x*length;copy.y=y*length;copy.z=z*length}else{copy.x=0;copy.y=0;copy.z=0}return copy},dot:function(lhs,rhs){return lhs.dot(rhs)},lerp:function(source,dest,t){return new Vector3(Algorithm.lerp(source.x,dest.x,t),Algorithm.lerp(source.y,dest.y,t),Algorithm.lerp(source.z,dest.z,t))},slerp:function(source,destination,t){return Algorithm.slerp(source.copy(),tmp.assign(destination),t)},min:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y,z=arguments[0].z;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.min(x,vector.x);y=Math.min(y,vector.y);z=Math.min(z,vector.z)}return new Vector3(x,y,z)},max:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y,z=arguments[0].z;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.max(x,vector.x);y=Math.max(y,vector.y);z=Math.max(z,vector.z)}return new Vector3(x,y,z)}});var tmp=new Vector3(0,0,0);return Vector3});define("standard/Math/Numbers/Matrix2",["jquery","standard/Math/Algorithm"],function($,Algorithm){function Matrix2(){if(arguments.length){this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3]}else this.identity()}Matrix2.prototype={constructor:Matrix2,order:2,length:4,copy:function(){var copy=Object.create(Matrix2.prototype);copy[0]=this[0];copy[1]=this[1];copy[2]=this[2];copy[3]=this[3];return copy},assign:function(matrix){this[0]=matrix[0];this[1]=matrix[1];this[2]=matrix[2];this[3]=matrix[3]},equals:function(matrix){return this[0]===matrix[0]&&this[1]===matrix[1]&&this[2]===matrix[2]&&this[3]===matrix[3]},set1:function(r,c,value){this[r*this.order+c]=value},get1:function(r,c){return this[r*this.order+c]},set:function(){switch(arguments.length){case 0:{this.identity();break}case 4:{this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3];break}}},identity:function(){this[0]=1;this[1]=0;this[2]=0;this[3]=1},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]}};Object.defineProperty(Matrix2.prototype,"x",{get:function(){return this[0]},enumerable:false,configurable:false});Object.defineProperty(Matrix2.prototype,"origin",{get:function(){return nthis[2]},enumerable:false,configurable:false});Object.defineProperty(Matrix2.prototype,"submatrix",{get:function(){return this.value[0]},enumerable:false,configurable:false});$.extend(Matrix2,{Identity:new Matrix2});return Matrix2});define("standard/Math/Algorithms/eigendecomposition",[],function(){return function(matrix){var ORDER=matrix.order,values=new Array(ORDER),vectors=new Array(ORDER);var sm;var theta;var c,s,t;var tau;var h,g;var thresh;var a=new Array(ORDER);var b=new Array(ORDER);var z=new Array(ORDER);var p,q,i,j;var SIZE=matrix.length;for(i=0;i<ORDER;++i){vectors[i]=new Array(ORDER);a[i]=new Array(ORDER);b[i]=values[i]=matrix.get1(i,i);z[i]=0;for(j=0;j<ORDER;++j){vectors[i][j]=i===j?1:0;a[i][j]=matrix.get1(j,i)}}for(i=0;i<50;++i){sm=0;for(p=0;p<ORDER-1;++p)for(q=p+1;q<ORDER;++q)sm+=Math.abs(a[p][q]);if(sm===0)break;thresh=i<3?.2*sm/SIZE:0;for(p=0;p<ORDER-1;++p){for(q=p+1;q<ORDER;++q){g=100*Math.abs(a[p][q]);if(i>3&&Math.abs(values[p])+g===Math.abs(values[p])&&Math.abs(values[q])+g===Math.abs(values[q])){a[p][q]=0}else if(Math.abs(a[p][q])>thresh){h=values[q]-values[p];if(Math.abs(h)+g===Math.abs(h))t=a[p][q]/h;else{theta=.5*h/a[p][q];t=1/(Math.abs(theta)+Math.sqrt(1+theta*theta));if(theta<0)t=-t}c=1/Math.sqrt(1+t*t);s=t*c;tau=s/(1+c);h=t*a[p][q];z[p]-=h;z[q]+=h;values[p]-=h;values[q]+=h;a[p][q]=0;for(j=0;j<p;++j){g=a[j][p];h=a[j][q];a[j][p]=g-s*(h+g*tau);a[j][q]=h+s*(g-h*tau)}for(j=p+1;j<q;++j){g=a[p][j];h=a[j][q];a[p][j]=g-s*(h+g*tau);a[j][q]=h+s*(g-h*tau)}for(j=q+1;j<ORDER;++j){g=a[p][j];h=a[q][j];a[p][j]=g-s*(h+g*tau);a[q][j]=h+s*(g-h*tau)}for(j=0;j<ORDER;++j){g=vectors[j][p];h=vectors[j][q];vectors[j][p]=g-s*(h+g*tau);vectors[j][q]=h+s*(g-h*tau)}}}}for(p=0;p<ORDER;++p){values[p]=b[p]+=z[p];z[p]=0}}return{values:values,vectors:vectors}}});define("standard/Math/Numbers/Matrix3",["jquery","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix2","standard/Math/Algorithms/eigendecomposition"],function($,Vector2,Vector3,Matrix2,eigendecomposition){var dummyTranslation=new Vector2(0,0),dummyRotation=new Vector3(0,0,0),dummyScale=new Vector2(0,0),dummyScaleOrientation=new Vector3(0,0,0),dummyCenter=new Vector2(0,0);function Matrix3(){if(arguments.length){this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3];this[4]=arguments[4];this[5]=arguments[5];this[6]=arguments[6];this[7]=arguments[7];this[8]=arguments[8]}else this.identity()}Matrix3.prototype={constructor:Matrix3,order:3,length:9,copy:function(){var copy=Object.create(Matrix3.prototype);copy[0]=this[0];copy[1]=this[1];copy[2]=this[2];copy[3]=this[3];copy[4]=this[4];copy[5]=this[5];copy[6]=this[6];copy[7]=this[7];copy[8]=this[8];return copy},assign:function(matrix){this[0]=matrix[0];this[1]=matrix[1];this[2]=matrix[2];this[3]=matrix[3];this[4]=matrix[4];this[5]=matrix[5];this[6]=matrix[6];this[7]=matrix[7];this[8]=matrix[8];return this},equals:function(matrix){return this[0]===matrix[0]&&this[1]===matrix[1]&&this[2]===matrix[2]&&this[3]===matrix[3]&&this[4]===matrix[4]&&this[5]===matrix[5]&&this[6]===matrix[6]&&this[7]===matrix[7]&&this[8]===matrix[8]},rotation:function(){return math.atan2(this[1],this[0])},set1:function(r,c,value){this[r*this.order+c]=value;return this},get1:function(r,c){return this[r*this.order+c]},set:function(translation,rotation,scale,scaleOrientation,center){switch(arguments.length){case 0:{this.identity();break}case 1:{if(translation===null)translation=Vector2.Zero;this.identity();this.translate(translation);break}case 2:{if(translation===null)translation=Vector2.Zero;if(rotation===null)rotation=Vector3.Zero;this.identity();this.translate(translation);if(rotation[2]!==0)this.rotate(rotation[2]);break}case 3:{if(translation===null)translation=Vector2.Zero;if(rotation===null)rotation=Vector3.Zero;if(scale===null)scale=Vector2.One;this.identity();this.translate(translation);if(rotation[2]!==0)this.rotate(rotation[2]);if(!scale.equals(Vector2.One))this.scale(scale);break}case 4:{if(translation===null)translation=Vector2.Zero;if(rotation===null)rotation=Vector3.Zero;if(scale===null)scale=Vector2.One;if(scaleOrientation===null)scaleOrientation=Vector3.Zero;this.identity();this.translate(translation);if(rotation[2]!==0)this.rotate(rotation[2]);if(!scale.equals(Vector2.One)){var hasScaleOrientation=scaleOrientation[2]!==0;if(hasScaleOrientation){this.rotate(scaleOrientation[2]);this.scale(scale);this.rotate(-scaleOrientation[2])}else this.scale(scale)}break}case 5:{if(translation===null)translation=Vector2.Zero;if(rotation===null)rotation=Vector3.Zero;if(scale===null)scale=Vector2.One;if(scaleOrientation===null)scaleOrientation=Vector3.Zero;if(center===null)center=Vector2.Zero;this.identity();this.translate(translation);var hasCenter=!center.equals(Vector2.Zero);if(hasCenter)this.translate(center);if(rotation[2]!==0)this.rotate(rotation[2]);if(!scale.equals(Vector2.One)){if(scaleOrientation[2]!==0){this.rotate(scaleOrientation[2]);this.scale(scale);this.rotate(-scaleOrientation[2])}else this.scale(scale)}if(hasCenter)this.translate(Vector2.negate(center));break}case 9:{this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3];this[4]=arguments[4];this[5]=arguments[5];this[6]=arguments[6];this[7]=arguments[7];this[8]=arguments[8];break}}return this},get:function(translation,rotation,scale,scaleOrientation,center){if(translation===null)translation=dummyTranslation;if(rotation===null)rotation=dummyRotation;if(scale===null)scale=dummyScale;if(scaleOrientation===null)scaleOrientation=dummyScaleOrientation;if(center===null)center=dummyCenter},determinant2:function(){return this[0]*this[4]-this[1]*this[3]},determinant:function(){var m0=this[0],m1=this[1],m2=this[2],m3=this[3],m4=this[4],m5=this[5],m6=this[6],m7=this[7],m8=this[8];return m0*(m4*m8-m5*m7)-m1*(m3*m8-m5*m6)+m2*(m3*m7-m4*m6)},transpose:function(){var tmp;tmp=this[1];this[1]=this[3];this[3]=tmp;tmp=this[2];this[2]=this[6];this[6]=tmp;tmp=this[5];this[5]=this[7];this[7]=tmp;return this},inverse:function(){var m0=this[0],m1=this[1],m2=this[2],m3=this[3],m4=this[4],m5=this[5],m6=this[6],m7=this[7],m8=this[8],t4=m0*m4,t6=m0*m7,t8=m3*m1,t10=m3*m7,t12=m6*m1,t14=m6*m4;var d=t4*m8-t6*m5-t8*m8+t10*m2+t12*m5-t14*m2;if(d===0)throw new Error("Matrix3 .inverse: determinant is 0.");d=1/d;var b0=(m4*m8-m7*m5)*d,b1=-(m1*m8-m7*m2)*d,b2=(m1*m5-m4*m2)*d,b3=-(m3*m8-m6*m5)*d,b4=(m0*m8-m6*m2)*d,b5=-(m0*m5-m3*m2)*d;this[0]=b0;this[1]=b1;this[2]=b2;this[3]=b3;this[4]=b4;this[5]=b5;this[6]=(t10-t14)*d;this[7]=-(t6-t12)*d;this[8]=(t4-t8)*d;return this},multLeft:function(matrix){var a0=this[0],a1=this[1],a2=this[2],a3=this[3],a4=this[4],a5=this[5],a6=this[6],a7=this[7],a8=this[8],b0=matrix[0],b1=matrix[1],b2=matrix[2],b3=matrix[3],b4=matrix[4],b5=matrix[5],b6=matrix[6],b7=matrix[7],b8=matrix[8];this[0]=a0*b0+a3*b1+a6*b2;this[1]=a1*b0+a4*b1+a7*b2;this[2]=a2*b0+a5*b1+a8*b2;this[3]=a0*b3+a3*b4+a6*b5;this[4]=a1*b3+a4*b4+a7*b5;this[5]=a2*b3+a5*b4+a8*b5;this[6]=a0*b6+a3*b7+a6*b8;this[7]=a1*b6+a4*b7+a7*b8;this[8]=a2*b6+a5*b7+a8*b8;return this},multRight:function(matrix){var a0=this[0],a1=this[1],a2=this[2],a3=this[3],a4=this[4],a5=this[5],a6=this[6],a7=this[7],a8=this[8],b0=matrix[0],b1=matrix[1],b2=matrix[2],b3=matrix[3],b4=matrix[4],b5=matrix[5],b6=matrix[6],b7=matrix[7],b8=matrix[8];this[0]=a0*b0+a1*b3+a2*b6;this[1]=a0*b1+a1*b4+a2*b7;this[2]=a0*b2+a1*b5+a2*b8;this[3]=a3*b0+a4*b3+a5*b6;this[4]=a3*b1+a4*b4+a5*b7;this[5]=a3*b2+a4*b5+a5*b8;this[6]=a6*b0+a7*b3+a8*b6;this[7]=a6*b1+a7*b4+a8*b7;this[8]=a6*b2+a7*b5+a8*b8;return this},multVecMatrix:function(vector){if(vector.length===2){var x=vector.x,y=vector.y,w=x*this[2]+y*this[5]+this[8];vector.x=(x*this[0]+y*this[3]+this[6])/w;vector.y=(x*this[1]+y*this[4]+this[7])/w;return vector}var x=vector.x,y=vector.y,z=vector.z;vector.x=x*this[0]+y*this[3]+z*this[6];vector.y=x*this[1]+y*this[4]+z*this[7];vector.z=x*this[2]+y*this[5]+z*this[8];return vector},multMatrixVec:function(vector){if(vector.length===2){var x=vector.x,y=vector.y,w=x*this[6]+y*this[7]+this[8];vector.x=(x*this[0]+y*this[1]+this[2])/w;vector.y=(x*this[3]+y*this[4]+this[5])/w;return vector}var x=vector.x,y=vector.y,z=vector.z;vector.x=x*this[0]+y*this[1]+z*this[2];vector.y=x*this[3]+y*this[4]+z*this[5];vector.z=x*this[6]+y*this[7]+z*this[8];return vector},multDirMatrix:function(vector){var x=vector.x,y=vector.y;vector.x=x*this[0]+y*this[3];vector.y=x*this[1]+y*this[4];return vector},multMatrixDir:function(vector){var x=vector.x,y=vector.y;vector.x=x*this[0]+y*this[1];vector.y=x*this[3]+y*this[4];return vector},identity:function(){this[0]=1;this[1]=0;this[2]=0;this[3]=0;this[4]=1;this[5]=0;this[6]=0;this[7]=0;this[8]=1},translate:function(translation){var x=translation.x,y=translation.y;this[6]+=this[0]*x+this[3]*y;this[7]+=this[1]*x+this[4]*y},rotate:function(rotation){this.multLeft(Matrix3.Rotation(rotation))},scale:function(scale){var x=scale.x,y=scale.y;this[0]*=x;this[3]*=y;this[1]*=x;this[4]*=y},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]}};Object.defineProperty(Matrix3.prototype,"x",{get:function(){return new Vector2(this[0],this[1])},enumerable:false,configurable:false});Object.defineProperty(Matrix3.prototype,"y",{get:function(){return new Vector2(this[3],this[4])},enumerable:false,configurable:false});Object.defineProperty(Matrix3.prototype,"origin",{get:function(){return new Vector2(this[6],this[7])},enumerable:false,configurable:false});Object.defineProperty(Matrix3.prototype,"submatrix",{get:function(){var matrix=Object.create(Matrix2.prototype);matrix[0]=this[0];matrix[1]=this[1];matrix[2]=this[3];matrix[3]=this[4];return matrix},enumerable:false,configurable:false});$.extend(Matrix3,{Identity:new Matrix3,Rotation:function(rotation){var sinAngle=Math.sin(rotation),cosAngle=Math.cos(rotation);return new Matrix3(cosAngle,sinAngle,0,-sinAngle,cosAngle,0,0,0,1)},Matrix2:function(matrix){return new Matrix3(matrix[0],matrix[1],0,matrix[2],matrix[3],0,0,0,1)},transpose:function(matrix){var copy=Object.create(this.prototype);copy[0]=matrix[0];copy[1]=matrix[3];copy[2]=matrix[6];copy[3]=matrix[1];copy[4]=matrix[4];copy[5]=matrix[7];copy[6]=matrix[2];copy[7]=matrix[5];copy[8]=matrix[8];return copy},inverse:function(matrix){var copy=Object.create(this.prototype),m0=matrix[0],m1=matrix[1],m2=matrix[2],m3=matrix[3],m4=matrix[4],m5=matrix[5],m6=matrix[6],m7=matrix[7],m8=matrix[8],t4=m0*m4,t6=m0*m7,t8=m3*m1,t10=m3*m7,t12=m6*m1,t14=m6*m4;var d=t4*m8-t6*m5-t8*m8+t10*m2+t12*m5-t14*m2;if(d===0)throw new Error("Matrix3 .inverse: determinant is 0.");d=1/d;var b0=(m4*m8-m7*m5)*d,b1=-(m1*m8-m7*m2)*d,b2=(m1*m5-m4*m2)*d,b3=-(m3*m8-m6*m5)*d,b4=(m0*m8-m6*m2)*d,b5=-(m0*m5-m3*m2)*d;copy[0]=b0;copy[1]=b1;copy[2]=b2;copy[3]=b3;copy[4]=b4;copy[5]=b5;copy[6]=(t10-t14)*d;copy[7]=-(t6-t12)*d;copy[8]=(t4-t8)*d;return copy},multLeft:function(lhs,rhs){var copy=Object.create(this.prototype),a0=lhs[0],a1=lhs[1],a2=lhs[2],a3=lhs[3],a4=lhs[4],a5=lhs[5],a6=lhs[6],a7=lhs[7],a8=lhs[8],b0=rhs[0],b1=rhs[1],b2=rhs[2],b3=rhs[3],b4=rhs[4],b5=rhs[5],b6=rhs[6],b7=rhs[7],b8=rhs[8];copy[0]=a0*b0+a3*b1+a6*b2;copy[1]=a1*b0+a4*b1+a7*b2;copy[2]=a2*b0+a5*b1+a8*b2;copy[3]=a0*b3+a3*b4+a6*b5;copy[4]=a1*b3+a4*b4+a7*b5;copy[5]=a2*b3+a5*b4+a8*b5;copy[6]=a0*b6+a3*b7+a6*b8;copy[7]=a1*b6+a4*b7+a7*b8;copy[8]=a2*b6+a5*b7+a8*b8;return copy},multRight:function(lhs,rhs){var copy=Object.create(this.prototype),a0=lhs[0],a1=lhs[1],a2=lhs[2],a3=lhs[3],a4=lhs[4],a5=lhs[5],a6=lhs[6],a7=lhs[7],a8=lhs[8],b0=rhs[0],b1=rhs[1],b2=rhs[2],b3=rhs[3],b4=rhs[4],b5=rhs[5],b6=rhs[6],b7=rhs[7],b8=rhs[8];copy[0]=a0*b0+a1*b3+a2*b6;copy[1]=a0*b1+a1*b4+a2*b7;copy[2]=a0*b2+a1*b5+a2*b8;copy[3]=a3*b0+a4*b3+a5*b6;copy[4]=a3*b1+a4*b4+a5*b7;copy[5]=a3*b2+a4*b5+a5*b8;copy[6]=a6*b0+a7*b3+a8*b6;copy[7]=a6*b1+a7*b4+a8*b7;copy[8]=a6*b2+a7*b5+a8*b8;return copy}});return Matrix3});define("cobweb/Fields/SFMatrix3",["jquery","cobweb/Basic/X3DField","cobweb/Fields/SFVec2","cobweb/Bits/X3DConstants","standard/Math/Numbers/Matrix3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,X3DField,SFVec2,X3DConstants,Matrix3,Vector2,Vector3){var SFVec2d=SFVec2.SFVec2d,SFVec2f=SFVec2.SFVec2f;function SFMatrix3(m){if(m.length){if(m[0]instanceof Matrix3)return X3DField.call(this,m[0]);return X3DField.call(this,new Matrix3(+m[0],+m[1],+m[2],+m[3],+m[4],+m[5],+m[6],+m[7],+m[8]))}return X3DField.call(this,new Matrix3)}SFMatrix3.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFMatrix3,copy:function(){return new this.constructor(this.getValue().copy())},equals:function(matrix){return this.getValue().equals(matrix.getValue())},set:function(value){this.getValue().assign(value)},setTransform:function(translation,rotation,scale,scaleOrientation,center){translation=translation?translation.getValue():Vector2.Zero;rotation=rotation?rotation.getValue():Vector3.Zero;scale=scale?scale.getValue():Vector2.One;scaleOrientation=scaleOrientation?scaleOrientation.getValue():Vector3.Zero;center=center?center.getValue():Vector2.Zero;this.getValue().set(translation,rotation,scale,scaleOrientation,center)},getTransform:function(translation,rotation,scale,scaleOrientation,center){translation=translation?translation.getValue():null;rotation=rotation?rotation.getValue():null;scale=scale?scale.getValue():null;scaleOrientation=scaleOrientation?scaleOrientation.getValue():null;center=center?center.getValue():null;this.getValue().get(translation,rotation,scale,scaleOrientation,center)},transpose:function(){return new this.constructor(Matrix3.transpose(this.getValue()))},inverse:function(){return new this.constructor(Matrix3.inverse(this.getValue()))},multLeft:function(matrix){return new this.constructor(Matrix3.multLeft(this.getValue(),matrix.getValue()))},multRight:function(matrix){return new this.constructor(Matrix3.multRight(this.getValue(),matrix.getValue()))},multVecMatrix:function(vector){return new this.Vector2(this.getValue().multVecMatrix(vector.getValue().copy()))},multMatrixVec:function(vector){return new this.Vector2(this.getValue().multMatrixVec(vector.getValue().copy()))},multDirMatrix:function(vector){return new this.Vector2(this.getValue().multDirMatrix(vector.getValue().copy()))},multMatrixDir:function(vector){return new this.Vector2(this.getValue().multMatrixDir(vector.getValue().copy()))},toString:function(){return this.getValue().toString()}});function defineProperty(i){Object.defineProperty(SFMatrix3.prototype,i,{get:function(){return this.getValue()[i]},set:function(value){this.getValue()[i]=value;this.addEvent()},enumerable:false,configurable:false})}for(var i=0;i<Matrix3.prototype.length;++i)defineProperty(i);function SFMatrix3d(m00,m01,m02,m10,m11,m12,m20,m21,m22){if(this instanceof SFMatrix3d)return SFMatrix3.call(this,arguments);return SFMatrix3.call(Object.create(SFMatrix3d.prototype),arguments)}SFMatrix3d.prototype=$.extend(Object.create(SFMatrix3.prototype),{constructor:SFMatrix3d,Vector2:SFVec2d,getTypeName:function(){return"SFMatrix3d"},getType:function(){return X3DConstants.SFMatrix3d}});function SFMatrix3f(m00,m01,m02,m10,m11,m12,m20,m21,m22){if(this instanceof SFMatrix3f)return SFMatrix3.call(this,arguments);return SFMatrix3.call(Object.create(SFMatrix3f.prototype),arguments)}SFMatrix3f.prototype=$.extend(Object.create(SFMatrix3.prototype),{constructor:SFMatrix3f,Vector2:SFVec2f,getTypeName:function(){return"SFMatrix3f"},getType:function(){return X3DConstants.SFMatrix3f}});return{SFMatrix3d:SFMatrix3d,SFMatrix3f:SFMatrix3f}});define("cobweb/Fields/SFVec3",["jquery","standard/Math/Numbers/Vector3","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,Vector3,X3DField,X3DConstants){function SFVec3(v){if(v.length){if(v[0]instanceof Vector3)return X3DField.call(this,v[0]);return X3DField.call(this,new Vector3(+v[0],+v[1],+v[2]))}return X3DField.call(this,new Vector3(0,0,0))}SFVec3.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFVec3,copy:function(){return new this.constructor(this.getValue().copy())},equals:function(vector){return this.getValue().equals(vector.getValue())},set:function(value){this.getValue().assign(value)},negate:function(){return new this.constructor(Vector3.negate(this.getValue().copy()))},add:function(vector){return new this.constructor(Vector3.add(this.getValue(),vector.getValue()))},subtract:function(vector){return new this.constructor(Vector3.subtract(this.getValue(),vector.getValue()))},multiply:function(value){return new this.constructor(Vector3.multiply(this.getValue(),value))},divide:function(value){return new this.constructor(Vector3.divide(this.getValue(),value))},cross:function(vector){return new this.constructor(Vector3.cross(this.getValue(),vector.getValue()))},dot:function(vector){return new this.constructor(this.getValue().dot(vector.getValue()))},normalize:function(vector){return new this.constructor(Vector3.normalize(this.getValue()))},length:function(vector){return new this.constructor(this.getValue().abs())},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFVec3.prototype,"x",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec3.prototype,"0",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec3.prototype,"y",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec3.prototype,"1",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec3.prototype,"z",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec3.prototype,"2",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:false,configurable:false});function SFVec3d(x,y,z){if(this instanceof SFVec3d)return SFVec3.call(this,arguments);return SFVec3.call(Object.create(SFVec3d.prototype),arguments)}SFVec3d.prototype=$.extend(Object.create(SFVec3.prototype),{constructor:SFVec3d,getTypeName:function(){return"SFVec3d"},getType:function(){return X3DConstants.SFVec3d}});function SFVec3f(x,y,z){if(this instanceof SFVec3f)return SFVec3.call(this,arguments);return SFVec3.call(Object.create(SFVec3f.prototype),arguments)}SFVec3f.prototype=$.extend(Object.create(SFVec3.prototype),{constructor:SFVec3f,getTypeName:function(){return"SFVec3f"},getType:function(){return X3DConstants.SFVec3f}});return{SFVec3d:SFVec3d,SFVec3f:SFVec3f}});define("standard/Math/Numbers/Vector4",["jquery","standard/Math/Algorithm"],function($,Algorithm){function Vector4(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w}Vector4.prototype={constructor:Vector4,length:4,copy:function(){var copy=Object.create(Vector4.prototype);copy.x=this.x;copy.y=this.y;copy.z=this.z;copy.w=this.w;return copy},assign:function(vector){this.x=vector.x;this.y=vector.y;this.z=vector.z;this.w=vector.w;return this},set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},equals:function(vector){return this.x===vector.x&&this.y===vector.y&&this.z===vector.z&&this.w===vector.w},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},add:function(vector){this.x+=vector.x;this.y+=vector.y;this.z+=vector.z;this.w+=vector.w;return this},subtract:function(vector){this.x-=vector.x;this.y-=vector.y;this.z-=vector.z;this.w-=vector.w;return this},multiply:function(value){this.x*=value;this.y*=value;this.z*=value;this.w*=value;return this},multVec:function(vector){this.x*=vector.x;this.y*=vector.y;this.z*=vector.z;this.w*=vector.w;return this},divide:function(value){this.x/=value;this.y/=value;this.z/=value;this.w/=value;return this},divVec:function(vector){this.x/=vector.x;this.y/=vector.y;this.z/=vector.z;this.w/=vector.w;return this},normalize:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(length){length=1/length;this.x*=length;this.y*=length;this.z*=length;this.w*=length}return this},dot:function(vector){return this.x*vector.x+this.y*vector.y+this.z*vector.z+this.w*vector.w},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},abs:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lerp:function(dest,t){this.x=Algorithm.lerp(this.x,dest.x,t);this.y=Algorithm.lerp(this.y,dest.y,t);this.z=Algorithm.lerp(this.z,dest.z,t);this.w=Algorithm.lerp(this.w,dest.w,t);return this},min:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.min(this.x,vector.x);this.y=Math.min(this.y,vector.y);this.z=Math.min(this.z,vector.z);this.w=Math.min(this.w,vector.w)}return this},max:function(vector){for(var i=0;i<arguments.length;++i){var vector=arguments[i];this.x=Math.max(this.x,vector.x);this.y=Math.max(this.y,vector.y);this.z=Math.max(this.z,vector.z);this.w=Math.max(this.w,vector.w)}return this},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}};Object.defineProperty(Vector4.prototype,"0",{get:function(){return this.x},set:function(value){this.x=value},enumerable:false,configurable:false});Object.defineProperty(Vector4.prototype,"1",{get:function(){return this.y},set:function(value){this.y=value},enumerable:false,configurable:false});Object.defineProperty(Vector4.prototype,"2",{get:function(){return this.z},set:function(value){this.z=value},enumerable:false,configurable:false});Object.defineProperty(Vector4.prototype,"3",{get:function(){return this.w},set:function(value){this.w=value},enumerable:false,configurable:false});$.extend(Vector4,{Zero:new Vector4(0,0,0,0),One:new Vector4(1,1,1,1),negate:function(vector){var copy=Object.create(this.prototype);copy.x=-vector.x;copy.y=-vector.y;copy.z=-vector.z;copy.w=-vector.w;return copy},add:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x+rhs.x;copy.y=lhs.y+rhs.y;copy.z=lhs.z+rhs.z;copy.w=lhs.w+rhs.w;return copy},subtract:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x-rhs.x;copy.y=lhs.y-rhs.y;copy.z=lhs.z-rhs.z;copy.w=lhs.w-rhs.w;return copy},multiply:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs;copy.y=lhs.y*rhs;copy.z=lhs.z*rhs;copy.w=lhs.w*rhs;return copy},multVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x*rhs.x;copy.y=lhs.y*rhs.y;copy.z=lhs.z*rhs.z;copy.w=lhs.w*rhs.w;return copy},divide:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs;copy.y=lhs.y/rhs;copy.z=lhs.z/rhs;copy.w=lhs.w/rhs;return copy},divVec:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=lhs.x/rhs.x;copy.y=lhs.y/rhs.y;copy.z=lhs.z/rhs.z;copy.w=lhs.w/rhs.w;return copy},normalize:function(vector){var copy=Object.create(this.prototype),x=vector.x,y=vector.y,z=vector.z,w=vector.w,length=Math.sqrt(x*x+y*y+z*z+w*w);if(length){length=1/length;copy.x=x*length;copy.y=y*length;copy.z=z*length;copy.w=w*length}else{copy.x=0;copy.y=0;copy.z=0;copy.w=0}return copy},dot:function(lhs,rhs){return lhs.dot(rhs)},lerp:function(source,dest,t){return new Vector4(Algorithm.lerp(source.x,dest.x,t),Algorithm.lerp(source.y,dest.y,t),Algorithm.lerp(source.z,dest.z,t),Algorithm.lerp(source.w,dest.w,t))},min:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y,z=arguments[0].z,w=arguments[0].w;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.min(x,vector.x);y=Math.min(y,vector.y);z=Math.min(z,vector.z);w=Math.min(w,vector.w)}return new Vector4(x,y,z,w)},max:function(lhs,rhs){var x=arguments[0].x,y=arguments[0].y,z=arguments[0].z,w=arguments[0].w;for(var i=1;i<arguments.length;++i){var vector=arguments[i];x=Math.max(x,vector.x);y=Math.max(y,vector.y);z=Math.max(z,vector.z);w=Math.max(w,vector.w)}return new Vector4(x,y,z,w)}});return Vector4});define("standard/Math/Numbers/Quaternion",["jquery","standard/Math/Numbers/Vector3","standard/Math/Algorithm"],function($,Vector3,Algorithm){function Quaternion(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w}Quaternion.prototype={constructor:Quaternion,length:4,copy:function(){var copy=Object.create(Quaternion.prototype);copy.x=this.x;copy.y=this.y;copy.z=this.z;copy.w=this.w;return copy},assign:function(quat){this.x=quat.x;this.y=quat.y;this.z=quat.z;this.w=quat.w;return this},set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},isReal:function(){return!(this.x||this.y||this.z)},isImag:function(){return!this.w},equals:function(quat){return this.x===quat.x&&this.y===quat.y&&this.z===quat.z&&this.w===quat.w},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},inverse:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},add:function(quat){this.x+=quat.x;this.y+=quat.y;this.z+=quat.z;this.w+=quat.w;return this},subtract:function(quat){this.x-=quat.x;this.y-=quat.y;this.z-=quat.z;this.w-=quat.w;return this},multiply:function(value){this.x*=value;this.y*=value;this.z*=value;this.w*=value;return this},multLeft:function(quat){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=quat.x,by=quat.y,bz=quat.z,bw=quat.w;this.x=aw*bx+ax*bw+ay*bz-az*by;this.y=aw*by+ay*bw+az*bx-ax*bz;this.z=aw*bz+az*bw+ax*by-ay*bx;this.w=aw*bw-ax*bx-ay*by-az*bz;return this},multRight:function(quat){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=quat.x,by=quat.y,bz=quat.z,bw=quat.w;this.x=bw*ax+bx*aw+by*az-bz*ay;this.y=bw*ay+by*aw+bz*ax-bx*az;this.z=bw*az+bz*aw+bx*ay-by*ax;this.w=bw*aw-bx*ax-by*ay-bz*az;return this},divide:function(value){this.x/=value;this.y/=value;this.z/=value;this.w/=value;return this},multVecQuat:function(vector){var qx=this.x,qy=this.y,qz=this.z,qw=this.w,vx=vector.x,vy=vector.y,vz=vector.z,a=qw*qw-qx*qx-qy*qy-qz*qz,b=2*(vx*qx+vy*qy+vz*qz),c=2*qw;vector.x=a*vx+b*qx+c*(qy*vz-qz*vy);vector.y=a*vy+b*qy+c*(qz*vx-qx*vz);vector.z=a*vz+b*qz+c*(qx*vy-qy*vx);return vector},multQuatVec:function(vector){var qx=this.x,qy=this.y,qz=this.z,qw=this.w,vx=vector.x,vy=vector.y,vz=vector.z,a=qw*qw-qx*qx-qy*qy-qz*qz,b=2*(vx*qx+vy*qy+vz*qz),c=2*qw;vector.x=a*vx+b*qx-c*(qy*vz-qz*vy);vector.y=a*vy+b*qy-c*(qz*vx-qx*vz);vector.z=a*vz+b*qz-c*(qx*vy-qy*vx);return vector},normalize:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(length){length=1/length;this.x*=length;this.y*=length;this.z*=length;this.w*=length}return this},dot:function(quat){return this.x*quat.x+this.y*quat.y+this.z*quat.z+this.w*quat.w},norm:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},abs:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},pow:function(exponent){if(exponent instanceof Quaternion)return this.exp(exponent*this.log());if(this.isReal())return this.set(0,0,0,Math.pow(this.w,exponent));var l=this.abs(),theta=Math.acos(this.w/l),li=this.imag.abs(),ltoe=Math.pow(l,exponent),et=exponent*theta,scale=ltoe/li*Math.sin(et);this.x*=scale;this.y*=scale;this.z*=scale;this.w=ltoe*Math.cos(et);return this},log:function(){if(this.isReal()){if(this.w>0)return this.set(0,0,0,Math.log(this.w));else return this.set(Math.PI,0,0,Math.log(-this.w))
}var l=this.abs(),v=this.imag.normalize().multiply(Math.acos(this.w/l)),w=Math.log(l);this.x=v.x;this.y=v.y;this.z=v.z;this.w=w;return this},exp:function(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));var i=this.imag,li=i.abs(),ew=Math.exp(this.w),w=ew*Math.cos(li),v=i.multiply(ew*Math.sin(li)/li);this.x=v.x;this.y=v.y;this.z=v.z;this.w=w;return this},slerp:function(dest,t){return Algorithm.slerp(this,tmp.assign(dest),t)},toString:function(){return this.x+" "+this.y+" "+this.z+" "+this.w}};Object.defineProperty(Quaternion.prototype,"0",{get:function(){return this.x},set:function(value){this.x=value},enumerable:false,configurable:false});Object.defineProperty(Quaternion.prototype,"1",{get:function(){return this.y},set:function(value){this.y=value},enumerable:false,configurable:false});Object.defineProperty(Quaternion.prototype,"2",{get:function(){return this.z},set:function(value){this.z=value},enumerable:false,configurable:false});Object.defineProperty(Quaternion.prototype,"3",{get:function(){return this.w},set:function(value){this.w=value},enumerable:false,configurable:false});Object.defineProperty(Quaternion.prototype,"real",{get:function(){return this.w},enumerable:false,configurable:false});Object.defineProperty(Quaternion.prototype,"imag",{get:function(){return new Vector3(this.x,this.y,this.z)},enumerable:false,configurable:false});$.extend(Quaternion,{Matrix3:function(matrix){var quat=Object.create(this.prototype);var i;if(matrix[0]>matrix[4]){i=matrix[0]>matrix[8]?0:2}else{i=matrix[4]>matrix[8]?1:2}var scalerow=matrix[0]+matrix[4]+matrix[8];if(scalerow>matrix[i*3+i]){quat[3]=Math.sqrt(scalerow+1)/2;var d=4*quat[3];quat[0]=(matrix[5]-matrix[7])/d;quat[1]=(matrix[6]-matrix[2])/d;quat[2]=(matrix[1]-matrix[3])/d}else{var j=(i+1)%3;var k=(i+2)%3;quat[i]=Math.sqrt(matrix[i*3+i]-matrix[j*3+j]-matrix[k*3+k]+1)/2;var d=4*quat[i];quat[j]=(matrix[i*3+j]+matrix[j*3+i])/d;quat[k]=(matrix[i*3+k]+matrix[k*3+i])/d;quat[3]=(matrix[j*3+k]-matrix[k*3+j])/d}return quat},negate:function(vector){var copy=Object.create(this.prototype);copy.x=-this.x;copy.y=-this.y;copy.z=-this.z;copy.w=-this.w;return copy},inverse:function(vector){var copy=Object.create(this.prototype);copy.x=-vector.x;copy.y=-vector.y;copy.z=-vector.z;copy.w=vector.w;return copy},add:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=rhs.x+rhs.x;copy.y=rhs.y+rhs.y;copy.z=rhs.z+rhs.z;copy.w=rhs.w+rhs.w;return copy},subtract:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=rhs.x-rhs.x;copy.y=rhs.y-rhs.y;copy.z=rhs.z-rhs.z;copy.w=rhs.w-rhs.w;return copy},multiply:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=rhs.x*rhs;copy.y=rhs.y*rhs;copy.z=rhs.z*rhs;copy.w=rhs.w*rhs;return copy},multLeft:function(lhs,rhs){var copy=Object.create(this.prototype),ax=lhs.x,ay=lhs.y,az=lhs.z,aw=lhs.w,bx=rhs.x,by=rhs.y,bz=rhs.z,bw=rhs.w;copy.x=aw*bx+ax*bw+ay*bz-az*by;copy.y=aw*by+ay*bw+az*bx-ax*bz;copy.z=aw*bz+az*bw+ax*by-ay*bx;copy.w=aw*bw-ax*bx-ay*by-az*bz;return copy},multRight:function(lhs,rhs){var copy=Object.create(this.prototype),ax=lhs.x,ay=lhs.y,az=lhs.z,aw=lhs.w,bx=rhs.x,by=rhs.y,bz=rhs.z,bw=rhs.w;copy.x=bw*ax+bx*aw+by*az-bz*ay;copy.y=bw*ay+by*aw+bz*ax-bx*az;copy.z=bw*az+bz*aw+bx*ay-by*ax;copy.w=bw*aw-bx*ax-by*ay-bz*az;return copy},divide:function(lhs,rhs){var copy=Object.create(this.prototype);copy.x=rhs.x/rhs;copy.y=rhs.y/rhs;copy.z=rhs.z/rhs;copy.w=rhs.w/rhs;return copy},normalize:function(quat){var copy=Object.create(this.prototype),x=quat.x,y=quat.y,z=quat.z,w=quat.w,length=Math.sqrt(x*x+y*y+z*z+w*w);if(length){length=1/length;copy.x=x*length;copy.y=y*length;copy.z=z*length;copy.w=w*length}else{copy.x=0;copy.y=0;copy.z=0;copy.w=0}return copy},slerp:function(source,dest,t){return Algorithm.slerp(source.copy(),tmp.assign(dest),t)}});var tmp=new Quaternion(0,0,0,1);return Quaternion});define("standard/Math/Numbers/Rotation4",["jquery","standard/Math/Numbers/Quaternion","standard/Math/Numbers/Vector3"],function($,Quaternion,Vector3){var xAxis=new Vector3(1,0,0),yAxis=new Vector3(0,1,0),from=new Vector3(0,0,0),to=new Vector3(0,0,0);function Rotation4(x,y,z,angle){switch(arguments.length){case 0:{this.value=new Quaternion(0,0,0,1);return}case 1:{this.value=arguments[0];return}case 2:{this.value=new Quaternion(0,0,0,1);if(arguments[1]instanceof Vector3)return this.setFromToVec(arguments[0],arguments[1]);this.set(arguments[0].x,arguments[0].y,arguments[0].z,arguments[1]);return}case 4:{this.value=new Quaternion(0,0,0,1);this.set(x,y,z,angle);return}}}Rotation4.prototype={constructor:Rotation4,length:4,copy:function(){var copy=Object.create(Rotation4.prototype);copy.value=this.value.copy();return copy},assign:function(rotation){this.value.assign(rotation.value);return this},set:function(x,y,z,angle){var scale=Math.sqrt(x*x+y*y+z*z);if(scale===0){this.value.set(0,0,0,1);return this}var halfTheta=angle/2;scale=Math.sin(halfTheta)/scale;this.value.set(x*scale,y*scale,z*scale,Math.cos(halfTheta));return this},get:function(){if(Math.abs(this.value.w)>=1)return[0,0,1,0];var vector=this.value.imag.normalize();return[vector.x,vector.y,vector.z,2*Math.acos(this.value.w)]},setFromToVec:function(fromVec,toVec){from.assign(fromVec).normalize();to.assign(toVec).normalize();var cos_angle=from.dot(to),crossvec=Vector3.cross(from,to).normalize(),crosslen=crossvec.abs();if(crosslen===0){if(cos_angle>0)this.value.set(0,0,0,1);else{var t=Vector3.cross(from,xAxis);if(t.norm()===0)t=Vector3.cross(from,yAxis);t.normalize();this.value.set(t.x,t.y,t.z,0)}}else{crossvec.multiply(Math.sqrt(Math.abs(1-cos_angle)/2));this.value.set(crossvec.x,crossvec.y,crossvec.z,Math.sqrt(Math.abs(1+cos_angle)/2))}return this},getAxis:function(){if(Math.abs(this.value.w)>=1)return new Vector3(0,0,1);return this.value.imag.normalize()},equals:function(rot){return this.value.equals(rot.value)},inverse:function(){this.value.inverse();return this},multLeft:function(rot){this.value.multLeft(rot.value).normalize();return this},multRight:function(rot){this.value.multRight(rot.value).normalize();return this},multVecRot:function(vector){return this.value.multVecQuat(vector)},multRotVec:function(vector){return this.value.multQuatVec(vector)},slerp:function(dest,t){this.value.slerp(dest.value,t);return this},toString:function(){var r=this.get();return r[0]+" "+r[1]+" "+r[2]+" "+r[3]}};Object.defineProperty(Rotation4.prototype,"x",{get:function(){return this.getAxis().x},set:function(value){var r=this.get();this.set(value,r[1],r[2],r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"0",{get:function(){return this.getAxis().x},set:function(value){var r=this.get();this.set(value,r[1],r[2],r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"y",{get:function(){return this.getAxis().y},set:function(value){var r=this.get();this.set(r[0],value,r[2],r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"1",{get:function(){return this.getAxis().y},set:function(value){var r=this.get();this.set(r[0],value,r[2],r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"z",{get:function(){return this.getAxis().z},set:function(value){var r=this.get();this.set(r[0],r[1],value,r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"2",{get:function(){return this.getAxis().z},set:function(value){var r=this.get();this.set(r[0],r[1],value,r[3])},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"angle",{get:function(){if(Math.abs(this.value.w)>=1)return 0;return 2*Math.acos(this.value.w)},set:function(value){var v=this.getAxis();this.set(v.x,v.y,v.z,value)},enumerable:false,configurable:false});Object.defineProperty(Rotation4.prototype,"3",{get:function(){if(Math.abs(this.value.w)>=1)return 0;return 2*Math.acos(this.value.w)},set:function(value){var v=this.getAxis();this.set(v.x,v.y,v.z,value)},enumerable:false,configurable:false});$.extend(Rotation4,{Identity:new Rotation4,Matrix3:function(matrix){var copy=Object.create(this.prototype);copy.value=Quaternion.Matrix3(matrix);return copy},inverse:function(rotation){var copy=Object.create(this.prototype);copy.value=Quaternion.inverse(rotation.value);return copy},multRight:function(lhs,rhs){var copy=Object.create(this.prototype);copy.value=Quaternion.multRight(lhs.value,rhs.value);return copy},slerp:function(source,destination,t){var copy=Object.create(this.prototype);copy.value=Quaternion.slerp(source.value,destination.value,t);return copy},squad:function(source,a,b,destination,t){var copy=Object.create(this.prototype);copy.value=Quaternion.squad(source.value,a,b,destination.value,t);return copy},bezier:function(source,a,b,destination,t){var copy=Object.create(this.prototype);copy.value=Quaternion.bezier(source.value,a,b,destination.value,t);return copy},spline:function(q0,a1,q2){var copy=Object.create(this.prototype);copy.value=Quaternion.spline(q0.value,q1.value,q2.value);return copy}});return Rotation4});define("standard/Math/Numbers/Matrix4",["jquery","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix3","standard/Math/Algorithms/eigendecomposition"],function($,Vector3,Vector4,Rotation4,Matrix3,eigendecomposition){var dummyTranslation=new Vector3(0,0,0),dummyRotation=new Rotation4,dummyScale=new Vector3(0,0,0),dummyScaleOrientation=new Rotation4,dummyCenter=new Vector3(0,0,0),rot=new Matrix3,so=new Matrix3,si=new Matrix3;function Matrix4(){if(arguments.length){this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3];this[4]=arguments[4];this[5]=arguments[5];this[6]=arguments[6];this[7]=arguments[7];this[8]=arguments[8];this[9]=arguments[9];this[10]=arguments[10];this[11]=arguments[11];this[12]=arguments[12];this[13]=arguments[13];this[14]=arguments[14];this[15]=arguments[15]}else this.identity()}Matrix4.prototype={constructor:Matrix4,order:4,length:16,copy:function(){var copy=Object.create(Matrix4.prototype);copy[0]=this[0];copy[1]=this[1];copy[2]=this[2];copy[3]=this[3];copy[4]=this[4];copy[5]=this[5];copy[6]=this[6];copy[7]=this[7];copy[8]=this[8];copy[9]=this[9];copy[10]=this[10];copy[11]=this[11];copy[12]=this[12];copy[13]=this[13];copy[14]=this[14];copy[15]=this[15];return copy},assign:function(matrix){this[0]=matrix[0];this[1]=matrix[1];this[2]=matrix[2];this[3]=matrix[3];this[4]=matrix[4];this[5]=matrix[5];this[6]=matrix[6];this[7]=matrix[7];this[8]=matrix[8];this[9]=matrix[9];this[10]=matrix[10];this[11]=matrix[11];this[12]=matrix[12];this[13]=matrix[13];this[14]=matrix[14];this[15]=matrix[15];return this},equals:function(matrix){return this[0]===matrix[0]&&this[1]===matrix[1]&&this[2]===matrix[2]&&this[3]===matrix[3]&&this[4]===matrix[4]&&this[5]===matrix[5]&&this[6]===matrix[6]&&this[7]===matrix[7]&&this[8]===matrix[8]&&this[9]===matrix[9]&&this[10]===matrix[10]&&this[11]===matrix[11]&&this[12]===matrix[12]&&this[13]===matrix[13]&&this[14]===matrix[14]&&this[15]===matrix[15]},set1:function(r,c,value){this[r*this.order+c]=value;return this},get1:function(r,c){return this[r*this.order+c]},set:function(translation,rotation,scale,scaleOrientation,center){switch(arguments.length){case 0:{this.identity();break}case 1:{if(translation===null)translation=Vector3.Zero;this.identity();this.translate(translation);break}case 2:{if(translation===null)translation=Vector3.Zero;if(rotation===null)rotation=Rotation4.Identity;this.identity();this.translate(translation);if(!rotation.equals(Rotation4.Identity))this.rotate(rotation);break}case 3:{if(translation===null)translation=Vector3.Zero;if(rotation===null)rotation=Rotation4.Identity;if(scale===null)scale=Vector3.One;this.identity();this.translate(translation);if(!rotation.equals(Rotation4.Identity))this.rotate(rotation);if(!scale.equals(Vector3.One))this.scale(scale);break}case 4:{if(translation===null)translation=Vector3.Zero;if(rotation===null)rotation=Rotation4.Identity;if(scale===null)scale=Vector3.One;if(scaleOrientation===null)scaleOrientation=Rotation4.Identity;this.identity();this.translate(translation);if(!rotation.equals(Rotation4.Identity))this.rotate(rotation);if(!scale.equals(Vector3.One)){var hasScaleOrientation=!scaleOrientation.equals(Rotation4.Identity);if(hasScaleOrientation){this.rotate(scaleOrientation);this.scale(scale);this.rotate(Rotation4.inverse(scaleOrientation))}else this.scale(scale)}break}case 5:{if(translation===null)translation=Vector3.Zero;if(rotation===null)rotation=Rotation4.Identity;if(scale===null)scale=Vector3.One;if(scaleOrientation===null)scaleOrientation=Rotation4.Identity;if(center===null)center=Vector3.Zero;this.identity();this.translate(translation);var hasCenter=!center.equals(Vector3.Zero);if(hasCenter)this.translate(center);if(!rotation.equals(Rotation4.Identity))this.rotate(rotation);if(!scale.equals(Vector3.One)){if(!scaleOrientation.equals(Rotation4.Identity)){this.rotate(scaleOrientation);this.scale(scale);this.rotate(Rotation4.inverse(scaleOrientation))}else this.scale(scale)}if(hasCenter)this.translate(Vector3.negate(center));break}case 16:{this[0]=arguments[0];this[1]=arguments[1];this[2]=arguments[2];this[3]=arguments[3];this[4]=arguments[4];this[5]=arguments[5];this[6]=arguments[6];this[7]=arguments[7];this[8]=arguments[8];this[9]=arguments[9];this[10]=arguments[10];this[11]=arguments[11];this[12]=arguments[12];this[13]=arguments[13];this[14]=arguments[14];this[15]=arguments[15];break}}return this},get:function(translation,rotation,scale,scaleOrientation,center){if(translation===null)translation=dummyTranslation;if(rotation===null)rotation=dummyRotation;if(scale===null)scale=dummyScale;if(scaleOrientation===null)scaleOrientation=dummyScaleOrientation;if(center===null)center=dummyCenter;switch(arguments.length){case 1:{translation.set(this[12],this[13],this[14]);break}case 2:{this.factor(translation,rot,dummyScale,so);rotation.assign(Rotation4.Matrix3(rot));break}case 3:{this.factor(translation,rot,scale,so);rotation.assign(Rotation4.Matrix3(rot));break}case 4:{this.factor(translation,rot,scale,so);rotation.assign(Rotation4.Matrix3(rot));scaleOrientation.assign(Rotation4.Matrix3(so));break}case 5:{var m=new Matrix4;m.set(Vector3.negate(center));m.multLeft(this);m.translate(center);m.get(translation,rotation,scale,scaleOrientation);break}}},setRotation:function(rotation){return this.setQuaternion(rotation.value)},setQuaternion:function(quaternion){var x=quaternion.x,y=quaternion.y,z=quaternion.z,w=quaternion.w,A=y*y,B=z*z,C=x*y,D=z*w,E=z*x,F=y*w,G=x*x,H=y*z,I=x*w;this[0]=1-2*(A+B);this[1]=2*(C+D);this[2]=2*(E-F);this[3]=0;this[4]=2*(C-D);this[5]=1-2*(B+G);this[6]=2*(H+I);this[7]=0;this[8]=2*(E+F);this[9]=2*(H-I);this[10]=1-2*(A+G);this[11]=0;this[12]=0;this[13]=0;this[14]=0;this[15]=1;return this},factor:function(translation,rotation,scale,scaleOrientation){translation.set(this[12],this[13],this[14]);var a=this.submatrix;var det=a.determinant();var det_sign=det<0?-1:1;if(det_sign*det===0)return false;var b=Matrix3.transpose(a).multLeft(a),e=eigendecomposition(b);scaleOrientation.set(e.vectors[0][0],e.vectors[0][1],e.vectors[0][2],e.vectors[1][0],e.vectors[1][1],e.vectors[1][2],e.vectors[2][0],e.vectors[2][1],e.vectors[2][2]);scale.x=det_sign*Math.sqrt(e.values[0]);scale.y=det_sign*Math.sqrt(e.values[1]);scale.z=det_sign*Math.sqrt(e.values[2]);si[0]=1/scale.x;si[4]=1/scale.y;si[8]=1/scale.z;rotation.assign(Matrix3.multRight(scaleOrientation,si).transpose().multLeft(scaleOrientation).multRight(a));scaleOrientation.transpose();return true},determinant3:function(){var m00=this[0],m01=this[1],m02=this[2],m04=this[4],m05=this[5],m06=this[6],m08=this[8],m09=this[9],m10=this[10];return m00*(m05*m10-m06*m09)-m01*(m04*m10-m06*m08)+m02*(m04*m09-m05*m08)},determinant:function(){var m00=this[0],m01=this[1],m02=this[2],m03=this[3],m04=this[4],m05=this[5],m06=this[6],m07=this[7],m08=this[8],m09=this[9],m10=this[10],m11=this[11],m12=this[12],m13=this[13],m14=this[14],m15=this[15],b=m10*m15,c=m14*m11,d=m06*m15,e=m14*m07,f=m06*m11,g=m10*m07,h=m02*m15,i=m14*m03,j=m02*m11,o=m10*m03,r=m02*m07,x=m06*m03,H=b*m05+e*m09+f*m13-c*m05-d*m09-g*m13,I=c*m01+h*m09+o*m13-b*m01-i*m09-j*m13,J=d*m01+i*m05+r*m13-e*m01-h*m05-x*m13,K=g*m01+j*m05+x*m09-f*m01-o*m05-r*m09;return m00*H+m04*I+m08*J+m12*K},transpose:function(){var tmp;tmp=this[1];this[1]=this[4];this[1]=tmp;tmp=this[2];this[2]=this[8];this[2]=tmp;tmp=this[3];this[3]=this[12];this[3]=tmp;tmp=this[6];this[6]=this[9];this[6]=tmp;tmp=this[7];this[7]=this[13];this[7]=tmp;tmp=this[11];this[11]=this[14];this[11]=tmp;return this},inverse:function(){var m00=this[0],m01=this[1],m02=this[2],m03=this[3],m04=this[4],m05=this[5],m06=this[6],m07=this[7],m08=this[8],m09=this[9],m10=this[10],m11=this[11],m12=this[12],m13=this[13],m14=this[14],m15=this[15],b=m10*m15,c=m14*m11,d=m06*m15,e=m14*m07,f=m06*m11,g=m10*m07,h=m02*m15,i=m14*m03,j=m02*m11,o=m10*m03,r=m02*m07,x=m06*m03,t=m08*m13,p=m12*m09,v=m04*m13,s=m12*m05,y=m04*m09,z=m08*m05,A=m00*m13,C=m12*m01,D=m00*m09,E=m08*m01,F=m00*m05,G=m04*m01,H=b*m05+e*m09+f*m13-(c*m05+d*m09+g*m13),I=c*m01+h*m09+o*m13-(b*m01+i*m09+j*m13),J=d*m01+i*m05+r*m13-(e*m01+h*m05+x*m13),K=g*m01+j*m05+x*m09-(f*m01+o*m05+r*m09),B=m00*H+m04*I+m08*J+m12*K;if(B===0)throw Error("Matrix4 .inverse: determinant is 0.");B=1/B;this[0]=B*H;this[1]=B*I;this[2]=B*J;this[3]=B*K;this[4]=B*(c*m04+d*m08+g*m12-b*m04-e*m08-f*m12);this[5]=B*(b*m00+i*m08+j*m12-c*m00-h*m08-o*m12);this[6]=B*(e*m00+h*m04+x*m12-d*m00-i*m04-r*m12);this[7]=B*(f*m00+o*m04+r*m08-g*m00-j*m04-x*m08);this[8]=B*(t*m07+s*m11+y*m15-p*m07-v*m11-z*m15);this[9]=B*(p*m03+A*m11+E*m15-t*m03-C*m11-D*m15);this[10]=B*(v*m03+C*m07+F*m15-s*m03-A*m07-G*m15);this[11]=B*(z*m03+D*m07+G*m11-y*m03-E*m07-F*m11);this[12]=B*(v*m10+z*m14+p*m06-y*m14-t*m06-s*m10);this[13]=B*(D*m14+t*m02+C*m10-A*m10-E*m14-p*m02);this[14]=B*(A*m06+G*m14+s*m02-F*m14-v*m02-C*m06);this[15]=B*(F*m10+y*m02+E*m06-D*m06-G*m10-z*m02);return this},multLeft:function(matrix){var a00=this[0],a01=this[1],a02=this[2],a03=this[3],a04=this[4],a05=this[5],a06=this[6],a07=this[7],a08=this[8],a09=this[9],a10=this[10],a11=this[11],a12=this[12],a13=this[13],a14=this[14],a15=this[15],b00=matrix[0],b01=matrix[1],b02=matrix[2],b03=matrix[3],b04=matrix[4],b05=matrix[5],b06=matrix[6],b07=matrix[7],b08=matrix[8],b09=matrix[9],b10=matrix[10],b11=matrix[11],b12=matrix[12],b13=matrix[13],b14=matrix[14],b15=matrix[15];this[0]=a00*b00+a04*b01+a08*b02+a12*b03;this[1]=a01*b00+a05*b01+a09*b02+a13*b03;this[2]=a02*b00+a06*b01+a10*b02+a14*b03;this[3]=a03*b00+a07*b01+a11*b02+a15*b03;this[4]=a00*b04+a04*b05+a08*b06+a12*b07;this[5]=a01*b04+a05*b05+a09*b06+a13*b07;this[6]=a02*b04+a06*b05+a10*b06+a14*b07;this[7]=a03*b04+a07*b05+a11*b06+a15*b07;this[8]=a00*b08+a04*b09+a08*b10+a12*b11;this[9]=a01*b08+a05*b09+a09*b10+a13*b11;this[10]=a02*b08+a06*b09+a10*b10+a14*b11;this[11]=a03*b08+a07*b09+a11*b10+a15*b11;this[12]=a00*b12+a04*b13+a08*b14+a12*b15;this[13]=a01*b12+a05*b13+a09*b14+a13*b15;this[14]=a02*b12+a06*b13+a10*b14+a14*b15;this[15]=a03*b12+a07*b13+a11*b14+a15*b15;return this},multRight:function(matrix){var a00=this[0],a01=this[1],a02=this[2],a03=this[3],a04=this[4],a05=this[5],a06=this[6],a07=this[7],a08=this[8],a09=this[9],a10=this[10],a11=this[11],a12=this[12],a13=this[13],a14=this[14],a15=this[15],b00=matrix[0],b01=matrix[1],b02=matrix[2],b03=matrix[3],b04=matrix[4],b05=matrix[5],b06=matrix[6],b07=matrix[7],b08=matrix[8],b09=matrix[9],b10=matrix[10],b11=matrix[11],b12=matrix[12],b13=matrix[13],b14=matrix[14],b15=matrix[15];this[0]=a00*b00+a01*b04+a02*b08+a03*b12;this[1]=a00*b01+a01*b05+a02*b09+a03*b13;this[2]=a00*b02+a01*b06+a02*b10+a03*b14;this[3]=a00*b03+a01*b07+a02*b11+a03*b15;this[4]=a04*b00+a05*b04+a06*b08+a07*b12;this[5]=a04*b01+a05*b05+a06*b09+a07*b13;this[6]=a04*b02+a05*b06+a06*b10+a07*b14;this[7]=a04*b03+a05*b07+a06*b11+a07*b15;this[8]=a08*b00+a09*b04+a10*b08+a11*b12;this[9]=a08*b01+a09*b05+a10*b09+a11*b13;this[10]=a08*b02+a09*b06+a10*b10+a11*b14;this[11]=a08*b03+a09*b07+a10*b11+a11*b15;this[12]=a12*b00+a13*b04+a14*b08+a15*b12;this[13]=a12*b01+a13*b05+a14*b09+a15*b13;this[14]=a12*b02+a13*b06+a14*b10+a15*b14;this[15]=a12*b03+a13*b07+a14*b11+a15*b15;return this},multVecMatrix:function(vector){if(vector.length===3){var x=vector.x,y=vector.y,z=vector.z,w=1/(x*this[3]+y*this[7]+z*this[11]+this[15]);vector.x=(x*this[0]+y*this[4]+z*this[8]+this[12])*w;vector.y=(x*this[1]+y*this[5]+z*this[9]+this[13])*w;vector.z=(x*this[2]+y*this[6]+z*this[10]+this[14])*w;return vector}var x=vector.x,y=vector.y,z=vector.z,w=vector.w;vector.x=x*this[0]+y*this[4]+z*this[8]+w*this[12];vector.y=x*this[1]+y*this[5]+z*this[9]+w*this[13];vector.z=x*this[2]+y*this[6]+z*this[10]+w*this[14];vector.w=x*this[3]+y*this[7]+z*this[11]+w*this[15];return vector},multMatrixVec:function(vector){if(vector.length===3){var x=vector.x,y=vector.y,z=vector.z,w=1/(x*this[12]+y*this[13]+z*this[14]+this[15]);vector.x=(x*this[0]+y*this[1]+z*this[2]+this[3])*w;vector.y=(x*this[4]+y*this[5]+z*this[6]+this[7])*w;vector.z=(x*this[8]+y*this[9]+z*this[10]+this[11])*w;return vector}var x=vector.x,y=vector.y,z=vector.z,w=vector.w;vector.x=x*this[0]+y*this[1]+z*this[2]+w*this[3];vector.y=x*this[4]+y*this[5]+z*this[6]+w*this[7];vector.z=x*this[8]+y*this[9]+z*this[10]+w*this[11];vector.w=x*this[12]+y*this[13]+z*this[14]+w*this[15];return vector},multDirMatrix:function(vector){var x=vector.x,y=vector.y,z=vector.z;vector.x=x*this[0]+y*this[4]+z*this[8];vector.y=x*this[1]+y*this[5]+z*this[9];vector.z=x*this[2]+y*this[6]+z*this[10];return vector},multMatrixDir:function(vector){var x=vector.x,y=vector.y,z=vector.z;vector.x=x*this[0]+y*this[1]+z*this[2];vector.y=x*this[4]+y*this[5]+z*this[6];vector.z=x*this[8]+y*this[9]+z*this[10];return vector},identity:function(){this[0]=1;this[1]=0;this[2]=0;this[3]=0;this[4]=0;this[5]=1;this[6]=0;this[7]=0;this[8]=0;this[9]=0;this[10]=1;this[11]=0;this[12]=0;this[13]=0;this[14]=0;this[15]=1},translate:function(translation){var x=translation.x,y=translation.y,z=translation.z;this[12]+=this[0]*x+this[4]*y+this[8]*z;this[13]+=this[1]*x+this[5]*y+this[9]*z;this[14]+=this[2]*x+this[6]*y+this[10]*z},rotate:function(rotation){this.multLeft(Matrix4.Quaternion(rotation.value))},scale:function(scale){var x=scale.x,y=scale.y,z=scale.z;this[0]*=x;this[4]*=y;this[8]*=z;this[1]*=x;this[5]*=y;this[9]*=z;this[2]*=x;this[6]*=y;this[10]*=z},toString:function(){return this[0]+" "+this[1]+" "+this[2]+" "+this[3]+" "+this[4]+" "+this[5]+" "+this[6]+" "+this[7]+" "+this[8]+" "+this[9]+" "+this[10]+" "+this[11]+" "+this[12]+" "+this[13]+" "+this[14]+" "+this[15]}};Object.defineProperty(Matrix4.prototype,"x",{get:function(){return new Vector3(this[0],this[1],this[2])},enumerable:false,configurable:false});Object.defineProperty(Matrix4.prototype,"y",{get:function(){return new Vector3(this[4],this[5],this[6])},enumerable:false,configurable:false});Object.defineProperty(Matrix4.prototype,"z",{get:function(){return new Vector3(this[8],this[9],this[10])},enumerable:false,configurable:false});Object.defineProperty(Matrix4.prototype,"origin",{get:function(){return new Vector3(this[12],this[13],this[14])},enumerable:false,configurable:false});Object.defineProperty(Matrix4.prototype,"submatrix",{get:function(){var matrix=Object.create(Matrix3.prototype);matrix[0]=this[0];matrix[1]=this[1];matrix[2]=this[2];matrix[3]=this[4];matrix[4]=this[5];matrix[5]=this[6];matrix[6]=this[8];matrix[7]=this[9];matrix[8]=this[10];return matrix},enumerable:false,configurable:false});$.extend(Matrix4,{Identity:new Matrix4,Rotation:function(rotation){return Object.create(this.prototype).setQuaternion(rotation.value)},Quaternion:function(quaternion){return Object.create(this.prototype).setQuaternion(quaternion)},Matrix3:function(matrix){return new Matrix4(matrix[0],matrix[1],matrix[2],0,matrix[3],matrix[4],matrix[5],0,matrix[6],matrix[7],matrix[8],0,0,0,0,1)},transpose:function(matrix){var copy=Object.create(this.prototype);copy[0]=matrix[0];copy[1]=matrix[4];copy[2]=matrix[8];copy[3]=matrix[12];copy[4]=matrix[1];copy[5]=matrix[5];copy[6]=matrix[9];copy[7]=matrix[13];copy[8]=matrix[2];copy[9]=matrix[6];copy[10]=matrix[10];copy[11]=matrix[14];copy[12]=matrix[3];copy[13]=matrix[7];copy[14]=matrix[11];copy[15]=matrix[15];return copy},inverse:function(matrix){var copy=Object.create(this.prototype),m00=matrix[0],m01=matrix[1],m02=matrix[2],m03=matrix[3],m04=matrix[4],m05=matrix[5],m06=matrix[6],m07=matrix[7],m08=matrix[8],m09=matrix[9],m10=matrix[10],m11=matrix[11],m12=matrix[12],m13=matrix[13],m14=matrix[14],m15=matrix[15],b=m10*m15,c=m14*m11,d=m06*m15,e=m14*m07,f=m06*m11,g=m10*m07,h=m02*m15,i=m14*m03,j=m02*m11,o=m10*m03,r=m02*m07,x=m06*m03,t=m08*m13,p=m12*m09,v=m04*m13,s=m12*m05,y=m04*m09,z=m08*m05,A=m00*m13,C=m12*m01,D=m00*m09,E=m08*m01,F=m00*m05,G=m04*m01,H=b*m05+e*m09+f*m13-(c*m05+d*m09+g*m13),I=c*m01+h*m09+o*m13-(b*m01+i*m09+j*m13),J=d*m01+i*m05+r*m13-(e*m01+h*m05+x*m13),K=g*m01+j*m05+x*m09-(f*m01+o*m05+r*m09),B=m00*H+m04*I+m08*J+m12*K;if(B==0)throw Error("Matrix4 .inverse: determinant is 0.");B=1/B;copy[0]=B*H;copy[1]=B*I;copy[2]=B*J;copy[3]=B*K;copy[4]=B*(c*m04+d*m08+g*m12-b*m04-e*m08-f*m12);copy[5]=B*(b*m00+i*m08+j*m12-c*m00-h*m08-o*m12);copy[6]=B*(e*m00+h*m04+x*m12-d*m00-i*m04-r*m12);copy[7]=B*(f*m00+o*m04+r*m08-g*m00-j*m04-x*m08);copy[8]=B*(t*m07+s*m11+y*m15-p*m07-v*m11-z*m15);copy[9]=B*(p*m03+A*m11+E*m15-t*m03-C*m11-D*m15);copy[10]=B*(v*m03+C*m07+F*m15-s*m03-A*m07-G*m15);copy[11]=B*(z*m03+D*m07+G*m11-y*m03-E*m07-F*m11);copy[12]=B*(v*m10+z*m14+p*m06-y*m14-t*m06-s*m10);copy[13]=B*(D*m14+t*m02+C*m10-A*m10-E*m14-p*m02);copy[14]=B*(A*m06+G*m14+s*m02-F*m14-v*m02-C*m06);copy[15]=B*(F*m10+y*m02+E*m06-D*m06-G*m10-z*m02);return copy},multLeft:function(lhs,rhs){var copy=Object.create(this.prototype),a00=lhs[0],a01=lhs[1],a02=lhs[2],a03=lhs[3],a04=lhs[4],a05=lhs[5],a06=lhs[6],a07=lhs[7],a08=lhs[8],a09=lhs[9],a10=lhs[10],a11=lhs[11],a12=lhs[12],a13=lhs[13],a14=lhs[14],a15=lhs[15],b00=rhs[0],b01=rhs[1],b02=rhs[2],b03=rhs[3],b04=rhs[4],b05=rhs[5],b06=rhs[6],b07=rhs[7],b08=rhs[8],b09=rhs[9],b10=rhs[10],b11=rhs[11],b12=rhs[12],b13=rhs[13],b14=rhs[14],b15=rhs[15];copy[0]=a00*b00+a04*b01+a08*b02+a12*b03;copy[1]=a01*b00+a05*b01+a09*b02+a13*b03;copy[2]=a02*b00+a06*b01+a10*b02+a14*b03;copy[3]=a03*b00+a07*b01+a11*b02+a15*b03;copy[4]=a00*b04+a04*b05+a08*b06+a12*b07;copy[5]=a01*b04+a05*b05+a09*b06+a13*b07;copy[6]=a02*b04+a06*b05+a10*b06+a14*b07;copy[7]=a03*b04+a07*b05+a11*b06+a15*b07;copy[8]=a00*b08+a04*b09+a08*b10+a12*b11;copy[9]=a01*b08+a05*b09+a09*b10+a13*b11;copy[10]=a02*b08+a06*b09+a10*b10+a14*b11;copy[11]=a03*b08+a07*b09+a11*b10+a15*b11;copy[12]=a00*b12+a04*b13+a08*b14+a12*b15;copy[13]=a01*b12+a05*b13+a09*b14+a13*b15;copy[14]=a02*b12+a06*b13+a10*b14+a14*b15;copy[15]=a03*b12+a07*b13+a11*b14+a15*b15;return copy},multRight:function(lhs,rhs){var copy=Object.create(this.prototype),a00=lhs[0],a01=lhs[1],a02=lhs[2],a03=lhs[3],a04=lhs[4],a05=lhs[5],a06=lhs[6],a07=lhs[7],a08=lhs[8],a09=lhs[9],a10=lhs[10],a11=lhs[11],a12=lhs[12],a13=lhs[13],a14=lhs[14],a15=lhs[15],b00=rhs[0],b01=rhs[1],b02=rhs[2],b03=rhs[3],b04=rhs[4],b05=rhs[5],b06=rhs[6],b07=rhs[7],b08=rhs[8],b09=rhs[9],b10=rhs[10],b11=rhs[11],b12=rhs[12],b13=rhs[13],b14=rhs[14],b15=rhs[15];copy[0]=a00*b00+a01*b04+a02*b08+a03*b12;copy[1]=a00*b01+a01*b05+a02*b09+a03*b13;copy[2]=a00*b02+a01*b06+a02*b10+a03*b14;copy[3]=a00*b03+a01*b07+a02*b11+a03*b15;copy[4]=a04*b00+a05*b04+a06*b08+a07*b12;copy[5]=a04*b01+a05*b05+a06*b09+a07*b13;copy[6]=a04*b02+a05*b06+a06*b10+a07*b14;copy[7]=a04*b03+a05*b07+a06*b11+a07*b15;copy[8]=a08*b00+a09*b04+a10*b08+a11*b12;copy[9]=a08*b01+a09*b05+a10*b09+a11*b13;copy[10]=a08*b02+a09*b06+a10*b10+a11*b14;copy[11]=a08*b03+a09*b07+a10*b11+a11*b15;copy[12]=a12*b00+a13*b04+a14*b08+a15*b12;copy[13]=a12*b01+a13*b05+a14*b09+a15*b13;copy[14]=a12*b02+a13*b06+a14*b10+a15*b14;copy[15]=a12*b03+a13*b07+a14*b11+a15*b15;return copy}});return Matrix4});define("cobweb/Fields/SFMatrix4",["jquery","cobweb/Basic/X3DField","cobweb/Fields/SFVec3","cobweb/Bits/X3DConstants","standard/Math/Numbers/Matrix4","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4"],function($,X3DField,SFVec3,X3DConstants,Matrix4,Vector3,Rotation4){var SFVec3d=SFVec3.SFVec3d,SFVec3f=SFVec3.SFVec3f;function SFMatrix4(m){if(m.length){if(m[0]instanceof Matrix4)return X3DField.call(this,m[0]);return X3DField.call(this,new Matrix4(+m[0],+m[1],+m[2],+m[3],+m[4],+m[5],+m[6],+m[7],+m[8],+m[9],+m[10],+m[11],+m[12],+m[13],+m[14],+m[15]))}return X3DField.call(this,new Matrix4)}SFMatrix4.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFMatrix4,copy:function(){return new this.constructor(this.getValue().copy())},equals:function(matrix){return this.getValue().equals(matrix.getValue())},set:function(value){this.getValue().assign(value)},set:function(value){this.getValue().assign(value)},setTransform:function(translation,rotation,scale,scaleOrientation,center){translation=translation?translation.getValue():null;rotation=rotation?rotation.getValue():null;scale=scale?scale.getValue():null;scaleOrientation=scaleOrientation?scaleOrientation.getValue():null;center=center?center.getValue():null;this.getValue().set(translation,rotation,scale,scaleOrientation,center)},getTransform:function(translation,rotation,scale,scaleOrientation,center){translation=translation?translation.getValue():null;rotation=rotation?rotation.getValue():null;scale=scale?scale.getValue():null;scaleOrientation=scaleOrientation?scaleOrientation.getValue():null;center=center?center.getValue():null;this.getValue().get(translation,rotation,scale,scaleOrientation,center)},transpose:function(){return new this.constructor(Matrix4.transpose(this.getValue()))},inverse:function(){return new this.constructor(Matrix4.inverse(this.getValue()))},multLeft:function(matrix){return new this.constructor(Matrix4.multLeft(this.getValue(),matrix.getValue()))},multRight:function(matrix){return new this.constructor(Matrix4.multRight(this.getValue(),matrix.getValue()))},multVecMatrix:function(vector){return new this.Vector3(this.getValue().multVecMatrix(vector.getValue().copy()))},multMatrixVec:function(vector){return new this.Vector3(this.getValue().multMatrixVec(vector.getValue().copy()))},multDirMatrix:function(vector){return new this.Vector3(this.getValue().multDirMatrix(vector.getValue().copy()))},multMatrixDir:function(vector){return new this.Vector3(this.getValue().multMatrixDir(vector.getValue().copy()))},toString:function(){return this.getValue().toString()}});function defineProperty(i){Object.defineProperty(SFMatrix4.prototype,i,{get:function(){return this.getValue()[i]},set:function(value){this.getValue()[i]=value;this.addEvent()},enumerable:false,configurable:false})}for(var i=0;i<Matrix4.prototype.length;++i)defineProperty(i);function SFMatrix4d(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){if(this instanceof SFMatrix4d)return SFMatrix4.call(this,arguments);return SFMatrix4.call(Object.create(SFMatrix4d.prototype),arguments)}SFMatrix4d.prototype=$.extend(Object.create(SFMatrix4.prototype),{constructor:SFMatrix4d,getTypeName:function(){return"SFMatrix4d"},getType:function(){return X3DConstants.SFMatrix4d}});function SFMatrix4f(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){if(this instanceof SFMatrix4f)return SFMatrix4.call(this,arguments);return SFMatrix4.call(Object.create(SFMatrix4f.prototype),arguments)}SFMatrix4f.prototype=$.extend(Object.create(SFMatrix4.prototype),{constructor:SFMatrix4f,Vector3:SFVec3d,getTypeName:function(){return"SFMatrix4f"},getType:function(){return X3DConstants.SFMatrix4f}});function VrmlMatrix(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){if(this instanceof VrmlMatrix)SFMatrix4.call(this,arguments);return SFMatrix4.call(Object.create(VrmlMatrix.prototype),arguments)}VrmlMatrix.prototype=$.extend(Object.create(SFMatrix4.prototype),{constructor:VrmlMatrix,Vector3:SFVec3f,getTypeName:function(){return"VrmlMatrix"},getType:function(){return X3DConstants.VrmlMatrix
}});return{SFMatrix4d:SFMatrix4d,SFMatrix4f:SFMatrix4f,VrmlMatrix:VrmlMatrix}});define("cobweb/Fields/SFNode",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){var handler={get:function(target,key){if(key in target)return target[key];try{var field=target.getValue().getField(key),accessType=field.getAccessType();if(accessType!==X3DConstants.inputOnly)return field.valueOf();return undefined}catch(error){return undefined}},set:function(target,key,value){if(key in target)return target[key]=value;try{var field=target.getValue().getField(key),accessType=field.getAccessType();if(accessType&X3DConstants.inputOnly)field.setValue(value);return true}catch(error){return false}}};function SFNode(value){if(this instanceof SFNode){X3DField.call(this,value?value:null);return new Proxy(this,handler)}return SFNode.call(Object.create(SFNode.prototype),value)}SFNode.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFNode,clone:function(){return new SFNode(this.getValue())},copy:function(executionContext){var value=this.getValue();if(value)return new SFNode(value.copy(executionContext));return new SFNode},getTypeName:function(){return"SFNode"},getType:function(){return X3DConstants.SFNode},set:function(value){X3DField.prototype.set.call(this,value?value:null)},getNodeTypeName:function(){return this.getValue().getTypeName()},getNodeName:function(){return this.getValue().getName()},getFieldDefinitions:function(){return this.getValue().getFieldDefinitions()},valueOf:function(){if(this.getValue())return this;return null},toString:function(){var node=this.getValue();return node?node.toString():"NULL"},toVRMLString:function(){var node=this.getValue();return node?node.toVRMLString():"NULL"},toXMLString:function(){var node=this.getValue();return node?node.toXMLString():"<!-- NULL -->"}});return SFNode});define("cobweb/Fields/SFRotation",["jquery","cobweb/Fields/SFVec3","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants","standard/Math/Numbers/Rotation4"],function($,SFVec3,X3DField,X3DConstants,Rotation4){var SFVec3f=SFVec3.SFVec3f;function SFRotation(x,y,z,angle){if(this instanceof SFRotation){switch(arguments.length){case 1:return X3DField.call(this,arguments[0]);case 2:if(arguments[1]instanceof SFVec3f)return X3DField.call(this,new Rotation4(arguments[0].getValue(),arguments[1].getValue()));return X3DField.call(this,new Rotation4(arguments[0].getValue(),+arguments[1]));case 4:return X3DField.call(this,new Rotation4(+x,+y,+z,+angle));default:return X3DField.call(this,new Rotation4)}}return SFRotation.apply(Object.create(SFRotation.prototype),arguments)}SFRotation.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFRotation,copy:function(){return new SFRotation(this.getValue().copy())},equals:function(rotation){return this.getValue().equals(rotation.getValue())},getTypeName:function(){return"SFRotation"},getType:function(){return X3DConstants.SFRotation},set:function(value){this.getValue().assign(value)},inverse:function(){return new SFRotation(Rotation4.inverse(this.getValue()))},multiply:function(rotation){return new SFRotation(Rotation4.multRight(this.getValue(),rotation.getValue()))},multVec:function(vector){return new SFVec3f(this.getValue().multVecRot(vector.getValue().copy()))},slerp:function(rotation,t){return new SFRotation(Rotation4.slerp(this.getValue(),rotation.getValue(),t))},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFRotation.prototype,"x",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFRotation.prototype,"0",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFRotation.prototype,"y",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFRotation.prototype,"1",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFRotation.prototype,"z",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFRotation.prototype,"2",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFRotation.prototype,"angle",{get:function(){return this.getValue().angle},set:function(value){this.getValue().angle=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFRotation.prototype,"3",{get:function(){return this.getValue().angle},set:function(value){this.getValue().angle=value;this.addEvent()},enumerable:true,configurable:false});return SFRotation});define("cobweb/Fields/SFString",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){var unescape=/\\([\\"])/g,escape=/([\\"])/g;function SFString(value){if(this instanceof SFString)return X3DField.call(this,arguments.length?String(value):"");return X3DField.call(Object.create(SFString.prototype),arguments.length?String(value):"")}$.extend(SFString,{unescape:function(string){return string.replace(unescape,"$1")},escape:function(string){return string.replace(escape,"\\$1")}});SFString.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFString,copy:function(){return new SFString(this.getValue())},getTypeName:function(){return"SFString"},getType:function(){return X3DConstants.SFString},set:function(value){X3DField.prototype.set.call(this,String(value))},valueOf:X3DField.prototype.getValue,toString:function(){return'"'+SFString.escape(this.getValue())+'"'}});Object.defineProperty(SFString.prototype,"length",{get:function(){return this.getValue().length},enumerable:true,configurable:false});return SFString});define("cobweb/Fields/SFTime",["jquery","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,X3DField,X3DConstants){function SFTime(value){if(this instanceof SFTime)return X3DField.call(this,arguments.length?+value:0);return X3DField.call(Object.create(SFTime.prototype),arguments.length?+value:0)}SFTime.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFTime,copy:function(){return new SFTime(this.getValue())},getTypeName:function(){return"SFTime"},getType:function(){return X3DConstants.SFTime},set:function(value){X3DField.prototype.set.call(this,+value)},valueOf:X3DField.prototype.getValue,toString:function(){return String(this.getValue())}});return SFTime});define("cobweb/Fields/SFVec4",["jquery","standard/Math/Numbers/Vector4","cobweb/Basic/X3DField","cobweb/Bits/X3DConstants"],function($,Vector4,X3DField,X3DConstants){function SFVec4(v){if(v.length){if(v[0]instanceof Vector4)return X3DField.call(this,v[0]);return X3DField.call(this,new Vector4(+v[0],+v[1],+v[2],+v[3]))}return X3DField.call(this,new Vector4(0,0,0,0))}SFVec4.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFVec4,copy:function(){return new this.constructor(this.getValue().copy())},equals:function(vector){return this.getValue().equals(vector.getValue())},set:function(value){this.getValue().assign(value)},negate:function(){return new this.constructor(Vector4.negate(this.getValue().copy()))},add:function(vector){return new this.constructor(Vector4.add(this.getValue(),vector.getValue()))},subtract:function(vector){return new this.constructor(Vector4.subtract(this.getValue(),vector.getValue()))},multiply:function(value){return new this.constructor(Vector4.multiply(this.getValue(),value))},divide:function(value){return new this.constructor(Vector4.divide(this.getValue(),value))},dot:function(vector){return new this.constructor(this.getValue().dot(vector.getValue()))},normalize:function(vector){return new this.constructor(Vector4.normalize(this.getValue()))},length:function(vector){return new this.constructor(this.getValue().abs())},toString:function(){return this.getValue().toString()}});Object.defineProperty(SFVec4.prototype,"x",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec4.prototype,"0",{get:function(){return this.getValue().x},set:function(value){this.getValue().x=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec4.prototype,"y",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec4.prototype,"1",{get:function(){return this.getValue().y},set:function(value){this.getValue().y=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec4.prototype,"z",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec4.prototype,"2",{get:function(){return this.getValue().z},set:function(value){this.getValue().z=value;this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFVec4.prototype,"w",{get:function(){return this.getValue().w},set:function(value){this.getValue().w=value;this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFVec4.prototype,"3",{get:function(){return this.getValue().w},set:function(value){this.getValue().w=value;this.addEvent()},enumerable:false,configurable:false});function SFVec4d(x,y,z,w){if(this instanceof SFVec4d)return SFVec4.call(this,arguments);return SFVec4.call(Object.create(SFVec4d.prototype),arguments)}SFVec4d.prototype=$.extend(Object.create(SFVec4.prototype),{constructor:SFVec4d,getTypeName:function(){return"SFVec4d"},getType:function(){return X3DConstants.SFVec4d}});function SFVec4f(x,y,z,w){if(this instanceof SFVec4f)return SFVec4.call(this,arguments);return SFVec4.call(Object.create(SFVec4f.prototype),arguments)}SFVec4f.prototype=$.extend(Object.create(SFVec4.prototype),{constructor:SFVec4f,getTypeName:function(){return"SFVec4f"},getType:function(){return X3DConstants.SFVec4f}});return{SFVec4d:SFVec4d,SFVec4f:SFVec4f}});define("cobweb/Fields/ArrayFields",["jquery","cobweb/Fields/SFBool","cobweb/Fields/SFColor","cobweb/Fields/SFColorRGBA","cobweb/Fields/SFDouble","cobweb/Fields/SFFloat","cobweb/Fields/SFImage","cobweb/Fields/SFInt32","cobweb/Fields/SFMatrix3","cobweb/Fields/SFMatrix4","cobweb/Fields/SFNode","cobweb/Fields/SFRotation","cobweb/Fields/SFString","cobweb/Fields/SFTime","cobweb/Fields/SFVec2","cobweb/Fields/SFVec3","cobweb/Fields/SFVec4","cobweb/Basic/X3DArrayField","cobweb/Bits/X3DConstants"],function($,SFBool,SFColor,SFColorRGBA,SFDouble,SFFloat,SFImage,SFInt32,SFMatrix3,SFMatrix4,SFNode,SFRotation,SFString,SFTime,SFVec2,SFVec3,SFVec4,X3DArrayField,X3DConstants){var SFMatrix3d=SFMatrix3.SFMatrix3d,SFMatrix3f=SFMatrix3.SFMatrix3f,SFMatrix4d=SFMatrix4.SFMatrix4d,SFMatrix4f=SFMatrix4.SFMatrix4f,SFVec2d=SFVec2.SFVec2d,SFVec2f=SFVec2.SFVec2f,SFVec3d=SFVec3.SFVec3d,SFVec3f=SFVec3.SFVec3f,SFVec4d=SFVec4.SFVec4d,SFVec4f=SFVec4.SFVec4f;function MFBool(value){if(this instanceof MFBool)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFBool.prototype),arguments)}MFBool.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFBool,valueType_:SFBool,getTypeName:function(){return"MFBool"},getType:function(){return X3DConstants.MFBool}});function MFColor(value){if(this instanceof MFColor)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFColor.prototype),arguments)}MFColor.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFColor,valueType_:SFColor,getTypeName:function(){return"MFColor"},getType:function(){return X3DConstants.MFColor}});function MFColorRGBA(value){if(this instanceof MFColorRGBA)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFColorRGBA.prototype),arguments)}MFColorRGBA.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFColorRGBA,valueType_:SFColorRGBA,getTypeName:function(){return"MFColorRGBA"},getType:function(){return X3DConstants.MFColorRGBA}});function MFDouble(value){if(this instanceof MFDouble)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFDouble.prototype),arguments)}MFDouble.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFDouble,valueType_:SFDouble,getTypeName:function(){return"MFDouble"},getType:function(){return X3DConstants.MFDouble}});function MFFloat(value){if(this instanceof MFFloat)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFFloat.prototype),arguments)}MFFloat.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFFloat,valueType_:SFFloat,getTypeName:function(){return"MFFloat"},getType:function(){return X3DConstants.MFFloat}});function MFImage(value){if(this instanceof MFImage)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFImage.prototype),arguments)}MFImage.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFImage,valueType_:SFImage,getTypeName:function(){return"MFImage"},getType:function(){return X3DConstants.MFImage}});function MFInt32(value){if(this instanceof MFInt32)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFInt32.prototype),arguments)}MFInt32.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFInt32,valueType_:SFInt32,getTypeName:function(){return"MFInt32"},getType:function(){return X3DConstants.MFInt32}});function MFMatrix3d(value){if(this instanceof MFMatrix3d)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFMatrix3d.prototype),arguments)}MFMatrix3d.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFMatrix3d,valueType_:SFMatrix3d,getTypeName:function(){return"MFMatrix3d"},getType:function(){return X3DConstants.MFMatrix3d}});function MFMatrix3f(value){if(this instanceof MFMatrix3f)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFMatrix3f.prototype),arguments)}MFMatrix3f.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFMatrix3f,valueType_:SFMatrix3f,getTypeName:function(){return"MFMatrix3f"},getType:function(){return X3DConstants.MFMatrix3f}});function MFMatrix4d(value){if(this instanceof MFMatrix4d)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFMatrix4d.prototype),arguments)}MFMatrix4d.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFMatrix4d,valueType_:SFMatrix4d,getTypeName:function(){return"MFMatrix4d"},getType:function(){return X3DConstants.MFMatrix4d}});function MFMatrix4f(value){if(this instanceof MFMatrix4f)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFMatrix4f.prototype),arguments)}MFMatrix4f.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFMatrix4f,valueType_:SFMatrix4f,getTypeName:function(){return"MFMatrix4f"},getType:function(){return X3DConstants.MFMatrix4f}});function MFNode(value){if(this instanceof MFNode)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFNode.prototype),arguments)}MFNode.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFNode,valueType_:SFNode,getTypeName:function(){return"MFNode"},getType:function(){return X3DConstants.MFNode},clone:function(){var clone=new MFNode;clone.setValue(this);return clone},copy:function(executionContext){var copy=new MFNode,array1=this.getValue(),array2=copy.getValue();for(var i=0,length=array1.length;i<length;++i){var value=array1[i].copy(executionContext);value.addParent(copy);array2.push(value)}return copy}});function MFRotation(value){if(this instanceof MFRotation)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFRotation.prototype),arguments)}MFRotation.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFRotation,valueType_:SFRotation,getTypeName:function(){return"MFRotation"},getType:function(){return X3DConstants.MFRotation}});function MFString(value){if(this instanceof MFString)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFString.prototype),arguments)}MFString.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFString,valueType_:SFString,getTypeName:function(){return"MFString"},getType:function(){return X3DConstants.MFString}});function MFTime(value){if(this instanceof MFTime)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFTime.prototype),arguments)}MFTime.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFTime,valueType_:SFTime,getTypeName:function(){return"MFTime"},getType:function(){return X3DConstants.MFTime}});function MFVec2d(value){if(this instanceof MFVec2d)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec2d.prototype),arguments)}MFVec2d.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec2d,valueType_:SFVec2d,getTypeName:function(){return"MFVec2d"},getType:function(){return X3DConstants.MFVec2d}});function MFVec2f(value){if(this instanceof MFVec2f)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec2f.prototype),arguments)}MFVec2f.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec2f,valueType_:SFVec2f,getTypeName:function(){return"MFVec2f"},getType:function(){return X3DConstants.MFVec2f}});function MFVec3d(value){if(this instanceof MFVec3d)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec3d.prototype),arguments)}MFVec3d.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec3d,valueType_:SFVec3d,getTypeName:function(){return"MFVec3d"},getType:function(){return X3DConstants.MFVec3d}});function MFVec3f(value){if(this instanceof MFVec3f)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec3f.prototype),arguments)}MFVec3f.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec3f,valueType_:SFVec3f,getTypeName:function(){return"MFVec3f"},getType:function(){return X3DConstants.MFVec3f}});function MFVec4d(value){if(this instanceof MFVec4d)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec4d.prototype),arguments)}MFVec4d.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec4d,valueType_:SFVec4d,getTypeName:function(){return"MFVec4d"},getType:function(){return X3DConstants.MFVec4d}});function MFVec4f(value){if(this instanceof MFVec4f)return X3DArrayField.call(this,arguments);return X3DArrayField.call(Object.create(MFVec4f.prototype),arguments)}MFVec4f.prototype=$.extend(Object.create(X3DArrayField.prototype),{constructor:MFVec4f,valueType_:SFVec4f,getTypeName:function(){return"MFVec4f"},getType:function(){return X3DConstants.MFVec4f}});var ArrayFields={MFBool:MFBool,MFColor:MFColor,MFColorRGBA:MFColorRGBA,MFDouble:MFDouble,MFFloat:MFFloat,MFImage:MFImage,MFInt32:MFInt32,MFMatrix3d:MFMatrix3d,MFMatrix3f:MFMatrix3f,MFMatrix4d:MFMatrix4d,MFMatrix4f:MFMatrix4f,MFNode:MFNode,MFRotation:MFRotation,MFString:MFString,MFTime:MFTime,MFVec2d:MFVec2d,MFVec2f:MFVec2f,MFVec3d:MFVec3d,MFVec3f:MFVec3f,MFVec4d:MFVec4d,MFVec4f:MFVec4f};Object.preventExtensions(ArrayFields);Object.freeze(ArrayFields);Object.seal(ArrayFields);return ArrayFields});define("cobweb/Fields/SFImage",["jquery","cobweb/Basic/X3DField","cobweb/Fields/ArrayFields","cobweb/Bits/X3DConstants"],function($,X3DField,ArrayFields,X3DConstants){var MFInt32=ArrayFields.MFInt32;function Image(width,height,comp,array){this.width=width;this.height=height;this.comp=comp;this.array=new MFInt32;this.array.setValue(array);this.array.length=width*height}Image.prototype={constructor:Image,copy:function(){return new Image(this.width,this.height,this.comp,this.array)},equals:function(image){return this.width===image.width&&this.height===image.height&&this.comp===image.comp&&this.array.equals(image.array)},assign:function(image){this.width=image.width;this.height=image.height;this.comp=image.comp;this.array.set(image.array.getValue())},set:function(width,height,comp,array){this.width=width;this.height=height;this.comp=comp;this.array.set(array)},setWidth:function(value){this.width=value;this.array.length=this.width*this.height},getWidth:function(){return this.width},setHeight:function(value){this.height=value;this.array.length=this.width*this.height},getHeight:function(){return this.height},setComp:function(value){this.comp=value},getComp:function(){return this.comp},setArray:function(value){this.array.setValue(value);this.array.length=this.width*this.height},getArray:function(){return this.array}};function SFImage(width,height,comp,array){if(this instanceof SFImage){if(arguments.length===4)X3DField.call(this,new Image(+width,+height,+comp,array));else X3DField.call(this,new Image(0,0,0,new MFInt32));this.getValue().getArray().addParent(this);this.addInterest(this,"set_size__");return this}return SFImage.apply(Object.create(SFImage.prototype),arguments)}SFImage.prototype=$.extend(Object.create(X3DField.prototype),{constructor:SFImage,set_size__:function(){this.getValue().getArray().length=this.width*this.height},copy:function(){return new SFImage(this.getValue())},equals:function(image){return this.getValue().equals(image.getValue())},set:function(image){this.getValue().assign(image)},getTypeName:function(){return"SFImage"},getType:function(){return X3DConstants.SFImage},toString:function(){return this.width+" "+this.height+" "+this.comp}});Object.defineProperty(SFImage.prototype,"width",{get:function(){return this.getValue().getWidth()},set:function(value){this.getValue().setWidth(value);this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFImage.prototype,"x",{get:function(){return this.getValue().getWidth()},set:function(value){this.getValue().setWidth(value);this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFImage.prototype,"height",{get:function(){return this.getValue().getHeight()},set:function(value){this.getValue().setHeight(value);this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFImage.prototype,"y",{get:function(){return this.getValue().getHeight()},set:function(value){this.getValue().setHeight(value);this.addEvent()},enumerable:false,configurable:false});Object.defineProperty(SFImage.prototype,"comp",{get:function(){return this.getValue().getComp()},set:function(value){this.getValue().setComp(value);this.addEvent()},enumerable:true,configurable:false});Object.defineProperty(SFImage.prototype,"array",{get:function(){return this.getValue().getArray()},set:function(value){this.getValue().setArray(value);this.addEvent()},enumerable:true,configurable:false});return SFImage});define("cobweb/Fields",["jquery","cobweb/Fields/SFBool","cobweb/Fields/SFColor","cobweb/Fields/SFColorRGBA","cobweb/Fields/SFDouble","cobweb/Fields/SFFloat","cobweb/Fields/SFImage","cobweb/Fields/SFInt32","cobweb/Fields/SFMatrix3","cobweb/Fields/SFMatrix4","cobweb/Fields/SFNode","cobweb/Fields/SFRotation","cobweb/Fields/SFString","cobweb/Fields/SFTime","cobweb/Fields/SFVec2","cobweb/Fields/SFVec3","cobweb/Fields/SFVec4","cobweb/Fields/ArrayFields"],function($,SFBool,SFColor,SFColorRGBA,SFDouble,SFFloat,SFImage,SFInt32,SFMatrix3,SFMatrix4,SFNode,SFRotation,SFString,SFTime,SFVec2,SFVec3,SFVec4,ArrayFields){var Fields=$.extend({SFBool:SFBool,SFColor:SFColor,SFColorRGBA:SFColorRGBA,SFDouble:SFDouble,SFFloat:SFFloat,SFImage:SFImage,SFInt32:SFInt32,SFMatrix3d:SFMatrix3.SFMatrix3d,SFMatrix3f:SFMatrix3.SFMatrix3f,SFMatrix4d:SFMatrix4.SFMatrix4d,SFMatrix4f:SFMatrix4.SFMatrix4f,SFNode:SFNode,SFRotation:SFRotation,SFString:SFString,SFTime:SFTime,SFVec3d:SFVec2.SFVec2d,SFVec2f:SFVec2.SFVec2f,SFVec2d:SFVec3.SFVec3d,SFVec3f:SFVec3.SFVec3f,SFVec4d:SFVec4.SFVec4d,SFVec4f:SFVec4.SFVec4f,VrmlMatrix:SFMatrix4.VrmlMatrix},ArrayFields);Object.preventExtensions(Fields);Object.freeze(Fields);Object.seal(Fields);return Fields});define("cobweb/Base/X3DEventObject",["jquery","cobweb/Base/X3DChildObject","cobweb/Base/Event"],function($,X3DChildObject,Event){function X3DEventObject(browser){X3DChildObject.call(this);this.browser=browser}X3DEventObject.prototype=$.extend(Object.create(X3DChildObject.prototype),{constructor:X3DEventObject,getBrowser:function(){return this.browser},getExtendedEventHandling:function(){return true},addEvent:function(field){if(field.getTainted())return;field.setTainted(true);this.addEventObject(field,Event.create(field))},addEventObject:function(field,event){this.getBrowser().addBrowserEvent();this.getBrowser().addTaintedField(field,event);if(this.getTainted())return;if(field.isInput()||this.getExtendedEventHandling()&&!field.isOutput()){this.setTainted(true);this.getBrowser().addTaintedNode(this)}},addNodeEvent:function(){if(this.getTainted())return;this.setTainted(true);this.getBrowser().addTaintedNode(this);this.getBrowser().addBrowserEvent()},processEvents:function(){this.setTainted(false);this.processInterests()}});return X3DEventObject});define("cobweb/Basic/X3DBaseNode",["jquery","cobweb/Base/X3DEventObject","cobweb/Base/Event","cobweb/Basic/X3DFieldDefinition","cobweb/Fields","cobweb/Bits/X3DConstants"],function($,X3DEventObject,Event,X3DFieldDefinition,Fields,X3DConstants){with(Fields){function X3DBaseNode(browser,executionContext){if(this.hasOwnProperty("executionContext"))return;X3DEventObject.call(this,browser);this.executionContext=executionContext;this.type=[X3DConstants.X3DBaseNode];this.fields={};this.preDefinedFields={};this.userDefinedFields={};this.addChildren("isLive",new SFBool(true));for(var i=0;i<this.fieldDefinitions.length;++i)this.addField(this.fieldDefinitions[i])}X3DBaseNode.prototype=$.extend(Object.create(X3DEventObject.prototype),{constructor:X3DBaseNode,fieldDefinitions:[],$initialized:false,create:function(executionContext){return new this.constructor(executionContext)},getScene:function(){var executionContext=this.executionContext;while(!executionContext.isRootContext())executionContext=executionContext.getExecutionContext();return executionContext},getExecutionContext:function(){return this.executionContext},addType:function(value){this.type.push(value)},getType:function(){return this.type},getInnerNode:function(){return this},isInitialized:function(){return this.$initialized},isLive:function(){return this.isLive_},setup:function(){if(this.$initialized)return;this.$initialized=true;for(var i=0;i<this.fieldDefinitions.length;++i){var field=this.fields[this.fieldDefinitions[i].name];field.updateReferences();field.setTainted(false)}this.initialize()},initialize:function(){},eventsProcessed:function(){},copy:function(executionContext){var name=this.getName();if(name.length){try{return executionContext.getNamedNode(name).getValue()}catch(error){}}var copy=this.create(executionContext);if(name.length)executionContext.updateNamedNode(name,copy);for(var i=0,length=copy.fieldDefinitions.length;i<length;++i){try{var fieldDefinition=copy.fieldDefinitions[i],field1=this.preDefinedFields[fieldDefinition.name],field2=copy.getField(fieldDefinition.name);field2.setFieldValue(field1.getFieldValue());if(field1.hasReferences()){for(var id in field1.getReferences()){var originalReference=field1.getReferences()[id];try{field2.addReference(executionContext.getField(originalReference.getName()))}catch(error){console.log(error.message)}}}else{if(field1.getAccessType()&X3DConstants.initializeOnly)field2.set(field1.copy(executionContext).getValue())}}catch(error){console.log(error.message)}}for(var name in this.userDefinedFields){var field1=this.userDefinedFields[name],field2=field1.copy(executionContext);copy.addUserDefinedField(field1.getAccessType(),field1.getName(),field2);field2.setFieldValue(field1.getFieldValue());if(field1.hasReferences()){for(var id in field1.getReferences()){var originalReference=field1.getReferences()[id];try{field2.addReference(executionContext.getField(originalReference.getName()))}catch(error){console.log("No reference '"+originalReference.getName()+"' inside execution context "+executionContext.getTypeName()+" '"+executionContext.getName()+"'.")}}}}executionContext.addUninitializedNode(copy);return copy},addChildren:function(name,field){for(var i=0;i<arguments.length;i+=2)this.addChild(arguments[i+0],arguments[i+1])},addChild:function(name,field){field.addParent(this);field.setName(name);Object.defineProperty(this,name+"_",{get:function(){return this}.bind(field),set:field.setValue.bind(field),enumerable:true,configurable:false})},addField:function(fieldDefinition){var accessType=fieldDefinition.accessType,name=fieldDefinition.name,field=fieldDefinition.value.clone();field.setTainted(true);field.addParent(this);field.setName(name);field.setAccessType(accessType);this.addAlias(name,field,fieldDefinition.userDefined)},addAlias:function(name,field,userDefined){this.fields[name]=field;this.preDefinedFields[name]=field;if(field.getAccessType()===X3DConstants.inputOutput){this.fields["set_"+name]=field;this.fields[name+"_changed"]=field}if(userDefined)return;Object.defineProperty(this,name+"_",{get:function(){return this}.bind(field),set:field.setValue.bind(field),enumerable:true,configurable:false})},removeField:function(name){var field=this.fields[name];delete this.fields[name];delete this.userDefinedFields[name];var fieldDefinitions=this.fieldDefinitions.getValue();for(var i=0;i<fieldDefinitions.length;++i){if(fieldDefinitions[i].name===name){fieldDefinitions.splice(i,1);break}}},getField:function(name){var field=this.fields[name];if(field)return field;throw Error("Unkown field '"+name+"' in node class "+this.getTypeName()+".")},getFieldDefinitions:function(){return this.fieldDefinitions},hasUserDefinedFields:function(){return false},addUserDefinedField:function(accessType,name,field){if(this.fields[name])this.removeField(name);field.setTainted(true);field.addParent(this);field.setName(name);field.setAccessType(accessType);this.fieldDefinitions.getValue().push(new X3DFieldDefinition(accessType,name,field,true));this.fields[name]=field;this.userDefinedFields[name]=field;if(field.getAccessType()===X3DConstants.inputOutput){this.fields["set_"+name]=field;this.fields[name+"_changed"]=field}},getUserDefinedFields:function(){return this.userDefinedFields},getCDATA:function(){return null},traverse:function(){},beginUpdate:function(){if(this.isLive().getValue())return;this.isLive().setValue(true);this.isLive().processEvent(Event.create(this.isLive()))},endUpdate:function(){if(this.isLive().getValue()){this.isLive().setValue(false);this.isLive().processEvent(Event.create(this.isLive()))}},toString:function(){return this.getTypeName()+" { }"}});return X3DBaseNode}});define("cobweb/Browser/Core/PrimitiveQuality",[],function(){var i=0;var PrimitiveQuality={LOW:i++,MEDIUM:i++,HIGH:i++};Object.preventExtensions(PrimitiveQuality);Object.freeze(PrimitiveQuality);Object.seal(PrimitiveQuality);return PrimitiveQuality});define("cobweb/Browser/Core/TextureQuality",[],function(){var i=0;var TextureQuality={LOW:i++,MEDIUM:i++,HIGH:i++};Object.preventExtensions(TextureQuality);Object.freeze(TextureQuality);Object.seal(TextureQuality);return TextureQuality});define("lib/dataStorage",[],function(){var handler={get:function(target,key){if(key in target)return target[key];if(localStorage[key]===undefined)return undefined;return JSON.parse(localStorage[key])},set:function(target,key,value){if(value===undefined)localStorage.removeItem(key);else localStorage[key]=JSON.stringify(value);return true}};function DataStorage(){return new Proxy(this,handler)
}DataStorage.prototype={constructor:DataStorage,clear:function(){return localStorage.clear()}};return new DataStorage});define("cobweb/Browser/Core/BrowserOptions",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Basic/X3DBaseNode","cobweb/Bits/X3DConstants","cobweb/Browser/Core/PrimitiveQuality","cobweb/Browser/Core/TextureQuality","lib/dataStorage"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DBaseNode,X3DConstants,PrimitiveQuality,TextureQuality,dataStorage){with(Fields){function BrowserOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.addAlias("AntiAliased",this.Antialiased_);this.primitiveQuality=PrimitiveQuality.MEDIUM;this.textureQuality=TextureQuality.MEDIUM}BrowserOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:BrowserOptions,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"SplashScreen",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"Dashboard",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"Rubberband",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"EnableInlineViewpoints",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"Antialiased",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"TextureQuality",new SFString("MEDIUM")),new X3DFieldDefinition(X3DConstants.inputOutput,"PrimitiveQuality",new SFString("MEDIUM")),new X3DFieldDefinition(X3DConstants.inputOutput,"QualityWhenMoving",new SFString("MEDIUM")),new X3DFieldDefinition(X3DConstants.inputOutput,"Shading",new SFString("GOURAUD")),new X3DFieldDefinition(X3DConstants.inputOutput,"MotionBlur",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"Gravity",new SFFloat(9.80665))]),getTypeName:function(){return"BrowserOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"browserOptions"},initialize:function(){X3DBaseNode.prototype.initialize.call(this);this.Rubberband_.addInterest(this,"set_rubberband__");this.PrimitiveQuality_.addInterest(this,"set_primitiveQuality__");this.TextureQuality_.addInterest(this,"set_textureQuality__");this.Shading_.addInterest(this,"set_shading__");this.getBrowser().shutdown().addInterest(this,"set_shutdown__");this.configure()},configure:function(){var rubberband=dataStorage["BrowserOptions.Rubberband"],primitiveQuality=dataStorage["BrowserOptions.PrimitiveQuality"],textureQuality=dataStorage["BrowserOptions.TextureQuality"];if(rubberband!==undefined&&rubberband!==this.Rubberband_.getValue())this.Rubberband_=rubberband;if(primitiveQuality!==undefined&&primitiveQuality!==this.PrimitiveQuality_.getValue())this.PrimitiveQuality_=primitiveQuality;if(textureQuality!==undefined&&textureQuality!==this.TextureQuality_.getValue())this.TextureQuality_=textureQuality},getPrimitiveQuality:function(){return this.primitiveQuality},getTextureQuality:function(){return this.textureQuality},set_shutdown__:function(){var fieldDefinitions=this.getFieldDefinitions();for(var i=0;i<fieldDefinitions.length;++i){var fieldDefinition=fieldDefinitions[i],field=this.getField(fieldDefinition.name);if(!field.equals(fieldDefinition.value))field.setValue(fieldDefinition.value)}this.configure()},set_rubberband__:function(rubberband){dataStorage["BrowserOptions.Rubberband"]=rubberband.getValue()},set_primitiveQuality__:function(primitiveQuality){dataStorage["BrowserOptions.PrimitiveQuality"]=primitiveQuality.getValue();var cone=this.getBrowser().getConeOptions(),cylinder=this.getBrowser().getCylinderOptions(),sphere=this.getBrowser().getSphereOptions();switch(primitiveQuality.getValue()){case"LOW":this.primitiveQuality=PrimitiveQuality.LOW;cone.vDimension_=16;cylinder.vDimension_=16;sphere.uDimension_=24;sphere.vDimension_=12;break;case"HIGH":this.primitiveQuality=PrimitiveQuality.HIGH;cone.vDimension_=32;cylinder.vDimension_=32;sphere.uDimension_=40;sphere.vDimension_=20;break;default:this.primitiveQuality=PrimitiveQuality.MEDIUM;cone.vDimension_=20;cylinder.vDimension_=20;sphere.uDimension_=32;sphere.vDimension_=16;break}},set_textureQuality__:function(textureQuality){dataStorage["BrowserOptions.TextureQuality"]=textureQuality.getValue();switch(textureQuality.getValue()){case"LOW":this.textureQuality=TextureQuality.LOW;break;case"HIGH":this.textureQuality=TextureQuality.HIGH;break;default:this.textureQuality=TextureQuality.MEDIUM;break}},set_shading__:function(shading){this.getBrowser().setDefaultShader(shading.getValue())}});return BrowserOptions}});define("cobweb/Browser/Core/RenderingProperties",["jquery","cobweb/Basic/X3DBaseNode"],function($,X3DBaseNode){function RenderingProperties(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext)}RenderingProperties.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:RenderingProperties,getTypeName:function(){return"RenderingProperties"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"renderingProperties"}});return RenderingProperties});define("cobweb/Browser/Core/Notification",["jquery","cobweb/Fields/SFString","cobweb/Basic/X3DBaseNode"],function($,SFString,X3DBaseNode){$.fn.textWidth=function(){var html_org=$(this).html();var html_calc="<span>"+html_org+"</span>";$(this).html(html_calc);var width=$(this).find("span:first").width();$(this).html(html_org);return width};function Notification(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext)}Notification.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:Notification,initialize:function(){X3DBaseNode.prototype.initialize.call(this);this.addChildren("string",new SFString);this.element=$("<div/>").addClass("cobweb-notification").appendTo(this.getBrowser().getXML().find(".cobweb-surface")).animate({width:0});this.string_.addInterest(this,"set_string__")},set_string__:function(){if(this.string_.length===0)return;this.element.text(this.string_.getValue());this.element.stop(true,true).fadeIn(0).animate({width:this.element.textWidth(this.string_.getValue())}).animate({delay:1},5e3).animate({width:0}).fadeOut(0)}});return Notification});define("locale/de",[],function(){return{"Cobweb X3D Browser":"Cobweb X3D Browser",Viewpoints:"Ansichtspunkte","Available Viewers":"Verf√ºgbare Betrachter","Examine Viewer":"Untersuchen","Walk Viewer":"Laufen","Fly Viewer":"Fliegen","Plane Viewer":"Ebenen Betrachter","None Viewer":"Kein Betrachter","Look At":"Auf Objekte zielen","Primitive Quality":"Qualit√§t der Grundobjekte","Texture Quality":"Textur Qualit√§t",Rubberband:"Gummiband","Display Rubberband":"Gummiband anzeigen","Browser Timings":"Zeitberechnung","Mute Browser":"Browser stumm schalten","Browser muted":"Browser stumm geschalten","Browser unmuted":"Browser Ton an","About Cobweb":"√úber Cobweb",High:"Hoch",Medium:"Mittel",Low:"Niedrig",high:"hoch",medium:"mittel",low:"niedrig",on:"an",off:"aus","Loading %d files":"Lade %d Datei","Loading %d file":"Lade %d Dateien","Loading done":"Fertig mit Laden","More Properties":"Mehr Eigenschaften","Less Properties":"Weniger Eigenschaften","Frame rate":"Bildrate",Speed:"Geschwindigkeit",Browser:"Browser",X3D:"X3D",Routing:"Routen",Picking:"Zeigeger√§t",Camera:"Kamera",Collision:"Kollision",Display:"Anzeige",Shapes:"Formen",Sensors:"Sensoren",fps:"BpS"}});define("locale/fr",[],function(){return{"Cobweb X3D Browser":"Cobweb X3D Navigateur",Viewpoints:"Points de vue","Available Viewers":"Visionneurs disponibles","Examine Viewer":"Examiner","Walk Viewer":"Aller","Fly Viewer":"Voler","Plane Viewer":"Visionneur de la plaine","None Viewer":"Pas de visionneur","Look At":"Regarder un objet de pr√®s","Primitive Quality":"Qualit√© des objets simples","Texture Quality":"Qualit√© des textures",Rubberband:"Bande √©lastique","Display Rubberband":"Pr√©senter le bande √©lastique","Browser Timings":"Calcul du temps","Mute Browser":"Rendre navigateur muet","Browser muted":"Navigateur muet","Browser unmuted":"Son de navigateur r√©activ√©","About Cobweb":"√Ä propos de Cobweb",High:"Haut",Medium:"Moyenne",Low:"Faible",high:"haut",medium:"moyenne",low:"faible",on:"marche",off:"arr√™t","Loading %d files":"T√©l√©charger %d fichiers","Loading %d file":"T√©l√©charger %d fichier","Loading done":"T√©l√©chargement fini","More Properties":"Plus de propri√©t√©s","Less Properties":"Moins de propri√©t√©s","Frame rate":"Fr√©quence",Speed:"V√©locit√©",Browser:"Navigateur",X3D:"X3D",Routing:"Routes",Picking:"Pointeur",Camera:"Cam√©ra",Collision:"Collision",Display:"Visualisation",Shapes:"Formes",Sensors:"Senseurs",fps:"fps"}});define("lib/gettext",["locale/de","locale/fr"],function(de,fr){var ƒ∫ocales={de:de,fr:fr};function gettext(string){var language=(navigator.language||navigator.userLanguage).split("-")[0],ƒ∫ocale=ƒ∫ocales[language];if(ƒ∫ocale===undefined)return string;var translation=ƒ∫ocale[string];if(translation===undefined)return string;return translation}gettext.count=function(count,singular,plural){return count==1?gettext(singular):gettext(plural)};return gettext});define("cobweb/Browser/Core/BrowserTimings",["jquery","cobweb/Fields/SFBool","cobweb/Basic/X3DBaseNode","lib/dataStorage","lib/gettext"],function($,SFBool,X3DBaseNode,dataStorage,_){function f2(n){return Math.floor(n*100)/100}function BrowserTimings(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.addChildren("enabled",new SFBool)}BrowserTimings.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:BrowserTimings,getTypeName:function(){return"BrowserTimings"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"browserTimings"},initialize:function(){X3DBaseNode.prototype.initialize.call(this);this.enabled_.addInterest(this,"set_enabled__");this.localeOptions={minimumFractionDigits:2,maximumFractionDigits:2};this.type=dataStorage["BrowserTimings.type"]||"LESS";this.startTime=0;this.frames=0;this.element=$("<div>").addClass("cobweb-browser-timing").appendTo(this.getBrowser().getXML().find(".cobweb-surface"));this.table=$("<table>").appendTo(this.element);this.header=$("<thead>").append($("<tr>").append($("<th colspan=2>"))).appendTo(this.table);this.body=$("<tbody>").appendTo(this.table);this.footer=$("<tfoot>").append($("<tr>").append($("<td colspan=2>"))).appendTo(this.table);this.button=$("<button>").click(this.set_type__.bind(this)).appendTo(this.footer.find("td"));this.rows=[];this.set_button__();if(dataStorage["BrowserTimings.enabled"])this.enabled_=true},set_enabled__:function(enabled){dataStorage["BrowserTimings.enabled"]=enabled.getValue();if(enabled.getValue()){this.element.fadeIn();this.getBrowser().prepareEvents().addInterest(this,"update");this.update()}else{this.element.fadeOut();this.getBrowser().prepareEvents().removeInterest(this,"update")}},set_type__:function(){if(this.type==="MORE")this.type="LESS";else this.type="MORE";dataStorage["BrowserTimings.type"]=this.type;this.set_button__();this.build()},set_button__:function(){if(this.type==="MORE")this.button.text(_("Less Properties"));else this.button.text(_("More Properties"))},update:function(){var currentTime=this.getBrowser().getCurrentTime();if(currentTime-this.startTime>1){this.build();this.frames=0;this.startTime=currentTime}else++this.frames},build:function(){var browser=this.getBrowser(),currentTime=browser.getCurrentTime(),language=navigator.language||navigator.userLanguage,fixed=this.localeOptions,rows=this.rows,r=0;rows[r++]=$("<tr>").append($("<td>").text(_("Frame rate")+":")).append($("<td>").text(f2(this.frames/(currentTime-this.startTime)).toLocaleString(language,fixed)+" "+_("fps")));rows[r++]=$("<tr>").append($("<td>").text(_("Speed")+":")).append($("<td>").text(f2(browser.currentSpeed).toLocaleString(language,fixed)+" "+_("m/s")));if(this.type==="MORE"){var systemTime=browser.systemTime-browser.pickingTime,navigationTime=activeLayer&&browser.getCollisionCount()?activeLayer.collisionTime:0,collisionTime=browser.collisionTime+navigationTime,routingTime=browser.browserTime-(browser.cameraTime+browser.collisionTime+browser.displayTime+navigationTime),prepareEvents=Object.keys(browser.prepareEvents().getInterests()).length-1,sensors=Object.keys(browser.sensors().getInterests()).length,layers=browser.getWorld().getLayerSet().getLayers(),activeLayer=browser.getActiveLayer(),opaqueShapes=0,transparentShapes=0;for(var l=0;l<layers.length;++l){var layer=layers[l];opaqueShapes+=layer.numOpaqueShapes;transparentShapes+=layer.numTransparentShapes}rows[1].addClass("cobweb-more");rows[r++]=$("<tr>").append($("<td>").text(_("Browser")+":")).append($("<td>").text(f2(systemTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("X3D")+":")).append($("<td>").text(f2(browser.browserTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Routing")+":")).append($("<td>").text(f2(routingTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Picking")+":")).append($("<td>").text(f2(browser.pickingTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Camera")+":")).append($("<td>").text(f2(browser.cameraTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Collision")+":")).append($("<td>").text(f2(collisionTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Display")+":")).append($("<td>").text(f2(browser.displayTime).toLocaleString(language,fixed)+" "+_("ms")));rows[r++]=$("<tr>").append($("<td>").text(_("Shapes")+":")).append($("<td>").text(opaqueShapes+" + "+transparentShapes));rows[r++]=$("<tr>").append($("<td>").text(_("Sensors")+":")).append($("<td>").text(prepareEvents+sensors))}rows.length=r;this.header.find("th").text(_("Browser Timings"));this.body.empty();this.body.append(rows)}});return BrowserTimings});(function(factory){if(typeof define==="function"&&define.amd){define("lib/jquery-contextMenu/dist/jquery.contextMenu",["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}})(function($){$.support.htmlMenuitem="HTMLMenuItemElement"in window;$.support.htmlCommand="HTMLCommandElement"in window;$.support.eventSelectstart="onselectstart"in document.documentElement;if(!$.ui||!$.widget){$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove")}}catch(e){}}orig(elems)}}($.cleanData)}var $currentTrigger=null,initialized=false,$win=$(window),counter=0,namespaces={},menus={},types={},defaults={selector:null,appendTo:null,trigger:"right",autoHide:false,delay:200,reposition:true,classNames:{hover:"hover",disabled:"disabled",visible:"visible",notSelectable:"not-selectable",icon:"icon",iconEdit:"icon-edit",iconCut:"icon-cut",iconCopy:"icon-copy",iconPaste:"icon-paste",iconDelete:"icon-delete",iconAdd:"icon-add",iconQuit:"icon-quit"},determinePosition:function($menu){if($.ui&&$.ui.position){$menu.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none")}else{var offset=this.offset();offset.top+=this.outerHeight();offset.left+=this.outerWidth()/2-$menu.outerWidth()/2;$menu.css(offset)}},position:function(opt,x,y){var offset;if(!x&&!y){opt.determinePosition.call(this,opt.$menu);return}else if(x==="maintain"&&y==="maintain"){offset=opt.$menu.position()}else{offset={top:y,left:x}}var bottom=$win.scrollTop()+$win.height(),right=$win.scrollLeft()+$win.width(),height=opt.$menu.outerHeight(),width=opt.$menu.outerWidth();if(offset.top+height>bottom){offset.top-=height}if(offset.top<0){offset.top=0}if(offset.left+width>right){offset.left-=width}opt.$menu.css(offset)},positionSubmenu:function($menu){if($.ui&&$.ui.position){$menu.css("display","block").position({my:"left top",at:"right top",of:this,collision:"flipfit fit"}).css("display","")}else{var offset={top:0,left:this.outerWidth()};$menu.css(offset)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:$.noop,hide:$.noop},callback:null,items:{}},hoveract={timer:null,pageX:null,pageY:null},zindex=function($t){var zin=0,$tt=$t;while(true){zin=Math.max(zin,parseInt($tt.css("z-index"),10)||0);$tt=$tt.parent();if(!$tt||!$tt.length||"html body".indexOf($tt.prop("nodeName").toLowerCase())>-1){break}}return zin},handle={abortevent:function(e){e.preventDefault();e.stopImmediatePropagation()},contextmenu:function(e){var $this=$(this);if(e.data.trigger==="right"){e.preventDefault();e.stopImmediatePropagation()}if(e.data.trigger!=="right"&&e.data.trigger!=="demand"&&e.originalEvent){return}if($this.hasClass("context-menu-active")){return}if(!$this.hasClass("context-menu-disabled")){$currentTrigger=$this;if(e.data.build){var built=e.data.build($currentTrigger,e);if(built===false){return}e.data=$.extend(true,{},defaults,e.data,built||{});if(!e.data.items||$.isEmptyObject(e.data.items)){if(window.console){(console.error||console.log).call(console,"No items specified to show in contextMenu")}throw new Error("No Items specified")}e.data.$trigger=$currentTrigger;op.create(e.data)}var showMenu=false;for(var item in e.data.items){if(e.data.items.hasOwnProperty(item)){var visible;if($.isFunction(e.data.items[item].visible)){visible=e.data.items[item].visible.call($(e.currentTarget),item,e.data)}else if(typeof item.visible!=="undefined"){visible=e.data.items[item].visible===true}else{visible=true}if(visible){showMenu=true}}}if(showMenu){op.show.call($this,e.data,e.pageX,e.pageY)}}},click:function(e){e.preventDefault();e.stopImmediatePropagation();$(this).trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var $this=$(this);if($currentTrigger&&$currentTrigger.length&&!$currentTrigger.is($this)){$currentTrigger.data("contextMenu").$menu.trigger("contextmenu:hide")}if(e.button===2){$currentTrigger=$this.data("contextMenuActive",true)}},mouseup:function(e){var $this=$(this);if($this.data("contextMenuActive")&&$currentTrigger&&$currentTrigger.length&&$currentTrigger.is($this)&&!$this.hasClass("context-menu-disabled")){e.preventDefault();e.stopImmediatePropagation();$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))}$this.removeData("contextMenuActive")},mouseenter:function(e){var $this=$(this),$related=$(e.relatedTarget),$document=$(document);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}if($currentTrigger&&$currentTrigger.length){return}hoveract.pageX=e.pageX;hoveract.pageY=e.pageY;hoveract.data=e.data;$document.on("mousemove.contextMenuShow",handle.mousemove);hoveract.timer=setTimeout(function(){hoveract.timer=null;$document.off("mousemove.contextMenuShow");$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:hoveract.data,pageX:hoveract.pageX,pageY:hoveract.pageY}))},e.data.delay)},mousemove:function(e){hoveract.pageX=e.pageX;hoveract.pageY=e.pageY},mouseleave:function(e){var $related=$(e.relatedTarget);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}try{clearTimeout(hoveract.timer)}catch(e){}hoveract.timer=null},layerClick:function(e){var $this=$(this),root=$this.data("contextMenuRoot"),button=e.button,x=e.pageX,y=e.pageY,target,offset;e.preventDefault();e.stopImmediatePropagation();setTimeout(function(){var $window;var triggerAction=root.trigger==="left"&&button===0||root.trigger==="right"&&button===2;if(document.elementFromPoint){root.$layer.hide();target=document.elementFromPoint(x-$win.scrollLeft(),y-$win.scrollTop());root.$layer.show()}if(root.reposition&&triggerAction){if(document.elementFromPoint){if(root.$trigger.is(target)||root.$trigger.has(target).length){root.position.call(root.$trigger,root,x,y);return}}else{offset=root.$trigger.offset();$window=$(window);offset.top+=$window.scrollTop();if(offset.top<=e.pageY){offset.left+=$window.scrollLeft();if(offset.left<=e.pageX){offset.bottom=offset.top+root.$trigger.outerHeight();if(offset.bottom>=e.pageY){offset.right=offset.left+root.$trigger.outerWidth();if(offset.right>=e.pageX){root.position.call(root.$trigger,root,x,y);return}}}}}}if(target&&triggerAction){root.$trigger.one("contextmenu:hidden",function(){$(target).contextMenu({x:x,y:y})})}root.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,opt){if(!opt.isInput){e.preventDefault()}e.stopPropagation()},key:function(e){var opt={};if($currentTrigger){opt=$currentTrigger.data("contextMenu")||{}}switch(e.keyCode){case 9:case 38:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9&&e.shiftKey){e.preventDefault();opt.$selected&&opt.$selected.find("input, textarea, select").blur();opt.$menu.trigger("prevcommand");return}else if(e.keyCode===38&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else if(e.keyCode!==9||e.shiftKey){opt.$menu.trigger("prevcommand");return}case 40:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9){e.preventDefault();opt.$selected&&opt.$selected.find("input, textarea, select").blur();opt.$menu.trigger("nextcommand");return}else if(e.keyCode===40&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else{opt.$menu.trigger("nextcommand");return}break;case 37:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}if(!opt.$selected.parent().hasClass("context-menu-root")){var $parent=opt.$selected.parent().parent();opt.$selected.trigger("contextmenu:blur");opt.$selected=$parent;return}break;case 39:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}var itemdata=opt.$selected.data("contextMenu")||{};if(itemdata.$menu&&opt.$selected.hasClass("context-menu-submenu")){opt.$selected=null;itemdata.$selected=null;itemdata.$menu.trigger("nextcommand");return}break;case 35:case 36:if(opt.$selected&&opt.$selected.find("input, textarea, select").length){return}else{(opt.$selected&&opt.$selected.parent()||opt.$menu).children(":not(."+opt.classNames.disabled+", ."+opt.classNames.notSelectable+")")[e.keyCode===36?"first":"last"]().trigger("contextmenu:focus");e.preventDefault();return}break;case 13:handle.keyStop(e,opt);if(opt.isInput){if(opt.$selected&&!opt.$selected.is("textarea, select")){e.preventDefault();return}break}if(typeof opt.$selected!=="undefined"){opt.$selected.trigger("mouseup")}return;case 32:case 33:case 34:handle.keyStop(e,opt);return;case 27:handle.keyStop(e,opt);opt.$menu.trigger("contextmenu:hide");return;default:var k=String.fromCharCode(e.keyCode).toUpperCase();if(opt.accesskeys&&opt.accesskeys[k]){opt.accesskeys[k].$node.trigger(opt.accesskeys[k].$menu?"contextmenu:focus":"mouseup");return}break}e.stopPropagation();if(typeof opt.$selected!=="undefined"){opt.$selected.trigger(e)}},prevItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$prev=!opt.$selected||!opt.$selected.prev().length?$children.last():opt.$selected.prev(),$round=$prev;while($prev.hasClass(root.classNames.disabled)||$prev.hasClass(root.classNames.notSelectable)){if($prev.prev().length){$prev=$prev.prev()}else{$prev=$children.last()}if($prev.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($prev.get(0),e);var $input=$prev.find("input, textarea, select");if($input.length){$input.focus()}},nextItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$next=!opt.$selected||!opt.$selected.next().length?$children.first():opt.$selected.next(),$round=$next;while($next.hasClass(root.classNames.disabled)||$next.hasClass(root.classNames.notSelectable)){if($next.next().length){$next=$next.next()}else{$next=$children.first()}if($next.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($next.get(0),e);var $input=$next.find("input, textarea, select");if($input.length){$input.focus()}},focusInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.$selected=opt.$selected=$this;root.isInput=opt.isInput=true},blurInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.isInput=opt.isInput=false},menuMouseenter:function(){var root=$(this).data().contextMenuRoot;root.hovering=true},menuMouseleave:function(e){var root=$(this).data().contextMenuRoot;if(root.$layer&&root.$layer.is(e.relatedTarget)){root.hovering=false}},itemMouseenter:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.hovering=true;if(e&&root.$layer&&root.$layer.is(e.relatedTarget)){e.preventDefault();e.stopImmediatePropagation()}(opt.$menu?opt:root).$menu.children(".hover").trigger("contextmenu:blur");if($this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)){opt.$selected=null;return}$this.trigger("contextmenu:focus")},itemMouseleave:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(root!==opt&&root.$layer&&root.$layer.is(e.relatedTarget)){if(typeof root.$selected!=="undefined"){root.$selected.trigger("contextmenu:blur")}e.preventDefault();e.stopImmediatePropagation();root.$selected=opt.$selected=opt.$node;return}$this.trigger("contextmenu:blur")},itemClick:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot,key=data.contextMenuKey,callback;if(!opt.items[key]||$this.is("."+root.classNames.disabled+", .context-menu-submenu, .context-menu-separator, ."+root.classNames.notSelectable)){return}e.preventDefault();e.stopImmediatePropagation();if($.isFunction(root.callbacks[key])&&Object.prototype.hasOwnProperty.call(root.callbacks,key)){callback=root.callbacks[key]}else if($.isFunction(root.callback)){callback=root.callback}else{return}if(callback.call(root.$trigger,key,root)!==false){root.$menu.trigger("contextmenu:hide")}else if(root.$menu.parent().length){op.update.call(root.$trigger,root)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(e,data){var root=$(this).data("contextMenuRoot");op.hide.call(root.$trigger,root,data&&data.force)},focusItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;$this.addClass([root.classNames.hover,root.classNames.visible].join(" ")).siblings().removeClass(root.classNames.visible).filter(root.classNames.hover).trigger("contextmenu:blur");opt.$selected=root.$selected=$this;if(opt.$node){root.positionSubmenu.call(opt.$node,opt.$menu)}},blurItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(opt.autoHide){$this.removeClass(root.classNames.visible)}$this.removeClass(root.classNames.hover);opt.$selected=null}},op={show:function(opt,x,y){var $trigger=$(this),css={};$("#context-menu-layer").trigger("mousedown");opt.$trigger=$trigger;if(opt.events.show.call($trigger,opt)===false){$currentTrigger=null;return}op.update.call($trigger,opt);opt.position.call($trigger,opt,x,y);if(opt.zIndex){css.zIndex=zindex($trigger)+opt.zIndex}op.layer.call(opt.$menu,opt,css.zIndex);opt.$menu.find("ul").css("zIndex",css.zIndex+1);opt.$menu.css(css)[opt.animation.show](opt.animation.duration,function(){$trigger.trigger("contextmenu:visible")});$trigger.data("contextMenu",opt).addClass("context-menu-active");$(document).off("keydown.contextMenu").on("keydown.contextMenu",handle.key);if(opt.autoHide){$(document).on("mousemove.contextMenuAutoHide",function(e){var pos=$trigger.offset();pos.right=pos.left+$trigger.outerWidth();pos.bottom=pos.top+$trigger.outerHeight();if(opt.$layer&&!opt.hovering&&(!(e.pageX>=pos.left&&e.pageX<=pos.right)||!(e.pageY>=pos.top&&e.pageY<=pos.bottom))){opt.$menu.trigger("contextmenu:hide")}})}},hide:function(opt,force){var $trigger=$(this);if(!opt){opt=$trigger.data("contextMenu")||{}}if(!force&&opt.events&&opt.events.hide.call($trigger,opt)===false){return}$trigger.removeData("contextMenu").removeClass("context-menu-active");if(opt.$layer){setTimeout(function($layer){return function(){$layer.remove()}}(opt.$layer),10);try{delete opt.$layer}catch(e){opt.$layer=null}}$currentTrigger=null;opt.$menu.find("."+opt.classNames.hover).trigger("contextmenu:blur");opt.$selected=null;$(document).off(".contextMenuAutoHide").off("keydown.contextMenu");opt.$menu&&opt.$menu[opt.animation.hide](opt.animation.duration,function(){if(opt.build){opt.$menu.remove();$.each(opt,function(key){switch(key){case"ns":case"selector":case"build":case"trigger":return true;default:opt[key]=undefined;try{delete opt[key]}catch(e){}return true}})}setTimeout(function(){$trigger.trigger("contextmenu:hidden")},10)})},create:function(opt,root){if(root===undefined){root=opt}opt.$menu=$('<ul class="context-menu-list"></ul>').addClass(opt.className||"").data({contextMenu:opt,contextMenuRoot:root});$.each(["callbacks","commands","inputs"],function(i,k){opt[k]={};if(!root[k]){root[k]={}}});root.accesskeys||(root.accesskeys={});$.each(opt.items,function(key,item){var $t=$('<li class="context-menu-item"></li>').addClass(item.className||""),$label=null,$input=null;$t.on("click",$.noop);if(typeof item==="string"){item={type:"cm_seperator"}}item.$node=$t.data({contextMenu:opt,contextMenuRoot:root,contextMenuKey:key});if(typeof item.accesskey!=="undefined"){var aks=splitAccesskey(item.accesskey);for(var i=0,ak;ak=aks[i];i++){if(!root.accesskeys[ak]){root.accesskeys[ak]=item;item._name=item.name.replace(new RegExp("("+ak+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}}if(item.type&&types[item.type]){types[item.type].call($t,item,opt,root);$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)){k.callbacks[key]=item.callback}})}else{if(item.type==="cm_seperator"){$t.addClass("context-menu-separator "+opt.classNames.notSelectable)}else if(item.type==="html"){$t.addClass("context-menu-html "+opt.classNames.notSelectable)}else if(item.type){$label=$("<label></label>").appendTo($t);$("<span></span>").html(item._name||item.name).appendTo($label);$t.addClass("context-menu-input");opt.hasTypes=true;$.each([opt,root],function(i,k){k.commands[key]=item;k.inputs[key]=item})}else if(item.items){item.type="sub"}switch(item.type){case"seperator":break;case"text":$input=$('<input type="text" value="1" name="" value="">').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);break;case"textarea":$input=$('<textarea name=""></textarea>').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);if(item.height){$input.height(item.height)}break;case"checkbox":$input=$('<input type="checkbox" value="1" name="" value="">').attr("name","context-menu-input-"+key).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"radio":$input=$('<input type="radio" value="1" name="" value="">').attr("name","context-menu-input-"+item.radio).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"select":$input=$('<select name="">').attr("name","context-menu-input-"+key).appendTo($label);if(item.options){$.each(item.options,function(value,text){$("<option></option>").val(value).text(text).appendTo($input)});$input.val(item.selected)}break;case"sub":$("<span></span>").html(item._name||item.name).appendTo($t);
item.appendTo=item.$node;op.create(item,root);$t.data("contextMenu",item).addClass("context-menu-submenu");item.callback=null;break;case"html":$(item.html).appendTo($t);break;default:$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)){k.callbacks[key]=item.callback}});$("<span></span>").html(item._name||item.name||"").appendTo($t);break}if(item.type&&item.type!=="sub"&&item.type!=="html"&&item.type!=="cm_seperator"){$input.on("focus",handle.focusInput).on("blur",handle.blurInput);if(item.events){$input.on(item.events,opt)}}if(item.icon){if($.isFunction(item.icon)){item._icon=item.icon.call(this,$t,key,item)}else{item._icon=opt.classNames.icon+" "+opt.classNames.icon+"-"+item.icon}$t.addClass(item._icon)}}item.$input=$input;item.$label=$label;$t.appendTo(opt.$menu);if(!opt.hasTypes&&$.support.eventSelectstart){$t.on("selectstart.disableTextSelect",handle.abortevent)}});if(!opt.$node){opt.$menu.css("display","none").addClass("context-menu-root")}opt.$menu.appendTo(opt.appendTo||document.body)},resize:function($menu,nested){$menu.css({position:"absolute",display:"block"});$menu.data("width",Math.ceil($menu.width()));$menu.css({position:"static",minWidth:"0px",maxWidth:"100000px"});$menu.find("> li > ul").each(function(){op.resize($(this),true)});if(!nested){$menu.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).width(function(){return $(this).data("width")})}},update:function(opt,root){var $trigger=this;if(root===undefined){root=opt;op.resize(opt.$menu)}opt.$menu.children().each(function(){var $item=$(this),key=$item.data("contextMenuKey"),item=opt.items[key],disabled=$.isFunction(item.disabled)&&item.disabled.call($trigger,key,root)||item.disabled===true,visible;if($.isFunction(item.visible)){visible=item.visible.call($trigger,key,root)}else if(typeof item.visible!=="undefined"){visible=item.visible===true}else{visible=true}$item[visible?"show":"hide"]();$item[disabled?"addClass":"removeClass"](root.classNames.disabled);if($.isFunction(item.icon)){$item.removeClass(item._icon);item._icon=item.icon.call(this,$trigger,key,item);$item.addClass(item._icon)}if(item.type){$item.find("input, select, textarea").prop("disabled",disabled);switch(item.type){case"text":case"textarea":item.$input.val(item.value||"");break;case"checkbox":case"radio":item.$input.val(item.value||"").prop("checked",!!item.selected);break;case"select":item.$input.val(item.selected||"");break}}if(item.$menu){op.update.call($trigger,item,root)}})},layer:function(opt,zIndex){var $layer=opt.$layer=$('<div id="context-menu-layer" style="position:fixed; z-index:'+zIndex+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:$win.height(),width:$win.width(),display:"block"}).data("contextMenuRoot",opt).insertBefore(this).on("contextmenu",handle.abortevent).on("mousedown",handle.layerClick);if(document.body.style.maxWidth===undefined){$layer.css({position:"absolute",height:$(document).height()})}return $layer}};function splitAccesskey(val){var t=val.split(/\s+/),keys=[];for(var i=0,k;k=t[i];i++){k=k.charAt(0).toUpperCase();keys.push(k)}return keys}$.fn.contextMenu=function(operation){var $t=this,$o=operation;if(this.length>0){if(operation===undefined){this.first().trigger("contextmenu")}else if(operation.x!==undefined&&operation.y!==undefined){this.first().trigger($.Event("contextmenu",{pageX:operation.x,pageY:operation.y}))}else if(operation==="hide"){var $menu=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;$menu&&$menu.trigger("contextmenu:hide")}else if(operation==="destroy"){$.contextMenu("destroy",{context:this})}else if($.isPlainObject(operation)){operation.context=this;$.contextMenu("create",operation)}else if(operation){this.removeClass("context-menu-disabled")}else if(!operation){this.addClass("context-menu-disabled")}}else{$.each(menus,function(){if(this.selector===$t.selector){$o.data=this;$.extend($o.data,{trigger:"demand"})}});handle.contextmenu.call($o.target,$o)}return this};$.contextMenu=function(operation,options){if(typeof operation!=="string"){options=operation;operation="create"}if(typeof options==="string"){options={selector:options}}else if(options===undefined){options={}}var o=$.extend(true,{},defaults,options||{});var $document=$(document);var $context=$document;var _hasContext=false;if(!o.context||!o.context.length){o.context=document}else{$context=$(o.context).first();o.context=$context.get(0);_hasContext=o.context!==document}switch(operation){case"create":if(!o.selector){throw new Error("No selector specified")}if(o.selector.match(/.context-menu-(list|item|input)($|\s)/)){throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className')}if(!o.build&&(!o.items||$.isEmptyObject(o.items))){throw new Error("No Items specified")}counter++;o.ns=".contextMenu"+counter;if(!_hasContext){namespaces[o.selector]=o.ns}menus[o.ns]=o;if(!o.trigger){o.trigger="right"}if(!initialized){$document.on({"contextmenu:hide.contextMenu":handle.hideMenu,"prevcommand.contextMenu":handle.prevItem,"nextcommand.contextMenu":handle.nextItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.menuMouseenter,"mouseleave.contextMenu":handle.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",handle.inputClick).on({"mouseup.contextMenu":handle.itemClick,"contextmenu:focus.contextMenu":handle.focusItem,"contextmenu:blur.contextMenu":handle.blurItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.itemMouseenter,"mouseleave.contextMenu":handle.itemMouseleave},".context-menu-item");initialized=true}$context.on("contextmenu"+o.ns,o.selector,o,handle.contextmenu);if(_hasContext){$context.on("remove"+o.ns,function(){$(this).contextMenu("destroy")})}switch(o.trigger){case"hover":$context.on("mouseenter"+o.ns,o.selector,o,handle.mouseenter).on("mouseleave"+o.ns,o.selector,o,handle.mouseleave);break;case"left":$context.on("click"+o.ns,o.selector,o,handle.click);break}if(!o.build){op.create(o)}break;case"destroy":var $visibleMenu;if(_hasContext){var context=o.context;$.each(menus,function(ns,o){if(o.context!==context){return true}$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is($(o.context).find(o.selector))){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[o.ns].$menu){menus[o.ns].$menu.remove()}delete menus[o.ns]}catch(e){menus[o.ns]=null}$(o.context).off(o.ns);return true})}else if(!o.selector){$document.off(".contextMenu .contextMenuAutoHide");$.each(menus,function(ns,o){$(o.context).off(o.ns)});namespaces={};menus={};counter=0;initialized=false;$("#context-menu-layer, .context-menu-list").remove()}else if(namespaces[o.selector]){$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is(o.selector)){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[namespaces[o.selector]].$menu){menus[namespaces[o.selector]].$menu.remove()}delete menus[namespaces[o.selector]]}catch(e){menus[namespaces[o.selector]]=null}$document.off(namespaces[o.selector])}break;case"html5":if(!$.support.htmlCommand&&!$.support.htmlMenuitem||typeof options==="boolean"&&options){$('menu[type="context"]').each(function(){if(this.id){$.contextMenu({selector:"[contextmenu="+this.id+"]",items:$.contextMenu.fromMenu(this)})}}).css("display","none")}break;default:throw new Error('Unknown operation "'+operation+'"')}return this};$.contextMenu.setInputValues=function(opt,data){if(data===undefined){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":item.value=data[key]||"";break;case"checkbox":item.selected=data[key]?true:false;break;case"radio":item.selected=(data[item.radio]||"")===item.value;break;case"select":item.selected=data[key]||"";break}})};$.contextMenu.getInputValues=function(opt,data){if(data===undefined){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":case"select":data[key]=item.$input.val();break;case"checkbox":data[key]=item.$input.prop("checked");break;case"radio":if(item.$input.prop("checked")){data[item.radio]=item.value}break}});return data};function inputLabel(node){return node.id&&$('label[for="'+node.id+'"]').val()||node.name}function menuChildren(items,$children,counter){if(!counter){counter=0}$children.each(function(){var $node=$(this),node=this,nodeName=this.nodeName.toLowerCase(),label,item;if(nodeName==="label"&&$node.find("input, textarea, select").length){label=$node.text();$node=$node.children().first();node=$node.get(0);nodeName=node.nodeName.toLowerCase()}switch(nodeName){case"menu":item={name:$node.attr("label"),items:{}};counter=menuChildren(item.items,$node.children(),counter);break;case"a":case"button":item={name:$node.text(),disabled:!!$node.attr("disabled"),callback:function(){return function(){$node.click()}}()};break;case"menuitem":case"command":switch($node.attr("type")){case undefined:case"command":case"menuitem":item={name:$node.attr("label"),disabled:!!$node.attr("disabled"),icon:$node.attr("icon"),callback:function(){return function(){$node.click()}}()};break;case"checkbox":item={type:"checkbox",disabled:!!$node.attr("disabled"),name:$node.attr("label"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",disabled:!!$node.attr("disabled"),name:$node.attr("label"),radio:$node.attr("radiogroup"),value:$node.attr("id"),selected:!!$node.attr("checked")};break;default:item=undefined}break;case"hr":item="-------";break;case"input":switch($node.attr("type")){case"text":item={type:"text",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"checkbox":item={type:"checkbox",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),radio:!!$node.attr("name"),value:$node.val(),selected:!!$node.attr("checked")};break;default:item=undefined;break}break;case"select":item={type:"select",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:$node.val(),options:{}};$node.children().each(function(){item.options[this.value]=$(this).text()});break;case"textarea":item={type:"textarea",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"label":break;default:item={type:"html",html:$node.clone(true)};break}if(item){counter++;items["key"+counter]=item}});return counter}$.contextMenu.fromMenu=function(element){var $this=$(element),items={};menuChildren(items,$this.children());return items};$.contextMenu.defaults=defaults;$.contextMenu.types=types;$.contextMenu.handle=handle;$.contextMenu.op=op;$.contextMenu.menus=menus});define("cobweb/Browser/Core/ContextMenu",["jquery","cobweb/Basic/X3DBaseNode","lib/gettext","lib/jquery-contextMenu/dist/jquery.contextMenu"],function($,X3DBaseNode,_){function ContextMenu(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);$("head").append('<style>.cobweb-menu-title:before { content: "'+_("Cobweb X3D Browser")+'" }</style>')}ContextMenu.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:ContextMenu,getTypeName:function(){return"ContextMenu"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"contextMenu"},initialize:function(){X3DBaseNode.prototype.initialize.call(this);$.contextMenu({selector:".cobweb-surface",build:this.build.bind(this)})},build:function(trigger,event){var activeLayer=this.getBrowser().getActiveLayer(),currentViewpoint=activeLayer?activeLayer.getViewpoint():null,currentViewer=this.getBrowser().viewer_.getValue(),lookat=this.getLookAtViewer();var menu={className:"cobweb-menu-title",items:{separator0:"--------",viewpoints:{name:_("Viewpoints"),className:"context-menu-icon cobweb-icon-viewpoint",items:this.getViewpoints(),callback:function(viewpoint){if(!viewpoint)return;this.getBrowser().bindViewpoint(viewpoint);this.getBrowser().getCanvas().focus()}.bind(this,currentViewpoint)},separator1:"--------",viewer:{name:_(this.getViewerName(currentViewer)),className:"context-menu-icon cobweb-icon-"+currentViewer.toLowerCase()+"-viewer",callback:function(viewer){this.getBrowser().viewer_=viewer;this.getBrowser().getNotification().string_=_(this.getViewerName(viewer));this.getBrowser().getCanvas().focus()}.bind(this,currentViewer)},"available-viewer":{name:_("Available Viewers"),items:this.getAvailableViewers()},lookat:{name:_("Look At"),className:"context-menu-icon cobweb-icon-zoom-in"},separator2:"--------","primitive-quality":{name:_("Primitive Quality"),className:"context-menu-icon cobweb-icon-primitive-quality",items:{high:{name:_("High"),type:"radio",radio:"primitive-quality",selected:this.getBrowser().getBrowserOption("PrimitiveQuality")==="HIGH",events:{click:function(){this.getBrowser().setBrowserOption("PrimitiveQuality","HIGH");this.getBrowser().getNotification().string_=_("Primitive Quality")+": "+_("high")}.bind(this)}},medium:{name:_("Medium"),type:"radio",radio:"primitive-quality",selected:this.getBrowser().getBrowserOption("PrimitiveQuality")==="MEDIUM",events:{click:function(){this.getBrowser().setBrowserOption("PrimitiveQuality","MEDIUM");this.getBrowser().getNotification().string_=_("Primitive Quality")+": "+_("medium")}.bind(this)}},low:{name:_("Low"),type:"radio",radio:"primitive-quality",selected:this.getBrowser().getBrowserOption("PrimitiveQuality")==="LOW",events:{click:function(){this.getBrowser().setBrowserOption("PrimitiveQuality","LOW");this.getBrowser().getNotification().string_=_("Primitive Quality")+": "+_("low")}.bind(this)}}}},"texture-quality":{name:_("Texture Quality"),className:"context-menu-icon cobweb-icon-texture-quality",items:{high:{name:_("High"),type:"radio",radio:"texture-quality",selected:this.getBrowser().getBrowserOption("TextureQuality")==="HIGH",events:{click:function(){this.getBrowser().setBrowserOption("TextureQuality","HIGH");this.getBrowser().getNotification().string_=_("Texture Quality")+": "+_("high")}.bind(this)}},medium:{name:_("Medium"),type:"radio",radio:"texture-quality",selected:this.getBrowser().getBrowserOption("TextureQuality")==="MEDIUM",events:{click:function(){this.getBrowser().setBrowserOption("TextureQuality","MEDIUM");this.getBrowser().getNotification().string_=_("Texture Quality")+": "+_("medium")}.bind(this)}},low:{name:_("Low"),type:"radio",radio:"texture-quality",selected:this.getBrowser().getBrowserOption("TextureQuality")==="LOW",events:{click:function(){this.getBrowser().setBrowserOption("TextureQuality","LOW");this.getBrowser().getNotification().string_=_("Texture Quality")+": "+_("low")}.bind(this)}}}},"display-rubberband":{name:_("Display Rubberband"),type:"checkbox",selected:this.getBrowser().getBrowserOption("Rubberband"),events:{click:function(){var rubberband=!this.getBrowser().getBrowserOption("Rubberband");this.getBrowser().setBrowserOption("Rubberband",rubberband);if(rubberband)this.getBrowser().getNotification().string_=_("Rubberband")+": "+_("on");else this.getBrowser().getNotification().string_=_("Rubberband")+": "+_("off")}.bind(this)}},"browser-timings":{name:_("Browser Timings"),type:"checkbox",selected:this.getBrowser().getBrowserTimings().enabled_.getValue(),events:{click:function(){this.getBrowser().getBrowserTimings().enabled_=!this.getBrowser().getBrowserTimings().enabled_.getValue();this.getBrowser().getCanvas().focus()}.bind(this)}},"mute-browser":{name:_("Mute Browser"),type:"checkbox",selected:this.getBrowser().mute_.getValue(),events:{click:function(){var mute=!this.getBrowser().mute_.getValue();this.getBrowser().mute_=mute;this.getBrowser().getNotification().string_=mute?_("Browser muted"):_("Browser unmuted")}.bind(this)}},separator3:"--------",about:{name:_("About Cobweb"),className:"context-menu-icon cobweb-icon-help-about",callback:function(){window.open("http://titania.create3000.de/cobweb")}}}};if($.isEmptyObject(menu.items.viewpoints.items)){delete menu.items.separator0;delete menu.items.viewpoints}if(!lookat)delete menu.items.lookat;return menu},getViewpoints:function(){var activeLayer=this.getBrowser().getActiveLayer();if(!activeLayer)return{};var viewpoints=activeLayer.getViewpoints().get(),currentViewpoint=activeLayer.getViewpoint(),menu={};for(var i=0;i<viewpoints.length;++i){var viewpoint=viewpoints[i];description=viewpoint.description_.getValue();if(description==="")continue;var item={name:description,callback:function(viewpoint){this.getBrowser().bindViewpoint(viewpoint);this.getBrowser().getCanvas().focus()}.bind(this,viewpoint)};if(viewpoint===currentViewpoint)item.className="context-menu-selected";menu["Viewpoint"+viewpoint.getId()]=item}return menu},getAvailableViewers:function(){var currentViewer=this.getBrowser().viewer_.getValue(),availableViewers=this.getBrowser().availableViewers_,menu={};for(var i=0;i<availableViewers.length;++i){var viewer=availableViewers[i];if(viewer==="LOOKAT")continue;menu[viewer]={name:_(this.getViewerName(viewer)),className:"context-menu-icon cobweb-icon-"+viewer.toLowerCase()+"-viewer",callback:function(viewer){this.getBrowser().viewer_=viewer;this.getBrowser().getNotification().string_=_(this.getViewerName(viewer));this.getBrowser().getCanvas().focus()}.bind(this,viewer)};if(viewer===currentViewer)menu[viewer].className+=" context-menu-selected"}return menu},getLookAtViewer:function(){var availableViewers=this.getBrowser().availableViewers_;for(var i=0;i<availableViewers.length;++i){if(availableViewers[i]==="LOOKAT")return true}return false},getViewerName:function(viewer){switch(viewer){case"EXAMINE":return _("Examine Viewer");case"WALK":return _("Walk Viewer");case"FLY":return _("Fly Viewer");case"PLANE":return _("Plane Viewer");case"NONE":return _("None Viewer")}}});return ContextMenu});define("cobweb/Browser/Core/X3DCoreContext",["cobweb/Browser/Core/BrowserOptions","cobweb/Browser/Core/RenderingProperties","cobweb/Browser/Core/Notification","cobweb/Browser/Core/BrowserTimings","cobweb/Browser/Core/ContextMenu"],function(BrowserOptions,RenderingProperties,Notification,BrowserTimings,ContextMenu){function getContext(canvas){try{return canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}catch(error){return null}}function X3DCoreContext(xml){this.xml=xml}X3DCoreContext.prototype={initialize:function(){var browser=$("<div/>").addClass("cobweb-browser").prependTo(this.xml);var canvas=$("<div/>").addClass("cobweb-surface").prependTo(browser);this.canvas=$("<canvas/>").prependTo(canvas);this.context=getContext(this.canvas[0]);this.browserOptions=new BrowserOptions(this);this.renderingProperties=new RenderingProperties(this);this.notification=new Notification(this);this.browserTimings=new BrowserTimings(this);this.contextMenu=new ContextMenu(this);this.browserOptions.setup();this.renderingProperties.setup();this.notification.setup();this.browserTimings.setup();this.contextMenu.setup()},getXML:function(){return this.xml},getCanvas:function(){return this.canvas},getContext:function(){return this.context},getBrowserOptions:function(){return this.browserOptions},getRenderingProperties:function(){return this.renderingProperties},getNotification:function(){return this.notification},getBrowserTimings:function(){return this.browserTimings}};return X3DCoreContext});define("standard/Networking/URI",["jquery"],function($){function Path(path,separator){switch(arguments.length){case 2:{this.value=path.split(separator);this.value.separator=separator;this.value.leadingSeparator=false;this.value.trailingSeparator=false;if(this.value.length){if(this.value[0]===""){this.value.shift();this.value.leadingSeparator=true}}if(this.value.length){if(this.value[this.value.length-1]===""){this.value.pop();this.value.trailingSeparator=true}}break}case 4:{this.value=arguments[0];this.value.separator=arguments[1];this.value.leadingSeparator=arguments[2];this.value.trailingSeparator=arguments[3];break}}}Path.prototype={copy:function(){return new Path(this.value.slice(0,this.value.length),this.value.separator,this.value.leadingSeparator,this.value.trailingSeparator)},get origin(){return new Path([],this.value.separator,true,false)},get base(){if(this.value.trailingSeparator)return this.copy();return this.parent},get parent(){switch(this.value.length){case 0:case 1:{if(this.value.leadingSeparator)return this.origin;return new Path([".."],this.value.separator,false,false)}default:return new Path(this.value.slice(0,this.value.length-1),this.value.separator,this.value.leadingSeparator,true)}},getRelativePath:function(descendant){var path=new Path([],"/",false,false);var basePath=this.removeDotSegments().base;var descendantPath=descendant.removeDotSegments();var i,j;for(i=0;i<basePath.value.length&&i<descendantPath.value.length;++i){if(basePath.value[i]!==descendantPath.value[i])break}for(j=i;j<basePath.value.length;++j)path.value.push("..");for(j=i;j<descendantPath.value.length;++j)path.value.push(descendantPath.value[j]);return path},removeDotSegments:function(){var path=new Path([],this.value.separator,this.value.leadingSeparator,this.value.trailingSeparator);if(this.value.length){for(var i=0;i<this.value.length;++i){var segment=this.value[i];if(segment.length===0);else if(segment===".")path.value.trailingSeparator=true;else if(segment===".."){path.value.trailingSeparator=true;if(path.value.length)path.value.pop()}else{path.value.trailingSeparator=false;path.value.push(segment)}}path.value.trailingSeparator|=this.value.trailingSeparator}return path},toString:function(){var string="";if(this.value.leadingSeparator)string+=this.value.separator;string+=this.value.join(this.value.separator);if(this.value.trailingSeparator)string+=this.value.separator;return string}};var wellKnownPorts={ftp:21,http:80,https:443,ftps:990};var address=/^(?:([^:\/?#]*?):)?(?:(\/\/)([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;var authority=/^(.*?)(?:\:([^:]*))?$/;function parse(uri,string){var result=address.exec(string);if(result){uri.scheme=result[1]||"";uri.slashs=result[2]||"";uri.authority=result[3]||"";uri.path=result[4]||"";uri.query=result[5]||"";uri.fragment=result[6]||"";var result=authority.exec(uri.authority);if(result){uri.host=result[1]||"";uri.port=result[2]?parseInt(result[2]):0;uri.authority=uri.host;if(uri.port)uri.authority+=":"+uri.port}uri.absolute=Boolean(uri.slashs.length)||uri.path[0]==="/";uri.local=/^(?:file|data)$/.test(uri.scheme)||!uri.scheme&&!uri.authority}uri.string=string}function removeDotSegments(path){return new Path(path,"/").removeDotSegments().toString()}function URI(uri){this.value={local:true,absolute:true,scheme:"",slashs:"",authority:"",host:"",port:0,path:"",query:"",fragment:"",string:""};switch(arguments.length){case 0:break;case 1:{parse(this.value,uri);break}case 10:{this.value.local=arguments[0];this.value.absolute=arguments[1];this.value.scheme=arguments[2];this.value.slashs=arguments[3];this.value.authority=arguments[4];this.value.host=arguments[5];this.value.port=arguments[6];this.value.path=arguments[7];this.value.query=arguments[8];this.value.fragment=arguments[9];this.value.string=this.toString();break}}}URI.prototype={copy:function(){return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,this.value.path,this.value.query,this.value.fragment)},get length(){return this.value.string.length},isRelative:function(){return!this.value.absolute()},isAbsolute:function(){return!this.value.absolute},isLocal:function(){return this.value.local},isNetwork:function(){return!this.value.local},isDirectory:function(){return this.value.path.length&&this.value.path[this.value.path.length-1]==="/"},isFile:function(){return!this.isDirectory()},get hierarchy(){var hierarchy="";hierarchy+=this.value.slashs;hierarchy+=this.value.authority;hierarchy+=this.value.path;return hierarchy},get authority(){return this.value.authority},get scheme(){return this.value.scheme},get host(){return this.value.host},get port(){return this.value.port},get wellKnownPort(){var wellKnownPort=wellKnownPorts[this.value.scheme];if(wellKnownPort!==undefined)return wellKnownPort;return 0},get path(){return this.value.path},set query(value){this.value.query=value},get query(){return this.value.query},set fragment(value){this.value.fragment=value},get fragment(){return this.value.fragment},get location(){return this.toString()},get origin(){return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,this.value.local?"/":"","","")},get base(){if(this.isDirectory())return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,this.value.path,"","");return this.parent},get parent(){var path;if(this.isDirectory()){if(this.value.path.length==1)return"/";path=this.value.path.substr(0,this.value.path.length-1)}else path=this.path;var slash=path.lastIndexOf("/");path=slash==-1?"":path.substring(0,path.lastIndexOf("/")+1);return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,path,"","")},get filename(){return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,this.value.path,"","")},get basename(){if(this.value.path)return this.value.path.substr(this.value.path.lastIndexOf("/")+1);return""},get prefix(){if(this.value.path.length&&this.isFile()){var basename=this.basename;var suffix=this.suffix;return basename.substr(0,basename.length-suffix.length)}return this.basename},get suffix(){var dot=this.value.path.lastIndexOf(".");var slash=this.value.path.lastIndexOf("/");if(slash<dot)return this.value.path.substr(dot);return""},transform:function(reference){var T_local=false;var T_absolute=false;var T_scheme="";var T_slashs="";var T_authority="";var T_host="";var T_port=0;var T_path="";var T_query="";var T_fragment="";if(reference.scheme.length){T_local=reference.isLocal();T_absolute=reference.isAbsolute();T_scheme=reference.scheme;T_slashs=reference.value.slashs;T_authority=reference.authority;T_host=reference.host;T_port=reference.port;T_path=reference.path;T_query=reference.query}else{if(reference.authority.length){T_local=reference.isLocal();T_absolute=reference.isAbsolute();T_authority=reference.authority;T_host=reference.host;T_port=reference.port;T_path=reference.path;T_query=reference.query}else{if(reference.path.length===0){var T_path=this.value.path;if(reference.query.length)T_query=reference.query;else T_query=this.value.query}else{if(reference.path[0]==="/"){T_path=reference.path}else{var base=this.base;if(base.path.length===0)T_path="/";else T_path+=base.path;T_path+=reference.path}T_query=reference.query}T_local=this.isLocal();T_absolute=this.isAbsolute()||reference.isAbsolute();T_authority=this.value.authority;T_host=this.value.host;T_port=this.value.port}T_scheme=this.value.scheme;T_slashs=this.value.slashs}T_fragment=reference.fragment;return new URI(T_local,T_absolute,T_scheme,T_slashs,T_authority,T_host,T_port,removeDotSegments(T_path),T_query,T_fragment)},removeDotSegments:function(){return new URI(this.value.local,this.value.absolute,this.value.scheme,this.value.slashs,this.value.authority,this.value.host,this.value.port,removeDotSegments(this.value.path),this.value.query,this.value.fragment)},getRelativePath:function(descendant){if(this.value.scheme!==descendant.scheme)return descendant;if(this.value.authority!==descendant.authority)return descendant;var path=new Path(this.value.path,"/");var descendantPath=new Path(descendant.path,"/");return new URI(true,false,"","","","",0,path.getRelativePath(descendantPath).toString(),descendant.query,descendant.fragment)},escape:function(){return new URI(escape(this.location))},unescape:function(){return new URI(unescape(this.location))},toString:function(){var string=this.value.scheme;if(this.value.scheme.length)string+=":";string+=this.hierarchy;if(this.value.query.length)string+="?"+this.value.query;if(this.value.fragment.length)string+="#"+this.value.fragment;return string}};return URI});(function(window){var re={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};function sprintf(){var key=arguments[0],cache=sprintf.cache;if(!(cache[key]&&cache.hasOwnProperty(key))){cache[key]=sprintf.parse(key)}return sprintf.format.call(null,cache[key],arguments)}sprintf.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length,is_positive=true,sign="";for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string"){output[output.length]=parse_tree[i]}else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw new Error(sprintf("[sprintf] property '%s' does not exist",match[2][k]))}arg=arg[match[2][k]]}}else if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}if(get_type(arg)=="function"){arg=arg()}if(re.not_string.test(match[8])&&re.not_json.test(match[8])&&(get_type(arg)!="number"&&isNaN(arg))){throw new TypeError(sprintf("[sprintf] expecting number but found %s",get_type(arg)))}if(re.number.test(match[8])){is_positive=arg>=0}switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":case"i":arg=parseInt(arg,10);break;case"j":arg=JSON.stringify(arg,null,match[6]?parseInt(match[6]):0);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"g":arg=match[7]?parseFloat(arg).toPrecision(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=arg>>>0;break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase();break}if(re.json.test(match[8])){output[output.length]=arg}else{if(re.number.test(match[8])&&(!is_positive||match[3])){sign=is_positive?"+":"-";arg=arg.toString().replace(re.sign,"")}else{sign=""}pad_character=match[4]?match[4]==="0"?"0":match[4].charAt(1):" ";pad_length=match[6]-(sign+arg).length;pad=match[6]?pad_length>0?str_repeat(pad_character,pad_length):"":"";output[output.length]=match[5]?sign+arg+pad:pad_character==="0"?sign+pad+arg:pad+sign+arg}}}return output.join("")};sprintf.cache={};sprintf.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=re.text.exec(_fmt))!==null){parse_tree[parse_tree.length]=match[0]}else if((match=re.modulo.exec(_fmt))!==null){parse_tree[parse_tree.length]="%"}else if((match=re.placeholder.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=re.key.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1];while((replacement_field=replacement_field.substring(field_match[0].length))!==""){if((field_match=re.key_access.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1]}else if((field_match=re.index_access.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1]}else{throw new SyntaxError("[sprintf] failed to parse named argument key")}}}else{throw new SyntaxError("[sprintf] failed to parse named argument key")}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported")
}parse_tree[parse_tree.length]=match}else{throw new SyntaxError("[sprintf] unexpected placeholder")}_fmt=_fmt.substring(match[0].length)}return parse_tree};var vsprintf=function(fmt,argv,_argv){_argv=(argv||[]).slice(0);_argv.splice(0,0,fmt);return sprintf.apply(null,_argv)};function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){return Array(multiplier+1).join(input)}if(typeof exports!=="undefined"){exports.sprintf=sprintf;exports.vsprintf=vsprintf}else{window.sprintf=sprintf;window.vsprintf=vsprintf;if(typeof define==="function"&&define.amd){define("lib/sprintf.js/src/sprintf",[],function(){return{sprintf:sprintf,vsprintf:vsprintf}})}}})(typeof window==="undefined"?this:window);define("cobweb/Browser/Networking/X3DNetworkingContext",["cobweb/Fields","standard/Networking/URI","lib/sprintf.js/src/sprintf","lib/gettext"],function(Fields,URI,sprintf,_){with(Fields){var loadCountId=0;function X3DNetworkingContext(){}X3DNetworkingContext.prototype={initialize:function(){this.cache=this.getXML()[0].getAttribute("cache")!="false";this.addChildren("loadCount",new SFInt32);this.loadingObjects={};this.location=new URI(this.getXML()[0].baseURI);this.defaultScene=this.createScene();this.defaultScene.setup();this.defaultScene.beginUpdate();this.privateScene=this.createScene();this.privateScene.setup();this.privateScene.beginUpdate()},doCaching:function(){return this.cache},getLocation:function(){return this.location},getDefaultScene:function(){return this.defaultScene},getPrivateScene:function(){return this.privateScene},addLoadCount:function(){var id=loadCountId++;this.loadingObjects[id]=true;var loadCount=this.loadCount_=this.loadCount_.getValue()+1;this.getNotification().string_=sprintf.sprintf(_.count(loadCount,"Loading %d file","Loading %d files"),loadCount);this.setCursor("DEFAULT");return id},removeLoadCount:function(id){if(!this.loadingObjects.hasOwnProperty(id))return;delete this.loadingObjects[id];var loadCount=this.loadCount_=this.loadCount_.getValue()-1;if(loadCount)this.getNotification().string_=sprintf.sprintf(_.count(loadCount,"Loading %d file","Loading %d files"),loadCount);else{this.getNotification().string_=_("Loading done");this.setCursor("DEFAULT")}},resetLoadCount:function(){this.loadCount_=0;this.loadingObjects={}}};return X3DNetworkingContext}});define("cobweb/Bits/TraverseType",[],function(){var i=0;var TraverseType={POINTER:i++,CAMERA:i++,COLLISION:i++,DISPLAY:i++};Object.preventExtensions(TraverseType);Object.freeze(TraverseType);Object.seal(TraverseType);return TraverseType});define("cobweb/Components/Core/X3DNode",["jquery","cobweb/Basic/X3DBaseNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,X3DBaseNode,TraverseType,X3DConstants){function X3DNode(browser,executionContext){X3DBaseNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DNode)}X3DNode.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:X3DNode,getCurrentLayer:function(){return this.getBrowser().getLayers()[0]},getCurrentViewport:function(){return this.getBrowser().getLayers()[0].getViewport()},getCurrentNavigationInfo:function(){return this.getBrowser().getLayers()[0].getNavigationInfo()},getCurrentViewpoint:function(){return this.getBrowser().getLayers()[0].getViewpoint()},getModelViewMatrix:function(type,modelViewMatrix){modelViewMatrix.assign(this.getBrowser().getModelViewMatrix().get());if(type===TraverseType.CAMERA)modelViewMatrix.multRight(this.getCurrentViewpoint().getInverseCameraSpaceMatrix());return modelViewMatrix}});return X3DNode});define("cobweb/Components/Shape/X3DAppearanceChildNode",["jquery","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants"],function($,X3DNode,X3DConstants){function X3DAppearanceChildNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DAppearanceChildNode)}X3DAppearanceChildNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DAppearanceChildNode});return X3DAppearanceChildNode});define("cobweb/Components/Shaders/X3DShaderNode",["jquery","cobweb/Components/Shape/X3DAppearanceChildNode","cobweb/Bits/X3DConstants"],function($,X3DAppearanceChildNode,X3DConstants){function X3DShaderNode(browser,executionContext){X3DAppearanceChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DShaderNode)}X3DShaderNode.prototype=$.extend(Object.create(X3DAppearanceChildNode.prototype),{constructor:X3DShaderNode});return X3DShaderNode});define("cobweb/Components/Shaders/X3DProgrammableShaderObject",["jquery","cobweb/Bits/X3DConstants"],function($,X3DConstants){function X3DProgrammableShaderObject(browser,executionContext){this.addType(X3DConstants.X3DProgrammableShaderObject)}X3DProgrammableShaderObject.prototype={constructor:X3DProgrammableShaderObject,initialize:function(){},hasUserDefinedFields:function(){return true}};return X3DProgrammableShaderObject});define("cobweb/Components/Shaders/ComposedShader",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Shaders/X3DShaderNode","cobweb/Components/Shaders/X3DProgrammableShaderObject","cobweb/Bits/X3DConstants","standard/Math/Numbers/Matrix3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DShaderNode,X3DProgrammableShaderObject,X3DConstants,Matrix3){with(Fields){var MAX_LIGHTS=8;function ComposedShader(executionContext){X3DShaderNode.call(this,executionContext.getBrowser(),executionContext);X3DProgrammableShaderObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ComposedShader)}ComposedShader.prototype=$.extend(Object.create(X3DShaderNode.prototype),X3DProgrammableShaderObject.prototype,{constructor:ComposedShader,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"activate",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isSelected",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isValid",new SFBool),new X3DFieldDefinition(X3DConstants.initializeOnly,"language",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"parts",new MFNode)]),maxLights:MAX_LIGHTS,settings:{shader:null,lights:MAX_LIGHTS},wireframe:false,getTypeName:function(){return"ComposedShader"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"shaders"},initialize:function(){X3DShaderNode.prototype.initialize.call(this);X3DProgrammableShaderObject.prototype.initialize.call(this);this.normalMatrixArray=new Float32Array(9);this.relink()},relink:function(){var gl=this.getBrowser().getContext(),program=gl.createProgram();this.program=program;for(var i=0,length=this.parts_.length;i<length;++i)gl.attachShader(program,this.parts_[i].getValue().getShader());this.bindAttribLocations(gl,program);gl.linkProgram(program);this.isValid_=gl.getProgramParameter(program,gl.LINK_STATUS);if(this.isValid_.getValue())this.getDefaultUniforms();else this.getBrowser().print("Could not initialise shaders!")},bindAttribLocations:function(gl,program){gl.bindAttribLocation(program,3,"x3d_Color");gl.bindAttribLocation(program,2,"x3d_TexCoord");gl.bindAttribLocation(program,1,"x3d_Normal");gl.bindAttribLocation(program,0,"x3d_Vertex")},getDefaultUniforms:function(){var gl=this.getBrowser().getContext(),program=this.program;gl.useProgram(program);this.fogType=gl.getUniformLocation(program,"x3d_FogType");this.fogColor=gl.getUniformLocation(program,"x3d_FogColor");this.fogVisibilityRange=gl.getUniformLocation(program,"x3d_FogVisibilityRange");this.lighting=gl.getUniformLocation(program,"x3d_Lighting");this.colorMaterial=gl.getUniformLocation(program,"x3d_ColorMaterial");this.lightType=[];this.lightOn=[];this.lightColor=[];this.lightIntensity=[];this.lightAmbientIntensity=[];this.lightAttenuation=[];this.lightLocation=[];this.lightDirection=[];this.lightBeamWidth=[];this.lightCutOffAngle=[];this.lightRadius=[];for(var i=0;i<this.maxLights;++i){this.lightType[i]=gl.getUniformLocation(program,"x3d_LightType["+i+"]");this.lightOn[i]=gl.getUniformLocation(program,"x3d_LightOn["+i+"]");this.lightColor[i]=gl.getUniformLocation(program,"x3d_LightColor["+i+"]");this.lightAmbientIntensity[i]=gl.getUniformLocation(program,"x3d_LightAmbientIntensity["+i+"]");this.lightIntensity[i]=gl.getUniformLocation(program,"x3d_LightIntensity["+i+"]");this.lightAttenuation[i]=gl.getUniformLocation(program,"x3d_LightAttenuation["+i+"]");this.lightLocation[i]=gl.getUniformLocation(program,"x3d_LightLocation["+i+"]");this.lightDirection[i]=gl.getUniformLocation(program,"x3d_LightDirection["+i+"]");this.lightBeamWidth[i]=gl.getUniformLocation(program,"x3d_LightBeamWidth["+i+"]");this.lightCutOffAngle[i]=gl.getUniformLocation(program,"x3d_LightCutOffAngle["+i+"]");this.lightRadius[i]=gl.getUniformLocation(program,"x3d_LightRadius["+i+"]")}this.separateBackColor=gl.getUniformLocation(program,"x3d_SeparateBackColor");this.ambientIntensity=gl.getUniformLocation(program,"x3d_AmbientIntensity");this.diffuseColor=gl.getUniformLocation(program,"x3d_DiffuseColor");this.specularColor=gl.getUniformLocation(program,"x3d_SpecularColor");this.emissiveColor=gl.getUniformLocation(program,"x3d_EmissiveColor");this.shininess=gl.getUniformLocation(program,"x3d_Shininess");this.transparency=gl.getUniformLocation(program,"x3d_Transparency");this.backAmbientIntensity=gl.getUniformLocation(program,"x3d_BackAmbientIntensity");this.backDiffuseColor=gl.getUniformLocation(program,"x3d_BackDiffuseColor");this.backSpecularColor=gl.getUniformLocation(program,"x3d_BackSpecularColor");this.backEmissiveColor=gl.getUniformLocation(program,"x3d_BackEmissiveColor");this.backShininess=gl.getUniformLocation(program,"x3d_BackShininess");this.backTransparency=gl.getUniformLocation(program,"x3d_BackTransparency");this.texturing=gl.getUniformLocation(program,"x3d_Texturing");this.texture=gl.getUniformLocation(program,"x3d_Texture");this.geometryType=gl.getUniformLocation(program,"x3d_GeometryType");this.textureMatrix=gl.getUniformLocation(program,"x3d_TextureMatrix");this.normalMatrix=gl.getUniformLocation(program,"x3d_NormalMatrix");this.projectionMatrix=gl.getUniformLocation(program,"x3d_ProjectionMatrix");this.modelViewMatrix=gl.getUniformLocation(program,"x3d_ModelViewMatrix");this.color=gl.getAttribLocation(program,"x3d_Color");this.texCoord=gl.getAttribLocation(program,"x3d_TexCoord");this.normal=gl.getAttribLocation(program,"x3d_Normal");this.vertex=gl.getAttribLocation(program,"x3d_Vertex");gl.uniform1i(this.texture,0)},setGlobalUniforms:function(){var browser=this.getBrowser(),gl=browser.getContext(),globalLights=browser.getGlobalLights();gl.useProgram(this.program);for(var i=0;i<globalLights.length;++i)globalLights[i].use(gl,this,i);this.settings.shader=null},setLocalUniforms:function(context){var settings=this.settings,browser=this.getBrowser(),gl=browser.getContext(),material=browser.getMaterial(),texture=browser.getTexture(),modelViewMatrix=context.modelViewMatrix,customShader=this!==browser.getDefaultShader();if(settings.shader!==this){settings.shader=this;gl.useProgram(this.program);gl.uniformMatrix4fv(this.projectionMatrix,false,browser.getProjectionMatrixArray())}context.fog.use(gl,this);gl.uniform1i(this.colorMaterial,context.colorMaterial);if(material){var globalLights=browser.getGlobalLights(),localLights=context.localLights,lights=Math.min(this.maxLights,globalLights.length+localLights.length),lightOn=this.lightOn;if(customShader){for(var i=0;i<globalLights.length;++i)globalLights[i].use(gl,this,i)}for(var i=globalLights.length,l=0;i<lights;++i,++l)localLights[l].use(gl,this,i);for(var length=settings.lights;i<length;++i)gl.uniform1i(lightOn[i],false);settings.lights=lights;gl.uniform1i(this.lighting,true);gl.uniform1f(this.ambientIntensity,material.ambientIntensity);gl.uniform3fv(this.diffuseColor,material.diffuseColor);gl.uniform3fv(this.specularColor,material.specularColor);gl.uniform3fv(this.emissiveColor,material.emissiveColor);gl.uniform1f(this.shininess,material.shininess);gl.uniform1f(this.transparency,material.transparency);if(material.getSeparateBackColor()){gl.uniform1i(this.separateBackColor,true);gl.uniform1f(this.backAmbientIntensity,material.backAmbientIntensity);gl.uniform3fv(this.backDiffuseColor,material.backDiffuseColor);gl.uniform3fv(this.backSpecularColor,material.backSpecularColor);gl.uniform3fv(this.backEmissiveColor,material.backEmissiveColor);gl.uniform1f(this.backShininess,material.backShininess);gl.uniform1f(this.backTransparency,material.backTransparency)}else gl.uniform1i(this.separateBackColor,false);var normalMatrix=this.normalMatrixArray;normalMatrix[0]=modelViewMatrix[0];normalMatrix[1]=modelViewMatrix[4];normalMatrix[2]=modelViewMatrix[8];normalMatrix[3]=modelViewMatrix[1];normalMatrix[4]=modelViewMatrix[5];normalMatrix[5]=modelViewMatrix[9];normalMatrix[6]=modelViewMatrix[2];normalMatrix[7]=modelViewMatrix[6];normalMatrix[8]=modelViewMatrix[10];Matrix3.prototype.inverse.call(normalMatrix);gl.uniformMatrix3fv(this.normalMatrix,false,normalMatrix)}else{gl.uniform1i(this.lighting,false);if(customShader){var normalMatrix=this.normalMatrixArray;normalMatrix[0]=modelViewMatrix[0];normalMatrix[1]=modelViewMatrix[4];normalMatrix[2]=modelViewMatrix[8];normalMatrix[3]=modelViewMatrix[1];normalMatrix[4]=modelViewMatrix[5];normalMatrix[5]=modelViewMatrix[9];normalMatrix[6]=modelViewMatrix[2];normalMatrix[7]=modelViewMatrix[6];normalMatrix[8]=modelViewMatrix[10];Matrix3.prototype.inverse.call(normalMatrix);gl.uniformMatrix3fv(this.normalMatrix,false,normalMatrix)}}if(texture){texture.traverse();gl.uniform1i(this.texturing,true);gl.uniformMatrix4fv(this.textureMatrix,false,browser.getTextureTransform()[0].getMatrixArray());gl.uniform1i(this.geometryType,context.geometryType)}else gl.uniform1i(this.texturing,false);gl.uniformMatrix4fv(this.modelViewMatrix,false,modelViewMatrix)},use:function(context){var gl=this.getBrowser().getContext();gl.useProgram(this.program)}});return ComposedShader}});define("cobweb/Components/Networking/X3DUrlObject",["jquery","cobweb/Fields","cobweb/Bits/X3DConstants"],function($,Fields,X3DConstants){with(Fields){function X3DUrlObject(browser,executionContext){this.addType(X3DConstants.X3DUrlObject);this.addChildren("loadState",new SFInt32(X3DConstants.NOT_STARTED_STATE))}X3DUrlObject.prototype={constructor:X3DUrlObject,initialize:function(){},setLoadState:function(value,notify){if(this.hasOwnProperty("loadId")){this.getBrowser().removeLoadCount(this.loadId);delete this.loadId}if(notify!==false&&value===X3DConstants.IN_PROGRESS_STATE)this.loadId=this.getBrowser().addLoadCount();this.loadState_=value},checkLoadState:function(){return this.loadState_.getValue()}};return X3DUrlObject}});define("cobweb/Components/Shaders/ShaderPart",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DUrlObject,X3DConstants){with(Fields){var shaderTypes={VERTEX:"VERTEX_SHADER",TESS_CONTROL:"TESS_CONTROL_SHADER",TESS_EVALUATION:"TESS_EVALUATION_SHADER",GEOMETRY:"GEOMETRY_SHADER",FRAGMENT:"FRAGMENT_SHADER",COMPUTE:"COMPUTE_SHADER"};function ShaderPart(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.valid=false;this.addType(X3DConstants.ShaderPart)}ShaderPart.prototype=$.extend(Object.create(X3DNode.prototype),X3DUrlObject.prototype,{constructor:ShaderPart,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"type",new SFString("VERTEX")),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString)]),getTypeName:function(){return"ShaderPart"},getComponentName:function(){return"Shaders"},getContainerField:function(){return"parts"},initialize:function(){X3DNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);var gl=this.getBrowser().getContext();this.shader=gl.createShader(gl[this.getShaderType()]);this.requestImmediateLoad()},isValid:function(){return this.valid},getShader:function(){return this.shader},getShaderType:function(){var type=shaderTypes[this.type_.getValue()];if(type)return type;return"VERTEX_SHADER"},getCDATA:function(){return this.url_},requestImmediateLoad:function(){if(this.checkLoadState()==X3DConstants.COMPLETE_STATE||this.checkLoadState()==X3DConstants.IN_PROGRESS_STATE)return;this.setLoadState(X3DConstants.IN_PROGRESS_STATE);this.valid=false;var gl=this.getBrowser().getContext();for(var i=0;i<this.url_.length;++i){var string=this.url_[i].replace(/^data\:.*?,/,"");gl.shaderSource(this.shader,string);gl.compileShader(this.shader);this.valid=gl.getShaderParameter(this.shader,gl.COMPILE_STATUS);if(this.valid)break;this.getBrowser().print(this.getTypeName()+" '"+this.getName()+"': "+gl.getShaderInfoLog(this.shader))}this.setLoadState(this.valid?X3DConstants.COMPLETE_STATE:X3DConstants.FAILED_STATE)}});return ShaderPart}});define("text/text",["module"],function(module){var text,fs,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!=="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap=[],masterConfig=module.config&&module.config()||{};text={version:"2.0.2+",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);if(matches){content=matches[1]}}else{content=""}return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else if(typeof ActiveXObject!=="undefined"){for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}}return xhr},parseName:function(name){var strip=false,index=name.indexOf("."),modName=name.substring(0,index),ext=name.substring(index+1,name.length);index=ext.indexOf("!");if(index!==-1){strip=ext.substring(index+1,ext.length);strip=strip==="strip";ext=ext.substring(0,index)}return{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);if(!match){return true}uProtocol=match[2];uHostName=match[3];uHostName=uHostName.split(":");uPort=uHostName[1];uHostName=uHostName[0];return(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName.toLowerCase()===hostname.toLowerCase())&&(!uPort&&!uHostName||uPort===port)},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content;if(masterConfig.isBuild){buildMap[name]=content}onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+"."+parsed.ext,url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;if(!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)){text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){if(onLoad.error){onLoad.error(err)}})}else{req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})}},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),nonStripName=parsed.moduleName+"."+parsed.ext,fileName=req.toUrl(parsed.moduleName+"."+parsed.ext)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)};text.write(pluginName,nonStripName,textWrite,config)},config)}};if(masterConfig.env==="node"||!masterConfig.env&&typeof process!=="undefined"&&process.versions&&!!process.versions.node){fs=require.nodeRequire("fs");text.get=function(url,callback){var file=fs.readFileSync(url,"utf8");if(file.indexOf("Ôªø")===0){file=file.substring(1)}callback(file)}}else if(masterConfig.env==="xhr"||!masterConfig.env&&text.createXhr()){text.get=function(url,callback,errback){var xhr=text.createXhr();xhr.open("GET",url,true);if(masterConfig.onXhr){masterConfig.onXhr(xhr,url)}xhr.onreadystatechange=function(evt){var status,err;if(xhr.readyState===4){status=xhr.status;if(status>399&&status<600){err=new Error(url+" HTTP status: "+status);err.xhr=xhr;errback(err)}else{callback(xhr.responseText)}}};xhr.send(null)}}else if(masterConfig.env==="rhino"||!masterConfig.env&&typeof Packages!=="undefined"&&typeof java!=="undefined"){text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{stringBuffer=new java.lang.StringBuffer;line=input.readLine();if(line&&line.length()&&line.charAt(0)===65279){line=line.substring(1)}stringBuffer.append(line);while((line=input.readLine())!==null){stringBuffer.append(lineSeparator);stringBuffer.append(line)}content=String(stringBuffer.toString())}finally{input.close()}callback(content)}}return text});define("text",["text/text"],function(main){return main});define("text!cobweb/Browser/Rendering/Wireframe.vs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nuniform bool  x3d_ColorMaterial;   // true if a X3DColorNode is attached, otherwise false\nuniform bool  x3d_Lighting;        // true if a X3DMaterialNode is attached, otherwise false\nuniform vec3  x3d_EmissiveColor;\nuniform float x3d_Transparency;\n\nattribute vec4 x3d_Color;\nattribute vec4 x3d_Vertex;\n\nvarying vec4  C;  // color\nvarying float dv; // distance to vertex\n\nvoid\nmain ()\n{\n	//gl_PointSize = 10.0;\n\n	vec4 p = x3d_ModelViewMatrix * x3d_Vertex;\n\n	dv          = length (vec3 (p));\n	gl_Position = x3d_ProjectionMatrix * p;\n\n	if (x3d_Lighting)\n	{\n		float alpha = 1.0 - x3d_Transparency;\n\n		if (x3d_ColorMaterial)\n		{\n			C .rgb = x3d_Color .rgb;\n			C .a   = x3d_Color .a * alpha;\n		}\n		else\n		{\n			C .rgb = x3d_EmissiveColor;\n			C .a   = alpha;\n		}\n	}\n	else\n	{\n		if (x3d_ColorMaterial)\n			C = x3d_Color;\n		else\n			C = vec4 (1.0, 1.0, 1.0, 1.0);\n	}\n}\n"});define("text!cobweb/Browser/Rendering/Wireframe.fs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\n#define NO_FOG           0\n#define LINEAR_FOG       1\n#define EXPONENTIAL_FOG  2\n#define EXPONENTIAL2_FOG 3\n\nuniform int   x3d_FogType;\nuniform vec3  x3d_FogColor;\nuniform float x3d_FogVisibilityRange;\n\nvarying vec4  C;  // color\nvarying float dv; // distance to vertex\n\nfloat\ngetFogInterpolant ()\n{\n	if (x3d_FogType == NO_FOG)\n		return 1.0;\n\n	if (dv >= x3d_FogVisibilityRange)\n		return 0.0;\n\n	if (x3d_FogType == LINEAR_FOG)\n		return (x3d_FogVisibilityRange - dv) / x3d_FogVisibilityRange;\n\n	if (x3d_FogType == EXPONENTIAL_FOG)\n		return exp (-dv / (x3d_FogVisibilityRange - dv));\n\n	return 1.0;\n}\n\nvoid\nmain ()\n{\n	float f0 = getFogInterpolant ();\n\n	gl_FragColor .rgb = mix (x3d_FogColor, C .rgb, f0);\n	gl_FragColor .a   = C .a;\n}\n"});define("text!cobweb/Browser/Rendering/Gouraud.vs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\n// 4 * 16\nuniform mat4 x3d_TextureMatrix;\nuniform mat3 x3d_NormalMatrix;\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\n// 2\nuniform bool x3d_Lighting;      // true if a X3DMaterialNode is attached, otherwise false\nuniform bool x3d_ColorMaterial; // true if a X3DColorNode is attached, otherwise false\n\n#define MAX_LIGHTS        8\n#define DIRECTIONAL_LIGHT 0\n#define POINT_LIGHT       1\n#define SPOT_LIGHT        2\n\n// 19 * MAX_LIGHTS\nuniform int   x3d_LightType [MAX_LIGHTS]; // 0: DirectionalLight, 1: PointLight, 2: SpotLight\nuniform bool  x3d_LightOn [MAX_LIGHTS];\nuniform vec3  x3d_LightColor [MAX_LIGHTS];\nuniform float x3d_LightIntensity [MAX_LIGHTS];\nuniform float x3d_LightAmbientIntensity [MAX_LIGHTS];\nuniform vec3  x3d_LightAttenuation [MAX_LIGHTS];\nuniform vec3  x3d_LightLocation [MAX_LIGHTS];\nuniform vec3  x3d_LightDirection [MAX_LIGHTS];\nuniform float x3d_LightRadius [MAX_LIGHTS];\nuniform float x3d_LightBeamWidth [MAX_LIGHTS];\nuniform float x3d_LightCutOffAngle [MAX_LIGHTS];\n\n// 1\nuniform bool x3d_SeparateBackColor;\n\n// 12\nuniform float x3d_AmbientIntensity;\nuniform vec3  x3d_DiffuseColor;\nuniform vec3  x3d_SpecularColor;\nuniform vec3  x3d_EmissiveColor;\nuniform float x3d_Shininess;\nuniform float x3d_Transparency;\n\n// 12\nuniform float x3d_BackAmbientIntensity;\nuniform vec3  x3d_BackDiffuseColor;\nuniform vec3  x3d_BackSpecularColor;\nuniform vec3  x3d_BackEmissiveColor;\nuniform float x3d_BackShininess;\nuniform float x3d_BackTransparency;\n\n// 2\nuniform bool      x3d_Texturing;      // true if a X3DTexture2DNode is attached, otherwise false\nuniform sampler2D x3d_Texture;\n\n// max 16\nattribute vec4 x3d_Color;\nattribute vec4 x3d_TexCoord;\nattribute vec3 x3d_Normal;\nattribute vec4 x3d_Vertex;\n\nvarying vec4  frontColor; // color\nvarying vec4  backColor;  // color\nvarying vec4  t;          // texCoord\nvarying float dv;         // distance to vertex\n\nvec4\ngetMaterial (float normalFactor,\n             vec3 v,\n             float x3d_AmbientIntensity,\n             vec3  x3d_DiffuseColor,\n             vec3  x3d_SpecularColor,\n             vec3  x3d_EmissiveColor,\n             float x3d_Shininess,\n             float x3d_Transparency)\n{  \n	vec3 N = normalize (x3d_NormalMatrix * x3d_Normal) * normalFactor;\n	vec3 V = normalize (-v); // normalized vector from point on geometry to viewer's position\n\n	// Calculate diffuseFactor & alpha\n\n	vec3  diffuseFactor = vec3 (1.0, 1.0, 1.0);\n	float alpha         = 1.0 - x3d_Transparency;\n\n	if (x3d_ColorMaterial)\n	{\n		diffuseFactor  = x3d_Color .rgb;\n		alpha         *= x3d_Color .a;\n	}\n	else\n		diffuseFactor = x3d_DiffuseColor;\n\n	vec3 ambientTerm = diffuseFactor * x3d_AmbientIntensity;\n\n	// Apply light sources\n\n	vec3 finalColor = vec3 (0.0, 0.0, 0.0);\n\n	for (int i = 0; i < MAX_LIGHTS; ++ i)\n	{\n		float dL = length (x3d_LightLocation [i] - v);\n\n		if (x3d_LightOn [i] && (x3d_LightType [i] == DIRECTIONAL_LIGHT || dL <= x3d_LightRadius [i]))\n		{\n			vec3 c = x3d_LightAttenuation [i];\n			vec3 L = x3d_LightType [i] == DIRECTIONAL_LIGHT ? -x3d_LightDirection [i] : normalize (x3d_LightLocation [i] - v);\n			vec3 H = normalize (L + V); // specular term\n\n			vec3  diffuseTerm    = diffuseFactor * max (dot (N, L), 0.0);\n			float specularFactor = bool (x3d_Shininess) ? pow (max (dot (N, H), 0.0), x3d_Shininess) : 1.0;\n			vec3  specularTerm   = x3d_SpecularColor * specularFactor;\n\n			float attenuation = x3d_LightType [i] == DIRECTIONAL_LIGHT ? 1.0 : 1.0 / max (c [0] + c [1] * dL + c [2] * (dL * dL), 1.0);\n			float spot        = 1.0;\n\n			if (x3d_LightType [i] == SPOT_LIGHT)\n			{\n				float spotAngle = acos (dot (-L, x3d_LightDirection [i]));\n				\n				if (spotAngle >= x3d_LightCutOffAngle [i])\n					spot = 0.0;\n				else if (spotAngle <= x3d_LightBeamWidth [i])\n					spot = 1.0;\n				else\n					spot = (spotAngle - x3d_LightCutOffAngle [i]) / (x3d_LightBeamWidth [i] - x3d_LightCutOffAngle [i]);\n			}\n		\n			vec3 lightFactor  = (attenuation * spot) * x3d_LightColor [i];\n			vec3 ambientLight = (lightFactor * x3d_LightAmbientIntensity [i]) * ambientTerm;\n\n			lightFactor *= x3d_LightIntensity [i];\n			finalColor  += ambientLight + lightFactor * (diffuseTerm + specularTerm);\n		}\n	}\n\n	finalColor += x3d_EmissiveColor;\n\n	return vec4 (clamp (finalColor, 0.0, 1.0), alpha);\n}\n\nvec4\ngetColor ()\n{\n	if (x3d_ColorMaterial)\n		return x3d_Color;\n\n	return vec4 (1.0, 1.0, 1.0, 1.0);\n}\n\nvoid\nmain ()\n{\n	vec4 p = x3d_ModelViewMatrix * x3d_Vertex;\n	vec3 v = vec3 (p);\n\n	if (x3d_Texturing)\n		t = x3d_TextureMatrix * x3d_TexCoord;\n\n	dv = length (v);\n\n	gl_Position = x3d_ProjectionMatrix * p;\n\n	if (x3d_Lighting)\n	{\n		float ambientIntensity = x3d_AmbientIntensity;\n		vec3  diffuseColor     = x3d_DiffuseColor;\n		vec3  specularColor    = x3d_SpecularColor;\n		vec3  emissiveColor    = x3d_EmissiveColor;\n		float shininess        = x3d_Shininess;\n		float transparency     = x3d_Transparency;\n\n		frontColor = getMaterial (1.0, v,\n		                       ambientIntensity,\n		                       diffuseColor,\n		                       specularColor,\n		                       emissiveColor,\n		                       shininess,\n		                       transparency);\n\n		if (x3d_SeparateBackColor)\n		{\n			ambientIntensity = x3d_BackAmbientIntensity;\n			diffuseColor     = x3d_BackDiffuseColor;\n			specularColor    = x3d_BackSpecularColor;\n			emissiveColor    = x3d_BackEmissiveColor;\n			shininess        = x3d_BackShininess;\n			transparency     = x3d_BackTransparency;\n		}\n			\n		backColor = getMaterial (-1.0, v,\n		                       ambientIntensity,\n		                       diffuseColor,\n		                       specularColor,\n		                       emissiveColor,\n		                       shininess,\n		                       transparency);\n	}\n	else\n	{\n	   frontColor = backColor = getColor ();\n	}\n}\n"});define("text!cobweb/Browser/Rendering/Gouraud.fs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\n#define NO_FOG           0\n#define LINEAR_FOG       1\n#define EXPONENTIAL_FOG  2\n#define EXPONENTIAL2_FOG 3\n\n// 5\nuniform int   x3d_FogType;\nuniform vec3  x3d_FogColor;\nuniform float x3d_FogVisibilityRange;\n\n// 2\nuniform bool x3d_Lighting;        // true if a X3DMaterialNode is attached, otherwise false\nuniform bool x3d_ColorMaterial;   // true if a X3DColorNode is attached, otherwise false\n\n#define GEOMETRY_2D 2\n#define GEOMETRY_3D 3\n\nuniform bool      x3d_Texturing;  // true if a X3DTexture2DNode is attached, otherwise false\nuniform sampler2D x3d_Texture;\nuniform int       x3d_GeometryType;\n\nvarying vec4  frontColor; // color\nvarying vec4  backColor;  // color\nvarying vec4  t;          // texCoord\nvarying float dv;         // distance to vertex\n\nfloat\ngetFogInterpolant ()\n{\n	if (x3d_FogType == NO_FOG)\n		return 1.0;\n\n	if (dv >= x3d_FogVisibilityRange)\n		return 0.0;\n\n	if (x3d_FogType == LINEAR_FOG)\n		return (x3d_FogVisibilityRange - dv) / x3d_FogVisibilityRange;\n\n	if (x3d_FogType == EXPONENTIAL_FOG)\n		return exp (-dv / (x3d_FogVisibilityRange - dv));\n\n	return 1.0;\n}\n\nvec4\ngetTextureColor ()\n{\n	if (x3d_GeometryType == GEOMETRY_3D)\n		return texture2D (x3d_Texture, vec2 (t .s, t .t));\n	\n	// GEOMETRY_2D\n	if (gl_FrontFacing)\n		return texture2D (x3d_Texture, vec2 (t .s, t .t));\n	\n	return texture2D (x3d_Texture, vec2 (1.0 - t .s, t .t));\n}\n\nvoid\nmain ()\n{\n	float f0 = getFogInterpolant ();\n\n	vec4 finalColor = gl_FrontFacing ? frontColor : backColor;\n\n	if (x3d_Lighting)\n	{\n		if (x3d_Texturing)\n			finalColor *= getTextureColor ();\n	}\n	else\n	{\n		if (x3d_ColorMaterial)\n		{\n			if (x3d_Texturing)\n				finalColor *= getTextureColor ();\n		}\n		else\n		{\n			if (x3d_Texturing)\n				finalColor = getTextureColor ();\n		}\n	}\n\n	gl_FragColor .rgb = mix (x3d_FogColor, finalColor .rgb, f0);\n	gl_FragColor .a   = finalColor .a;\n}\n"
});define("text!cobweb/Browser/Rendering/Phong.vs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nuniform mat4 x3d_TextureMatrix;\nuniform mat3 x3d_NormalMatrix;\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nuniform bool x3d_Lighting; // true if a X3DMaterialNode is attached, otherwise false\nuniform bool x3d_Texturing; // true if a X3DTexture2DNode is attached, otherwise false\n\nattribute vec4 x3d_Color;\nattribute vec4 x3d_TexCoord;\nattribute vec3 x3d_Normal;\nattribute vec4 x3d_Vertex;\n\nvarying vec4 C;  // color\nvarying vec4 t;  // texCoord\nvarying vec3 vN; // normalized normal vector at this point on geometry\nvarying vec3 v;  // point on geometry\n\nvoid\nmain ()\n{\n	vec4 p = x3d_ModelViewMatrix * x3d_Vertex;\n\n	if (x3d_Lighting)\n		vN = normalize (x3d_NormalMatrix * x3d_Normal);\n\n	if (x3d_Texturing)\n		t = x3d_TextureMatrix * x3d_TexCoord;\n\n	C = x3d_Color;\n	v = vec3 (p);\n\n	gl_Position = x3d_ProjectionMatrix * p;\n}\n"});define("text!cobweb/Browser/Rendering/Phong.fs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\n#define NO_FOG           0\n#define LINEAR_FOG       1\n#define EXPONENTIAL_FOG  2\n#define EXPONENTIAL2_FOG 3\n\nuniform int   x3d_FogType;\nuniform vec3  x3d_FogColor;\nuniform float x3d_FogVisibilityRange;\n\nuniform bool x3d_Lighting;      // true if a X3DMaterialNode is attached, otherwise false\nuniform bool x3d_ColorMaterial; // true if a X3DColorNode is attached, otherwise false\n\n#define MAX_LIGHTS        8\n#define DIRECTIONAL_LIGHT 0\n#define POINT_LIGHT       1\n#define SPOT_LIGHT        2\n\nuniform int   x3d_LightType [MAX_LIGHTS]; // 0: DirectionalLight, 1: PointLight, 2: SpotLight\nuniform bool  x3d_LightOn [MAX_LIGHTS];\nuniform vec3  x3d_LightColor [MAX_LIGHTS];\nuniform float x3d_LightIntensity [MAX_LIGHTS];\nuniform float x3d_LightAmbientIntensity [MAX_LIGHTS];\nuniform vec3  x3d_LightAttenuation [MAX_LIGHTS];\nuniform vec3  x3d_LightLocation [MAX_LIGHTS];\nuniform vec3  x3d_LightDirection [MAX_LIGHTS];\nuniform float x3d_LightRadius [MAX_LIGHTS];\nuniform float x3d_LightBeamWidth [MAX_LIGHTS];\nuniform float x3d_LightCutOffAngle [MAX_LIGHTS];\n\nuniform bool x3d_SeparateBackColor;\n\nuniform float x3d_AmbientIntensity;\nuniform vec3  x3d_DiffuseColor;\nuniform vec3  x3d_SpecularColor;\nuniform vec3  x3d_EmissiveColor;\nuniform float x3d_Shininess;\nuniform float x3d_Transparency;\n\nuniform float x3d_BackAmbientIntensity;\nuniform vec3  x3d_BackDiffuseColor;\nuniform vec3  x3d_BackSpecularColor;\nuniform vec3  x3d_BackEmissiveColor;\nuniform float x3d_BackShininess;\nuniform float x3d_BackTransparency;\n\n#define GEOMETRY_2D 2\n#define GEOMETRY_3D 3\n\nuniform bool      x3d_Texturing; // true if a X3DTexture2DNode is attached, otherwise false\nuniform sampler2D x3d_Texture;\nuniform int       x3d_GeometryType;\n\nvarying vec4 C;  // color\nvarying vec4 t;  // texCoord\nvarying vec3 vN; // normalized normal vector at this point on geometry\nvarying vec3 v;  // point on geometry\n\nfloat\ngetFogInterpolant ()\n{\n	if (x3d_FogType == NO_FOG)\n		return 1.0;\n\n	float dv = length (v);\n\n	if (dv >= x3d_FogVisibilityRange)\n		return 0.0;\n\n	if (x3d_FogType == LINEAR_FOG)\n		return (x3d_FogVisibilityRange - dv) / x3d_FogVisibilityRange;\n\n	if (x3d_FogType == EXPONENTIAL_FOG)\n		return exp (-dv / (x3d_FogVisibilityRange - dv));\n\n	return 1.0;\n}\n\nvec4\ngetTextureColor ()\n{\n	if (x3d_GeometryType == GEOMETRY_3D)\n		return texture2D (x3d_Texture, vec2 (t .s, t .t));\n	\n	// GEOMETRY_2D\n	if (gl_FrontFacing)\n		return texture2D (x3d_Texture, vec2 (t .s, t .t));\n	\n	return texture2D (x3d_Texture, vec2 (1.0 - t .s, t .t));\n}\n\nvoid\nmain ()\n{\n	float f0 = getFogInterpolant ();\n\n	if (x3d_Lighting)\n	{\n		vec3  N  = normalize (gl_FrontFacing ? vN : -vN);\n		vec3  V  = normalize (-v); // normalized vector from point on geometry to viewer's position\n		float dV = length (v);\n\n		// Calculate diffuseFactor & alpha\n\n		bool frontColor = gl_FrontFacing || ! x3d_SeparateBackColor;\n\n		float ambientIntensity = frontColor ? x3d_AmbientIntensity : x3d_BackAmbientIntensity;\n		vec3  diffuseColor     = frontColor ? x3d_DiffuseColor     : x3d_BackDiffuseColor;\n		vec3  specularColor    = frontColor ? x3d_SpecularColor    : x3d_BackSpecularColor;\n		vec3  emissiveColor    = frontColor ? x3d_EmissiveColor    : x3d_BackEmissiveColor;\n		float shininess        = frontColor ? x3d_Shininess        : x3d_BackShininess;\n		float transparency     = frontColor ? x3d_Transparency     : x3d_BackTransparency;\n\n		vec3  diffuseFactor = vec3 (1.0, 1.0, 1.0);\n		float alpha         = 1.0 - transparency;\n\n		if (x3d_ColorMaterial)\n		{\n			if (x3d_Texturing)\n			{\n				vec4 T = getTextureColor ();\n\n				diffuseFactor  = T .rgb * C .rgb;\n				alpha         *= T .a;\n			}\n			else\n				diffuseFactor = C .rgb;\n\n			alpha *= C .a;\n		}\n		else\n		{\n			if (x3d_Texturing)\n			{\n				vec4 T = getTextureColor ();\n\n				diffuseFactor  = T .rgb * diffuseColor;\n				alpha         *= T .a;\n			}\n			else\n				diffuseFactor = diffuseColor;\n		}\n\n		vec3 ambientTerm = diffuseFactor * ambientIntensity;\n\n		// Apply light sources\n\n		vec3 finalColor = vec3 (0.0, 0.0, 0.0);\n\n		for (int i = 0; i < MAX_LIGHTS; ++ i)\n		{\n			float dL = length (x3d_LightLocation [i] - v);\n\n			if (x3d_LightOn [i] && (x3d_LightType [i] == DIRECTIONAL_LIGHT || dL <= x3d_LightRadius [i]))\n			{\n				vec3 c = x3d_LightAttenuation [i];\n				vec3 L = x3d_LightType [i] == DIRECTIONAL_LIGHT ? -x3d_LightDirection [i] : normalize (x3d_LightLocation [i] - v);\n				vec3 H = normalize (L + V); // specular term\n\n				vec3  diffuseTerm    = diffuseFactor * max (dot (N, L), 0.0);\n				float specularFactor = bool (shininess) ? pow (max (dot (N, H), 0.0), shininess) : 1.0;\n				vec3  specularTerm   = specularColor * specularFactor;\n\n				float attenuation = 1.0 / max (c [0] + c [1] * dL + c [2] * (dL * dL), 1.0);\n				float spot        = 1.0;\n\n				if (x3d_LightType [i] == SPOT_LIGHT)\n				{\n					float spotAngle = acos (dot (-L, x3d_LightDirection [i]));\n					\n					if (spotAngle >= x3d_LightCutOffAngle [i])\n						spot = 0.0;\n					else if (spotAngle <= x3d_LightBeamWidth [i])\n						spot = 1.0;\n					else\n						spot = (spotAngle - x3d_LightCutOffAngle [i]) / (x3d_LightBeamWidth [i] - x3d_LightCutOffAngle [i]);\n				}\n\n				finalColor += (attenuation * spot) * x3d_LightColor [i] *\n				              (x3d_LightAmbientIntensity [i] * ambientTerm +\n				               x3d_LightIntensity [i] * (diffuseTerm + specularTerm));\n			}\n		}\n\n		finalColor += emissiveColor;\n\n		gl_FragColor = vec4 (finalColor, alpha);\n	}\n	else\n	{\n		vec4 finalColor = vec4 (1.0, 1.0, 1.0, 1.0);\n	\n		if (x3d_ColorMaterial)\n		{\n			if (x3d_Texturing)\n			{\n				vec4 T = getTextureColor ();\n\n				finalColor = T * C;\n			}\n			else\n				finalColor = C;\n		}\n		else\n		{\n			if (x3d_Texturing)\n				finalColor = getTextureColor ();\n		}\n\n		gl_FragColor = finalColor;\n	}\n\n	gl_FragColor .rgb = mix (x3d_FogColor, gl_FragColor .rgb, f0);\n}\n"});define("text!cobweb/Browser/Rendering/Depth.vs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\nattribute vec4 x3d_Vertex;\n\nvoid\nmain ()\n{\n	gl_Position = x3d_ProjectionMatrix * x3d_ModelViewMatrix * x3d_Vertex;\n}\n"});define("text!cobweb/Browser/Rendering/Depth.fs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nvec3\npack (float f)\n{\n	vec3 color;\n\n	f *= 255.0;\n	color .r = floor (f);\n\n	f -= color .r;\n	f *= 255.0;\n	color .g = floor (f);\n\n	f -= color .g;\n	f *= 255.0;\n	color .b = floor (f);\n\n	return color / 255.0;\n}\n\nvoid\nmain ()\n{\n	gl_FragColor .rgb = pack (gl_FragCoord .z);\n}\n"});define("standard/Math/Utility/MatrixStack",["jquery"],function($){function MatrixStack(Type){return $.extend([new Type],{top:0,set:function(matrix){this[this.top].assign(matrix)},get:function(matrix){return this[this.top]},push:function(){var top=++this.top;if(top<this.length)this[top].assign(this[top-1]);else this[top]=this[top-1].copy()},pop:function(){--this.top},identity:function(){this[this.top].identity()},multLeft:function(matrix){this[this.top].multLeft(matrix)}})}return MatrixStack});define("cobweb/Browser/Rendering/X3DRenderingContext",["cobweb/Fields","cobweb/Components/Shaders/ComposedShader","cobweb/Components/Shaders/ShaderPart","text!cobweb/Browser/Rendering/Wireframe.vs","text!cobweb/Browser/Rendering/Wireframe.fs","text!cobweb/Browser/Rendering/Gouraud.vs","text!cobweb/Browser/Rendering/Gouraud.fs","text!cobweb/Browser/Rendering/Phong.vs","text!cobweb/Browser/Rendering/Phong.fs","text!cobweb/Browser/Rendering/Depth.vs","text!cobweb/Browser/Rendering/Depth.fs","standard/Math/Numbers/Vector4","standard/Math/Numbers/Matrix4","standard/Math/Utility/MatrixStack"],function(Fields,ComposedShader,ShaderPart,wireframeVS,wireframeFS,gouraudVS,gouraudFS,phongVS,phongFS,depthVS,depthFS,Vector4,Matrix4,MatrixStack){var MFInt32=Fields.MFInt32;function getShader(executionContext,vs,fs){var vertexShader=new ShaderPart(executionContext);vertexShader.type_="VERTEX";vertexShader.url_.push(vs);vertexShader.setup();var fragmentShader=new ShaderPart(executionContext);fragmentShader.type_="FRAGMENT";fragmentShader.url_.push(fs);fragmentShader.setup();var shader=new ComposedShader(executionContext);shader.language_="GLSL";shader.parts_.push(vertexShader);shader.parts_.push(fragmentShader);shader.setup();return shader}function getPointShader(executionContext,lineShader){var shader=new ComposedShader(executionContext);shader.language_="GLSL";shader.parts_=lineShader.parts_;shader.setup();return shader}function X3DRenderingContext(x3d){this.projectionMatrix=new Matrix4;this.projectionMatrixArray=new Float32Array(16);this.modelViewMatrix=new MatrixStack(Matrix4)}X3DRenderingContext.prototype={initialize:function(){this.addChildren("viewport",new MFInt32(0,0,100,100));var gl=this.getContext();gl.enable(gl.SCISSOR_TEST);gl.cullFace(gl.BACK);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.clearDepth(1);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.BLEND);setInterval(this.reshape.bind(this),401);this.reshape();this.lineShader=getShader(this,wireframeVS,wireframeFS);this.pointShader=getPointShader(this,this.lineShader);this.setDefaultShader(this.getXML()[0].getAttribute("shading"));this.setShader(this.getDefaultShader())},getVendor:function(){return this.getContext().getParameter(this.getContext().VENDOR)},getWebGLVersion:function(){return this.getContext().getParameter(this.getContext().VERSION)},getAntialiased:function(){return this.getContext().getParameter(this.getContext().SAMPLES)>0},getColorDepth:function(){var gl=this.context;var colorDepth=0;colorDepth+=gl.getParameter(gl.RED_BITS);colorDepth+=gl.getParameter(gl.BLUE_BITS);colorDepth+=gl.getParameter(gl.GREEN_BITS);colorDepth+=gl.getParameter(gl.ALPHA_BITS);return colorDepth},setProjectionMatrix:function(value){this.projectionMatrix=value;this.projectionMatrixArray.set(value)},getProjectionMatrix:function(){return this.projectionMatrix},getProjectionMatrixArray:function(){return this.projectionMatrixArray},getModelViewMatrix:function(){return this.modelViewMatrix},getViewport:function(){return this.viewport_},setDefaultShader:function(type){var gl=this.context;switch(type){case"POINTSET":{if(!this.gouraudShader)this.gouraudShader=getShader(this,gouraudVS,gouraudFS);this.defaultShader=this.gouraudShader;this.pointShader.primitiveMode=gl.POINTS;this.lineShader.primitiveMode=gl.POINTS;this.defaultShader.primitiveMode=gl.POINTS;this.pointShader.wireframe=true;this.lineShader.wireframe=true;this.defaultShader.wireframe=true;break}case"WIREFRAME":{if(!this.gouraudShader)this.gouraudShader=getShader(this,gouraudVS,gouraudFS);this.defaultShader=this.gouraudShader;this.pointShader.primitiveMode=gl.POINTS;this.lineShader.primitiveMode=gl.LINES;this.defaultShader.primitiveMode=gl.LINE_LOOP;this.pointShader.wireframe=true;this.lineShader.wireframe=true;this.defaultShader.wireframe=true;break}case"PHONG":{if(!this.phongShader)this.phongShader=getShader(this,phongVS,phongFS);this.defaultShader=this.phongShader;this.pointShader.primitiveMode=gl.POINTS;this.lineShader.primitiveMode=gl.LINES;this.defaultShader.primitiveMode=gl.TRIANGLES;this.pointShader.wireframe=true;this.lineShader.wireframe=true;this.defaultShader.wireframe=false;break}default:{if(!this.gouraudShader)this.gouraudShader=getShader(this,gouraudVS,gouraudFS);this.defaultShader=this.gouraudShader;this.pointShader.primitiveMode=gl.POINTS;this.lineShader.primitiveMode=gl.LINES;this.defaultShader.primitiveMode=gl.TRIANGLES;this.pointShader.wireframe=true;this.lineShader.wireframe=true;this.defaultShader.wireframe=false;break}}},getDefaultShader:function(){return this.defaultShader},getPointShader:function(){return this.pointShader},getLineShader:function(){return this.lineShader},getGouraudShader:function(){return this.gouraudShader},setShader:function(value){this.shader=value},getShader:function(){return this.shader},getDepthShader:function(){if(!this.depthShader)this.depthShader=getShader(this,depthVS,depthFS);return this.depthShader},reshape:function(){var canvas=this.canvas,width=canvas.width(),height=canvas.height();canvas=canvas[0];if(width!==canvas.width||height!==canvas.height){this.viewport_.setValue([0,0,width,height]);this.context.viewport(0,0,width,height);this.context.scissor(0,0,width,height);canvas.width=width;canvas.height=height;this.addBrowserEvent()}}};return X3DRenderingContext});define("standard/Math/Geometry/Box3",["standard/Math/Numbers/Matrix4","standard/Math/Numbers/Vector3"],function(Matrix4,Vector3){var min=new Vector3(0,0,0),max=new Vector3(0,0,0),x=new Vector3(0,0,0),y=new Vector3(0,0,0),z=new Vector3(0,0,0),r1=new Vector3(0,0,0),p1=new Vector3(0,0,0),p4=new Vector3(0,0,0);function Box3(size,center){switch(arguments.length){case 0:{this.matrix=new Matrix4(.5,0,0,0,0,.5,0,0,0,0,.5,0,0,0,0,0);return}case 2:{this.matrix=new Matrix4(size.x/2,0,0,0,0,size.y/2,0,0,0,0,size.z/2,0,center.x,center.y,center.z,1);return}case 3:{var min=arguments[0],max=arguments[1],sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,sz=(max.z-min.z)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2,cz=(max.z+min.z)/2;this.matrix=new Matrix4(sx,0,0,0,0,sy,0,0,0,0,sz,0,cx,cy,cz,1);return}}}Box3.prototype={constructor:Box3,copy:function(){var copy=Object.create(Box3.prototype);copy.matrix=this.matrix.copy();return copy},assign:function(box){this.matrix.assign(box.matrix);return this},set:function(size,center){var m=this.matrix;switch(arguments.length){case 0:{m[0]=.5;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=.5;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=.5;m[11]=0;m[12]=0;m[13]=0;m[14]=0;m[15]=0;return this}case 2:{m[0]=size.x/2;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=size.y/2;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=size.z/2;m[11]=0;m[12]=center.x;m[13]=center.y;m[14]=center.z;m[15]=1;return this}case 3:{var min=arguments[0],max=arguments[1],sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,sz=(max.z-min.z)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2,cz=(max.z+min.z)/2;m[0]=sx;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=sy;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=sz;m[11]=0;m[12]=cx;m[13]=cy;m[14]=cz;m[15]=1;return this}}},setExtents:function(min,max){var m=this.matrix,sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,sz=(max.z-min.z)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2,cz=(max.z+min.z)/2;m[0]=sx;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=sy;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=sz;m[11]=0;m[12]=cx;m[13]=cy;m[14]=cz;m[15]=1;return this},isEmpty:function(){return this.matrix[15]===0},add:function(box){if(this.isEmpty())return this.assign(box);if(box.isEmpty())return this;var lhs_min=new Vector3(0,0,0),lhs_max=new Vector3(0,0,0),rhs_min=new Vector3(0,0,0),rhs_max=new Vector3(0,0,0);this.getExtents(lhs_min,lhs_max);box.getExtents(rhs_min,rhs_max);return this.assign(new Box3(lhs_min.min(rhs_min),lhs_max.max(rhs_max),true))},multLeft:function(matrix){this.matrix.multLeft(matrix);return this},multRight:function(matrix){this.matrix.multRight(matrix);return this},getExtents:function(min,max){this.getAbsoluteExtents(min,max);min.add(this.center);max.add(this.center)},getAbsoluteExtents:function(min,max){var m=this.matrix;x.set(m[0],m[1],m[2]);y.set(m[4],m[5],m[6]);z.set(m[8],m[9],m[10]);r1.assign(y).add(z);var r2=z.subtract(y);p1.assign(x).add(r1),p4.assign(x).add(r2);var p2=r1.subtract(x),p3=r2.subtract(x);min.assign(p1);max.assign(p1);min.min(p2,p3,p4);max.max(p2,p3,p4);p1.negate();p2.negate();p3.negate();p4.negate();min.min(p1,p2,p3,p4);max.max(p1,p2,p3,p4)},intersectsPoint:function(point){this.getExtents(min,max);return min.x<=point.x&&max.x>=point.x&&min.y<=point.y&&max.y>=point.y&&min.z<=point.z&&max.z>=point.z},toString:function(){return this.size+", "+this.center}};Object.defineProperty(Box3.prototype,"size",{get:function(){var max=new Vector3(0,0,0);this.getAbsoluteExtents(min,max);return max.subtract(min)},enumerable:true,configurable:false});Object.defineProperty(Box3.prototype,"center",{get:function(){return this.matrix.origin},enumerable:true,configurable:false});return Box3});define("standard/Math/Geometry/Plane3",["standard/Math/Numbers/Vector3"],function(Vector3){function Plane3(point,normal){this.normal=normal.copy();this.distanceFromOrigin=normal.dot(point)}Plane3.prototype={constructor:Plane3,set:function(point,normal){this.normal.assign(normal);this.distanceFromOrigin=normal.dot(point)},distance:function(point){return point.dot(this.normal)-this.distanceFromOrigin},getDistanceToPoint:function(point){return Vector3.dot(point,this.normal)-this.distanceFromOrigin},intersectsLine:function(line,intersection){var point=line.point,direction=line.direction;var theta=direction.dot(this.normal);if(theta===0)return false;var t=(this.distanceFromOrigin-this.normal.dot(point))/theta;intersection.x=point.x+direction.x*t;intersection.y=point.y+direction.y*t;intersection.z=point.z+direction.z*t;return true},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}};return Plane3});define("standard/Math/Geometry/Triangle3",["standard/Math/Numbers/Vector3"],function(Vector3){var A=new Vector3(0,0,0),B=new Vector3(0,0,0),C=new Vector3(0,0,0);return{area:function(a,b,c){return A.assign(v2).subtract(v1).cross(B.assign(v3).subtract(v1)).abs()/2},normal:function(v1,v2,v3,normal){var x1=v3.x-v2.x,y1=v3.y-v2.y,z1=v3.z-v2.z,x2=v1.x-v2.x,y2=v1.y-v2.y,z2=v1.z-v2.z;normal.set(y1*z2-z1*y2,z1*x2-x1*z2,x1*y2-y1*x2);return normal.normalize()},quadNormal:function(v1,v2,v3,v4,normal){var x1=v3.x-v1.x,y1=v3.y-v1.y,z1=v3.z-v1.z,x2=v4.x-v2.x,y2=v4.y-v2.y,z2=v4.z-v2.z;normal.set(y1*z2-z1*y2,z1*x2-x1*z2,x1*y2-y1*x2);return normal.normalize()}}});define("cobweb/Components/Rendering/X3DGeometryNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Color3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Box3","standard/Math/Geometry/Plane3","standard/Math/Geometry/Triangle3","standard/Math/Algorithm"],function($,Fields,X3DNode,X3DConstants,Color3,Vector2,Vector3,Matrix4,Box3,Plane3,Triangle3,Algorithm){with(Fields){var boxNormals=[new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0),new Vector3(1,0,0)];function X3DGeometryNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DGeometryNode);this.addChildren("transparent",new SFBool)}X3DGeometryNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DGeometryNode,intersection:new Vector3(0,0,0),uvt:{u:0,v:0,t:0},v0:new Vector3(0,0,0),v1:new Vector3(0,0,0),v2:new Vector3(0,0,0),normal:new Vector3(0,0,0),setup:function(){this.setTainted(true);X3DNode.prototype.setup.call(this);this.addInterest(this,"eventsProcessed");this.eventsProcessed();this.setTainted(false)},initialize:function(){X3DNode.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");var gl=this.getBrowser().getContext();this.min=new Vector3(0,0,0);this.max=new Vector3(0,0,0);this.bbox=new Box3(this.min,this.max,true);this.solid=true;this.flatShading=undefined;this.colors=[];this.texCoords=[];this.normals=[];this.flatNormals=[];this.vertices=[];this.vertexCount=0;this.primitiveMode=gl.TRIANGLES;this.frontFace=gl.CCW;this.colorBuffer=gl.createBuffer();this.texCoordBuffers=[];this.normalBuffer=gl.createBuffer();this.vertexBuffer=gl.createBuffer();this.planes=[];if(!this.isLineGeometry()){for(var i=0;i<5;++i)this.planes[i]=new Plane3(Vector3.Zero,boxNormals[0])}this.setCurrentTexCoord(null);this.set_live__()},isLineGeometry:function(){return false},getBBox:function(){return this.bbox},setExtents:function(extents){this.min.assign(extents[0]);this.max.assign(extents[1])},getExtents:function(){return[this.min,this.max]},getMatrix:function(){return Matrix4.Identity},setPrimitiveMode:function(value){this.primitiveMode=value},setSolid:function(value){this.solid=value},setCCW:function(value){this.frontFace=value?this.getBrowser().getContext().CCW:this.getBrowser().getContext().CW},addColor:function(color){this.colors.push(color.r,color.g,color.b,color.length===3?1:color.a)},setColors:function(value){this.colors=value},getColors:function(){return this.colors},setTexCoords:function(value){this.texCoords=value},getTexCoords:function(){return this.texCoords},setCurrentTexCoord:function(value){this.currentTexCoordNode=value||this.getBrowser().getDefaultTextureCoordinate()},addNormal:function(normal){this.normals.push(normal.x,normal.y,normal.z)},setNormals:function(value){this.normals=value},getNormals:function(){return this.normals},addVertex:function(vertex){this.min.min(vertex);this.max.max(vertex);this.vertices.push(vertex.x,vertex.y,vertex.z,1)},setVertices:function(value){this.vertices=value},getVertices:function(){return this.vertices},buildTexCoords:function(){var p=this.getTexCoordParams(),min=p.min,Sindex=p.Sindex,Tindex=p.Tindex,Ssize=p.Ssize,S=min[Sindex],T=min[Tindex],texCoords=[],vertices=this.vertices;this.texCoords.push(texCoords);for(var i=0,length=this.vertices.length;i<length;i+=4){texCoords.push((vertices[i+Sindex]-S)/Ssize,(vertices[i+Tindex]-T)/Ssize,0,1)}},getTexCoordParams:function(){var p={},bbox=this.getBBox(),size=bbox.size,Xsize=size.x,Ysize=size.y,Zsize=size.z;p.min=bbox.center.subtract(size.divide(2));if(Xsize>=Ysize&&Xsize>=Zsize){p.Ssize=Xsize;p.Sindex=0;if(Ysize>=Zsize)p.Tindex=1;else p.Tindex=2}else if(Ysize>=Xsize&&Ysize>=Zsize){p.Ssize=Ysize;p.Sindex=1;if(Xsize>=Zsize)p.Tindex=0;else p.Tindex=2}else{p.Ssize=Zsize;p.Sindex=2;if(Xsize>=Ysize)p.Tindex=0;else p.Tindex=1}return p},refineNormals:function(normalIndex,normals,creaseAngle){if(creaseAngle===0)return normals;var cosCreaseAngle=Math.cos(Algorithm.clamp(creaseAngle,0,Math.PI)),normals_=[];for(var i in normalIndex){var vertex=normalIndex[i];for(var p=0,length=vertex.length;p<length;++p){var P=vertex[p],m=normals[P],n=new Vector3(0,0,0);for(var q=0;q<length;++q){var Q=normals[vertex[q]];if(Q.dot(m)>=cosCreaseAngle)n.add(Q)}normals_[P]=n.normalize()}}return normals_},addBackFaces:function(){var texCoords=this.texCoords[0],normals=this.normals,vertices=this.vertices;for(var i=this.vertices.length-1;i>-1;i-=4){texCoords.push(1-texCoords[i-3],texCoords[i-2],texCoords[i-1],texCoords[i]);normals.push(0,0,-1);vertices.push(vertices[i-3],vertices[i-2],vertices[i-1],1)}},set_live__:function(){var live=this.getExecutionContext().isLive().getValue()&&this.isLive().getValue();if(live)this.getBrowser().getBrowserOptions().Shading_.addInterest(this,"set_shading__");else this.getBrowser().getBrowserOptions().Shading_.removeInterest(this,"set_shading__")},set_shading__:function(shading){if(this.isLineGeometry())return;var flatShading=shading.getValue()==="FLAT";if(flatShading===this.flatShading)return;this.flatShading=flatShading;var gl=this.getBrowser().getContext();if(flatShading){if(!this.flatNormals.length){var cw=this.frontFace===gl.CW,flatNormals=this.flatNormals,vertices=this.vertices,v0=this.v0,v1=this.v1,v2=this.v2,normal=this.normal;for(var i=0,length=vertices.length;i<length;i+=12){Triangle3.normal(v0.set(vertices[i+0],vertices[i+1],vertices[i+2]),v1.set(vertices[i+4],vertices[i+5],vertices[i+6]),v2.set(vertices[i+8],vertices[i+9],vertices[i+10]),normal);if(cw)normal.negate();flatNormals.push(normal.x,normal.y,normal.z,normal.x,normal.y,normal.z,normal.x,normal.y,normal.z)}}}gl.bindBuffer(gl.ARRAY_BUFFER,this.normalBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(flatShading?this.flatNormals:this.normals),gl.STATIC_DRAW)},eventsProcessed:function(){X3DNode.prototype.eventsProcessed.call(this);this.clear();this.build();if(this.vertices.length)this.bbox.setExtents(this.min,this.max);else this.bbox.setExtents(this.min.set(0,0,0),this.max.set(0,0,0));if(!this.isLineGeometry()){for(var i=0;i<5;++i)this.planes[i].set(i%2?this.min:this.max,boxNormals[i]);if(this.texCoords.length===0)this.buildTexCoords()}this.set_shading__(this.getBrowser().getBrowserOptions().Shading_);this.transfer()},clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);this.flatShading=undefined;this.colors.length=0;this.texCoords.length=0;this.normals.length=0;this.flatNormals.length=0;this.vertices.length=0},transfer:function(){var gl=this.getBrowser().getContext(),count=this.vertices.length/4;gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.colors),gl.STATIC_DRAW);for(var i=this.texCoordBuffers.length;i<this.texCoords.length;++i)this.texCoordBuffers.push(gl.createBuffer());this.texCoordBuffers.length=this.texCoords.length;for(var i=0;i<this.texCoords.length;++i){gl.bindBuffer(gl.ARRAY_BUFFER,this.texCoordBuffers[i]);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.texCoords[i]),gl.STATIC_DRAW)}gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.vertices),gl.STATIC_DRAW);this.vertexCount=count},traverse:function(context){var browser=this.getBrowser(),gl=browser.getContext(),shader=browser.getShader();if(shader.vertex<0)return;context.colorMaterial=this.colors.length;shader.setLocalUniforms(context);if(this.colors.length&&shader.color>=0){gl.enableVertexAttribArray(shader.color);gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.vertexAttribPointer(shader.color,4,gl.FLOAT,false,0,0)}if(shader.texCoord>=0){gl.enableVertexAttribArray(shader.texCoord);gl.bindBuffer(gl.ARRAY_BUFFER,this.texCoordBuffers[0]);gl.vertexAttribPointer(shader.texCoord,4,gl.FLOAT,false,0,0)}if(shader.normal>=0){gl.enableVertexAttribArray(shader.normal);gl.bindBuffer(gl.ARRAY_BUFFER,this.normalBuffer);gl.vertexAttribPointer(shader.normal,3,gl.FLOAT,false,0,0)}gl.enableVertexAttribArray(shader.vertex);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.vertexAttribPointer(shader.vertex,4,gl.FLOAT,false,0,0);if(shader.wireframe||this.isLineGeometry()){if(this.isLineGeometry())gl.drawArrays(shader.primitiveMode,0,this.vertexCount);else{for(var i=0;i<this.vertexCount;i+=3)gl.drawArrays(shader.primitiveMode,i,3)}}else{var positiveScale=Matrix4.prototype.determinant3.call(context.modelViewMatrix)>0;gl.frontFace(positiveScale?this.frontFace:this.frontFace===gl.CCW?gl.CW:gl.CCW);if(context.transparent&&!this.solid){gl.enable(gl.CULL_FACE);gl.cullFace(gl.FRONT);gl.drawArrays(shader.primitiveMode,0,this.vertexCount);gl.cullFace(gl.BACK);gl.drawArrays(shader.primitiveMode,0,this.vertexCount)}else{if(this.solid)gl.enable(gl.CULL_FACE);else gl.disable(gl.CULL_FACE);gl.drawArrays(shader.primitiveMode,0,this.vertexCount)}}if(shader.color>=0)gl.disableVertexAttribArray(shader.color);if(shader.texCoord>=0)gl.disableVertexAttribArray(shader.texCoord);if(shader.normal>=0)gl.disableVertexAttribArray(shader.normal);gl.disableVertexAttribArray(shader.vertex)},collision:function(shader){var browser=this.getBrowser(),gl=browser.getContext();gl.enableVertexAttribArray(shader.vertex);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.vertexAttribPointer(shader.vertex,4,gl.FLOAT,false,0,0);if(this.isLineGeometry())gl.drawArrays(this.primitiveMode,0,this.vertexCount);else{gl.disable(gl.CULL_FACE);gl.drawArrays(this.primitiveMode,0,this.vertexCount)}gl.disableVertexAttribArray(shader.vertex)},intersectsLine:function(line,intersections){try{var intersected=false;this.transformLine(line);if(this.intersectsBBox(line)){var texCoords=this.texCoords[0],normals=this.normals,vertices=this.vertices,uvt=this.uvt,v0=this.v0,v1=this.v1,v2=this.v2;for(var i=0,length=this.vertexCount;i<length;i+=3){var i4=i*4;v0.x=vertices[i4+0];v0.y=vertices[i4+1];v0.z=vertices[i4+2];v1.x=vertices[i4+4];v1.y=vertices[i4+5];v1.z=vertices[i4+6];v2.x=vertices[i4+8];v2.y=vertices[i4+9];v2.z=vertices[i4+10];if(line.intersectsTriangle(v0,v1,v2,uvt)){var u=uvt.u,v=uvt.v,t=1-u-v;var point=new Vector3(t*vertices[i4+0]+u*vertices[i4+4]+v*vertices[i4+8],t*vertices[i4+1]+u*vertices[i4+5]+v*vertices[i4+9],t*vertices[i4+2]+u*vertices[i4+6]+v*vertices[i4+10]);var texCoord=new Vector2(t*texCoords[i4+0]+u*texCoords[i4+4]+v*texCoords[i4+8],t*texCoords[i4+1]+u*texCoords[i4+5]+v*texCoords[i4+9]);var i3=i*3;var normal=new Vector3(t*normals[i3+0]+u*normals[i3+3]+v*normals[i3+6],t*normals[i3+1]+u*normals[i3+4]+v*normals[i3+7],t*normals[i3+2]+u*normals[i3+5]+v*normals[i3+8]);intersections.push({texCoord:texCoord,normal:normal,point:point});intersected=true}}}return intersected}catch(error){return false}},intersectsBBox:function(line){var planes=this.planes,min=this.min,max=this.max,intersection=this.intersection;if(planes[0].intersectsLine(line,intersection)){if(intersection.x>=min.x&&intersection.x<=max.x&&intersection.y>=min.y&&intersection.y<=max.y)return true}if(planes[1].intersectsLine(line,intersection)){if(intersection.x>=min.x&&intersection.x<=max.x&&intersection.y>=min.y&&intersection.y<=max.y)return true}if(planes[2].intersectsLine(line,intersection)){if(intersection.x>=min.x&&intersection.x<=max.x&&intersection.z>=min.z&&intersection.z<=max.z)return true}if(planes[3].intersectsLine(line,intersection)){if(intersection.x>=min.x&&intersection.x<=max.x&&intersection.z>=min.z&&intersection.z<=max.z)return true}if(planes[4].intersectsLine(line,intersection)){if(intersection.y>=min.y&&intersection.y<=max.y&&intersection.z>=min.z&&intersection.z<=max.z)return true}return false},transformLine:function(line){},intersectsSphere:function(sphere){var vertices=this.vertices,v0=this.v0,v1=this.v1,v2=this.v2;for(var i=0,length=this.vertexCount;i<length;i+=3){var i4=i*4;v0.x=vertices[i4+0];v0.y=vertices[i4+1];v0.z=vertices[i4+2];v1.x=vertices[i4+4];v1.y=vertices[i4+5];v1.z=vertices[i4+6];v2.x=vertices[i4+8];v2.y=vertices[i4+9];v2.z=vertices[i4+10];if(sphere.intersectsTriangle(v0,v1,v2))return true}return false}});return X3DGeometryNode}});define("cobweb/Bits/X3DCast",[],function(){return function(type,node){try{if(node){if(node.getValue)node=node.getValue();if(node){node=node.getInnerNode();if(node.getType().indexOf(type)!==-1)return node}}}catch(error){}return null}});define("cobweb/Components/Rendering/X3DComposedGeometryNode",["jquery","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,X3DGeometryNode,X3DCast,X3DConstants){function X3DComposedGeometryNode(browser,executionContext){X3DGeometryNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DComposedGeometryNode);
this.attribNodes=[];this.colorNode=null;this.texCoordNode=null;this.normalNode=null;this.coordNode=null}X3DComposedGeometryNode.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:X3DComposedGeometryNode,initialize:function(){X3DGeometryNode.prototype.initialize.call(this);this.attrib_.addInterest(this,"set_attrib__");this.color_.addInterest(this,"set_color__");this.texCoord_.addInterest(this,"set_texCoord__");this.normal_.addInterest(this,"set_normal__");this.coord_.addInterest(this,"set_coord__");this.set_attrib__();this.set_color__();this.set_texCoord__();this.set_normal__();this.set_coord__()},getAttrib:function(){return this.attribNodes},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getCoord:function(){return this.coordNode},set_attrib__:function(){for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].removeInterest(this,"addNodeEvent");this.attribNodes.length=0;for(var i=0,length=this.attrib_.length;i<length;++i){var attribNode=X3DCast(X3DConstants.X3DVertexAttributeNode,this.attrib_[i]);if(attribNode)this.attribNodes.push(attribNode)}for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].addInterest(this,"addNodeEvent")},set_color__:function(){if(this.colorNode){this.colorNode.removeInterest(this,"addNodeEvent");this.colorNode.removeInterest(this,"set_transparent__")}this.colorNode=X3DCast(X3DConstants.X3DColorNode,this.color_);if(this.colorNode){this.colorNode.addInterest(this,"addNodeEvent");this.colorNode.addInterest(this,"set_transparent__");this.set_transparent__()}else this.transparent_=false},set_transparent__:function(){this.transparent_=this.colorNode.isTransparent()},set_texCoord__:function(){if(this.texCoordNode)this.texCoordNode.removeInterest(this,"addNodeEvent");this.texCoordNode=X3DCast(X3DConstants.X3DTextureCoordinateNode,this.texCoord_);if(this.texCoordNode)this.texCoordNode.addInterest(this,"addNodeEvent")},set_normal__:function(){if(this.normalNode)this.normalNode.removeInterest(this,"addNodeEvent");this.normalNode=X3DCast(X3DConstants.X3DNormalNode,this.normal_);if(this.normalNode)this.normalNode.addInterest(this,"addNodeEvent")},set_coord__:function(){if(this.coordNode)this.coordNode.removeInterest(this,"addNodeEvent");this.coordNode=X3DCast(X3DConstants.X3DCoordinateNode,this.coord_);if(this.coordNode)this.coordNode.addInterest(this,"addNodeEvent")}});return X3DComposedGeometryNode});!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("lib/poly2tri.js/dist/poly2tri.js",e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.poly2tri=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports={version:"1.3.5"}},{}],2:[function(_dereq_,module,exports){var Node=function(p,t){this.point=p;this.triangle=t||null;this.next=null;this.prev=null;this.value=p.x};var AdvancingFront=function(head,tail){this.head_=head;this.tail_=tail;this.search_node_=head};AdvancingFront.prototype.head=function(){return this.head_};AdvancingFront.prototype.setHead=function(node){this.head_=node};AdvancingFront.prototype.tail=function(){return this.tail_};AdvancingFront.prototype.setTail=function(node){this.tail_=node};AdvancingFront.prototype.search=function(){return this.search_node_};AdvancingFront.prototype.setSearch=function(node){this.search_node_=node};AdvancingFront.prototype.findSearchNode=function(){return this.search_node_};AdvancingFront.prototype.locateNode=function(x){var node=this.search_node_;if(x<node.value){while(node=node.prev){if(x>=node.value){this.search_node_=node;return node}}}else{while(node=node.next){if(x<node.value){this.search_node_=node.prev;return node.prev}}}return null};AdvancingFront.prototype.locatePoint=function(point){var px=point.x;var node=this.findSearchNode(px);var nx=node.point.x;if(px===nx){if(point!==node.point){if(point===node.prev.point){node=node.prev}else if(point===node.next.point){node=node.next}else{throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}}}else if(px<nx){while(node=node.prev){if(point===node.point){break}}}else{while(node=node.next){if(point===node.point){break}}}if(node){this.search_node_=node}return node};module.exports=AdvancingFront;module.exports.Node=Node},{}],3:[function(_dereq_,module,exports){function assert(condition,message){if(!condition){throw new Error(message||"Assert Failed")}}module.exports=assert},{}],4:[function(_dereq_,module,exports){var xy=_dereq_("./xy");var Point=function(x,y){this.x=+x||0;this.y=+y||0;this._p2t_edge_list=null};Point.prototype.toString=function(){return xy.toStringBase(this)};Point.prototype.toJSON=function(){return{x:this.x,y:this.y}};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.set_zero=function(){this.x=0;this.y=0;return this};Point.prototype.set=function(x,y){this.x=+x||0;this.y=+y||0;return this};Point.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};Point.prototype.add=function(n){this.x+=n.x;this.y+=n.y;return this};Point.prototype.sub=function(n){this.x-=n.x;this.y-=n.y;return this};Point.prototype.mul=function(s){this.x*=s;this.y*=s;return this};Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Point.prototype.normalize=function(){var len=this.length();this.x/=len;this.y/=len;return len};Point.prototype.equals=function(p){return this.x===p.x&&this.y===p.y};Point.negate=function(p){return new Point(-p.x,-p.y)};Point.add=function(a,b){return new Point(a.x+b.x,a.y+b.y)};Point.sub=function(a,b){return new Point(a.x-b.x,a.y-b.y)};Point.mul=function(s,p){return new Point(s*p.x,s*p.y)};Point.cross=function(a,b){if(typeof a==="number"){if(typeof b==="number"){return a*b}else{return new Point(-a*b.y,a*b.x)}}else{if(typeof b==="number"){return new Point(b*a.y,-b*a.x)}else{return a.x*b.y-a.y*b.x}}};Point.toString=xy.toString;Point.compare=xy.compare;Point.cmp=xy.compare;Point.equals=xy.equals;Point.dot=function(a,b){return a.x*b.x+a.y*b.y};module.exports=Point},{"./xy":11}],5:[function(_dereq_,module,exports){var xy=_dereq_("./xy");var PointError=function(message,points){this.name="PointError";this.points=points=points||[];this.message=message||"Invalid Points!";for(var i=0;i<points.length;i++){this.message+=" "+xy.toString(points[i])}};PointError.prototype=new Error;PointError.prototype.constructor=PointError;module.exports=PointError},{"./xy":11}],6:[function(_dereq_,module,exports){(function(global){var previousPoly2tri=global.poly2tri;exports.noConflict=function(){global.poly2tri=previousPoly2tri;return exports};exports.VERSION=_dereq_("../dist/version.json").version;exports.PointError=_dereq_("./pointerror");exports.Point=_dereq_("./point");exports.Triangle=_dereq_("./triangle");exports.SweepContext=_dereq_("./sweepcontext");var sweep=_dereq_("./sweep");exports.triangulate=sweep.triangulate;exports.sweep={Triangulate:sweep.triangulate}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(_dereq_,module,exports){var assert=_dereq_("./assert");var PointError=_dereq_("./pointerror");var Triangle=_dereq_("./triangle");var Node=_dereq_("./advancingfront").Node;var utils=_dereq_("./utils");var EPSILON=utils.EPSILON;var Orientation=utils.Orientation;var orient2d=utils.orient2d;var inScanArea=utils.inScanArea;var isAngleObtuse=utils.isAngleObtuse;function triangulate(tcx){tcx.initTriangulation();tcx.createAdvancingFront();sweepPoints(tcx);finalizationPolygon(tcx)}function sweepPoints(tcx){var i,len=tcx.pointCount();for(i=1;i<len;++i){var point=tcx.getPoint(i);var node=pointEvent(tcx,point);var edges=point._p2t_edge_list;for(var j=0;edges&&j<edges.length;++j){edgeEventByEdge(tcx,edges[j],node)}}}function finalizationPolygon(tcx){var t=tcx.front().head().next.triangle;var p=tcx.front().head().next.point;while(!t.getConstrainedEdgeCW(p)){t=t.neighborCCW(p)}tcx.meshClean(t)}function pointEvent(tcx,point){var node=tcx.locateNode(point);var new_node=newFrontTriangle(tcx,point,node);if(point.x<=node.point.x+EPSILON){fill(tcx,node)}fillAdvancingFront(tcx,new_node);return new_node}function edgeEventByEdge(tcx,edge,node){tcx.edge_event.constrained_edge=edge;tcx.edge_event.right=edge.p.x>edge.q.x;if(isEdgeSideOfTriangle(node.triangle,edge.p,edge.q)){return}fillEdgeEvent(tcx,edge,node);edgeEventByPoints(tcx,edge.p,edge.q,node.triangle,edge.q)}function edgeEventByPoints(tcx,ep,eq,triangle,point){if(isEdgeSideOfTriangle(triangle,ep,eq)){return}var p1=triangle.pointCCW(point);var o1=orient2d(eq,p1,ep);if(o1===Orientation.COLLINEAR){throw new PointError("poly2tri EdgeEvent: Collinear not supported!",[eq,p1,ep])}var p2=triangle.pointCW(point);var o2=orient2d(eq,p2,ep);if(o2===Orientation.COLLINEAR){throw new PointError("poly2tri EdgeEvent: Collinear not supported!",[eq,p2,ep])}if(o1===o2){if(o1===Orientation.CW){triangle=triangle.neighborCCW(point)}else{triangle=triangle.neighborCW(point)}edgeEventByPoints(tcx,ep,eq,triangle,point)}else{flipEdgeEvent(tcx,ep,eq,triangle,point)}}function isEdgeSideOfTriangle(triangle,ep,eq){var index=triangle.edgeIndex(ep,eq);if(index!==-1){triangle.markConstrainedEdgeByIndex(index);var t=triangle.getNeighbor(index);if(t){t.markConstrainedEdgeByPoints(ep,eq)}return true}return false}function newFrontTriangle(tcx,point,node){var triangle=new Triangle(point,node.point,node.next.point);triangle.markNeighbor(node.triangle);tcx.addToMap(triangle);var new_node=new Node(point);new_node.next=node.next;new_node.prev=node;node.next.prev=new_node;node.next=new_node;if(!legalize(tcx,triangle)){tcx.mapTriangleToNodes(triangle)}return new_node}function fill(tcx,node){var triangle=new Triangle(node.prev.point,node.point,node.next.point);triangle.markNeighbor(node.prev.triangle);triangle.markNeighbor(node.triangle);tcx.addToMap(triangle);node.prev.next=node.next;node.next.prev=node.prev;if(!legalize(tcx,triangle)){tcx.mapTriangleToNodes(triangle)}}function fillAdvancingFront(tcx,n){var node=n.next;while(node.next){if(isAngleObtuse(node.point,node.next.point,node.prev.point)){break}fill(tcx,node);node=node.next}node=n.prev;while(node.prev){if(isAngleObtuse(node.point,node.next.point,node.prev.point)){break}fill(tcx,node);node=node.prev}if(n.next&&n.next.next){if(isBasinAngleRight(n)){fillBasin(tcx,n)}}}function isBasinAngleRight(node){var ax=node.point.x-node.next.next.point.x;var ay=node.point.y-node.next.next.point.y;assert(ay>=0,"unordered y");return ax>=0||Math.abs(ax)<ay}function legalize(tcx,t){for(var i=0;i<3;++i){if(t.delaunay_edge[i]){continue}var ot=t.getNeighbor(i);if(ot){var p=t.getPoint(i);var op=ot.oppositePoint(t,p);var oi=ot.index(op);if(ot.constrained_edge[oi]||ot.delaunay_edge[oi]){t.constrained_edge[i]=ot.constrained_edge[oi];continue}var inside=inCircle(p,t.pointCCW(p),t.pointCW(p),op);if(inside){t.delaunay_edge[i]=true;ot.delaunay_edge[oi]=true;rotateTrianglePair(t,p,ot,op);var not_legalized=!legalize(tcx,t);if(not_legalized){tcx.mapTriangleToNodes(t)}not_legalized=!legalize(tcx,ot);if(not_legalized){tcx.mapTriangleToNodes(ot)}t.delaunay_edge[i]=false;ot.delaunay_edge[oi]=false;return true}}}return false}function inCircle(pa,pb,pc,pd){var adx=pa.x-pd.x;var ady=pa.y-pd.y;var bdx=pb.x-pd.x;var bdy=pb.y-pd.y;var adxbdy=adx*bdy;var bdxady=bdx*ady;var oabd=adxbdy-bdxady;if(oabd<=0){return false}var cdx=pc.x-pd.x;var cdy=pc.y-pd.y;var cdxady=cdx*ady;var adxcdy=adx*cdy;var ocad=cdxady-adxcdy;if(ocad<=0){return false}var bdxcdy=bdx*cdy;var cdxbdy=cdx*bdy;var alift=adx*adx+ady*ady;var blift=bdx*bdx+bdy*bdy;var clift=cdx*cdx+cdy*cdy;var det=alift*(bdxcdy-cdxbdy)+blift*ocad+clift*oabd;return det>0}function rotateTrianglePair(t,p,ot,op){var n1,n2,n3,n4;n1=t.neighborCCW(p);n2=t.neighborCW(p);n3=ot.neighborCCW(op);n4=ot.neighborCW(op);var ce1,ce2,ce3,ce4;ce1=t.getConstrainedEdgeCCW(p);ce2=t.getConstrainedEdgeCW(p);ce3=ot.getConstrainedEdgeCCW(op);ce4=ot.getConstrainedEdgeCW(op);var de1,de2,de3,de4;de1=t.getDelaunayEdgeCCW(p);de2=t.getDelaunayEdgeCW(p);de3=ot.getDelaunayEdgeCCW(op);de4=ot.getDelaunayEdgeCW(op);t.legalize(p,op);ot.legalize(op,p);ot.setDelaunayEdgeCCW(p,de1);t.setDelaunayEdgeCW(p,de2);t.setDelaunayEdgeCCW(op,de3);ot.setDelaunayEdgeCW(op,de4);ot.setConstrainedEdgeCCW(p,ce1);t.setConstrainedEdgeCW(p,ce2);t.setConstrainedEdgeCCW(op,ce3);ot.setConstrainedEdgeCW(op,ce4);t.clearNeighbors();ot.clearNeighbors();if(n1){ot.markNeighbor(n1)}if(n2){t.markNeighbor(n2)}if(n3){t.markNeighbor(n3)}if(n4){ot.markNeighbor(n4)}t.markNeighbor(ot)}function fillBasin(tcx,node){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){tcx.basin.left_node=node.next.next}else{tcx.basin.left_node=node.next}tcx.basin.bottom_node=tcx.basin.left_node;while(tcx.basin.bottom_node.next&&tcx.basin.bottom_node.point.y>=tcx.basin.bottom_node.next.point.y){tcx.basin.bottom_node=tcx.basin.bottom_node.next}if(tcx.basin.bottom_node===tcx.basin.left_node){return}tcx.basin.right_node=tcx.basin.bottom_node;while(tcx.basin.right_node.next&&tcx.basin.right_node.point.y<tcx.basin.right_node.next.point.y){tcx.basin.right_node=tcx.basin.right_node.next}if(tcx.basin.right_node===tcx.basin.bottom_node){return}tcx.basin.width=tcx.basin.right_node.point.x-tcx.basin.left_node.point.x;tcx.basin.left_highest=tcx.basin.left_node.point.y>tcx.basin.right_node.point.y;fillBasinReq(tcx,tcx.basin.bottom_node)}function fillBasinReq(tcx,node){if(isShallow(tcx,node)){return}fill(tcx,node);var o;if(node.prev===tcx.basin.left_node&&node.next===tcx.basin.right_node){return}else if(node.prev===tcx.basin.left_node){o=orient2d(node.point,node.next.point,node.next.next.point);if(o===Orientation.CW){return}node=node.next}else if(node.next===tcx.basin.right_node){o=orient2d(node.point,node.prev.point,node.prev.prev.point);if(o===Orientation.CCW){return}node=node.prev}else{if(node.prev.point.y<node.next.point.y){node=node.prev}else{node=node.next}}fillBasinReq(tcx,node)}function isShallow(tcx,node){var height;if(tcx.basin.left_highest){height=tcx.basin.left_node.point.y-node.point.y}else{height=tcx.basin.right_node.point.y-node.point.y}if(tcx.basin.width>height){return true}return false}function fillEdgeEvent(tcx,edge,node){if(tcx.edge_event.right){fillRightAboveEdgeEvent(tcx,edge,node)}else{fillLeftAboveEdgeEvent(tcx,edge,node)}}function fillRightAboveEdgeEvent(tcx,edge,node){while(node.next.point.x<edge.p.x){if(orient2d(edge.q,node.next.point,edge.p)===Orientation.CCW){fillRightBelowEdgeEvent(tcx,edge,node)}else{node=node.next}}}function fillRightBelowEdgeEvent(tcx,edge,node){if(node.point.x<edge.p.x){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node)}else{fillRightConvexEdgeEvent(tcx,edge,node);fillRightBelowEdgeEvent(tcx,edge,node)}}}function fillRightConcaveEdgeEvent(tcx,edge,node){fill(tcx,node.next);if(node.next.point!==edge.p){if(orient2d(edge.q,node.next.point,edge.p)===Orientation.CCW){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node)}else{}}}}function fillRightConvexEdgeEvent(tcx,edge,node){if(orient2d(node.next.point,node.next.next.point,node.next.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node.next)}else{if(orient2d(edge.q,node.next.next.point,edge.p)===Orientation.CCW){fillRightConvexEdgeEvent(tcx,edge,node.next)}else{}}}function fillLeftAboveEdgeEvent(tcx,edge,node){while(node.prev.point.x>edge.p.x){if(orient2d(edge.q,node.prev.point,edge.p)===Orientation.CW){fillLeftBelowEdgeEvent(tcx,edge,node)}else{node=node.prev}}}function fillLeftBelowEdgeEvent(tcx,edge,node){if(node.point.x>edge.p.x){if(orient2d(node.point,node.prev.point,node.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node)}else{fillLeftConvexEdgeEvent(tcx,edge,node);fillLeftBelowEdgeEvent(tcx,edge,node)}}}function fillLeftConvexEdgeEvent(tcx,edge,node){if(orient2d(node.prev.point,node.prev.prev.point,node.prev.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node.prev)}else{if(orient2d(edge.q,node.prev.prev.point,edge.p)===Orientation.CW){fillLeftConvexEdgeEvent(tcx,edge,node.prev)}else{}}}function fillLeftConcaveEdgeEvent(tcx,edge,node){fill(tcx,node.prev);if(node.prev.point!==edge.p){if(orient2d(edge.q,node.prev.point,edge.p)===Orientation.CW){if(orient2d(node.point,node.prev.point,node.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node)}else{}}}}function flipEdgeEvent(tcx,ep,eq,t,p){var ot=t.neighborAcross(p);assert(ot,"FLIP failed due to missing triangle!");var op=ot.oppositePoint(t,p);if(t.getConstrainedEdgeAcross(p)){var index=t.index(p);throw new PointError("poly2tri Intersecting Constraints",[p,op,t.getPoint((index+1)%3),t.getPoint((index+2)%3)])}if(inScanArea(p,t.pointCCW(p),t.pointCW(p),op)){rotateTrianglePair(t,p,ot,op);tcx.mapTriangleToNodes(t);tcx.mapTriangleToNodes(ot);if(p===eq&&op===ep){if(eq===tcx.edge_event.constrained_edge.q&&ep===tcx.edge_event.constrained_edge.p){t.markConstrainedEdgeByPoints(ep,eq);ot.markConstrainedEdgeByPoints(ep,eq);legalize(tcx,t);legalize(tcx,ot)}else{}}else{var o=orient2d(eq,op,ep);t=nextFlipTriangle(tcx,o,t,ot,p,op);flipEdgeEvent(tcx,ep,eq,t,p)}}else{var newP=nextFlipPoint(ep,eq,ot,op);flipScanEdgeEvent(tcx,ep,eq,t,ot,newP);edgeEventByPoints(tcx,ep,eq,t,p)}}function nextFlipTriangle(tcx,o,t,ot,p,op){var edge_index;if(o===Orientation.CCW){edge_index=ot.edgeIndex(p,op);ot.delaunay_edge[edge_index]=true;legalize(tcx,ot);ot.clearDelaunayEdges();return t}edge_index=t.edgeIndex(p,op);t.delaunay_edge[edge_index]=true;legalize(tcx,t);t.clearDelaunayEdges();return ot}function nextFlipPoint(ep,eq,ot,op){var o2d=orient2d(eq,op,ep);if(o2d===Orientation.CW){return ot.pointCCW(op)}else if(o2d===Orientation.CCW){return ot.pointCW(op)}else{throw new PointError("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[eq,op,ep])}}function flipScanEdgeEvent(tcx,ep,eq,flip_triangle,t,p){var ot=t.neighborAcross(p);assert(ot,"FLIP failed due to missing triangle");var op=ot.oppositePoint(t,p);if(inScanArea(eq,flip_triangle.pointCCW(eq),flip_triangle.pointCW(eq),op)){flipEdgeEvent(tcx,eq,op,ot,op)}else{var newP=nextFlipPoint(ep,eq,ot,op);flipScanEdgeEvent(tcx,ep,eq,flip_triangle,ot,newP)}}exports.triangulate=triangulate},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(_dereq_,module,exports){var PointError=_dereq_("./pointerror");var Point=_dereq_("./point");var Triangle=_dereq_("./triangle");var sweep=_dereq_("./sweep");var AdvancingFront=_dereq_("./advancingfront");var Node=AdvancingFront.Node;var kAlpha=.3;var Edge=function(p1,p2){this.p=p1;this.q=p2;if(p1.y>p2.y){this.q=p1;this.p=p2}else if(p1.y===p2.y){if(p1.x>p2.x){this.q=p1;this.p=p2}else if(p1.x===p2.x){throw new PointError("poly2tri Invalid Edge constructor: repeated points!",[p1])}}if(!this.q._p2t_edge_list){this.q._p2t_edge_list=[]}this.q._p2t_edge_list.push(this)};var Basin=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=false};Basin.prototype.clear=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=false};var EdgeEvent=function(){this.constrained_edge=null;this.right=false};var SweepContext=function(contour,options){options=options||{};this.triangles_=[];this.map_=[];this.points_=options.cloneArrays?contour.slice(0):contour;this.edge_list=[];this.pmin_=this.pmax_=null;this.front_=null;this.head_=null;this.tail_=null;this.af_head_=null;this.af_middle_=null;this.af_tail_=null;this.basin=new Basin;this.edge_event=new EdgeEvent;this.initEdges(this.points_)};SweepContext.prototype.addHole=function(polyline){this.initEdges(polyline);var i,len=polyline.length;for(i=0;i<len;i++){this.points_.push(polyline[i])}return this};SweepContext.prototype.AddHole=SweepContext.prototype.addHole;SweepContext.prototype.addHoles=function(holes){var i,len=holes.length;for(i=0;i<len;i++){this.initEdges(holes[i])}this.points_=this.points_.concat.apply(this.points_,holes);return this};SweepContext.prototype.addPoint=function(point){this.points_.push(point);return this};SweepContext.prototype.AddPoint=SweepContext.prototype.addPoint;SweepContext.prototype.addPoints=function(points){this.points_=this.points_.concat(points);return this};SweepContext.prototype.triangulate=function(){sweep.triangulate(this);return this};SweepContext.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};SweepContext.prototype.getTriangles=function(){return this.triangles_};SweepContext.prototype.GetTriangles=SweepContext.prototype.getTriangles;SweepContext.prototype.front=function(){return this.front_};SweepContext.prototype.pointCount=function(){return this.points_.length};SweepContext.prototype.head=function(){return this.head_};SweepContext.prototype.setHead=function(p1){this.head_=p1};SweepContext.prototype.tail=function(){return this.tail_};SweepContext.prototype.setTail=function(p1){this.tail_=p1};SweepContext.prototype.getMap=function(){return this.map_};SweepContext.prototype.initTriangulation=function(){var xmax=this.points_[0].x;var xmin=this.points_[0].x;var ymax=this.points_[0].y;var ymin=this.points_[0].y;var i,len=this.points_.length;for(i=1;i<len;i++){var p=this.points_[i];p.x>xmax&&(xmax=p.x);p.x<xmin&&(xmin=p.x);p.y>ymax&&(ymax=p.y);p.y<ymin&&(ymin=p.y)}this.pmin_=new Point(xmin,ymin);this.pmax_=new Point(xmax,ymax);var dx=kAlpha*(xmax-xmin);var dy=kAlpha*(ymax-ymin);this.head_=new Point(xmax+dx,ymin-dy);this.tail_=new Point(xmin-dx,ymin-dy);this.points_.sort(Point.compare)};SweepContext.prototype.initEdges=function(polyline){var i,len=polyline.length;for(i=0;i<len;++i){this.edge_list.push(new Edge(polyline[i],polyline[(i+1)%len]))}};SweepContext.prototype.getPoint=function(index){return this.points_[index]};SweepContext.prototype.addToMap=function(triangle){this.map_.push(triangle)};SweepContext.prototype.locateNode=function(point){return this.front_.locateNode(point.x)};SweepContext.prototype.createAdvancingFront=function(){var head;var middle;var tail;var triangle=new Triangle(this.points_[0],this.tail_,this.head_);this.map_.push(triangle);head=new Node(triangle.getPoint(1),triangle);middle=new Node(triangle.getPoint(0),triangle);tail=new Node(triangle.getPoint(2));this.front_=new AdvancingFront(head,tail);head.next=middle;middle.next=tail;middle.prev=head;tail.prev=middle};SweepContext.prototype.removeNode=function(node){};SweepContext.prototype.mapTriangleToNodes=function(t){for(var i=0;i<3;++i){if(!t.getNeighbor(i)){var n=this.front_.locatePoint(t.pointCW(t.getPoint(i)));if(n){n.triangle=t}}}};SweepContext.prototype.removeFromMap=function(triangle){var i,map=this.map_,len=map.length;for(i=0;i<len;i++){if(map[i]===triangle){map.splice(i,1);break}}};SweepContext.prototype.meshClean=function(triangle){var triangles=[triangle],t,i;while(t=triangles.pop()){if(!t.isInterior()){t.setInterior(true);this.triangles_.push(t);for(i=0;i<3;i++){if(!t.constrained_edge[i]){triangles.push(t.getNeighbor(i))}}}}};module.exports=SweepContext},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(_dereq_,module,exports){var xy=_dereq_("./xy");var Triangle=function(a,b,c){this.points_=[a,b,c];this.neighbors_=[null,null,null];this.interior_=false;this.constrained_edge=[false,false,false];this.delaunay_edge=[false,false,false]};var p2s=xy.toString;Triangle.prototype.toString=function(){return"["+p2s(this.points_[0])+p2s(this.points_[1])+p2s(this.points_[2])+"]"};Triangle.prototype.getPoint=function(index){return this.points_[index]};Triangle.prototype.GetPoint=Triangle.prototype.getPoint;Triangle.prototype.getPoints=function(){return this.points_};Triangle.prototype.getNeighbor=function(index){return this.neighbors_[index]};Triangle.prototype.containsPoint=function(point){var points=this.points_;return point===points[0]||point===points[1]||point===points[2]};Triangle.prototype.containsEdge=function(edge){return this.containsPoint(edge.p)&&this.containsPoint(edge.q)};Triangle.prototype.containsPoints=function(p1,p2){return this.containsPoint(p1)&&this.containsPoint(p2)};Triangle.prototype.isInterior=function(){return this.interior_};Triangle.prototype.setInterior=function(interior){this.interior_=interior;return this};Triangle.prototype.markNeighborPointers=function(p1,p2,t){var points=this.points_;if(p1===points[2]&&p2===points[1]||p1===points[1]&&p2===points[2]){this.neighbors_[0]=t}else if(p1===points[0]&&p2===points[2]||p1===points[2]&&p2===points[0]){this.neighbors_[1]=t}else if(p1===points[0]&&p2===points[1]||p1===points[1]&&p2===points[0]){this.neighbors_[2]=t}else{throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")}};Triangle.prototype.markNeighbor=function(t){var points=this.points_;if(t.containsPoints(points[1],points[2])){this.neighbors_[0]=t;t.markNeighborPointers(points[1],points[2],this)}else if(t.containsPoints(points[0],points[2])){this.neighbors_[1]=t;t.markNeighborPointers(points[0],points[2],this)}else if(t.containsPoints(points[0],points[1])){this.neighbors_[2]=t;t.markNeighborPointers(points[0],points[1],this)}};Triangle.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};Triangle.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=false;this.delaunay_edge[1]=false;this.delaunay_edge[2]=false};Triangle.prototype.pointCW=function(p){var points=this.points_;if(p===points[0]){return points[2]}else if(p===points[1]){return points[0]}else if(p===points[2]){return points[1]}else{return null}};Triangle.prototype.pointCCW=function(p){var points=this.points_;if(p===points[0]){return points[1]}else if(p===points[1]){return points[2]}else if(p===points[2]){return points[0]}else{return null}};Triangle.prototype.neighborCW=function(p){if(p===this.points_[0]){return this.neighbors_[1]}else if(p===this.points_[1]){return this.neighbors_[2]}else{return this.neighbors_[0]}};Triangle.prototype.neighborCCW=function(p){if(p===this.points_[0]){return this.neighbors_[2]}else if(p===this.points_[1]){return this.neighbors_[0]}else{return this.neighbors_[1]}};Triangle.prototype.getConstrainedEdgeCW=function(p){if(p===this.points_[0]){return this.constrained_edge[1]}else if(p===this.points_[1]){return this.constrained_edge[2]}else{return this.constrained_edge[0]}};Triangle.prototype.getConstrainedEdgeCCW=function(p){if(p===this.points_[0]){return this.constrained_edge[2]}else if(p===this.points_[1]){return this.constrained_edge[0]}else{return this.constrained_edge[1]}};Triangle.prototype.getConstrainedEdgeAcross=function(p){if(p===this.points_[0]){return this.constrained_edge[0]}else if(p===this.points_[1]){return this.constrained_edge[1]}else{return this.constrained_edge[2]}};Triangle.prototype.setConstrainedEdgeCW=function(p,ce){if(p===this.points_[0]){this.constrained_edge[1]=ce}else if(p===this.points_[1]){this.constrained_edge[2]=ce}else{this.constrained_edge[0]=ce}};Triangle.prototype.setConstrainedEdgeCCW=function(p,ce){if(p===this.points_[0]){this.constrained_edge[2]=ce}else if(p===this.points_[1]){this.constrained_edge[0]=ce}else{this.constrained_edge[1]=ce}};Triangle.prototype.getDelaunayEdgeCW=function(p){if(p===this.points_[0]){return this.delaunay_edge[1]}else if(p===this.points_[1]){return this.delaunay_edge[2]}else{return this.delaunay_edge[0]}};Triangle.prototype.getDelaunayEdgeCCW=function(p){if(p===this.points_[0]){return this.delaunay_edge[2]}else if(p===this.points_[1]){return this.delaunay_edge[0]}else{return this.delaunay_edge[1]}};Triangle.prototype.setDelaunayEdgeCW=function(p,e){if(p===this.points_[0]){this.delaunay_edge[1]=e}else if(p===this.points_[1]){this.delaunay_edge[2]=e}else{this.delaunay_edge[0]=e}};Triangle.prototype.setDelaunayEdgeCCW=function(p,e){if(p===this.points_[0]){this.delaunay_edge[2]=e}else if(p===this.points_[1]){this.delaunay_edge[0]=e}else{this.delaunay_edge[1]=e}};Triangle.prototype.neighborAcross=function(p){if(p===this.points_[0]){return this.neighbors_[0]}else if(p===this.points_[1]){return this.neighbors_[1]}else{return this.neighbors_[2]}};Triangle.prototype.oppositePoint=function(t,p){var cw=t.pointCW(p);return this.pointCW(cw)};Triangle.prototype.legalize=function(opoint,npoint){var points=this.points_;if(opoint===points[0]){points[1]=points[0];points[0]=points[2];points[2]=npoint}else if(opoint===points[1]){points[2]=points[1];points[1]=points[0];points[0]=npoint}else if(opoint===points[2]){points[0]=points[2];points[2]=points[1];points[1]=npoint}else{throw new Error("poly2tri Invalid Triangle.legalize() call")}};Triangle.prototype.index=function(p){var points=this.points_;if(p===points[0]){return 0}else if(p===points[1]){return 1}else if(p===points[2]){return 2}else{throw new Error("poly2tri Invalid Triangle.index() call")}};Triangle.prototype.edgeIndex=function(p1,p2){var points=this.points_;if(p1===points[0]){if(p2===points[1]){return 2}else if(p2===points[2]){return 1}}else if(p1===points[1]){if(p2===points[2]){return 0}else if(p2===points[0]){return 2}}else if(p1===points[2]){if(p2===points[0]){return 1}else if(p2===points[1]){return 0}}return-1};Triangle.prototype.markConstrainedEdgeByIndex=function(index){this.constrained_edge[index]=true};Triangle.prototype.markConstrainedEdgeByEdge=function(edge){this.markConstrainedEdgeByPoints(edge.p,edge.q)};Triangle.prototype.markConstrainedEdgeByPoints=function(p,q){var points=this.points_;if(q===points[0]&&p===points[1]||q===points[1]&&p===points[0]){this.constrained_edge[2]=true}else if(q===points[0]&&p===points[2]||q===points[2]&&p===points[0]){this.constrained_edge[1]=true}else if(q===points[1]&&p===points[2]||q===points[2]&&p===points[1]){this.constrained_edge[0]=true}};module.exports=Triangle},{"./xy":11}],10:[function(_dereq_,module,exports){var EPSILON=1e-12;exports.EPSILON=EPSILON;var Orientation={CW:1,CCW:-1,COLLINEAR:0};exports.Orientation=Orientation;function orient2d(pa,pb,pc){var detleft=(pa.x-pc.x)*(pb.y-pc.y);var detright=(pa.y-pc.y)*(pb.x-pc.x);var val=detleft-detright;if(val>-EPSILON&&val<EPSILON){return Orientation.COLLINEAR}else if(val>0){return Orientation.CCW}else{return Orientation.CW}}exports.orient2d=orient2d;function inScanArea(pa,pb,pc,pd){var oadb=(pa.x-pb.x)*(pd.y-pb.y)-(pd.x-pb.x)*(pa.y-pb.y);if(oadb>=-EPSILON){return false}var oadc=(pa.x-pc.x)*(pd.y-pc.y)-(pd.x-pc.x)*(pa.y-pc.y);if(oadc<=EPSILON){return false}return true}exports.inScanArea=inScanArea;function isAngleObtuse(pa,pb,pc){var ax=pb.x-pa.x;var ay=pb.y-pa.y;var bx=pc.x-pa.x;var by=pc.y-pa.y;return ax*bx+ay*by<0}exports.isAngleObtuse=isAngleObtuse},{}],11:[function(_dereq_,module,exports){function toStringBase(p){return"("+p.x+";"+p.y+")"}function toString(p){var s=p.toString();return s==="[object Object]"?toStringBase(p):s}function compare(a,b){if(a.y===b.y){return a.x-b.x}else{return a.y-b.y}}function equals(a,b){return a.x===b.x&&a.y===b.y}module.exports={toString:toString,toStringBase:toStringBase,compare:compare,equals:equals}},{}]},{},[6])(6)});define("cobweb/Components/Geometry3D/IndexedFaceSet",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DComposedGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","lib/poly2tri.js/dist/poly2tri.js"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DComposedGeometryNode,X3DConstants,Vector3,Matrix4,poly2tri){with(Fields){function IndexedFaceSet(executionContext){X3DComposedGeometryNode.call(this,executionContext.getBrowser(),executionContext);
this.addType(X3DConstants.IndexedFaceSet)}IndexedFaceSet.prototype=$.extend(Object.create(X3DComposedGeometryNode.prototype),{constructor:IndexedFaceSet,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"ccw",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"convex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"creaseAngle",new SFFloat),new X3DFieldDefinition(X3DConstants.initializeOnly,"colorPerVertex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"normalPerVertex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"colorIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"texCoordIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"normalIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"coordIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"attrib",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"fogCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"texCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"normal",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"coord",new SFNode)]),getTypeName:function(){return"IndexedFaceSet"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getTexCoordPerVertexIndex:function(index){if(index<this.texCoordIndex_.length)return this.texCoordIndex_[index];return this.coordIndex_[index]},getColorPerVertexIndex:function(index){if(index<this.colorIndex_.length)return this.colorIndex_[index];return this.coordIndex_[index]},getColorIndex:function(index){if(index<this.colorIndex_.length)return this.colorIndex_[index];return index},getNormalPerVertexIndex:function(index){if(index<this.normalIndex_.length)return this.normalIndex_[index];return this.coordIndex_[index]},getNormalIndex:function(index){if(index<this.normalIndex_.length)return this.normalIndex_[index];return index},build:function(){var polygons=this.triangulate();if(polygons.length===0)return;var colorPerVertex=this.colorPerVertex_.getValue(),normalPerVertex=this.normalPerVertex_.getValue(),coordIndex=this.coordIndex_.getValue(),colorNode=this.getColor(),texCoordNode=this.getTexCoord(),normalNode=this.getNormal(),coordNode=this.getCoord(),textCoords=this.getTexCoords(),face=0;if(texCoordNode)texCoordNode.init(textCoords);for(var p=0,pl=polygons.length;p<pl;++p){var triangles=polygons[p].triangles;for(var t=0,tl=triangles.length;t<tl;++t){var triangle=triangles[t];for(var v=0;v<3;++v){var i=triangle[v],index=coordIndex[i].getValue();if(colorNode){if(colorPerVertex)this.addColor(colorNode.getColor(this.getColorPerVertexIndex(i)));else this.addColor(colorNode.getColor(this.getColorIndex(face)))}if(texCoordNode)texCoordNode.addTexCoord(textCoords,this.getTexCoordPerVertexIndex(i));if(normalNode){if(normalPerVertex)this.addNormal(normalNode.getVector(this.getNormalPerVertexIndex(i)));else this.addNormal(normalNode.getVector(this.getNormalIndex(face)))}this.addVertex(coordNode.getPoint(index))}}++face}if(!this.getNormal())this.buildNormals(polygons);this.setSolid(this.solid_.getValue());this.setCCW(this.ccw_.getValue());this.setCurrentTexCoord(this.getTexCoord())},triangulate:function(){var convex=this.convex_.getValue(),coordIndex=this.coordIndex_.getValue(),coordLength=coordIndex.length,polygons=[];if(!this.getCoord())return polygons;if(coordLength){if(this.coordIndex_[coordLength-1]>-1)this.coordIndex_.push(-1);var i=0;polygons.push({vertices:[],triangles:[]});for(var c=0;c<coordLength;++c){var index=coordIndex[c].getValue(),vertices=polygons[polygons.length-1].vertices;if(index>-1){vertices.push(i)}else{if(vertices.length){if(vertices[0]===vertices[vertices.length-1])vertices.pop();switch(vertices.length){case 0:case 1:case 2:{vertices.length=0;break}case 3:{polygons[polygons.length-1].triangles.push(vertices);polygons.push({vertices:[],triangles:[]});break}default:{if(convex)this.triangulateConvexPolygon(polygons[polygons.length-1]);else this.triangulatePolygon(polygons[polygons.length-1]);if(polygons[polygons.length-1].triangles.length)polygons.push({vertices:[],triangles:[]});else vertices.length=0;break}}}}++i}if(polygons[polygons.length-1].triangles.length===0)polygons.pop()}return polygons},triangulatePolygon:function(polygon){try{var vertices=polygon.vertices,triangles=polygon.triangles,coordIndex=this.coordIndex_.getValue(),coord=this.getCoord();var p0=coord.getPoint(coordIndex[vertices[0]].getValue()),p1=coord.getPoint(coordIndex[vertices[1]].getValue());var zAxis=this.getPolygonNormal(vertices,coordIndex,coord),xAxis=Vector3.subtract(p1,p0),yAxis=Vector3.cross(zAxis,xAxis);xAxis.normalize();yAxis.normalize();var matrix=new Matrix4(xAxis.x,xAxis.y,xAxis.z,0,yAxis.x,yAxis.y,yAxis.z,0,zAxis.x,zAxis.y,zAxis.z,0,p0.x,p0.y,p0.z,1);matrix.inverse();var contour=[];for(var i=0,length=vertices.length;i<length;++i){var index=vertices[i],vertex2=matrix.multVecMatrix(coord.getPoint(coordIndex[index].getValue()).copy());vertex2.index=index;contour.push(vertex2)}var context=new poly2tri.SweepContext(contour),ts=context.triangulate().getTriangles();for(var i=0,length=ts.length;i<length;++i)triangles.push([ts[i].getPoint(0).index,ts[i].getPoint(1).index,ts[i].getPoint(2).index])}catch(error){this.triangulateConvexPolygon(polygon)}},triangulateConvexPolygon:function(polygon){var vertices=polygon.vertices,triangles=polygon.triangles;for(var i=1,length=vertices.length-1;i<length;++i)triangles.push([vertices[0],vertices[i],vertices[i+1]])},buildNormals:function(polygons){var normals=this.createNormals(polygons);for(var p=0,pl=polygons.length;p<pl;++p){var triangles=polygons[p].triangles;for(var t=0,tl=triangles.length;t<tl;++t){var triangle=triangles[t];this.addNormal(normals[triangle[0]]);this.addNormal(normals[triangle[1]]);this.addNormal(normals[triangle[2]])}}},createNormals:function(polygons){var cw=!this.ccw_.getValue(),normals=[],normalIndex=[],coordIndex=this.coordIndex_.getValue(),coord=this.getCoord(),normal=null;for(var p=0,pl=polygons.length;p<pl;++p){var polygon=polygons[p],vertices=polygon.vertices,length=vertices.length;switch(length){case 3:{normal=coord.getNormal(coordIndex[vertices[0]].getValue(),coordIndex[vertices[1]].getValue(),coordIndex[vertices[2]].getValue());break}case 4:{normal=coord.getQuadNormal(coordIndex[vertices[0]].getValue(),coordIndex[vertices[1]].getValue(),coordIndex[vertices[2]].getValue(),coordIndex[vertices[3]].getValue());break}default:{normal=this.getPolygonNormal(vertices,coordIndex,coord);break}}for(var i=0;i<length;++i){var index=coordIndex[vertices[i]].getValue();if(!normalIndex[index])normalIndex[index]=[];normalIndex[index].push(normals.length+i)}if(cw)normal.negate();for(var i=0,nl=length+1;i<nl;++i)normals.push(normal)}return this.refineNormals(normalIndex,normals,this.creaseAngle_.getValue())},getPolygonNormal:function(vertices,coordIndex,coord){var normal=new Vector3(0,0,0),next=coord.getPoint(coordIndex[vertices[0]].getValue());for(var i=0,length=vertices.length;i<length;++i){var current=next,next=coord.getPoint(coordIndex[vertices[(i+1)%length]].getValue());normal.x+=(current.y-next.y)*(current.z+next.z);normal.y+=(current.z-next.z)*(current.x+next.x);normal.z+=(current.x-next.x)*(current.y+next.y)}return normal.normalize()}});return IndexedFaceSet}});define("cobweb/Components/Rendering/X3DGeometricPropertyNode",["jquery","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants"],function($,X3DNode,X3DConstants){function X3DGeometricPropertyNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DGeometricPropertyNode)}X3DGeometricPropertyNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DGeometricPropertyNode});return X3DGeometricPropertyNode});define("cobweb/Components/Rendering/X3DCoordinateNode",["jquery","cobweb/Components/Rendering/X3DGeometricPropertyNode","cobweb/Bits/X3DConstants"],function($,X3DGeometricPropertyNode,X3DConstants){function X3DCoordinateNode(browser,executionContext){X3DGeometricPropertyNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DCoordinateNode)}X3DCoordinateNode.prototype=$.extend(Object.create(X3DGeometricPropertyNode.prototype),{constructor:X3DCoordinateNode});return X3DCoordinateNode});define("cobweb/Components/Rendering/Coordinate",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DCoordinateNode","cobweb/Bits/X3DConstants","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DCoordinateNode,X3DConstants,Triangle3,Vector3){with(Fields){function Coordinate(executionContext){X3DCoordinateNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Coordinate)}Coordinate.prototype=$.extend(Object.create(X3DCoordinateNode.prototype),{constructor:Coordinate,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"point",new MFVec3f)]),getTypeName:function(){return"Coordinate"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"coord"},isEmpty:function(){return this.point_.length==0},getPoint:function(index){if(index<this.point_.length)return this.point_[index].getValue();return new Vector3(0,0,0)},getNormal:function(index1,index2,index3){var length=this.point_.length;if(index1<length&&index2<length&&index3<length)return Triangle3.normal(this.point_[index1].getValue(),this.point_[index2].getValue(),this.point_[index3].getValue(),new Vector3(0,0,0));return new Vector3(0,0,0)},getQuadNormal:function(index1,index2,index3,index4){var length=this.point_.length;if(index1<length&&index2<length&&index3<length&&index4<length)return Triangle3.quadNormal(this.point_[index1].getValue(),this.point_[index2].getValue(),this.point_[index3].getValue(),this.point_[index4].getValue(),new Vector3(0,0,0));return new Vector3(0,0,0)}});return Coordinate}});define("cobweb/Components/Texturing/X3DTextureCoordinateNode",["jquery","cobweb/Components/Rendering/X3DGeometricPropertyNode","cobweb/Bits/X3DConstants"],function($,X3DGeometricPropertyNode,X3DConstants){function X3DTextureCoordinateNode(browser,executionContext){X3DGeometricPropertyNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTextureCoordinateNode)}X3DTextureCoordinateNode.prototype=$.extend(Object.create(X3DGeometricPropertyNode.prototype),{constructor:X3DTextureCoordinateNode});return X3DTextureCoordinateNode});define("cobweb/Components/Texturing/TextureCoordinate",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Texturing/X3DTextureCoordinateNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTextureCoordinateNode,X3DConstants){with(Fields){function TextureCoordinate(executionContext){X3DTextureCoordinateNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TextureCoordinate)}TextureCoordinate.prototype=$.extend(Object.create(X3DTextureCoordinateNode.prototype),{constructor:TextureCoordinate,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"point",new MFVec2f)]),getTypeName:function(){return"TextureCoordinate"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texCoord"},init:function(texCoords){texCoords.push([])},addTexCoord:function(texCoord,index){this.addTexCoordToChannel(texCoord[0],index)},addTexCoordToChannel:function(texCoords,index){if(index>=0&&index<this.point_.length){var point2=this.point_[index];texCoords.push(point2.x);texCoords.push(point2.y);texCoords.push(0);texCoords.push(1)}else{texCoords.push(0);texCoords.push(0);texCoords.push(0);texCoords.push(1)}}});return TextureCoordinate}});define("cobweb/Browser/Geometry2D/Rectangle2DOptions",["jquery","cobweb/Basic/X3DBaseNode","cobweb/Components/Geometry3D/IndexedFaceSet","cobweb/Components/Rendering/Coordinate","cobweb/Components/Texturing/TextureCoordinate","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,X3DBaseNode,IndexedFaceSet,Coordinate,TextureCoordinate,Vector2,Vector3){function BoxOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext)}BoxOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:BoxOptions,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"boxOptions"},initialize:function(){X3DBaseNode.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new IndexedFaceSet(this.getExecutionContext());this.geometry.texCoord_=new TextureCoordinate(this.getExecutionContext());this.geometry.coord_=new Coordinate(this.getExecutionContext());var geometry=this.geometry,texCoord=this.geometry.texCoord_.getValue(),coord=this.geometry.coord_.getValue();geometry.texCoordIndex_=[0,1,2,3,-1];geometry.coordIndex_=[0,1,2,3,-1];texCoord.point_=[new Vector2(1,1),new Vector2(0,1),new Vector2(0,0),new Vector2(1,0)];coord.point_=[new Vector3(1,1,0),new Vector3(-1,1,0),new Vector3(-1,-1,0),new Vector3(1,-1,0)];texCoord.setup();coord.setup();geometry.setup();return this.geometry}});return BoxOptions});define("cobweb/Browser/Geometry2D/X3DGeometry2DContext",["cobweb/Browser/Geometry2D/Rectangle2DOptions"],function(Rectangle2DOptions){function getOptionNode(name,Type){if(this[name])return this[name];this[name]=new Type(this);this[name].setup();return this[name]}function X3DGeometry2DContext(){}X3DGeometry2DContext.prototype={initialize:function(){},getRectangle2DOptions:function(){return getOptionNode.call(this,"rectangle2DOptions",Rectangle2DOptions)}};return X3DGeometry2DContext});define("cobweb/Browser/Geometry3D/BoxOptions",["jquery","cobweb/Basic/X3DBaseNode","cobweb/Components/Geometry3D/IndexedFaceSet","cobweb/Components/Rendering/Coordinate","cobweb/Components/Texturing/TextureCoordinate","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,X3DBaseNode,IndexedFaceSet,Coordinate,TextureCoordinate,Vector2,Vector3){function BoxOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext)}BoxOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:BoxOptions,getTypeName:function(){return"BoxOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"boxOptions"},initialize:function(){X3DBaseNode.prototype.initialize.call(this)},getGeometry:function(){if(this.geometry)return this.geometry;this.geometry=new IndexedFaceSet(this.getExecutionContext());this.geometry.texCoord_=new TextureCoordinate(this.getExecutionContext());this.geometry.coord_=new Coordinate(this.getExecutionContext());var geometry=this.geometry,texCoord=this.geometry.texCoord_.getValue(),coord=this.geometry.coord_.getValue();geometry.texCoordIndex_=[0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1];geometry.coordIndex_=[0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1];texCoord.point_=[new Vector2(1,1),new Vector2(0,1),new Vector2(0,0),new Vector2(1,0)];coord.point_=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(-1,-1,1),new Vector3(1,-1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(-1,-1,-1),new Vector3(1,-1,-1)];texCoord.setup();coord.setup();geometry.setup();return this.geometry}});return BoxOptions});define("cobweb/Browser/Geometry3D/ConeOptions",["jquery","cobweb/Fields","cobweb/Basic/X3DBaseNode"],function($,Fields,X3DBaseNode){with(Fields){function ConeOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.addChildren("uDimension",new SFInt32(1),"vDimension",new SFInt32(20))}ConeOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:ConeOptions,getTypeName:function(){return"ConeOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"coneOptions"}});return ConeOptions}});define("cobweb/Browser/Geometry3D/CylinderOptions",["jquery","cobweb/Fields","cobweb/Basic/X3DBaseNode"],function($,Fields,X3DBaseNode){with(Fields){function CylinderOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.addChildren("uDimension",new SFInt32(1),"vDimension",new SFInt32(20))}CylinderOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:CylinderOptions,getTypeName:function(){return"CylinderOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"cylinderOptions"}});return CylinderOptions}});define("standard/Math/Numbers/Complex",["jquery"],function($){function Complex(real,imag){this.real=real;this.imag=imag}Complex.prototype={constructor:Complex,copy:function(){var copy=Object.create(Complex.prototype);copy.real=this.real;copy.imag=this.imag;return copy},assign:function(complex){this.real=complex.real;this.imag=complex.imag;return this},equals:function(complex){return this.real===complex.real&&this.imag===complex.imag},setRadius:function(radius){return this.setPolar(radius,this.getAngle())},getRadius:function(){if(this.real){if(this.imag)return Math.sqrt(this.real*this.real+this.imag*this.imag);return Math.abs(this.real)}return Math.abs(this.imag)},setAngle:function(angle){return this.setPolar(this.getRadius(),angle)},getAngle:function(){return Math.atan2(this.imag,this.real)},setPolar:function(radius,angle){this.real=radius*Math.cos(angle);this.imag=radius*Math.sin(angle)},conjugate:function(){this.imag=-this.imag;return this},negate:function(){this.real=-this.real;this.imag=-this.imag;return this},inverse:function(){var d=this.real*this.real+this.imag*this.imag;this.real/=d;this.imag/=-d;return this},add:function(value){this.real+=value.real;this.imag+=value.imag;return this},subtract:function(value){this.real-=value.real;this.imag-=value.imag;return this},multiply:function(value){this.real*=value;this.imag*=value;return this},multComp:function(){var real=this.real,imag=this.imag;this.real=real*value.real-imag*value.imag;this.imag=real*value.imag+imag*value.real;return this},divComp:function(value){var ar=this.real,ai=this.imag,br=value.real,bi=value.imag;var d=br*br+bi*bi;this.real=(ar*br+ai*bi)/d;this.imag=(ai*br-ar*bi)/d;return this},toString:function(){if(this.imag)return this.real+" "+this.imag+"i";return String(this.real)}};$.extend(Complex,{Polar:function(radius,angle){var complex=Object.create(Complex.prototype);complex.real=radius*Math.cos(angle);complex.imag=radius*Math.sin(angle);return complex},multiply:function(lhs,rhs){var copy=Object.create(this.prototype);copy.real=lhs.real*rhs;copy.imag=lhs.imag*rhs;return copy},multComp:function(lhs,rhs){var copy=Object.create(this.prototype);copy.real=lhs.real*rhs.real-lsh.imag*rhs.imag;copy.imag=lhs.real*rhs.imag+lsh.imag*rhs.real;return copy}});return Complex});define("cobweb/Browser/Geometry3D/QuadSphereOptions",["jquery","cobweb/Fields","cobweb/Basic/X3DBaseNode","cobweb/Components/Geometry3D/IndexedFaceSet","cobweb/Components/Rendering/Coordinate","cobweb/Components/Texturing/TextureCoordinate","standard/Math/Numbers/Complex","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,Fields,X3DBaseNode,IndexedFaceSet,Coordinate,TextureCoordinate,Complex,Vector2,Vector3){with(Fields){function QuadSphereOptions(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.addChildren("uDimension",new SFInt32(32),"vDimension",new SFInt32(16))}QuadSphereOptions.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:QuadSphereOptions,getTypeName:function(){return"QuadSphereOptions"},getComponentName:function(){return"Cobweb"},getContainerField:function(){return"quadSphereOptions"},initialize:function(){X3DBaseNode.prototype.initialize.call(this);this.addInterest(this,"eventsProcessed")},getGeometry:function(){if(!this.geometry)this.eventsProcessed();return this.geometry},createTexCoordIndex:function(){var uDimension=this.uDimension_.getValue()+1,vDimension=this.vDimension_.getValue()+1,texCoordIndex=this.geometry.texCoordIndex_;for(var u=0,uLength=uDimension-1;u<uLength;++u){texCoordIndex.push(u);texCoordIndex.push(u+uDimension-1);texCoordIndex.push(u+uDimension);texCoordIndex.push(-1)}for(var p=uDimension-1,v=0,vLength=vDimension-3;v<vLength;++v,++p){for(var u=0,uLength=uDimension-1;u<uLength;++u,++p){texCoordIndex.push(p);texCoordIndex.push(p+uDimension);texCoordIndex.push(p+uDimension+1);texCoordIndex.push(p+1);texCoordIndex.push(-1)}}var p=(vDimension-2)*uDimension-1;for(var u=0,uLength=uDimension-1;u<uLength;++u,++p){texCoordIndex.push(p+uDimension);texCoordIndex.push(p+1);texCoordIndex.push(p);texCoordIndex.push(-1)}},createTexCoord:function(){var uDimension=this.uDimension_.getValue()+1,vDimension=this.vDimension_.getValue()+1,point=this.geometry.texCoord_.getValue().point_;var poleOffset=-.5/(uDimension-1),i=0;for(var u=1;u<uDimension;++u){var x=u/(uDimension-1)+poleOffset;point.push(new Vector2(x,1))}for(var v=1,vLength=vDimension-1;v<vLength;++v){var y=1-v/(vDimension-1);for(var u=0;u<uDimension;++u){var x=u/(uDimension-1);point.push(new Vector2(x,y))}}for(var u=1;u<uDimension;++u){var x=u/(uDimension-1)+poleOffset;point.push(new Vector2(x,0))}},createCoordIndex:function(){var uDimension=this.uDimension_.getValue()+1,vDimension=this.vDimension_.getValue()+1,coordIndex=this.geometry.coordIndex_;for(var u=1,uLength=uDimension-1;u<uLength;++u){coordIndex.push(0);coordIndex.push(u);coordIndex.push(u+1);coordIndex.push(-1)}coordIndex.push(0);coordIndex.push(u);coordIndex.push(1);coordIndex.push(-1);var p=1;for(var v=0,vLength=vDimension-3;v<vLength;++v,++p){for(var u=0,uLength=uDimension-2;u<uLength;++u,++p){coordIndex.push(p);coordIndex.push(p+uDimension-1);coordIndex.push(p+uDimension);coordIndex.push(p+1);coordIndex.push(-1)}coordIndex.push(p);coordIndex.push(p+uDimension-1);coordIndex.push(p+1);coordIndex.push(p-uDimension+2);coordIndex.push(-1)}var last=p+uDimension-1;for(var u=0,uLength=uDimension-2;u<uLength;++u,++p){coordIndex.push(last);coordIndex.push(p+1);coordIndex.push(p);coordIndex.push(-1)}coordIndex.push(last);coordIndex.push(last-uDimension+1);coordIndex.push(p);coordIndex.push(-1)},createPoints:function(){var uDimension=this.uDimension_.getValue()+1,vDimension=this.vDimension_.getValue()+1,point=this.geometry.coord_.getValue().point_;point.push(new Vector3(0,1,0));for(var v=1,vLength=vDimension-1;v<vLength;++v){var zPlane=Complex.Polar(1,-Math.PI*v/vLength);for(var u=0,uLength=uDimension-1;u<uLength;++u){var yPlane=Complex.Polar(zPlane.imag,2*Math.PI*u/uLength);point.push(new Vector3(yPlane.imag,zPlane.real,yPlane.real))}}point.push(new Vector3(0,-1,0))},eventsProcessed:function(){this.geometry=new IndexedFaceSet(this.getExecutionContext());this.geometry.texCoord_=new TextureCoordinate(this.getExecutionContext());this.geometry.coord_=new Coordinate(this.getExecutionContext());this.createTexCoordIndex();this.createTexCoord();this.createCoordIndex();this.createPoints();var geometry=this.geometry,texCoord=this.geometry.texCoord_.getValue(),coord=this.geometry.coord_.getValue();geometry.creaseAngle_=Math.PI;texCoord.setup();coord.setup();geometry.setup()}});return QuadSphereOptions}});define("cobweb/Browser/Geometry3D/X3DGeometry3DContext",["cobweb/Browser/Geometry3D/BoxOptions","cobweb/Browser/Geometry3D/ConeOptions","cobweb/Browser/Geometry3D/CylinderOptions","cobweb/Browser/Geometry3D/QuadSphereOptions"],function(BoxOptions,ConeOptions,CylinderOptions,QuadSphereOptions){function getOptionNode(name,Type){if(this[name])return this[name];this[name]=new Type(this);this[name].setup();return this[name]}function X3DGeometry3DContext(){}X3DGeometry3DContext.prototype={initialize:function(){},getBoxOptions:function(){return getOptionNode.call(this,"boxOptions",BoxOptions)},getConeOptions:function(){return getOptionNode.call(this,"coneOptions",ConeOptions)},getCylinderOptions:function(){return getOptionNode.call(this,"cylinderOptions",CylinderOptions)},getSphereOptions:function(){return getOptionNode.call(this,"sphereOptions",QuadSphereOptions)}};return X3DGeometry3DContext});define("cobweb/Browser/PointingDeviceSensor/PointingDevice",["jquery","cobweb/Basic/X3DBaseNode"],function(jquery,X3DBaseNode){function PointingDevice(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext)}PointingDevice.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:PointingDevice,initialize:function(){this.cursor="DEFAULT";this.isOver=false;this.motionTime=0;var browser=this.getBrowser();browser.getCanvas().bind("mousedown.PointingDevice",this.mousedown.bind(this));browser.getCanvas().bind("mouseup.PointingDevice",this.mouseup.bind(this));browser.getCanvas().bind("mousemove.PointingDevice",this.mousemove.bind(this));browser.getCanvas().bind("mouseout.PointingDevice",this.onmouseout.bind(this))},mousedown:function(event){event.preventDefault();var browser=this.getBrowser();browser.getCanvas().focus();if(browser.hasShiftKey()&&browser.hasCtrlKey())return;if(event.button===0){var offset=browser.getCanvas().offset(),x=event.pageX-offset.left,y=browser.getCanvas().height()-(event.pageY-offset.top);if(browser.buttonPressEvent(x,y)){event.stopImmediatePropagation();browser.setCursor("HAND");browser.finished().addInterest(this,"onverifymotion",x,y)}}},mouseup:function(event){event.preventDefault();var browser=this.getBrowser();if(event.button===0){browser.buttonReleaseEvent();var offset=browser.getCanvas().offset(),x=event.pageX-offset.left,y=browser.getCanvas().height()-(event.pageY-offset.top);browser.setCursor(this.isOver?"HAND":"DEFAULT");browser.finished().addInterest(this,"onverifymotion",x,y);browser.addBrowserEvent();this.cursor="DEFAULT"}},mousemove:function(event){event.preventDefault();var browser=this.getBrowser();if(this.motionTime===browser.getCurrentTime())return;this.motionTime=browser.getCurrentTime();var offset=browser.getCanvas().offset(),x=event.pageX-offset.left,y=browser.getCanvas().height()-(event.pageY-offset.top);this.onmotion(x,y)},onmotion:function(x,y){var browser=this.getBrowser();if(browser.motionNotifyEvent(x,y)){if(!this.isOver){this.isOver=true;this.cursor=browser.getCursor();browser.setCursor("HAND")}}else{if(this.isOver){this.isOver=false;browser.setCursor(this.cursor)}}},onmouseout:function(event){event.preventDefault();this.getBrowser().leaveNotifyEvent()},onverifymotion:function(value,x,y){this.getBrowser().finished().removeInterest(this,"onverifymotion");this.onmotion(x,y)}});return PointingDevice});define("standard/Math/Geometry/Line3",["standard/Math/Numbers/Vector3"],function(Vector3){function Line3(point,direction){this.point=point.copy();this.direction=direction.copy()}Line3.prototype={constructor:Line3,u:new Vector3(0,0,0),pvec:new Vector3(0,0,0),tvec:new Vector3(0,0,0),copy:function(){var copy=Object.create(Line3.prototype);copy.point=this.point.copy();copy.direction=this.direction.copy();return copy},assign:function(line){this.point.assign(line.point);this.direction.assign(line.direction);return this},multMatrixLine:function(matrix){matrix.multMatrixVec(this.point);matrix.multMatrixDir(this.direction).normalize();return this},multLineMatrix:function(matrix){matrix.multVecMatrix(this.point);matrix.multDirMatrix(this.direction).normalize();return this},getClosestPointToPoint:function(point){var r=point.copy().subtract(this.point),d=r.dot(this.direction);return r.assign(this.direction).multiply(d).add(this.point)},getClosestPointToLine:function(line,point){var p1=this.point,p2=line.point,d1=this.direction,d2=line.direction;var t=Vector3.dot(d1,d2);if(Math.abs(t)>=1)return false;var u=this.u.assign(p2).subtract(p1);t=(Vector3.dot(u,d1)-t*Vector3.dot(u,d2))/(1-t*t);point.assign(d1).multiply(t).add(p1);return true},getPerpendicularVector:function(point){var d=Vector3.subtract(this.point,point);return d.subtract(this.direction.copy().multiply(Vector3.dot(d,this.direction)))},intersectsTriangle:function(A,B,C,uvt){var edge1=B.subtract(A),edge2=C.subtract(A);var pvec=this.pvec.assign(this.direction).cross(edge2);var det=edge1.dot(pvec);if(det===0)return false;var inv_det=1/det;var tvec=this.tvec.assign(this.point).subtract(A);var u=tvec.dot(pvec)*inv_det;if(u<0||u>1)return false;var qvec=tvec.cross(edge1);var v=this.direction.dot(qvec)*inv_det;if(v<0||u+v>1)return false;var t=edge2.dot(qvec)*inv_det;uvt.u=u;uvt.v=v;uvt.t=t;return true},toString:function(){return this.point+", "+this.direction}};Line3.Points=function(point1,point2){var line=Object.create(Line3.prototype);line.point=point1.copy();line.direction=Vector3.subtract(point2,point1).normalize();return line};return Line3});define("standard/Math/Geometry/ViewVolume",["jquery","standard/Math/Geometry/Line3","standard/Math/Geometry/Plane3","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4","standard/Math/Numbers/Matrix4"],function($,Line3,Plane3,Triangle3,Vector3,Vector4,Matrix4){var p1=new Vector3(0,0,0),p2=new Vector3(0,0,0),p3=new Vector3(0,0,0),p4=new Vector3(0,0,0),p5=new Vector3(0,0,0),p6=new Vector3(0,0,0),near=new Vector3(0,0,0),far=new Vector3(0,0,0),matrix=new Matrix4,normal=new Vector3(0,0,0),vin=new Vector4(0,0,0,0);function ViewVolume(projectionMatrix,viewport,scissor){this.viewport=new Vector4(0,0,0,0);this.scissor=new Vector4(0,0,0,0);this.planes=[new Plane3(Vector3.Zero,Vector3.Zero),new Plane3(Vector3.Zero,Vector3.Zero),new Plane3(Vector3.Zero,Vector3.Zero),new Plane3(Vector3.Zero,Vector3.Zero),new Plane3(Vector3.Zero,Vector3.Zero),new Plane3(Vector3.Zero,Vector3.Zero)];this.set(projectionMatrix,viewport,scissor)}ViewVolume.prototype={constructor:ViewVolume,set:function(projectionMatrix,viewport,scissor){try{this.viewport.assign(viewport);this.scissor.assign(scissor);var x1=scissor[0],x2=scissor[0]+scissor[2],y1=scissor[1],y2=scissor[1]+scissor[3];matrix.assign(projectionMatrix).inverse();ViewVolume.unProjectPointMatrix(x1,y2,1,matrix,viewport,p1),ViewVolume.unProjectPointMatrix(x1,y1,1,matrix,viewport,p2),ViewVolume.unProjectPointMatrix(x1,y1,0,matrix,viewport,p3),ViewVolume.unProjectPointMatrix(x2,y1,0,matrix,viewport,p4),ViewVolume.unProjectPointMatrix(x2,y2,0,matrix,viewport,p5),ViewVolume.unProjectPointMatrix(x2,y2,1,matrix,viewport,p6);this.planes[0].set(p4,Triangle3.normal(p5,p4,p3,normal));this.planes[1].set(p2,Triangle3.normal(p3,p2,p1,normal));this.planes[2].set(p5,Triangle3.normal(p4,p5,p6,normal));this.planes[3].set(p6,Triangle3.normal(p1,p6,p5,normal));this.planes[4].set(p3,Triangle3.normal(p2,p3,p4,normal));this.planes[5].set(p1,Triangle3.normal(p6,p1,p2,normal));this.valid=true}catch(error){this.valid=false;console.log(error)}},getViewport:function(){return this.viewport},getScissor:function(){return this.scissor},intersectsSphere:function(radius,center){var planes=this.planes;if(planes[0].distance(center)+radius<0)return false;if(planes[1].distance(center)+radius<0)return false;if(planes[2].distance(center)+radius<0)return false;if(planes[3].distance(center)+radius<0)return false;if(planes[4].distance(center)+radius<0)return false;if(planes[5].distance(center)+radius<0)return false;return true}};$.extend(ViewVolume,{unProjectPoint:function(winx,winy,winz,modelview,projection,viewport,point){var matrix=Matrix4.multRight(modelview,projection).inverse();return this.unProjectPointMatrix(winx,winy,winz,matrix,viewport,point)
},unProjectPointMatrix:function(winx,winy,winz,matrix,viewport,point){vin.set((winx-viewport[0])/viewport[2]*2-1,(winy-viewport[1])/viewport[3]*2-1,2*winz-1,1);matrix.multVecMatrix(vin);if(vin.w===0)throw Error("Couldn't unproject point: divisor is 0.");var d=1/vin.w;return point.set(vin.x*d,vin.y*d,vin.z*d)},unProjectLine:function(winx,winy,modelview,projection,viewport){matrix.assign(modelview).multRight(projection).inverse();ViewVolume.unProjectPointMatrix(winx,winy,0,matrix,viewport,near);ViewVolume.unProjectPointMatrix(winx,winy,.9,matrix,viewport,far);return new Line3.Points(near,far)},projectPoint:function(point,modelview,projection,viewport,vout){vin.set(point.x,point.y,point.z,1);projection.multVecMatrix(modelview.multVecMatrix(vin));if(vin.w===0)throw Error("Couldn't project point: divisor is 0.");var d=1/(2*vin.w);return vout.set((vin.x*d+.5)*viewport[2]+viewport[0],(vin.y*d+.5)*viewport[3]+viewport[1],vin.z*d+.5)},projectLine:function(line,modelview,projection,viewport){ViewVolume.projectPoint(line.point,modelview,projection,viewport,near);ViewVolume.projectPoint(Vector3.multiply(line.direction,1e9).add(line.point),modelview,projection,viewport,far);near.z=0;far.z=0;return new Line3.Points(near,far)}});return ViewVolume});define("standard/Math/Algorithms/MergeSort",[],function(){function MergeSort(array,compare){this.array=array;this.auxiliary=[];if(compare)this.compare=compare}MergeSort.prototype={compare:function(lhs,rhs){return lhs<rhs},sort:function(first,last){this.mergeSort(first,last-1)},mergeSort:function(lo,hi){if(lo<hi){var m=lo+hi>>>1;this.mergeSort(lo,m);this.mergeSort(m+1,hi);this.merge(lo,m,hi)}},merge:function(lo,m,hi){var i,j,k;i=0,j=lo;while(j<=m)this.auxiliary[i++]=this.array[j++];i=0;k=lo;while(k<j&&j<=hi){if(this.compare(this.array[j],this.auxiliary[i]))this.array[k++]=this.array[j++];else this.array[k++]=this.auxiliary[i++]}while(k<j)this.array[k++]=this.auxiliary[i++]}};return MergeSort});define("cobweb/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",["jquery","cobweb/Browser/PointingDeviceSensor/PointingDevice","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Geometry/Line3","standard/Math/Geometry/ViewVolume","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","standard/Math/Algorithms/MergeSort","standard/Math/Algorithm"],function($,PointingDevice,TraverseType,X3DConstants,Line3,ViewVolume,Vector2,Vector3,Matrix4,MergeSort,Algorithm){var line=new Line3(new Vector3(0,0,0),new Vector3(0,0,0));function X3DPointingDeviceSensorContext(){}X3DPointingDeviceSensorContext.prototype={initialize:function(){this.getCanvas().attr("tabindex",8803068);this.setCursor("DEFAULT");this.pointingDevice=new PointingDevice(this);this.pointingDevice.setup();this.pointer=new Vector2(0,0);this.hits=[];this.enabledSensors=[{}];this.selectedLayer=null;this.overSensors={};this.activeSensors={};this.hitPointSorter=new MergeSort(this.hits,function(lhs,rhs){return lhs.intersection.point.z<rhs.intersection.point.z});this.layerSorter=new MergeSort(this.hits,function(lhs,rhs){return lhs.layerNumber<rhs.layerNumber});this.pickingTime=0},setCursor:function(value){this.cursorType=value;var div=this.getBrowser().getXML().find(".cobweb-surface");switch(value){case"HAND":div.css("cursor","pointer");break;case"MOVE":div.css("cursor","move");break;case"CROSSHAIR":div.css("cursor","crosshair");break;default:{if(this.loadCount_.getValue())div.css("cursor","wait");else if(this.pointingDevice&&this.pointingDevice.isOver)div.css("cursor","pointer");else div.css("cursor","default");break}}},getCursor:function(){return this.cursorType},isPointerInRectangle:function(rectangle){return this.pointer.x>rectangle.x&&this.pointer.x<rectangle.x+rectangle.z&&this.pointer.y>rectangle.y&&this.pointer.y<rectangle.y+rectangle.w},setLayerNumber:function(value){this.layerNumber=value},getSelectedLayer:function(){return this.selectedLayer},setHitRay:function(viewport){try{return this.hitRay=ViewVolume.unProjectLine(this.pointer.x,this.pointer.y,Matrix4.Identity,this.getProjectionMatrix(),viewport)}catch(error){return this.hitRay=line}},getHitRay:function(){return this.hitRay},getSensors:function(){return this.enabledSensors},addHit:function(intersection,layer){this.hits.push({pointer:this.pointer,hitRay:this.hitRay,intersection:intersection,sensors:this.enabledSensors[this.enabledSensors.length-1],layer:layer,layerNumber:this.layerNumber})},buttonPressEvent:function(x,y){this.touch(x,y);if(this.hits.length===0)return false;var nearestHit=this.hits[this.hits.length-1];this.selectedLayer=nearestHit.layer;this.activeSensors=nearestHit.sensors;for(var key in this.activeSensors)this.activeSensors[key].set_active__(nearestHit,true);return!$.isEmptyObject(nearestHit.sensors)},buttonReleaseEvent:function(){this.selectedLayer=null;for(var key in this.activeSensors)this.activeSensors[key].set_active__(null,false);this.activeSensors={};return true},motionNotifyEvent:function(x,y){this.touch(x,y);this.motion();return this.hits.length&&!$.isEmptyObject(this.hits[this.hits.length-1].sensors)},leaveNotifyEvent:function(){},touch:function(x,y){var t0=performance.now();this.pointer.set(x,y);this.hits.length=0;this.getWorld().traverse(TraverseType.POINTER);this.hitPointSorter.sort(0,this.hits.length);this.layerSorter.sort(0,this.hits.length);this.addBrowserEvent();this.pickingTime=performance.now()-t0},motion:function(){if(this.hits.length)var nearestHit=this.hits[this.hits.length-1];else{var hitRay=this.selectedLayer?this.selectedLayer.getHitRay():line;var nearestHit={pointer:this.pointer,modelViewMatrix:new Matrix4,hitRay:hitRay,intersection:null,sensors:{},shape:null,layer:null,layerNumber:0}}if(this.hits.length)var difference=Algorithm.set_difference(this.overSensors,nearestHit.sensors,{});else var difference=$.extend({},this.overSensors);for(var key in difference)difference[key].set_over__(nearestHit,false);if(this.hits.length){this.overSensors=nearestHit.sensors;for(var key in this.overSensors)this.overSensors[key].set_over__(nearestHit,true)}else this.overSensors={};for(var key in this.activeSensors){var dragSensorNode=this.activeSensors[key];if(dragSensorNode.getType().indexOf(X3DConstants.X3DDragSensorNode)===-1)continue;dragSensorNode.set_motion__(nearestHit)}}};return X3DPointingDeviceSensorContext});define("cobweb/Browser/KeyDeviceSensor/X3DKeyDeviceSensorContext",["jquery"],function($){function X3DKeyDeviceSensorContext(){this.keyDeviceSensorNode=null;this.shiftKey=false;this.ctrlKey=false;this.altKey=false;this.altGrKey=false}X3DKeyDeviceSensorContext.prototype={initialize:function(){this.getCanvas().bind("keydown.X3DKeyDeviceSensorContext",this.keydown.bind(this));this.getCanvas().bind("keyup.X3DKeyDeviceSensorContext",this.keyup.bind(this))},setKeyDeviceSensorNode:function(value){this.keyDeviceSensorNode=value},getKeyDeviceSensorNode:function(){return this.keyDeviceSensorNode},hasShiftKey:function(){return this.shiftKey},hasCtrlKey:function(){return this.ctrlKey},hasAltKey:function(){return this.altKey},hasAltGrKey:function(){return this.altGrKey},keydown:function(event){event.preventDefault();if(this.keyDeviceSensorNode)this.keyDeviceSensorNode.keydown(event);switch(event.which){case 16:{this.shiftKey=true;break}case 17:{this.ctrlKey=true;break}case 18:{this.altKey=true;break}case 49:{if(this.ctrlKey){this.setBrowserOption("Shading","POINTSET");this.getNotification().string_="Shading: Pointset"}break}case 50:{if(this.ctrlKey){this.setBrowserOption("Shading","WIREFRAME");this.getNotification().string_="Shading: Wireframe"}break}case 51:{if(this.ctrlKey){this.setBrowserOption("Shading","FLAT");this.getNotification().string_="Shading: Flat"}break}case 52:{if(this.ctrlKey){this.setBrowserOption("Shading","GOURAUD");this.getNotification().string_="Shading: Gouraud"}break}case 53:{if(this.ctrlKey){this.setBrowserOption("Shading","PHONG");this.getNotification().string_="Shading: Phong"}break}case 83:{if(this.ctrlKey){if(this.isLive().getValue())this.endUpdate();else this.beginUpdate();this.getNotification().string_=this.isLive().getValue()?"Begin Update":"End Update"}break}case 225:{this.altGrKey=true;break}case 171:{if(this.ctrlKey)this.getBrowserTimings().enabled_=!this.getBrowserTimings().enabled_.getValue();break}case 36:{this.firstViewpoint();break}case 35:{this.lastViewpoint();break}case 33:{this.previousViewpoint();break}case 34:{this.nextViewpoint();break}}},keyup:function(event){event.preventDefault();if(this.keyDeviceSensorNode)this.keyDeviceSensorNode.keyup(event);switch(event.which){case 16:{this.shiftKey=false;break}case 17:{this.ctrlKey=false;break}case 18:{this.altKey=false;break}case 225:{this.altGrKey=false;break}}}};return X3DKeyDeviceSensorContext});define("cobweb/Components/Core/X3DChildNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DNode,X3DConstants){with(Fields){function X3DChildNode(browser,executionContext){if(this.getExecutionContext())return;X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DChildNode);this.addChildren("isCameraObject",new SFBool)}X3DChildNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DChildNode,setCameraObject:function(value){if(value!==this.isCameraObject_.getValue())this.isCameraObject_=value},getCameraObject:function(){return this.isCameraObject_.getValue()}});return X3DChildNode}});define("cobweb/Components/Core/X3DBindableNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DConstants){function X3DBindableNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DBindableNode);this.layers={}}X3DBindableNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DBindableNode,initialize:function(){X3DChildNode.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.set_live__()},getCameraObject:function(){return true},getLayers:function(){return this.layers},bindToLayer:function(layer){this.layers[layer.getId()]=layer},unbindFromLayer:function(layer){delete this.layers[layer.getId()]},transitionStart:function(){},set_live__:function(){if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue())return}});return X3DBindableNode});define("cobweb/Components/Navigation/X3DViewpointObject",["jquery","cobweb/Bits/X3DConstants"],function($,X3DConstants){function X3DViewpointObject(browser,executionContext){this.addType(X3DConstants.X3DViewpointObject)}X3DViewpointObject.prototype={constructor:X3DViewpointObject,initialize:function(){}};return X3DViewpointObject});define("cobweb/Components/Core/X3DSensorNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DConstants){function X3DSensorNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DSensorNode)}X3DSensorNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DSensorNode});return X3DSensorNode});define("cobweb/Components/Time/X3DTimeDependentNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DChildNode,X3DConstants){with(Fields){function X3DTimeDependentNode(browser,executionContext){this.addType(X3DConstants.X3DTimeDependentNode);this.startTimeValue=0;this.pauseTimeValue=0;this.resumeTimeValue=0;this.stopTimeValue=0;this.start=0;this.pause=0;this.pauseInterval=0;this.startTimeout=null;this.pauseTimeout=null;this.resumeTimeout=null;this.stopTimeout=null;this.disabled=false}X3DTimeDependentNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DTimeDependentNode,initialize:function(){X3DChildNode.prototype.initialize.call(this);this.addChildren("initialized",new SFTime,"isEvenLive",new SFBool);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.isEvenLive_.addInterest(this,"set_live__");this.initialized_.addInterest(this,"set_loop__");this.enabled_.addInterest(this,"set_enabled__");this.loop_.addInterest(this,"set_loop__");this.startTime_.addInterest(this,"set_startTime__");this.pauseTime_.addInterest(this,"set_pauseTime__");this.resumeTime_.addInterest(this,"set_resumeTime__");this.stopTime_.addInterest(this,"set_stopTime__");this.startTimeValue=this.startTime_.getValue();this.pauseTimeValue=this.pauseTime_.getValue();this.resumeTimeValue=this.resumeTime_.getValue();this.stopTimeValue=this.stopTime_.getValue();this.initialized_=this.getBrowser().getCurrentTime()},getElapsedTime:function(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},getLive:function(){return(this.getExecutionContext().isLive().getValue()||this.isEvenLive_.getValue())&&this.isLive().getValue()},set_live__:function(){if(this.getLive()){if(this.disabled){this.disabled=false;if(this.isActive_.getValue()&&!this.isPaused_.getValue())this.real_resume()}}else{if(!this.disabled&&this.isActive_.getValue()&&!this.isPaused_.getValue()){this.disabled=true;this.real_pause()}}},set_enabled__:function(){if(this.enabled_.getValue())this.set_loop__();else this.stop()},set_loop__:function(){if(this.enabled_.getValue()){if(this.loop_.getValue()){if(this.stopTimeValue<=this.startTimeValue){if(this.startTimeValue<=this.getBrowser().getCurrentTime())this.do_start()}}}},set_startTime__:function(){this.startTimeValue=this.startTime_.getValue();if(this.enabled_.getValue()){this.removeTimeout("startTimeout");if(this.startTimeValue<=this.getBrowser().getCurrentTime())this.do_start();else this.addTimeout("startTimeout","do_start",this.startTimeValue)}},set_pauseTime__:function(){this.pauseTimeValue=this.pauseTime_.getValue();if(this.enabled_.getValue()){this.removeTimeout("pauseTimeout");if(this.pauseTimeValue<=this.resumeTimeValue)return;if(this.pauseTimeValue<=this.getBrowser().getCurrentTime())this.do_pause();else this.addTimeout("pauseTimeout","do_pause",this.pauseTimeValue)}},set_resumeTime__:function(){this.resumeTimeValue=this.resumeTime_.getValue();if(this.enabled_.getValue()){this.removeTimeout("resumeTimeout");if(this.resumeTimeValue<=this.pauseTimeValue)return;if(this.resumeTimeValue<=this.getBrowser().getCurrentTime())this.do_resume();else this.addTimeout("resumeTimeout","do_resume",this.resumeTimeValue)}},set_stopTime__:function(){this.stopTimeValue=this.stopTime_.getValue();if(this.enabled_.getValue()){this.removeTimeout("stopTimeout");if(this.stopTimeValue<=this.startTimeValue)return;if(this.stopTimeValue<=this.getBrowser().getCurrentTime())this.do_stop();else this.addTimeout("stopTimeout","do_stop",this.stopTimeValue)}},do_start:function(){if(!this.isActive_.getValue()){this.start=this.getBrowser().getCurrentTime();this.pauseInterval=0;this.isActive_=true;this.set_start();if(this.getLive()){this.getBrowser().prepareEvents().addInterest(this,"prepareEvents")}else if(!this.disabled){this.disabled=true;this.real_pause()}this.elapsedTime_=0;this.cycleTime_=this.getBrowser().getCurrentTime()}},do_pause:function(){if(this.isActive_.getValue()&&!this.isPaused_.getValue()){this.isPaused_=true;if(this.pauseTimeValue!==this.getBrowser().getCurrentTime())this.pauseTimeValue=this.getBrowser().getCurrentTime();if(this.getLive())this.real_pause()}},real_pause:function(){this.pause=this.getBrowser().getCurrentTime();this.set_pause();this.getBrowser().prepareEvents().removeInterest(this,"prepareEvents")},do_resume:function(){if(this.isActive_.getValue()&&this.isPaused_.getValue()){this.isPaused_=false;if(this.resumeTimeValue!==this.getBrowser().getCurrentTime())this.resumeTimeValue=this.getBrowser().getCurrentTime();if(this.getLive())this.real_resume()}},real_resume:function(){var interval=this.getBrowser().getCurrentTime()-this.pause;this.pauseInterval+=interval;this.set_resume(interval);this.getBrowser().prepareEvents().addInterest(this,"prepareEvents");this.getBrowser().addBrowserEvent()},do_stop:function(){this.stop()},stop:function(){if(this.isActive_.getValue()){this.set_stop();this.elapsedTime_=this.getElapsedTime();if(this.isPaused_.getValue())this.isPaused_=false;this.isActive_=false;if(this.getLive())this.getBrowser().prepareEvents().removeInterest(this,"prepareEvents")}},timeout:function(callback){if(this.enabled_.getValue()){this.getBrowser().advanceTime(performance.now());this[callback]()}},addTimeout:function(name,callback,time){this.removeTimeout(name);this[name]=setTimeout(this.timeout.bind(this,callback),(time-this.getBrowser().getCurrentTime())*1e3)},removeTimeout:function(name){clearTimeout(this[name]);this[name]=null},prepareEvents:function(){},set_start:function(){},set_pause:function(){},set_resume:function(){},set_stop:function(){}});return X3DTimeDependentNode}});define("cobweb/Components/Time/TimeSensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DSensorNode","cobweb/Components/Time/X3DTimeDependentNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DSensorNode,X3DTimeDependentNode,X3DConstants){with(Fields){function TimeSensor(executionContext){X3DSensorNode.call(this,executionContext.getBrowser(),executionContext);X3DTimeDependentNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TimeSensor);this.addChildren("range",new MFFloat(0,0,1));this.cycle=0;this.interval=0;this.first=0;this.last=1;this.scale=1}TimeSensor.prototype=$.extend(Object.create(X3DSensorNode.prototype),X3DTimeDependentNode.prototype,{constructor:TimeSensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"cycleInterval",new SFTime(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"loop",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"startTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"resumeTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"pauseTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"stopTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"isPaused",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"cycleTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"elapsedTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"fraction_changed",new SFFloat),new X3DFieldDefinition(X3DConstants.outputOnly,"time",new SFTime)]),getTypeName:function(){return"TimeSensor"},getComponentName:function(){return"Time"},getContainerField:function(){return"children"},initialize:function(){X3DSensorNode.prototype.initialize.call(this);X3DTimeDependentNode.prototype.initialize.call(this)},prepareEvents:function(){var time=this.getBrowser().getCurrentTime();if(time-this.cycle>=this.interval){if(this.loop_.getValue()){this.cycle+=this.interval*Math.floor((time-this.cycle)/this.interval);this.fraction_changed_=this.last;this.elapsedTime_=this.getElapsedTime();this.cycleTime_=time}else{this.fraction_changed_=this.last;this.stop()}}else{var t=(time-this.cycle)/this.interval;this.fraction_changed_=this.first+(t-Math.floor(t))*this.scale;this.elapsedTime_=this.getElapsedTime()}this.time_=time},set_start:function(){this.first=this.range_[0];this.last=this.range_[2];this.scale=this.last-this.first;var offset=(this.range_[1]-this.first)*this.cycleInterval_.getValue();this.interval=this.cycleInterval_.getValue()*this.scale;this.cycle=this.getBrowser().getCurrentTime()-offset;this.fraction_changed_=this.range_[1];this.time_=this.getBrowser().getCurrentTime()},set_resume:function(pauseInterval){this.cycle+=pauseInterval}});return TimeSensor}});define("cobweb/Components/Interpolation/X3DInterpolatorNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants","standard/Math/Algorithm"],function($,X3DChildNode,X3DConstants,Algorithm){function X3DInterpolatorNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DInterpolatorNode)}X3DInterpolatorNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DInterpolatorNode,setup:function(){this.set_key__();if(this.key_.length)this.interpolate(0,0,0);X3DChildNode.prototype.setup.call(this)},initialize:function(){X3DChildNode.prototype.initialize.call(this);this.set_fraction_.addInterest(this,"set_fraction__");this.key_.addInterest(this,"set_key__")},set_fraction__:function(){var key=this.key_,length=key.length,fraction=this.set_fraction_.getValue();switch(length){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(fraction<=key[0])return this.interpolate(0,1,0);var index1=Algorithm.upperBound(key,0,length,fraction,Algorithm.less);if(index1!==length){var index0=index1-1,weight=(fraction-key[index0])/(key[index1]-key[index0]);this.interpolate(index0,index1,Algorithm.clamp(weight,0,1))}else this.interpolate(length-2,length-1,1)}}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}});return X3DInterpolatorNode});define("cobweb/Components/Interpolation/EaseInEaseOut",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants){with(Fields){function EaseInEaseOut(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.EaseInEaseOut)}EaseInEaseOut.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:EaseInEaseOut,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"easeInEaseOut",new MFVec2f),new X3DFieldDefinition(X3DConstants.outputOnly,"modifiedFraction_changed",new SFFloat)]),getTypeName:function(){return"EaseInEaseOut"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.easeInEaseOut_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){if(this.easeInEaseOut_.length<this.key_.length)this.easeInEaseOut_.resize(this.key_.length,this.easeInEaseOut_.length?this.easeInEaseOut_[this.easeInEaseOut_.length-1]:new SFVec2f)},interpolate:function(index0,index1,weight){var easeOut=this.easeInEaseOut_[index0].y;var easeIn=this.easeInEaseOut_[index1].x;var sum=easeOut+easeIn;if(sum<0)this.modifiedFraction_changed_=weight;else{if(sum>1){easeIn/=sum;easeOut/=sum}var t=1/(2-easeOut-easeIn);if(weight<easeOut){this.modifiedFraction_changed_=t/easeOut*weight*weight}else if(weight<=1-easeIn){this.modifiedFraction_changed_=t*(2*weight-easeOut)}else{var w=1-weight;this.modifiedFraction_changed_=1-t*w*w/easeIn}}}});return EaseInEaseOut}});define("cobweb/Components/Interpolation/PositionInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Vector3){with(Fields){function PositionInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PositionInterpolator)}PositionInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:PositionInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new SFVec3f)]),keyValue:new Vector3(0,0,0),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){var key=this.key_,keyValue=this.keyValue_;if(keyValue.length<key.length)keyValue.resize(key.length,keyValue.length?keyValue[keyValue.length-1]:new SFVec3f)},interpolate:function(index0,index1,weight){this.value_changed_=this.keyValue.assign(this.keyValue_[index0].getValue()).lerp(this.keyValue_[index1].getValue(),weight)}});return PositionInterpolator}});define("cobweb/Components/Interpolation/OrientationInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Rotation4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Rotation4){with(Fields){function OrientationInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.OrientationInterpolator)}OrientationInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:OrientationInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFRotation),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new SFRotation)]),keyValue:new Rotation4,getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){var key=this.key_,keyValue=this.keyValue_;if(keyValue.length<key.length)keyValue.resize(key.length,keyValue.length?keyValue[keyValue.length-1]:new SFRotation)},interpolate:function(index0,index1,weight){try{this.value_changed_=this.keyValue.assign(this.keyValue_[index0].getValue()).slerp(this.keyValue_[index1].getValue(),weight)}catch(error){}}});return OrientationInterpolator}});define("cobweb/Components/Navigation/X3DViewpointNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DBindableNode","cobweb/Components/Navigation/X3DViewpointObject","cobweb/Components/Time/TimeSensor","cobweb/Components/Interpolation/EaseInEaseOut","cobweb/Components/Interpolation/PositionInterpolator","cobweb/Components/Interpolation/OrientationInterpolator","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function($,Fields,X3DBindableNode,X3DViewpointObject,TimeSensor,EaseInEaseOut,PositionInterpolator,OrientationInterpolator,TraverseType,X3DConstants,Vector2,Vector3,Rotation4,Matrix4){with(Fields){var invTransformationMatrix=new Matrix4,upVector=new Vector3(0,1,0),yAxis=new Vector3(0,1,0),zAxis=new Vector3(0,0,1);var relativePosition=new Vector3(0,0,0),relativeOrientation=new Rotation4(0,0,1,0),relativeScale=new Vector3(0,0,0),relativeScaleOrientation=new Rotation4(0,0,1,0);var localYAxis=new Vector3(0,0,0),direction=new Vector3(0,0,0),normal=new Vector3(0,0,0),vector=new Vector3(0,0,0),rotation=new Rotation4(0,0,1,0);function X3DViewpointNode(browser,executionContext){X3DBindableNode.call(this,browser,executionContext);X3DViewpointObject.call(this,browser,executionContext);this.addType(X3DConstants.X3DViewpointNode);this.userPosition=new Vector3(0,1,0);this.userOrientation=new Rotation4(0,0,1,0);this.userCenterOfRotation=new Vector3(0,0,0);this.transformationMatrix=new Matrix4;this.cameraSpaceMatrix=new Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1);this.inverseCameraSpaceMatrix=new Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1)}X3DViewpointNode.prototype=$.extend(Object.create(X3DBindableNode.prototype),X3DViewpointObject.prototype,{constructor:X3DViewpointNode,initialize:function(){X3DBindableNode.prototype.initialize.call(this);X3DViewpointObject.prototype.initialize.call(this);this.addChildren("positionOffset",new SFVec3f,"orientationOffset",new SFRotation,"scaleOffset",new SFVec3f(1,1,1),"scaleOrientationOffset",new SFRotation,"centerOfRotationOffset",new SFVec3f,"fieldOfViewScale",new SFFloat(1));this.timeSensor=new TimeSensor(this.getBrowser().getPrivateScene());this.easeInEaseOut=new EaseInEaseOut(this.getBrowser().getPrivateScene());this.positionInterpolator=new PositionInterpolator(this.getBrowser().getPrivateScene());this.orientationInterpolator=new OrientationInterpolator(this.getBrowser().getPrivateScene());this.scaleInterpolator=new PositionInterpolator(this.getBrowser().getPrivateScene());this.scaleOrientationInterpolator=new OrientationInterpolator(this.getBrowser().getPrivateScene());this.timeSensor.stopTime_=1;this.timeSensor.setup();this.easeInEaseOut.key_=[0,1];this.easeInEaseOut.easeInEaseOut_=[new Vector2(0,0),new Vector2(0,0)];this.easeInEaseOut.setup();this.positionInterpolator.key_=[0,1];this.orientationInterpolator.key_=[0,1];this.scaleInterpolator.key_=[0,1];this.scaleOrientationInterpolator.key_=[0,1];this.positionInterpolator.setup();this.orientationInterpolator.setup();this.scaleInterpolator.setup();this.scaleOrientationInterpolator.setup();this.timeSensor.fraction_changed_.addFieldInterest(this.easeInEaseOut.set_fraction_);this.easeInEaseOut.modifiedFraction_changed_.addFieldInterest(this.positionInterpolator.set_fraction_);this.easeInEaseOut.modifiedFraction_changed_.addFieldInterest(this.orientationInterpolator.set_fraction_);this.easeInEaseOut.modifiedFraction_changed_.addFieldInterest(this.scaleInterpolator.set_fraction_);this.easeInEaseOut.modifiedFraction_changed_.addFieldInterest(this.scaleOrientationInterpolator.set_fraction_);this.positionInterpolator.value_changed_.addFieldInterest(this.positionOffset_);this.orientationInterpolator.value_changed_.addFieldInterest(this.orientationOffset_);this.scaleInterpolator.value_changed_.addFieldInterest(this.scaleOffset_);this.scaleOrientationInterpolator.value_changed_.addFieldInterest(this.scaleOrientationOffset_);this.isBound_.addInterest(this,"set_bind__")},bindToLayer:function(layer){X3DBindableNode.prototype.bindToLayer.call(this,layer);layer.getViewpointStack().push(this)},unbindFromLayer:function(layer){X3DBindableNode.prototype.unbindFromLayer.call(this,layer);layer.getViewpointStack().pop(this)},removeFromLayer:function(layer){layer.getViewpointStack().remove(this)},getPosition:function(){return this.position_.getValue()},getUserPosition:function(){return this.userPosition.assign(this.getPosition()).add(this.positionOffset_.getValue())},getOrientation:function(){return this.orientation_.getValue()},getUserOrientation:function(){return this.userOrientation.assign(this.getOrientation()).multRight(this.orientationOffset_.getValue())},getCenterOfRotation:function(){return this.centerOfRotation_.getValue()},getUserCenterOfRotation:function(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this.centerOfRotationOffset_.getValue())},getTransformationMatrix:function(){return this.transformationMatrix
},getCameraSpaceMatrix:function(){return this.cameraSpaceMatrix},getInverseCameraSpaceMatrix:function(){return this.inverseCameraSpaceMatrix},getUpVector:function(){return yAxis},getSpeedFactor:function(){return 1},getMaxZFar:function(){return 1e5},transitionStart:function(layer,fromViewpoint){try{if(!layer){for(var id in this.getLayers()){layer=this.getLayers()[id];break}}if(this.jump_.getValue()){if(!this.retainUserOffsets_.getValue())this.resetUserOffsets();if(layer){var navigationInfo=layer.getNavigationInfo();navigationInfo.transitionStart_=true;var transitionType=navigationInfo.getTransitionType(),transitionTime=navigationInfo.transitionTime_.getValue()}else{var transitionType="LINEAR",transitionTime=1}switch(transitionType){case"TELEPORT":{if(layer)layer.getNavigationInfo().transitionComplete_=true;return}case"ANIMATE":{this.easeInEaseOut.easeInEaseOut_=[new Vector2(0,1),new Vector2(1,0)];break}default:{this.easeInEaseOut.easeInEaseOut_=[new Vector2(0,0),new Vector2(0,0)];break}}this.timeSensor.cycleInterval_=transitionTime;this.timeSensor.stopTime_=this.getBrowser().getCurrentTime();this.timeSensor.startTime_=this.getBrowser().getCurrentTime();this.timeSensor.isActive_.addInterest(this,"set_active__");this.getRelativeTransformation(fromViewpoint,relativePosition,relativeOrientation,relativeScale,relativeScaleOrientation);this.positionInterpolator.keyValue_=[relativePosition,this.positionOffset_.getValue()];this.orientationInterpolator.keyValue_=[relativeOrientation,this.orientationOffset_.getValue()];this.scaleInterpolator.keyValue_=[relativeScale,this.scaleOffset_.getValue()];this.scaleOrientationInterpolator.keyValue_=[relativeScaleOrientation,this.scaleOrientationOffset_.getValue()];this.positionOffset_=relativePosition;this.orientationOffset_=relativeOrientation;this.scaleOffset_=relativeScale;this.scaleOrientationOffset_=relativeScaleOrientation}else{this.getRelativeTransformation(fromViewpoint,relativePosition,relativeOrientation,relativeScale,relativeScaleOrientation);this.positionOffset_=relativePosition;this.orientationOffset_=relativeOrientation;this.scaleOffset_=relativeScale;this.scaleOrientationOffset_=relativeScaleOrientation}}catch(error){console.log(error)}},transitionStop:function(){this.timeSensor.stopTime_=this.getBrowser().getCurrentTime();this.timeSensor.isActive_.removeInterest(this,"set_active__")},resetUserOffsets:function(){this.positionOffset_=Vector3.Zero;this.orientationOffset_=Rotation4.Identity;this.scaleOffset_=Vector3.One;this.scaleOrientationOffset_=Rotation4.Identity;this.centerOfRotationOffset_=Vector3.Zero;this.fieldOfViewScale_=1},getRelativeTransformation:function(fromViewpoint,relativePosition,relativeOrientation,relativeScale,relativeScaleOrientation){var differenceMatrix=this.transformationMatrix.copy().multRight(fromViewpoint.getInverseCameraSpaceMatrix()).inverse();differenceMatrix.get(relativePosition,relativeOrientation,relativeScale,relativeScaleOrientation);relativePosition.subtract(this.position_.getValue());relativeOrientation.assign(this.orientation_.getValue().copy().inverse().multRight(relativeOrientation))},straightenHorizon:function(orientation){orientation.multVecRot(direction.assign(zAxis));orientation.multVecRot(localYAxis.assign(yAxis));normal.assign(direction).cross(this.getUpVector());vector.assign(direction).cross(localYAxis);rotation.setFromToVec(vector,normal);return orientation.multRight(rotation)},set_active__:function(active){if(!active.getValue()&&this.timeSensor.fraction_changed_.getValue()===1){for(var id in this.getLayers()){var navigationInfo=this.getLayers()[id].getNavigationInfo();navigationInfo.transitionComplete_=true}this.easeInEaseOut.set_fraction_=1}},set_bind__:function(){if(this.isBound_.getValue())this.getBrowser().getNotification().string_=this.description_;else this.timeSensor.stopTime_=this.getBrowser().getCurrentTime()},reshape:function(){var navigationInfo=this.getCurrentNavigationInfo();this.reshapeWithLimits(navigationInfo.getNearPlane(),navigationInfo.getFarPlane(this))},reshapeWithLimits:function(zNear,zFar){this.getBrowser().setProjectionMatrix(this.getProjectionMatrix(zNear,zFar,this.getCurrentViewport().getRectangle()))},transform:function(){this.getBrowser().getModelViewMatrix().set(this.inverseCameraSpaceMatrix)},traverse:function(type){try{if(type===TraverseType.CAMERA){this.getCurrentLayer().getViewpoints().push(this);this.transformationMatrix.assign(this.getBrowser().getModelViewMatrix().get());if(this.isBound_.getValue()){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this.scaleOffset_.getValue(),this.scaleOrientationOffset_.getValue());this.cameraSpaceMatrix.multRight(this.transformationMatrix);this.inverseCameraSpaceMatrix.assign(this.cameraSpaceMatrix).inverse()}}}catch(error){console.log(error)}}});return X3DViewpointNode}});define("standard/Math/Geometry/Camera",["standard/Math/Numbers/Matrix4"],function(Matrix4){return{frustum:function(l,r,b,t,n,f,matrix){var r_l=r-l,t_b=t-b,f_n=f-n,n_2=2*n,A=(r+l)/r_l,B=(t+b)/t_b,C=-(f+n)/f_n,D=-n_2*f/f_n,E=n_2/r_l,F=n_2/t_b;return matrix.set(E,0,0,0,0,F,0,0,A,B,C,-1,0,0,D,0)},perspective:function(fieldOfView,zNear,zFar,viewport,matrix){var width=viewport[2],height=viewport[3],ratio=Math.tan(fieldOfView/2)*zNear;if(width>height){var aspect=width*ratio/height;return this.frustum(-aspect,aspect,-ratio,ratio,zNear,zFar,matrix)}else{var aspect=height*ratio/width;return this.frustum(-ratio,ratio,-aspect,aspect,zNear,zFar,matrix)}},ortho:function(l,r,b,t,n,f,matrix){var r_l=r-l,t_b=t-b,f_n=f-n,A=2/r_l,B=2/t_b,C=-2/f_n,D=-(r+l)/r_l,E=-(t+b)/t_b,F=-(f+n)/f_n;return matrix.set(A,0,0,0,0,B,0,0,0,0,C,0,D,E,F,1)}}});define("cobweb/Components/Navigation/OrthoViewpoint",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Navigation/X3DViewpointNode","cobweb/Bits/X3DConstants","standard/Math/Geometry/Camera","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DViewpointNode,X3DConstants,Camera,Vector2,Vector3,Matrix4){with(Fields){function OrthoViewpoint(executionContext){X3DViewpointNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.OrthoViewpoint);this.projectionMatrix=new Matrix4}OrthoViewpoint.prototype=$.extend(Object.create(X3DViewpointNode.prototype),{constructor:OrthoViewpoint,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"position",new SFVec3f(0,0,10)),new X3DFieldDefinition(X3DConstants.inputOutput,"orientation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"centerOfRotation",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"fieldOfView",new MFFloat([-1,-1,1,1])),new X3DFieldDefinition(X3DConstants.inputOutput,"jump",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"retainUserOffsets",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime)]),getTypeName:function(){return"OrthoViewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getMinimumX:function(){return(this.fieldOfView_.length>0?this.fieldOfView_[0]:-1)*this.fieldOfViewScale_.getValue()},getMinimumY:function(){return(this.fieldOfView_.length>1?this.fieldOfView_[1]:-1)*this.fieldOfViewScale_.getValue()},getMaximumX:function(){return(this.fieldOfView_.length>2?this.fieldOfView_[2]:1)*this.fieldOfViewScale_.getValue()},getMaximumY:function(){return(this.fieldOfView_.length>3?this.fieldOfView_[3]:1)*this.fieldOfViewScale_.getValue()},getSizeX:function(){return this.getMaximumX()-this.getMinimumX()},getSizeY:function(){return this.getMaximumY()-this.getMinimumY()},getScreenScale:function(distance,viewport){var width=viewport[2],height=viewport[3],sizeX=this.getSizeX(),sizeY=this.getSizeY(),aspect=width/height;if(aspect>sizeX/sizeY){var s=this.getSizeY()/height;return new Vector3(s,s,s)}var s=this.getSizeX()/width;return new Vector3(s,s,s)},getViewportSize:function(viewport){var width=viewport[2],height=viewport[3],sizeX=this.getSizeX(),sizeY=this.getSizeY(),aspect=width/height;if(aspect>sizeX/sizeY)return new Vector2(this.getSizeY()*aspect,this.getSizeY());return new Vector2(this.getSizeX(),this.getSizeX()/aspect)},getLookAtDistance:function(bbox){return bbox.size.abs()/2+10},getProjectionMatrix:function(zNear,zFar,viewport){var width=viewport[2],height=viewport[3],aspect=width/height;if(aspect>this.getSizeX()/this.getSizeY()){var center=(this.getMinimumX()+this.getMaximumX())/2,size1_2=this.getSizeY()*aspect/2;return Camera.ortho(center-size1_2,center+size1_2,this.getMinimumY(),this.getMaximumY(),zNear,zFar,this.projectionMatrix)}var center=(this.getMinimumY()+this.getMaximumY())/2,size1_2=this.getSizeX()/aspect/2;return Camera.ortho(this.getMinimumX(),this.getMaximumX(),center-size1_2,center+size1_2,zNear,zFar,this.projectionMatrix)}});return OrthoViewpoint}});define("cobweb/Browser/Navigation/X3DViewer",["jquery","cobweb/Basic/X3DBaseNode","cobweb/Components/Navigation/OrthoViewpoint","standard/Math/Geometry/ViewVolume","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4"],function($,X3DBaseNode,OrthoViewpoint,ViewVolume,Vector3,Matrix4){var far=new Vector3(0,0,0);function X3DViewer(browser,executionContext){X3DBaseNode.call(this,browser,executionContext)}X3DViewer.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:X3DViewer,initialize:function(){},getActiveLayer:function(){return this.getBrowser().getActiveLayer()},getViewport:function(){return this.getBrowser().getActiveLayer().getViewport()},getNavigationInfo:function(){return this.getBrowser().getActiveLayer().getNavigationInfo()},getActiveViewpoint:function(){return this.getBrowser().getActiveLayer().getViewpoint()},getPointOnCenterPlane:function(x,y){try{var viewport=this.getViewport().getRectangle(),navigationInfo=this.getNavigationInfo(),viewpoint=this.getActiveViewpoint(),projection=viewpoint.getProjectionMatrix(navigationInfo.getNearPlane(),navigationInfo.getFarPlane(viewpoint),viewport),modelview=new Matrix4;ViewVolume.unProjectPoint(x,this.getBrowser().getViewport()[3]-y,.9,modelview,projection,viewport,far);if(viewpoint instanceof OrthoViewpoint)return new Vector3(far.x,far.y,-this.getDistanceToCenter().abs());var direction=far.normalize();return Vector3.multiply(direction,this.getDistanceToCenter().abs()/direction.dot(new Vector3(0,0,-1)))}catch(error){console.log(error);return new Vector3(0,0,0)}},getDistanceToCenter:function(){var viewpoint=this.getActiveViewpoint();return Vector3.subtract(viewpoint.getUserPosition(),viewpoint.getUserCenterOfRotation())},trackballProjectToSphere:function(x,y){x=x/this.getBrowser().getViewport()[2]-.5;y=-y/this.getBrowser().getViewport()[3]+.5;return new Vector3(x,y,tbProjectToSphere(.5,x,y))},dispose:function(){}});function tbProjectToSphere(r,x,y){var d=Math.sqrt(x*x+y*y);if(d<r*Math.sqrt(.5)){return Math.sqrt(r*r-d*d)}var t=r/Math.sqrt(2);return t*t/d}return X3DViewer});var jQueryMouseWheel=function($){var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120}if(orgEvent.detail){delta=-orgEvent.detail/3}deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120}if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120}args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}};define("jquery-mousewheel/jquery.mousewheel",["jquery"],jQueryMouseWheel);define("jquery-mousewheel",["jquery-mousewheel/jquery.mousewheel"],function(main){return main});define("cobweb/Browser/Navigation/ExamineViewer",["jquery","cobweb/Browser/Navigation/X3DViewer","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","lib/gettext","jquery-mousewheel"],function($,X3DViewer,Vector3,Rotation4,_){var MOTION_TIME=.05*1e3,SPIN_RELEASE_TIME=.01*1e3,SPIN_ANGLE=.006,SPIN_FACTOR=.6,SCROLL_FACTOR=1/50,FRAME_RATE=60;function ExamineViewer(executionContext){X3DViewer.call(this,executionContext.getBrowser(),executionContext);this.button=-1;this.orientationOffset=new Rotation4(0,0,1,0);this.rotation=new Rotation4(0,0,1,0);this.fromVector=new Vector3(0,0,0);this.fromPoint=new Vector3(0,0,0);this.pressTime=0;this.motionTime=0;this.spinId=undefined}ExamineViewer.prototype=$.extend(Object.create(X3DViewer.prototype),{constructor:ExamineViewer,initialize:function(){X3DViewer.prototype.initialize.call(this);var browser=this.getBrowser(),canvas=browser.getCanvas();canvas.bind("mousedown.ExamineViewer",this.mousedown.bind(this));canvas.bind("mouseup.ExamineViewer",this.mouseup.bind(this));canvas.bind("mousemove.ExamineViewer",this.mousemove.bind(this));canvas.bind("mousewheel.ExamineViewer",this.mousewheel.bind(this))},mousedown:function(event){if(this.button>=0)return;this.pressTime=performance.now();var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(event.button){case 0:{this.button=event.button;this.getBrowser().getCanvas().unbind("mousemove.ExamineViewer");$(document).bind("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this));$(document).bind("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this));event.preventDefault();this.disconnect();this.getActiveViewpoint().transitionStop();this.getBrowser().setCursor("MOVE");this.fromVector=this.trackballProjectToSphere(x,y);this.rotation=new Rotation4;this.motionTime=0;break}case 1:{this.button=event.button;this.getBrowser().getCanvas().unbind("mousemove.ExamineViewer");$(document).bind("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this));$(document).bind("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this));event.preventDefault();this.disconnect();this.getActiveViewpoint().transitionStop();this.getBrowser().setCursor("MOVE");this.fromPoint=this.getPointOnCenterPlane(x,y);break}}},mouseup:function(event){if(event.button!==this.button)return;this.button=-1;$(document).unbind(".ExamineViewer"+this.getId());this.getBrowser().getCanvas().bind("mousemove.ExamineViewer",this.mousemove.bind(this));switch(event.button){case 0:{event.preventDefault();this.getBrowser().setCursor("DEFAULT");if(Math.abs(this.rotation.angle)>SPIN_ANGLE&&performance.now()-this.motionTime<SPIN_RELEASE_TIME){try{this.rotation=new Rotation4(0,0,1,0).slerp(this.rotation,SPIN_FACTOR);this.addSpinning()}catch(error){}}break}case 1:{event.preventDefault();this.getBrowser().setCursor("DEFAULT");break}}},mousemove:function(event){var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(this.button){case 0:{var viewpoint=this.getActiveViewpoint(),toVector=this.trackballProjectToSphere(x,y);this.rotation=new Rotation4(toVector,this.fromVector);if(Math.abs(this.rotation.angle)<SPIN_ANGLE&&performance.now()-this.pressTime<MOTION_TIME)return false;viewpoint.orientationOffset_=this.getOrientationOffset();viewpoint.positionOffset_=this.getPositionOffset();this.fromVector=toVector;this.motionTime=performance.now();break}case 1:{event.preventDefault();var viewpoint=this.getActiveViewpoint(),toPoint=this.getPointOnCenterPlane(x,y),translation=viewpoint.getUserOrientation().multVecRot(Vector3.subtract(this.fromPoint,toPoint));viewpoint.positionOffset_=Vector3.add(viewpoint.positionOffset_.getValue(),translation);viewpoint.centerOfRotationOffset_=Vector3.add(viewpoint.centerOfRotationOffset_.getValue(),translation);this.fromPoint=toPoint;break}}},mousewheel:function(event){event.preventDefault();var direction=0;if(event.originalEvent.wheelDelta)direction=-event.originalEvent.wheelDelta/120;else if(event.originalEvent.detail)direction=event.originalEvent.detail/3;var viewpoint=this.getActiveViewpoint();var step=this.getDistanceToCenter().multiply(SCROLL_FACTOR),positionOffset=viewpoint.getUserOrientation().multVecRot(new Vector3(0,0,step.abs()));if(direction<0)viewpoint.positionOffset_.setValue(viewpoint.positionOffset_.getValue().subtract(positionOffset));else if(direction>0)viewpoint.positionOffset_.setValue(viewpoint.positionOffset_.getValue().add(positionOffset))},getPositionOffset:function(){var viewpoint=this.getActiveViewpoint(),distance=this.getDistanceToCenter();return this.orientationOffset.copy().inverse().multRight(viewpoint.orientationOffset_.getValue()).multVecRot(distance.copy()).subtract(distance).add(viewpoint.positionOffset_.getValue())},getOrientationOffset:function(){var viewpoint=this.getActiveViewpoint();this.orientationOffset.assign(viewpoint.orientationOffset_.getValue());return viewpoint.getOrientation().copy().inverse().multRight(this.rotation).multRight(viewpoint.getUserOrientation())},spin:function(){var viewpoint=this.getActiveViewpoint();viewpoint.orientationOffset_=this.getOrientationOffset();viewpoint.positionOffset_=this.getPositionOffset()},addSpinning:function(){if(!this.spinId)this.spinId=setInterval(this.spin.bind(this),1e3/FRAME_RATE)},disconnect:function(){clearInterval(this.spinId);this.spinId=undefined},dispose:function(){this.disconnect();this.getBrowser().getCanvas().unbind(".ExamineViewer");$(document).unbind(".ExamineViewer"+this.getId())}});return ExamineViewer});define("cobweb/Browser/Navigation/X3DFlyViewer",["jquery","cobweb/Browser/Navigation/X3DViewer","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Camera","jquery-mousewheel"],function($,X3DViewer,Vector3,Rotation4,Matrix4,Camera){var SPEED_FACTOR=.007,SHIFT_SPEED_FACTOR=4*SPEED_FACTOR,ROTATION_SPEED_FACTOR=1.4,ROTATION_LIMIT=40,PAN_SPEED_FACTOR=SPEED_FACTOR,PAN_SHIFT_SPEED_FACTOR=1.4*PAN_SPEED_FACTOR,ROLL_ANGLE=Math.PI/32,ROLL_TIME=.2,FRAME_RATE=60;var yAxis=new Vector3(0,1,0),zAxis=new Vector3(0,0,1);var black=new Float32Array([0,0,0]),white=new Float32Array([1,1,1]);var fromPoint=new Vector3(0,0,0),toPoint=new Vector3(0,0,0);var MOVE=0,PAN=1;function X3DFlyViewer(executionContext){X3DViewer.call(this,executionContext.getBrowser(),executionContext);var gl=this.getBrowser().getContext();this.button=-1;this.fromVector=new Vector3(0,0,0);this.toVector=new Vector3(0,0,0);this.direction=new Vector3(0,0,0);this.sourceRotation=new Rotation4(0,0,1,0);this.destinationRotation=new Rotation4(0,0,1,0);this.startTime=0;this.lineBuffer=gl.createBuffer();this.lineCount=2;this.lineVertices=new Array(this.lineCount*4);this.lineArray=new Float32Array(this.lineVertices);this.projectionMatrix=new Matrix4;this.projectionMatrixArray=new Float32Array(this.projectionMatrix);this.modelViewMatrixArray=new Float32Array(this.projectionMatrix)}X3DFlyViewer.prototype=$.extend(Object.create(X3DViewer.prototype),{constructor:X3DFlyViewer,initialize:function(){X3DViewer.prototype.initialize.call(this);var canvas=this.getBrowser().getCanvas();canvas.bind("mousedown.X3DFlyViewer",this.mousedown.bind(this));canvas.bind("mouseup.X3DFlyViewer",this.mouseup.bind(this));canvas.bind("mousemove.X3DFlyViewer",this.mousemove.bind(this));canvas.bind("mousewheel.X3DFlyViewer",this.mousewheel.bind(this));this.getBrowser().addCollision(this)},mousedown:function(event){if(this.button>=0)return;var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(event.button){case 0:{this.button=event.button;this.getBrowser().getCanvas().unbind("mousemove.X3DFlyViewer");$(document).bind("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this));$(document).bind("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this));event.preventDefault();this.disconnect();this.getActiveViewpoint().transitionStop();this.getBrowser().setCursor("MOVE");if(this.getBrowser().hasCtrlKey()){this.fromVector=this.trackballProjectToSphere(x,y)}else{this.fromVector.set(x,0,y);this.toVector.assign(this.fromVector);this.direction.set(0,0,0);if(this.getBrowser().getBrowserOption("Rubberband"))this.getBrowser().finished().addInterest(this,"display",MOVE)}break}case 1:{this.button=event.button;this.getBrowser().getCanvas().unbind("mousemove.X3DFlyViewer");$(document).bind("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this));$(document).bind("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this));event.preventDefault();this.disconnect();this.getActiveViewpoint().transitionStop();this.getBrowser().setCursor("MOVE");this.fromVector.set(x,-y,0);this.toVector.assign(this.fromVector);if(this.getBrowser().getBrowserOption("Rubberband"))this.getBrowser().finished().addInterest(this,"display",PAN);break}}},mouseup:function(event){if(event.button!==this.button)return;this.button=-1;$(document).unbind(".X3DFlyViewer"+this.getId());this.getBrowser().getCanvas().bind("mousemove.X3DFlyViewer",this.mousemove.bind(this));this.disconnect();this.getBrowser().setCursor("DEFAULT")},mousemove:function(event){this.getBrowser().addBrowserEvent();var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(this.button){case 0:{if(this.getBrowser().hasCtrlKey()){var viewpoint=this.getActiveViewpoint(),orientation=viewpoint.getUserOrientation(),toVector=this.trackballProjectToSphere(x,y);orientation=new Rotation4(toVector,this.fromVector).multRight(orientation);viewpoint.straightenHorizon(orientation);viewpoint.orientationOffset_=viewpoint.getOrientation().copy().inverse().multRight(orientation);this.fromVector.assign(toVector)}else{this.toVector.set(x,0,y);this.direction.assign(this.toVector).subtract(this.fromVector);this.addFly()}break}case 1:{event.preventDefault();this.toVector.set(x,-y,0);this.direction.assign(this.toVector).subtract(this.fromVector);this.addPan();break}}},mousewheel:function(event){event.preventDefault();var direction=0;if(event.originalEvent.wheelDelta)direction=-event.originalEvent.wheelDelta/120;else if(event.originalEvent.detail)direction=event.originalEvent.detail/3;var viewpoint=this.getActiveViewpoint();viewpoint.transitionStop();if(direction<0){this.sourceRotation.assign(viewpoint.orientationOffset_.getValue());this.destinationRotation=this.sourceRotation.multRight(new Rotation4(viewpoint.getUserOrientation().multVecRot(new Vector3(-1,0,0)),ROLL_ANGLE));this.addRoll()}else if(direction>0){this.sourceRotation.assign(viewpoint.orientationOffset_.getValue());this.destinationRotation=this.sourceRotation.multRight(new Rotation4(viewpoint.getUserOrientation().multVecRot(new Vector3(1,0,0)),ROLL_ANGLE));this.addRoll()}},fly:function(){var now=performance.now(),dt=(now-this.startTime)/1e3;var navigationInfo=this.getNavigationInfo(),viewpoint=this.getActiveViewpoint(),upVector=viewpoint.getUpVector();var up=new Rotation4(yAxis,upVector);var rubberBandRotation=this.direction.z>0?new Rotation4(up.multVecRot(this.direction.copy()),up.multVecRot(zAxis.copy())):new Rotation4(up.multVecRot(Vector3.negate(zAxis)),up.multVecRot(this.direction.copy()));var rubberBandLength=this.direction.abs();var speedFactor=1-rubberBandRotation.angle/(Math.PI/2);speedFactor*=navigationInfo.speed_.getValue();speedFactor*=viewpoint.getSpeedFactor();speedFactor*=this.getBrowser().hasShiftKey()?SHIFT_SPEED_FACTOR:SPEED_FACTOR;speedFactor*=dt;var translation=this.getTranslationOffset(Vector3.multiply(this.direction,speedFactor));viewpoint.positionOffset_=this.getActiveLayer().constrainTranslation(translation).add(viewpoint.positionOffset_.getValue());var weight=ROTATION_SPEED_FACTOR*dt;weight*=Math.pow(rubberBandLength/(rubberBandLength+ROTATION_LIMIT),2);viewpoint.orientationOffset_=(new Rotation4).slerp(rubberBandRotation,weight).multLeft(viewpoint.orientationOffset_.getValue());var geoRotation=new Rotation4(upVector,viewpoint.getUpVector());viewpoint.orientationOffset_=geoRotation.multLeft(viewpoint.orientationOffset_.getValue());this.startTime=now},pan:function(){var now=performance.now(),dt=(now-this.startTime)/1e3;var navigationInfo=this.getNavigationInfo(),viewpoint=this.getActiveViewpoint(),upVector=viewpoint.getUpVector();var speedFactor=1;speedFactor*=navigationInfo.speed_.getValue();speedFactor*=viewpoint.getSpeedFactor();speedFactor*=this.getBrowser().hasShiftKey()?PAN_SHIFT_SPEED_FACTOR:PAN_SPEED_FACTOR;speedFactor*=dt;var orientation=viewpoint.getUserOrientation().multRight(new Rotation4(viewpoint.getUserOrientation().multVecRot(yAxis.copy()),upVector));translation=orientation.multVecRot(this.direction.copy().multiply(speedFactor));viewpoint.positionOffset_=this.getActiveLayer().constrainTranslation(translation).add(viewpoint.positionOffset_.getValue());this.startTime=now},roll:function(){var now=performance.now(),elapsedTime=(now-this.startTime)/1e3;if(elapsedTime>ROLL_TIME)return this.disconnect();var viewpoint=this.getActiveViewpoint();viewpoint.orientationOffset_=Rotation4.slerp(this.sourceRotation,this.destinationRotation,elapsedTime/ROLL_TIME)},addFly:function(){if(this.startTime)return;this.getBrowser().prepareEvents().addInterest(this,"fly");this.getBrowser().addBrowserEvent();this.startTime=performance.now()},addPan:function(){if(this.startTime)return;this.getBrowser().prepareEvents().addInterest(this,"pan");this.getBrowser().addBrowserEvent();this.startTime=performance.now()},addRoll:function(){if(this.startTime)return;this.getBrowser().prepareEvents().addInterest(this,"roll");this.getBrowser().addBrowserEvent();this.startTime=performance.now()},display:function(interest,type){var browser=this.getBrowser(),viewport=browser.getViewport(),width=viewport[2];height=viewport[3];Camera.ortho(0,width,0,height,-1,1,this.projectionMatrix);this.projectionMatrixArray.set(this.projectionMatrix);if(type===MOVE){fromPoint.set(this.fromVector.x,height-this.fromVector.z,0);toPoint.set(this.toVector.x,height-this.toVector.z,0)}else{fromPoint.set(this.fromVector.x,height+this.fromVector.y,0);toPoint.set(this.toVector.x,height+this.toVector.y,0)}this.transfer(fromPoint,toPoint);var gl=browser.getContext(),shader=browser.getLineShader();shader.use();gl.uniform1i(shader.fogType,0);gl.uniform1i(shader.colorMaterial,false);gl.uniform1i(shader.lighting,true);gl.uniformMatrix4fv(shader.projectionMatrix,false,this.projectionMatrixArray);gl.uniformMatrix4fv(shader.modelViewMatrix,false,this.modelViewMatrixArray);gl.disable(gl.DEPTH_TEST);gl.lineWidth(2);gl.uniform3fv(shader.emissiveColor,black);gl.uniform1f(shader.transparency,0);gl.enableVertexAttribArray(shader.vertex);gl.bindBuffer(gl.ARRAY_BUFFER,this.lineBuffer);gl.vertexAttribPointer(shader.vertex,4,gl.FLOAT,false,0,0);gl.drawArrays(gl.LINES,0,this.lineCount);gl.lineWidth(1);gl.uniform3fv(shader.emissiveColor,white);gl.drawArrays(gl.LINES,0,this.lineCount);gl.disableVertexAttribArray(shader.vertex);gl.enable(gl.DEPTH_TEST)},transfer:function(fromPoint,toPoint){var gl=this.getBrowser().getContext(),lineVertices=this.lineVertices;lineVertices[0]=fromPoint.x;lineVertices[1]=fromPoint.y;lineVertices[2]=fromPoint.z;lineVertices[3]=1;lineVertices[4]=toPoint.x;lineVertices[5]=toPoint.y;lineVertices[6]=toPoint.z;lineVertices[7]=1;this.lineArray.set(lineVertices);gl.bindBuffer(gl.ARRAY_BUFFER,this.lineBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.lineArray,gl.STATIC_DRAW)},disconnect:function(){var browser=this.getBrowser();browser.addBrowserEvent();browser.prepareEvents().removeInterest(this,"fly");browser.prepareEvents().removeInterest(this,"pan");browser.prepareEvents().removeInterest(this,"roll");browser.finished().removeInterest(this,"display");this.startTime=0},dispose:function(){this.disconnect();this.getBrowser().removeCollision(this);this.getBrowser().getCanvas().unbind(".X3DFlyViewer");$(document).unbind(".X3DFlyViewer"+this.getId())}});return X3DFlyViewer});define("cobweb/Browser/Navigation/WalkViewer",["cobweb/Browser/Navigation/X3DFlyViewer","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","lib/gettext"],function(X3DFlyViewer,Vector3,Rotation4,_){var yAxis=new Vector3(0,1,0);function WalkViewer(executionContext){X3DFlyViewer.call(this,executionContext.getBrowser(),executionContext)}WalkViewer.prototype=$.extend(Object.create(X3DFlyViewer.prototype),{constructor:WalkViewer,getTranslationOffset:function(velocity){var viewpoint=this.getActiveViewpoint(),upVector=viewpoint.getUpVector();var userOrientation=viewpoint.getUserOrientation().copy(),orientation=userOrientation.multRight(new Rotation4(userOrientation.multVecRot(yAxis.copy()),upVector));return orientation.multVecRot(velocity)}});return WalkViewer});define("cobweb/Browser/Navigation/FlyViewer",["cobweb/Browser/Navigation/X3DFlyViewer","lib/gettext"],function(X3DFlyViewer,_){function FlyViewer(executionContext){X3DFlyViewer.call(this,executionContext.getBrowser(),executionContext)}FlyViewer.prototype=$.extend(Object.create(X3DFlyViewer.prototype),{constructor:FlyViewer,getTranslationOffset:function(velocity){return this.getActiveViewpoint().getUserOrientation().multVecRot(velocity)}});return FlyViewer});define("cobweb/Components/Navigation/Viewpoint",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Navigation/X3DViewpointNode","cobweb/Bits/X3DConstants","standard/Math/Geometry/Camera","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DViewpointNode,X3DConstants,Camera,Vector3,Matrix4){with(Fields){function Viewpoint(executionContext){X3DViewpointNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Viewpoint);this.projectionMatrix=new Matrix4}Viewpoint.prototype=$.extend(Object.create(X3DViewpointNode.prototype),{constructor:Viewpoint,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"position",new SFVec3f(0,0,10)),new X3DFieldDefinition(X3DConstants.inputOutput,"orientation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"centerOfRotation",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"fieldOfView",new SFFloat(Math.PI/4)),new X3DFieldDefinition(X3DConstants.inputOutput,"jump",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"retainUserOffsets",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime)]),getTypeName:function(){return"Viewpoint"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},getFieldOfView:function(){var fov=this.fieldOfView_*this.fieldOfViewScale_;return fov>0&&fov<Math.PI?fov:Math.PI/4},getScreenScale:function(distance,viewport){var width=viewport[2],height=viewport[3],size=distance*Math.tan(this.getFieldOfView()/2)*2;
if(width>height)size/=height;else size/=width;return new Vector3(size,size,size)},getLookAtDistance:function(bbox){return bbox.size.abs()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrix:function(zNear,zFar,viewport){return Camera.perspective(this.getFieldOfView(),zNear,zFar,viewport,this.projectionMatrix)}});return Viewpoint}});define("cobweb/Components/Geospatial/X3DGeospatialObject",["jquery","cobweb/Bits/X3DConstants"],function($,X3DConstants){function X3DGeospatialObject(browser,executionContext){this.addType(X3DConstants.X3DGeospatialObject)}X3DGeospatialObject.prototype={constructor:X3DGeospatialObject,initialize:function(){}};return X3DGeospatialObject});define("cobweb/Components/Geospatial/GeoViewpoint",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Navigation/X3DViewpointNode","cobweb/Components/Geospatial/X3DGeospatialObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DViewpointNode,X3DGeospatialObject,X3DConstants){with(Fields){function GeoViewpoint(executionContext){X3DViewpointNode.call(this,executionContext.getBrowser(),executionContext);X3DGeospatialObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.GeoViewpoint)}GeoViewpoint.prototype=$.extend(Object.create(X3DViewpointNode.prototype),X3DGeospatialObject.prototype,{constructor:GeoViewpoint,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"geoSystem",new MFString(["GD","WE"])),new X3DFieldDefinition(X3DConstants.inputOutput,"position",new SFVec3d(0,0,1e5)),new X3DFieldDefinition(X3DConstants.inputOutput,"orientation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"centerOfRotation",new SFVec3d),new X3DFieldDefinition(X3DConstants.inputOutput,"fieldOfView",new SFFloat(.785398)),new X3DFieldDefinition(X3DConstants.inputOutput,"jump",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"retainUserOffsets",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"navType",new MFString(["EXAMINE","ANY"])),new X3DFieldDefinition(X3DConstants.inputOutput,"headlight",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"speedFactor",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime),new X3DFieldDefinition(X3DConstants.initializeOnly,"geoOrigin",new SFNode)]),getTypeName:function(){return"GeoViewpoint"},getComponentName:function(){return"Geospatial"},getContainerField:function(){return"children"}});return GeoViewpoint}});define("cobweb/Browser/Navigation/PlaneViewer",["jquery","cobweb/Browser/Navigation/X3DViewer","cobweb/Components/Navigation/Viewpoint","cobweb/Components/Geospatial/GeoViewpoint","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","lib/gettext","jquery-mousewheel"],function($,X3DViewer,Viewpoint,GeoViewpoint,Vector3,Rotation4,_){var SCROLL_FACTOR=.05;function PlaneViewer(executionContext){X3DViewer.call(this,executionContext.getBrowser(),executionContext);this.button=-1;this.fromPoint=new Vector3(0,0,0)}PlaneViewer.prototype=$.extend(Object.create(X3DViewer.prototype),{constructor:PlaneViewer,initialize:function(){X3DViewer.prototype.initialize.call(this);var browser=this.getBrowser(),canvas=browser.getCanvas();canvas.bind("mousedown.PlaneViewer",this.mousedown.bind(this));canvas.bind("mouseup.PlaneViewer",this.mouseup.bind(this));canvas.bind("mousemove.PlaneViewer",this.mousemove.bind(this));canvas.bind("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown:function(event){if(this.button>=0)return;this.pressTime=performance.now();var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(event.button){case 1:{this.button=event.button;this.getBrowser().getCanvas().unbind("mousemove.PlaneViewer");$(document).bind("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this));$(document).bind("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this));event.preventDefault();this.getActiveViewpoint().transitionStop();this.getBrowser().setCursor("MOVE");this.fromPoint=this.getPointOnCenterPlane(x,y);break}}},mouseup:function(event){if(event.button!==this.button)return;this.button=-1;$(document).unbind(".PlaneViewer"+this.getId());this.getBrowser().getCanvas().bind("mousemove.PlaneViewer",this.mousemove.bind(this));this.getBrowser().setCursor("DEFAULT")},mousemove:function(event){var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(this.button){case 1:{event.preventDefault();var viewpoint=this.getActiveViewpoint(),toPoint=this.getPointOnCenterPlane(x,y),translation=viewpoint.getUserOrientation().multVecRot(Vector3.subtract(this.fromPoint,toPoint));viewpoint.positionOffset_=Vector3.add(viewpoint.positionOffset_.getValue(),translation);viewpoint.centerOfRotationOffset_=Vector3.add(viewpoint.centerOfRotationOffset_.getValue(),translation);this.fromPoint=toPoint;break}}},mousewheel:function(event){event.preventDefault();var offset=this.getBrowser().getCanvas().offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;var direction=0;if(event.originalEvent.wheelDelta)direction=-event.originalEvent.wheelDelta/120;else if(event.originalEvent.detail)direction=event.originalEvent.detail/3;var viewpoint=this.getActiveViewpoint(),fromPoint=this.getPointOnCenterPlane(x,y);viewpoint.transitionStop();if(direction<0)viewpoint.fieldOfViewScale_=Math.max(1e-5,viewpoint.fieldOfViewScale_.getValue()*(1-SCROLL_FACTOR));else if(direction>0){viewpoint.fieldOfViewScale_=viewpoint.fieldOfViewScale_.getValue()*(1+SCROLL_FACTOR);this.constrainFieldOfViewScale()}var toPoint=this.getPointOnCenterPlane(x,y),translation=viewpoint.getUserOrientation().multVecRot(Vector3.subtract(fromPoint,toPoint));viewpoint.positionOffset_=Vector3.add(viewpoint.positionOffset_.getValue(),translation);viewpoint.centerOfRotationOffset_=Vector3.add(viewpoint.centerOfRotationOffset_.getValue(),translation)},constrainFieldOfViewScale:function(){var viewpoint=this.getActiveViewpoint();if(viewpoint instanceof Viewpoint||viewpoint instanceof GeoViewpoint){if(viewpoint.fieldOfView_.getValue()*viewpoint.fieldOfViewScale_.getValue()>=Math.PI)viewpoint.fieldOfViewScale_=(Math.PI-.001)/viewpoint.fieldOfView_.getValue()}},dispose:function(){this.getBrowser().getCanvas().unbind(".PlaneViewer");$(document).unbind(".PlaneViewer"+this.getId())}});return PlaneViewer});define("cobweb/Browser/Navigation/NoneViewer",["jquery","cobweb/Browser/Navigation/X3DViewer","lib/gettext"],function($,X3DViewer,_){function NoneViewer(executionContext){X3DViewer.call(this,executionContext.getBrowser(),executionContext)}NoneViewer.prototype=$.extend(Object.create(X3DViewer.prototype),{constructor:NoneViewer});return NoneViewer});define("cobweb/Components/Lighting/X3DLightNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,X3DChildNode,TraverseType,X3DConstants){function X3DLightNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DLightNode)}X3DLightNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DLightNode,push:function(){if(this.on_.getValue()){if(this.global_.getValue())this.getBrowser().getGlobalLights().push(this.getLights().pop(this));else this.getCurrentLayer().getLocalLights().push(this.getLights().pop(this))}},pop:function(){if(this.on_.getValue()){if(this.global_.getValue())return;this.getBrowser().getLocalLights().push(this.getCurrentLayer().getLocalLights().pop())}}});return X3DLightNode});define("standard/Utility/ObjectCache",[],function(){return function(Type){return{stack:[],last:-1,pop:function(){if(this.last>-1){var object=this.stack[this.last];object.set.apply(object,arguments);this.last--}else{var object=Object.create(Type.prototype);Type.apply(object,arguments)}return object},push:function(object){this.last++;this.stack[this.last]=object},clear:function(){this.stack.length=0;this.last=-1}}}});define("cobweb/Components/Lighting/DirectionalLight",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Lighting/X3DLightNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Utility/ObjectCache"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DLightNode,X3DConstants,Vector3,ObjectCache){var DirectionalLights=ObjectCache(DirectionalLightContainer);function DirectionalLightContainer(light){this.direction=new Vector3(0,0,0);this.set(light)}DirectionalLightContainer.prototype={set:function(light){this.color=light.color_.getValue();this.intensity=light.intensity_.getValue();this.ambientIntensity=light.ambientIntensity_.getValue();light.getBrowser().getModelViewMatrix().get().multDirMatrix(this.direction.assign(light.direction_.getValue())).normalize()},use:function(gl,shader,i){gl.uniform1i(shader.lightType[i],0);gl.uniform1i(shader.lightOn[i],true);gl.uniform3f(shader.lightColor[i],this.color.r,this.color.g,this.color.b);gl.uniform1f(shader.lightIntensity[i],this.intensity);gl.uniform1f(shader.lightAmbientIntensity[i],this.ambientIntensity);gl.uniform3f(shader.lightAttenuation[i],1,0,0);gl.uniform3f(shader.lightDirection[i],this.direction.x,this.direction.y,this.direction.z)},recycle:function(){DirectionalLights.push(this)}};with(Fields){function DirectionalLight(executionContext){X3DLightNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.DirectionalLight)}DirectionalLight.prototype=$.extend(Object.create(X3DLightNode.prototype),{constructor:DirectionalLight,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"global",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"on",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFColor(1,1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"intensity",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"ambientIntensity",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"direction",new SFVec3f(0,0,-1))]),getTypeName:function(){return"DirectionalLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return DirectionalLights}});return DirectionalLight}});define("cobweb/Browser/Navigation/X3DNavigationContext",["cobweb/Fields","cobweb/Browser/Navigation/ExamineViewer","cobweb/Browser/Navigation/WalkViewer","cobweb/Browser/Navigation/FlyViewer","cobweb/Browser/Navigation/PlaneViewer","cobweb/Browser/Navigation/NoneViewer","cobweb/Components/Lighting/DirectionalLight"],function(Fields,ExamineViewer,WalkViewer,FlyViewer,PlaneViewer,NoneViewer,DirectionalLight){with(Fields){getHeadLight=function(executionContext){var light=new DirectionalLight(executionContext);light.setup();var headlight=light.getLights().pop(light);headlight.recycle=function(){};return headlight};function X3DNavigationContext(){this.addChildren("availableViewers",new MFString,"viewer",new SFString("EXAMINE"));this.collisions=[];this.activeCollisions={};this.collisionCount=0;this.activeLayerNode=null;this.navigationInfoNode=null;this.viewerNode=null}X3DNavigationContext.prototype={initialize:function(){this.viewer_.addInterest(this,"set_viewer__");this.initialized().addInterest(this,"set_world__");this.shutdown().addInterest(this,"remove_world__");this.headlight=getHeadLight(this)},getHeadlight:function(){return this.headlight},getActiveLayer:function(){return this.activeLayerNode},getCollisions:function(){return this.collisions},addCollision:function(object){if(this.activeCollisions.hasOwnProperty(object.getId()))return;this.activeCollisions[object.getId()]=true;++this.collisionCount},removeCollision:function(object){if(!this.activeCollisions.hasOwnProperty(object.getId()))return;delete this.activeCollisions[object.getId()];--this.collisionCount},getCollisionCount:function(){return this.collisionCount},remove_world__:function(){this.getWorld().activeLayer_.removeInterest(this,"set_activeLayer__")},set_world__:function(){this.getWorld().activeLayer_.addInterest(this,"set_activeLayer__");this.set_activeLayer__()},set_activeLayer__:function(){if(this.activeLayerNode)this.activeLayerNode.getNavigationInfoStack().removeInterest(this,"set_navigationInfo__");this.activeLayerNode=this.getWorld().getActiveLayer();if(this.activeLayerNode)this.activeLayerNode.getNavigationInfoStack().addInterest(this,"set_navigationInfo__");this.set_navigationInfo__()},set_navigationInfo__:function(){if(this.navigationInfoNode)this.navigationInfoNode.viewer_.removeFieldInterest(this.viewer_);if(!this.activeLayerNode){this.navigationInfoNode=null;this.viewer_="NONE";return}this.navigationInfoNode=this.activeLayerNode.getNavigationInfo();this.navigationInfoNode.viewer_.addFieldInterest(this.viewer_);this.viewer_=this.navigationInfoNode.viewer_},set_viewer__:function(viewer){if(this.navigationInfoNode)this.availableViewers_=this.navigationInfoNode.availableViewers_;else this.availableViewers_.length=0;if(this.viewerNode)this.viewerNode.dispose();switch(viewer.getValue()){case"EXAMINE":this.viewerNode=new ExamineViewer(this);break;case"WALK":this.viewerNode=new WalkViewer(this);break;case"FLY":this.viewerNode=new FlyViewer(this);break;case"PLANE":case"PLANE_create3000.de":this.viewerNode=new PlaneViewer(this);break;case"NONE":this.viewerNode=new NoneViewer(this);break;default:this.viewerNode=new ExamineViewer(this);break}this.viewerNode.setup()}};return X3DNavigationContext}});define("cobweb/Components/Grouping/X3DBoundedObject",["jquery","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Geometry/Box3"],function($,X3DCast,X3DConstants,Vector3,Box3){function X3DBoundedObject(browser,executionContext){this.addType(X3DConstants.X3DBoundedObject)}X3DBoundedObject.prototype={constructor:X3DBoundedObject,defaultBBoxSize:new Vector3(-1,-1,-1),initialize:function(){}};X3DBoundedObject.getBBox=function(nodes){var bbox=new Box3;for(var i=0;i<nodes.length;++i){var boundedObject=X3DCast(X3DConstants.X3DBoundedObject,nodes[i]);if(boundedObject){if(!boundedObject.getBBox())console.log(boundedObject.getTypeName());bbox.add(boundedObject.getBBox())}}return bbox};return X3DBoundedObject});define("cobweb/Components/Grouping/X3DGroupingNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Components/Grouping/X3DBoundedObject","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Geometry/Box3"],function($,X3DChildNode,X3DBoundedObject,TraverseType,X3DConstants,Box3){function remove(array,first,last,range,rfirst,rlast,getId){if(!getId)getId=remove.getId;var set={};for(var i=rfirst;i<rlast;++i)set[getId(range[i])]=true;return remove_impl(array,first,last,set,getId)}function remove_impl(array,first,last,set,getId){if($.isEmptyObject(set))return last;var count=0;for(;first!==last;++first){if(set[getId(array[first])]){++count;break}}LOOP:for(;;){var second=first+count;for(;second!==last;++first,++second){if(set[getId(array[second])]){++count;continue LOOP}array[first]=array[second]}break}for(var second=first+count;second!==last;++first,++second){array[first]=array[second]}return first}remove.getId=function(value){return value};function getId(value){return value?value.getId():-1}function getNodeId(value){return value?value.getValue().getId():-1}function X3DGroupingNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);X3DBoundedObject.call(this,browser,executionContext);this.addType(X3DConstants.X3DGroupingNode);this.hidden=false;this.visible=[];this.pointingDeviceSensors=[];this.cameraObjects=[];this.clipPlanes=[];this.localFogs=[];this.lights=[];this.childNodes=[]}X3DGroupingNode.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DBoundedObject.prototype,{constructor:X3DGroupingNode,initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DBoundedObject.prototype.initialize.call(this);this.addChildren_.addInterest(this,"set_addChildren__");this.removeChildren_.addInterest(this,"set_removeChildren__");this.children_.addInterest(this,"set_children__");this.set_children__()},getBBox:function(){if(this.bboxSize_.getValue().equals(this.defaultBBoxSize))return X3DBoundedObject.getBBox(this.children_);return new Box3(this.bboxSize_.getValue(),this.bboxCenter_.getValue())},setHidden:function(value){if(value!==this.hidden){this.hidden=value;this.set_children__()}},setVisible:function(value){this.visible=value;this.set_children__()},getChild:function(index){try{if(index>=0&&index<this.children_.length){var child=this.children_[index];if(child)return child.getValue().getInnerNode()}}catch(error){}return null},set_addChildren__:function(){if(this.addChildren_.length===0)return;this.addChildren_.setTainted(true);this.addChildren_.erase(remove(this.addChildren_,0,this.addChildren_.length,this.children_,0,this.children_.length,getNodeId),this.addChildren_.length);if(!this.children_.getTainted()){this.children_.removeInterest(this,"set_children__");this.children_.addInterest(this,"connectChildren")}this.children_.insert(this.children_.length,this.addChildren_,0,this.addChildren_.length);this.add(this.addChildren_);this.addChildren_.set([]);this.addChildren_.setTainted(false)},set_removeChildren__:function(){if(this.removeChildren_.length===0)return;if(this.children_.length===0)return;if(!this.children_.getTainted()){this.children_.removeInterest(this,"set_children__");this.children_.addInterest(this,"connectChildren")}this.children_.erase(remove(this.children_,0,this.children_.length,this.removeChildren_,0,this.removeChildren_.length,getNodeId),this.children_.length);this.removeChildren_.set([]);this.set_children__()},set_children__:function(){this.clear();this.add(this.children_)},connectChildren:function(){this.children_.removeInterest(this,"connectChildren");this.children_.addInterest(this,"set_children__")},add:function(children){if(this.hidden)return;for(var i=0,length=children.length;i<length;++i){var child=children[i];if(child&&(i>=this.visible.length||this.visible[i].getValue())){try{var innerNode=child.getValue().getInnerNode(),type=Array.prototype.slice.call(innerNode.getType(),0).reverse();for(var t=0;t<type.length;++t){switch(type[t]){case X3DConstants.X3DPointingDeviceSensorNode:{this.pointingDeviceSensors.push(innerNode);break}case X3DConstants.ClipPlane:{this.clipPlanes.push(innerNode);break}case X3DConstants.LocalFog:{this.localFogs.push(innerNode);break}case X3DConstants.X3DLightNode:{this.lights.push(innerNode);break}case X3DConstants.X3DChildNode:{this.childNodes.push(innerNode);innerNode.isCameraObject_.addInterest(this,"set_cameraObjects__");break}case X3DConstants.BooleanFilter:case X3DConstants.BooleanToggle:case X3DConstants.NurbsOrientationInterpolator:case X3DConstants.NurbsPositionInterpolator:case X3DConstants.NurbsSurfaceInterpolator:case X3DConstants.TimeSensor:case X3DConstants.X3DFollowerNode:case X3DConstants.X3DInfoNode:case X3DConstants.X3DInterpolatorNode:case X3DConstants.X3DLayoutNode:case X3DConstants.X3DScriptNode:case X3DConstants.X3DSequencerNode:case X3DConstants.X3DTriggerNode:break;default:continue}break}}catch(error){}}}this.set_cameraObjects__()},clear:function(){for(var i=0,length=this.childNodes.length;i<length;++i)this.childNodes[i].isCameraObject_.removeInterest(this,"set_cameraObjects__");this.pointingDeviceSensors.length=0;this.cameraObjects.length=0;this.clipPlanes.length=0;this.localFogs.length=0;this.lights.length=0;this.childNodes.length=0},set_cameraObjects__:function(){this.cameraObjects.length=0;for(var i=0,length=this.childNodes.length;i<length;++i){var childNode=this.childNodes[i];if(childNode.getCameraObject())this.cameraObjects.push(childNode)}this.setCameraObject(this.cameraObjects.length)},traverse:function(type){switch(type){case TraverseType.POINTER:{if(this.pointingDeviceSensors.length){var sensors={};this.getBrowser().getSensors().push(sensors);for(var i=0,length=this.pointingDeviceSensors.length;i<length;++i)this.pointingDeviceSensors[i].traverse(sensors)}for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].push();for(var i=0,length=this.childNodes.length;i<length;++i)this.childNodes[i].traverse(type);for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].pop();if(this.pointingDeviceSensors.length)this.getBrowser().getSensors().pop();return}case TraverseType.CAMERA:{for(var i=0,length=this.cameraObjects.length;i<length;++i)this.cameraObjects[i].traverse(type);return}case TraverseType.COLLISION:{for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].push();for(var i=0,length=this.childNodes.length;i<length;++i)this.childNodes[i].traverse(type);for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].pop();return}case TraverseType.DISPLAY:{for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].push();for(var i=0,length=this.localFogs.length;i<length;++i)this.localFogs[i].push();for(var i=0,length=this.lights.length;i<length;++i)this.lights[i].push();for(var i=0,length=this.childNodes.length;i<length;++i)this.childNodes[i].traverse(type);for(var i=0,length=this.lights.length;i<length;++i)this.lights[i].pop();for(var i=0,length=this.localFogs.length;i<length;++i)this.localFogs[i].pop();for(var i=0,length=this.clipPlanes.length;i<length;++i)this.clipPlanes[i].pop();return}}}});return X3DGroupingNode});define("cobweb/Components/Layering/X3DViewportNode",["jquery","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DConstants"],function($,X3DGroupingNode,X3DConstants){function X3DViewportNode(browser,executionContext){X3DGroupingNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DViewportNode)}X3DViewportNode.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:X3DViewportNode});return X3DViewportNode});define("cobweb/Components/Layering/Viewport",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Layering/X3DViewportNode","cobweb/Bits/X3DConstants","cobweb/Bits/TraverseType","standard/Utility/ObjectCache","standard/Math/Geometry/ViewVolume","standard/Math/Numbers/Vector4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DViewportNode,X3DConstants,TraverseType,ObjectCache,ViewVolume,Vector4){with(Fields){var ViewVolumes=ObjectCache(ViewVolume);function Viewport(executionContext){X3DViewportNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Viewport)}Viewport.prototype=$.extend(Object.create(X3DViewportNode.prototype),{constructor:Viewport,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"clipBoundary",new MFFloat(0,1,0,1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Viewport"},getComponentName:function(){return"Layering"},getContainerField:function(){return"viewport"},initialize:function(){X3DViewportNode.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.getBrowser().getViewport().addInterest(this,"set_rectangle__");this.clipBoundary_.addInterest(this,"set_rectangle__");this.rectangle=new Vector4(0,0,0,0);this.set_live__()},set_live__:function(){if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue()){this.getBrowser().getViewport().addInterest(this,"set_rectangle__");this.set_rectangle__()}else this.getBrowser().getViewport().removeInterest(this,"set_rectangle__")},set_rectangle__:function(){var viewport=this.getBrowser().getViewport();var left=Math.floor(viewport[2]*this.getLeft()),right=Math.floor(viewport[2]*this.getRight()),bottom=Math.floor(viewport[3]*this.getBottom()),top=Math.floor(viewport[3]*this.getTop());this.rectangle.set(left,bottom,Math.max(0,right-left),Math.max(0,top-bottom))},getRectangle:function(){return this.rectangle},getLeft:function(){return this.clipBoundary_.length>0?this.clipBoundary_[0]:0},getRight:function(){return this.clipBoundary_.length>1?this.clipBoundary_[1]:1},getBottom:function(){return this.clipBoundary_.length>2?this.clipBoundary_[2]:0},getTop:function(){return this.clipBoundary_.length>3?this.clipBoundary_[3]:1},traverse:function(type){this.push();switch(type){case TraverseType.POINTER:{if(this.getBrowser().isPointerInRectangle(this.rectangle))X3DViewportNode.prototype.traverse.call(this,type);break}default:X3DViewportNode.prototype.traverse.call(this,type);break}this.pop()},push:function(){var currentLayer=this.getCurrentLayer(),viewVolumes=currentLayer.getViewVolumes(),viewport=viewVolumes.length?viewVolumes[0].getViewport():this.rectangle;currentLayer.getViewVolumes().push(ViewVolumes.pop(this.getBrowser().getProjectionMatrix(),viewport,this.rectangle))},pop:function(){ViewVolumes.push(this.getCurrentLayer().getViewVolumes().pop())}});return Viewport}});define("cobweb/Browser/Layering/X3DLayeringContext",["cobweb/Components/Layering/Viewport"],function(Viewport){function X3DLayeringContext(){this.defaultViewport=new Viewport(this);this.layers=[]}X3DLayeringContext.prototype={initialize:function(){this.defaultViewport.setup()},getDefaultViewport:function(){return this.defaultViewport},getLayers:function(){return this.layers}};return X3DLayeringContext});define("cobweb/Components/Texturing/TextureProperties",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DConstants){with(Fields){var boundaryModes={CLAMP:"CLAMP_TO_EDGE",CLAMP_TO_EDGE:"CLAMP_TO_EDGE",CLAMP_TO_BOUNDARY:"CLAMP_TO_EDGE",MIRRORED_REPEAT:"MIRRORED_REPEAT",REPEAT:"REPEAT"};var minificationFilters={AVG_PIXEL_AVG_MIPMAP:"LINEAR_MIPMAP_LINEAR",AVG_PIXEL:"LINEAR",AVG_PIXEL_NEAREST_MIPMAP:"LINEAR_MIPMAP_NEAREST",NEAREST_PIXEL_AVG_MIPMAP:"NEAREST_MIPMAP_LINEAR",NEAREST_PIXEL_NEAREST_MIPMAP:"NEAREST_MIPMAP_NEAREST",NEAREST_PIXEL:"NEAREST",NICEST:"LINEAR_MIPMAP_LINEAR",FASTEST:"NEAREST"};var magnificationFilters={AVG_PIXEL:"LINEAR",NEAREST_PIXEL:"NEAREST",NICEST:"LINEAR",FASTEST:"NEAREST"};function TextureProperties(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TextureProperties)}TextureProperties.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:TextureProperties,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"borderColor",new SFColorRGBA),new X3DFieldDefinition(X3DConstants.inputOutput,"borderWidth",new SFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"anisotropicDegree",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"generateMipMaps",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"minificationFilter",new SFString("FASTEST")),new X3DFieldDefinition(X3DConstants.inputOutput,"magnificationFilter",new SFString("FASTEST")),new X3DFieldDefinition(X3DConstants.inputOutput,"boundaryModeS",new SFString("REPEAT")),new X3DFieldDefinition(X3DConstants.inputOutput,"boundaryModeT",new SFString("REPEAT")),new X3DFieldDefinition(X3DConstants.inputOutput,"boundaryModeR",new SFString("REPEAT")),new X3DFieldDefinition(X3DConstants.inputOutput,"textureCompression",new SFString("FASTEST")),new X3DFieldDefinition(X3DConstants.inputOutput,"texturePriority",new SFFloat)]),getTypeName:function(){return"TextureProperties"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureProperties"},getBoundaryMode:function(string){var boundaryMode=boundaryModes[string];if(boundaryMode!==undefined)return boundaryMode;return"REPEAT"},getBoundaryModeS:function(){return this.getBoundaryMode(this.boundaryModeS_.getValue())},getBoundaryModeT:function(){return this.getBoundaryMode(this.boundaryModeT_.getValue())},getBoundaryModeR:function(){return this.getBoundaryMode(this.boundaryModeR_.getValue())},getMinificationFilter:function(){if(this.generateMipMaps_.getValue()){var minificationFilter=minificationFilters[this.minificationFilter_.getValue()];if(minificationFilter!==undefined)return minificationFilter;return this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"},getMagnificationFilter:function(){var magnificationFilter=magnificationFilters[this.magnificationFilter_.getValue()];if(magnificationFilter!==undefined)return magnificationFilter;return this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}});return TextureProperties}});define("text!cobweb/Browser/EnvironmentalEffects/SphereVertexShader.vs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\n\nattribute vec4 x3d_Color;\nattribute vec4 x3d_Vertex;\n\nvarying vec4 C;\n\nvoid\nmain ()\n{\n	C           = x3d_Color;\n	gl_Position = x3d_ProjectionMatrix * x3d_ModelViewMatrix * x3d_Vertex;\n}\n"});define("text!cobweb/Browser/EnvironmentalEffects/SphereFragmentShader.fs",[],function(){return"// -*- Mode: C++; coding: utf-8; tab-width: 3; indent-tabs-mode: tab; c-basic-offset: 3 -*-\nprecision mediump float;\n\nvarying vec4 C;\n\nvoid\nmain ()\n{\n	gl_FragColor = C;\n}\n"});define("cobweb/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",["cobweb/Components/Shaders/ComposedShader","cobweb/Components/Shaders/ShaderPart","cobweb/Components/Texturing/TextureProperties","text!cobweb/Browser/EnvironmentalEffects/SphereVertexShader.vs","text!cobweb/Browser/EnvironmentalEffects/SphereFragmentShader.fs"],function(ComposedShader,ShaderPart,TextureProperties,vertexShaderText,fragmentShaderText){function X3DEnvironmentalEffectsContext(){}X3DEnvironmentalEffectsContext.prototype={initialize:function(){var vertexShader=new ShaderPart(this);vertexShader.type_="VERTEX";vertexShader.url_.push(vertexShaderText);vertexShader.setup();var fragmentShader=new ShaderPart(this);fragmentShader.type_="FRAGMENT";fragmentShader.url_.push(fragmentShaderText);fragmentShader.setup();this.backgroundSphereShader=new ComposedShader(this);this.backgroundSphereShader.language_="GLSL";this.backgroundSphereShader.parts_.push(vertexShader);this.backgroundSphereShader.parts_.push(fragmentShader);this.backgroundSphereShader.setup();this.backgroundTextureProperties=new TextureProperties(this);this.backgroundTextureProperties.boundaryModeS_="CLAMP_TO_EDGE";this.backgroundTextureProperties.boundaryModeT_="CLAMP_TO_EDGE";this.backgroundTextureProperties.boundaryModeR_="CLAMP_TO_EDGE";this.backgroundTextureProperties.minificationFilter_="NICEST";this.backgroundTextureProperties.magnificationFilter_="NICEST";this.backgroundTextureProperties.setup()},getBackgroundSphereShader:function(){return this.backgroundSphereShader},getBackgroundTextureProperties:function(){return this.backgroundTextureProperties}};
return X3DEnvironmentalEffectsContext});define("cobweb/Browser/Lighting/X3DLightingContext",["cobweb/Components/Layering/Viewport"],function(Viewport){function X3DLightingContext(){this.globalLights=[];this.localLights=[]}X3DLightingContext.prototype={initialize:function(){},getGlobalLights:function(){return this.globalLights},getLocalLights:function(){return this.localLights}};return X3DLightingContext});define("cobweb/Browser/Scripting/X3DScriptingContext",[],function(){function X3DScriptingContext(){this.scripts=[this]}X3DScriptingContext.prototype={initialize:function(){},isExternal:function(){return this.scripts.length===1},getScriptStack:function(){return this.scripts}};return X3DScriptingContext});define("cobweb/Browser/Shaders/X3DShadersContext",[],function(){function X3DShadersContext(){}X3DShadersContext.prototype={initialize:function(){},getShadingLanguageVersion:function(){return this.getContext().getParameter(this.getContext().SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors:function(){return this.getContext().getParameter(this.getContext().MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors:function(){return this.getContext().getParameter(this.getContext().MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs:function(){return this.getContext().getParameter(this.getContext().MAX_VERTEX_ATTRIBS)}};return X3DShadersContext});define("cobweb/Components/Shape/X3DAppearanceNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DNode,X3DConstants){with(Fields){function X3DAppearanceNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DAppearanceNode)}X3DAppearanceNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DAppearanceNode,initialize:function(){X3DNode.prototype.initialize.call(this);this.addChildren("transparent",new SFBool)}});return X3DAppearanceNode}});define("cobweb/Components/Shape/Appearance",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Shape/X3DAppearanceNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DAppearanceNode,X3DCast,X3DConstants){with(Fields){function Appearance(executionContext){X3DAppearanceNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Appearance)}Appearance.prototype=$.extend(Object.create(X3DAppearanceNode.prototype),{constructor:Appearance,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"fillProperties",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"lineProperties",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"material",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"texture",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"textureTransform",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"shaders",new MFNode)]),getTypeName:function(){return"Appearance"},getComponentName:function(){return"Shape"},getContainerField:function(){return"appearance"},initialize:function(){X3DAppearanceNode.prototype.initialize.call(this);this.material_.addInterest(this,"set_material__");this.texture_.addInterest(this,"set_texture__");this.textureTransform_.addInterest(this,"set_textureTransform__");this.shaders_.addInterest(this,"set_shaders__");this.set_material__();this.set_texture__();this.set_textureTransform__();this.set_shaders__()},set_material__:function(){if(this.materialNode)this.materialNode.transparent_.removeInterest(this,"set_transparent__");this.materialNode=X3DCast(X3DConstants.X3DMaterialNode,this.material_);if(this.materialNode)this.materialNode.transparent_.addInterest(this,"set_transparent__");this.set_transparent__()},set_texture__:function(){if(this.textureNode)this.textureNode.transparent_.removeInterest(this,"set_transparent__");this.textureNode=X3DCast(X3DConstants.X3DTextureNode,this.texture_);if(this.textureNode)this.textureNode.transparent_.addInterest(this,"set_transparent__");this.set_transparent__()},set_textureTransform__:function(){this.textureTransformNode=X3DCast(X3DConstants.X3DTextureTransformNode,this.textureTransform_);if(this.textureTransformNode)return;this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()},set_shaders__:function(){},set_transparent__:function(){this.transparent_=this.materialNode&&this.materialNode.transparent_.getValue()||this.textureNode&&this.textureNode.transparent_.getValue()},traverse:function(){var browser=this.getBrowser();browser.setMaterial(this.materialNode);browser.setTexture(this.textureNode);browser.setShader(browser.getDefaultShader());this.textureTransformNode.traverse()}});return Appearance}});define("cobweb/Browser/Shape/X3DShapeContext",["cobweb/Components/Shape/Appearance"],function(Appearance){function X3DShapeContext(){this.defaultAppearance=new Appearance(this)}X3DShapeContext.prototype={initialize:function(){this.defaultAppearance.setup()},getDefaultAppearance:function(){return this.defaultAppearance},setMaterial:function(value){this.material=value},getMaterial:function(){return this.material}};return X3DShapeContext});define("cobweb/Browser/Sound/X3DSoundContext",["cobweb/Fields","lib/dataStorage"],function(Fields,dataStorage){var SFBool=Fields.SFBool,SFFloat=Fields.SFFloat;function X3DSoundContext(){}X3DSoundContext.prototype={initialize:function(){this.addChildren("volume",new SFFloat(1));this.addChildren("mute",new SFBool);this.volume_.addInterest(this,"set_volume__");this.mute_.addInterest(this,"set_mute__");var volume=dataStorage["X3DSoundContext.volume"],mute=dataStorage["X3DSoundContext.mute"];if(volume!==undefined)this.volume_=volume;if(mute!==undefined)this.mute_=mute},set_volume__:function(volume){dataStorage["X3DSoundContext.volume"]=volume.getValue()},set_mute__:function(mute){dataStorage["X3DSoundContext.mute"]=mute.getValue()}};return X3DSoundContext});define("cobweb/Parser/Parser",["jquery","cobweb/Fields"],function($,Fields){with(Fields){var Grammar={Whitespaces:new RegExp("^([\\x20\\n,\\t\\r]+)","y"),FALSE:new RegExp("^FALSE","y"),TRUE:new RegExp("^TRUE","y"),"false":new RegExp("^false","y"),"true":new RegExp("^true","y"),OpenBrace:new RegExp("^\\{","y"),CloseBrace:new RegExp("^\\}","y"),OpenBracket:new RegExp("^\\[","y"),CloseBracket:new RegExp("^\\]","y"),Period:new RegExp("^\\.","y"),Colon:new RegExp("^\\:","y"),int32:new RegExp("^((?:0[xX][\\da-fA-F]+)|(?:[+-]?\\d+))","y"),"double":new RegExp("^([+-]?(?:(?:(?:\\d*\\.\\d+)|(?:\\d+(?:\\.)?))(?:[eE][+-]?\\d+)?))","y"),string:new RegExp('^"((?:[^\\\\"]|\\\\\\\\|\\\\\\")*)"',"y"),Inf:new RegExp("^[+]?inf","y"),NegativeInf:new RegExp("^-inf","y"),NaN:new RegExp("^[+-]?nan","y"),Break:new RegExp("\\n","g")};function parse(parser){this.lastIndex=parser.lastIndex;parser.result=this.exec(parser.input);if(parser.result){parser.lastIndex=this.lastIndex;return true}return false}for(var key in Grammar)Grammar[key].parse=parse;Object.preventExtensions(Grammar);Object.freeze(Grammar);Object.seal(Grammar);function Parser(scene,input,xml){this.scene=scene;this.xml=xml;this.setInput(input)}Parser.prototype={setInput:function(value){this.input=value;this.lineNumber=1;this.lastIndex=0},comments:function(){while(this.comment());},comment:function(){return this.whitespaces()},whitespaces:function(){if(Grammar.Whitespaces.parse(this)){if(!this.xml)this.lines(this.result[1]);return true}return false},lines:function(string){this.lineNumber+=string.match(Grammar.Break)},"double":function(){this.comments();if(Grammar.double.parse(this)){this.value=parseFloat(this.result[1]);return true}if(Grammar.Inf.parse(this)){this.value=Number.POSITIVE_INFINITY;return true}if(Grammar.NegativeInf.parse(this)){this.value=Number.NEGATIVE_INFINITY;return true}if(Grammar.NaN.parse(this)){this.value=Number.NaN;return true}return false},int32:function(){this.comments();if(Grammar.int32.parse(this)){this.value=parseInt(this.result[1]);return true}return false},string:function(){this.comments();if(Grammar.string.parse(this)){this.value=SFString.unescape(this.result[1]);if(!this.xml)this.lines(this.value);return true}return false},sfboolValue:function(field){if(this.xml){if(Grammar.true.parse(this)){field.set(true);return true}if(Grammar.false.parse(this)){field.set(false);return true}}else{if(Grammar.TRUE.parse(this)){field.set(true);return true}if(Grammar.FALSE.parse(this)){field.set(false);return true}}return false},mfboolValue:function(field){return false},mfboolValues:function(field){field.length=0;var array=field.getValue(),value=new SFBool;while(this.sfboolValue(value)){value.addParent(field);array.push(value);value=new SFBool}},sfcolorValue:function(field){if(this.double()){var r=this.value;if(this.double()){var g=this.value;if(this.double()){var b=this.value;field.getValue().set(r,g,b);return true}}}return false},mfcolorValue:function(field){return false},mfcolorValues:function(field){field.length=0;var array=field.getValue(),value=new SFColor;while(this.sfcolorValue(value)){value.addParent(field);array.push(value);value=new SFColor}},sfcolorrgbaValue:function(field){if(this.double()){var r=this.value;if(this.double()){var g=this.value;if(this.double()){var b=this.value;if(this.double()){var a=this.value;field.getValue().set(r,g,b,a);return true}}}}return false},mfcolorrgbaValue:function(field){return false},mfcolorrgbaValues:function(field){field.length=0;var array=field.getValue(),value=new SFColorRGBA;while(this.sfcolorrgbaValue(value)){value.addParent(field);array.push(value);value=new SFColorRGBA}},sfdoubleValue:function(field){if(this.double()){field.set(this.value);return true}return false},mfdoubleValue:function(field){return false},mfdoubleValues:function(field){field.length=0;var array=field.getValue(),value=new SFDouble;while(this.sfdoubleValue(value)){value.addParent(field);array.push(value);value=new SFDouble}},sffloatValue:function(field){return this.sfdoubleValue(field)},mffloatValue:function(field){return false},mffloatValues:function(field){field.length=0;var array=field.getValue(),value=new SFFloat;while(this.sffloatValue(value)){value.addParent(field);array.push(value);value=new SFFloat}},sfimageValue:function(field){if(this.int32()){var width=this.value;if(this.int32()){var height=this.value;if(this.int32()){var comp=this.value,array=[],size=width*height;for(var i=0;i<size;++i){if(this.int32()){array.push(this.value);continue}return false}field.getValue().set(width,height,comp,array);return true}}}return false},mfimageValue:function(field){return false},mfimageValues:function(field){field.length=0;var array=field.getValue(),value=new SFImage;while(this.sfimageValue(value)){value.addParent(field);array.push(value);value=new SFImage}},sfint32Value:function(field){if(this.int32()){field.set(this.value);return true}return false},mfint32Value:function(field){return false},mfint32Values:function(field){field.length=0;var array=field.getValue(),value=new SFInt32;while(this.sfint32Value(value)){value.addParent(field);array.push(value);value=new SFInt32}},sfmatrix3dValue:function(field){if(this.double()){var m00=this.value;if(this.double()){var m01=this.value;if(this.double()){var m02=this.value;if(this.double()){var m10=this.value;if(this.double()){var m11=this.value;if(this.double()){var m12=this.value;if(this.double()){var m20=this.value;if(this.double()){var m21=this.value;if(this.double()){var m22=this.value;field.getValue().set(m00,m01,m02,m10,m11,m12,m20,m21,m22);return true}}}}}}}}}return false},mfmatrix3dValue:function(field){return false},mfmatrix3dValues:function(field){field.length=0;var array=field.getValue(),value=new SFMatrix3d;while(this.sfmatrix3dValue(value)){value.addParent(field);array.push(value);value=new SFMatrix3d}},sfmatrix3fValue:function(field){return this.sfmatrix3dValue(field)},mfmatrix3fValue:function(field){return false},mfmatrix3fValues:function(field){field.length=0;var array=field.getValue(),value=new SFMatrix3f;while(this.sfmatrix3fValue(value)){value.addParent(field);array.push(value);value=new SFMatrix3f}},sfmatrix4dValue:function(field){if(this.double()){var m00=this.value;if(this.double()){var m01=this.value;if(this.double()){var m02=this.value;if(this.double()){var m03=this.value;if(this.double()){var m10=this.value;if(this.double()){var m11=this.value;if(this.double()){var m12=this.value;if(this.double()){var m13=this.value;if(this.double()){var m20=this.value;if(this.double()){var m21=this.value;if(this.double()){var m22=this.value;if(this.double()){var m23=this.value;if(this.double()){var m30=this.value;if(this.double()){var m31=this.value;if(this.double()){var m32=this.value;if(this.double()){var m33=this.value;field.getValue().set(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);return true}}}}}}}}}}}}}}}}return false},mfmatrix4dValue:function(field){return false},mfmatrix4dValues:function(field){field.length=0;var array=field.getValue(),value=new SFMatrix4d;while(this.sfmatrix4dValue(value)){value.addParent(field);array.push(value);value=new SFMatrix4d}},sfmatrix4fValue:function(field){return this.sfmatrix4dValue(field)},mfmatrix4fValue:function(field){return false},mfmatrix4fValues:function(field){field.length=0;var array=field.getValue(),value=new SFMatrix4f;while(this.sfmatrix4fValue(value)){value.addParent(field);array.push(value);value=new SFMatrix4f}},sfrotationValue:function(field){if(this.double()){var x=this.value;if(this.double()){var y=this.value;if(this.double()){var z=this.value;if(this.double()){var angle=this.value;field.getValue().set(x,y,z,angle);return true}}}}return false},mfrotationValue:function(field){return false},mfrotationValues:function(field){field.length=0;var array=field.getValue(),value=new SFRotation;while(this.sfrotationValue(value)){value.addParent(field);array.push(value);value=new SFRotation}},sfstringValue:function(field){if(this.string()){field.set(this.value);return true}return false},mfstringValue:function(field){return false},mfstringValues:function(field){field.length=0;var array=field.getValue(),value=new SFString;while(this.sfstringValue(value)){value.addParent(field);array.push(value);value=new SFString}},sftimeValue:function(field){return this.sfdoubleValue(field)},mftimeValue:function(field){return false},mftimeValues:function(field){field.length=0;var array=field.getValue(),value=new SFTime;while(this.sftimeValue(value)){value.addParent(field);array.push(value);value=new SFTime}},sfvec2dValue:function(field){if(this.double()){var x=this.value;if(this.double()){var y=this.value;field.getValue().set(x,y);return true}}return false},mfvec2dValue:function(field){return false},mfvec2dValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec2d;while(this.sfvec2dValue(value)){value.addParent(field);array.push(value);value=new SFVec2d}},sfvec2fValue:function(field){return this.sfvec2dValue(field)},mfvec2fValue:function(field){return false},mfvec2fValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec2f;while(this.sfvec2fValue(value)){value.addParent(field);array.push(value);value=new SFVec2f}},sfvec3dValue:function(field){if(this.double()){var x=this.value;if(this.double()){var y=this.value;if(this.double()){var z=this.value;field.getValue().set(x,y,z);return true}}}return false},mfvec3dValue:function(field){return false},mfvec3dValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec3d;while(this.sfvec3dValue(value)){value.addParent(field);array.push(value);value=new SFVec3d}},sfvec3fValue:function(field){return this.sfvec3dValue(field)},mfvec3fValue:function(field){return false},mfvec3fValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec3f;while(this.sfvec3fValue(value)){value.addParent(field);array.push(value);value=new SFVec3f}},sfvec4dValue:function(field){if(this.double()){var x=this.value;if(this.double()){var y=this.value;if(this.double()){var z=this.value;if(this.double()){var w=this.value;field.getValue().set(x,y,z);return true}}}}return false},mfvec4dValue:function(field){return false},mfvec4dValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec4d;while(this.sfvec4dValue(value)){value.addParent(field);array.push(value);value=new SFVec4d}},sfvec4fValue:function(field){return this.sfvec4dValue(field)},mfvec4fValue:function(field){field.length=0;if(this.sfvec4fValue(this.SFVec4f)){field.push(this.SFVec4f);return true}if(Grammar.OpenBracket.parse(this)){this.sfvec4fValues(field);this.comments();if(Grammar.CloseBracket.parse(this))return true;throw Error("Expected ']'.",this.scene.getWorldURL(),this.lineNumber)}return false},mfvec4fValues:function(field){field.length=0;var array=field.getValue(),value=new SFVec4f;while(this.sfvec4Value(value)){value.addParent(field);array.push(value);value=new SFVec4f}}};return Parser}});define("cobweb/Prototype/ExternProtoDeclarationArray",["jquery"],function($){var handler={get:function(target,key){if(key in target)return target[key];if(parseInt(key)==key)return target.array[key];return target.index[key]},set:function(target,key,value){var X3DExternProtoDeclaration=require("cobweb/Prototype/X3DExternProtoDeclaration");if(value instanceof X3DExternProtoDeclaration){target.array[key]=value;target.index={};for(var i=0;i<target.array.length;++i){var proto=target.array[i];target.index[proto.getName()]=proto}return true}return false}};function ExternProtoDeclarationArray(){this.array=[];this.index={};return new Proxy(this,handler)}$.extend(ExternProtoDeclarationArray.prototype,{constructor:ExternProtoDeclarationArray,push:function(value){var X3DExternProtoDeclaration=require("cobweb/Prototype/X3DExternProtoDeclaration");if(value instanceof X3DExternProtoDeclaration){this.index[value.getName()]=value;return this.array.push(value)}return this.array.length}});return ExternProtoDeclarationArray});define("cobweb/Prototype/ProtoDeclarationArray",["jquery"],function($){var handler={get:function(target,key){if(key in target)return target[key];if(parseInt(key)==key)return target.array[key];return target.index[key]},set:function(target,key,value){var X3DProtoDeclaration=require("cobweb/Prototype/X3DProtoDeclaration");if(value instanceof X3DProtoDeclaration){target.array[key]=value;target.index={};for(var i=0;i<target.array.length;++i){var proto=target.array[i];target.index[proto.getName()]=proto}return true}return false}};function ProtoDeclarationArray(){this.array=[];this.index={};return new Proxy(this,handler)}$.extend(ProtoDeclarationArray.prototype,{constructor:ProtoDeclarationArray,push:function(value){var X3DProtoDeclaration=require("cobweb/Prototype/X3DProtoDeclaration");if(value instanceof X3DProtoDeclaration){this.index[value.getName()]=value;return this.array.push(value)}return this.array.length}});return ProtoDeclarationArray});define("cobweb/Routing/RouteArray",["jquery"],function($){var handler={get:function(target,key){if(key in target)return target[key];return target.array[key]},set:function(target,key,value){return false}};function RouteArray(){this.array=[];return new Proxy(this,handler)}$.extend(RouteArray.prototype,{constructor:RouteArray,getValue:function(){return this.array}});return RouteArray});define("cobweb/Routing/X3DRoute",["jquery","cobweb/Basic/X3DBaseNode"],function($,X3DBaseNode){function X3DRoute(sourceNode,sourceField,destinationNode,destinationField){this.sourceNode_=sourceNode;this.sourceField_=sourceField;this.destinationNode_=destinationNode;this.destinationField_=destinationField;sourceField.addFieldInterest(destinationField)}X3DRoute.prototype={toString:function(){return Object.prototype.toString(this)}};Object.defineProperty(X3DRoute.prototype,"sourceNode",{get:function(){return this.sourceNode_},enumerable:true,configurable:false});Object.defineProperty(X3DRoute.prototype,"sourceField",{get:function(){return this.sourceField_.getName()},enumerable:true,configurable:false});Object.defineProperty(X3DRoute.prototype,"destinationNode",{get:function(){return this.destinationNode_},enumerable:true,configurable:false});Object.defineProperty(X3DRoute.prototype,"destinationField",{get:function(){return this.destinationField_.getName()},enumerable:true,configurable:false});return X3DRoute});define("cobweb/Execution/X3DExecutionContext",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Basic/X3DBaseNode","cobweb/Prototype/ExternProtoDeclarationArray","cobweb/Prototype/ProtoDeclarationArray","cobweb/Routing/RouteArray","cobweb/Routing/X3DRoute","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Networking/URI"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DBaseNode,ExternProtoDeclarationArray,ProtoDeclarationArray,RouteArray,X3DRoute,X3DCast,X3DConstants,URI){with(Fields){function X3DExecutionContext(browser,executionContext){X3DBaseNode.call(this,browser,executionContext);this.addChildren("rootNodes",new MFNode);this.url=new URI(window.location);this.uninitializedNodes=[];this.namedNodes={};this.protos=new ProtoDeclarationArray;this.externprotos=new ExternProtoDeclarationArray;this.routes=new RouteArray;this.routeIndex={};this.endUpdate()}X3DExecutionContext.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:X3DExecutionContext,setup:function(){X3DBaseNode.prototype.setup.call(this);for(var i=0;i<this.uninitializedNodes.length;++i)this.uninitializedNodes[i].setup();this.uninitializedNodes.length=0},isRootContext:function(){return false},setWorldURL:function(url){this.url=url},getWorldURL:function(){return this.url},createNode:function(typeName,parser){var node=new(this.getBrowser().supportedNodes[typeName])(this);if(parser)return node;node.setup();return new SFNode(node)},createProto:function(name,parser){var executionContext=this;for(;;){var proto=executionContext.protos[name];if(proto)return proto.createInstance(parser);var externproto=executionContext.externprotos[name];if(externproto)return externproto.createInstance(parser);if(executionContext.isRootContext())break;executionContext=executionContext.getExecutionContext()}throw new Error("Unknown proto or externproto type '"+name+"'.")},addUninitializedNode:function(node){this.uninitializedNodes.push(node)},addNamedNode:function(name,node){if(this.namedNodes[name]!==undefined)throw Error("Couldn't add named node: node name '"+name+"' is already in use.");this.updateNamedNode(name,node)},updateNamedNode:function(name,node){name=String(name);if(node instanceof X3DBaseNode)node=new SFNode(node);if(!(node instanceof SFNode))throw Error("Couldn't update named node: node must be of type SFNode.");if(!node.getValue())throw Error("Couldn't update named node: node IS NULL.");if(node.getValue().getExecutionContext()!==this)throw Error("Couldn't update named node: the node does not belong to this execution context.");if(name.length===0)throw Error("Couldn't update named node: node name is empty.");this.removeNamedNode(node.getValue().getName());this.removeNamedNode(name);node.getValue().setName(name);this.namedNodes[name]=new SFNode(node.getValue())},removeNamedNode:function(name){delete this.namedNodes[name]},getNamedNode:function(name){var node=this.namedNodes[name];if(node!==undefined)return node;throw Error("Named node '"+name+"' not found.")},setRootNodes:function(){},getRootNodes:function(){return this.rootNodes_},addRoute:function(sourceNode,fromField,destinationNode,toField){try{if(!sourceNode.getValue())throw new Error("Bad ROUTE specification: sourceNode is NULL.");if(!destinationNode.getValue())throw new Error("Bad ROUTE specification: destinationNode is NULL.");var sourceField=sourceNode.getValue().getField(fromField),destinationField=destinationNode.getValue().getField(toField);if(!sourceField.isOutput())throw new Error("Bad ROUTE specification: Field named '"+sourceField.getName()+"' in node named '"+sourceNode.getNodeName()+"' of type "+sourceNode.getNodeTypeName()+" is not an output field.");if(!destinationField.isInput())throw new Error("Bad ROUTE specification: Field named '"+destinationField.getName()+"' in node named '"+destinationNode.getName()+"' of type "+destinationNode.getNodeTypeName()+" is not an input field.");var id=sourceField.getId()+"."+destinationField.getId(),route=new X3DRoute(sourceNode,sourceField,destinationNode,destinationField);this.routes.getValue().push(route);this.routeIndex[id]=route;return route}catch(error){throw new Error("Bad ROUTE specification: "+error.message)}},deleteRoute:function(route){try{var sourceField=route.sourceField_,destinationField=route.destinationField_,id=sourceField.getId()+"."+destinationField.getId(),index=this.routes.getValue().indexOf(route);if(index!==-1)this.routes.getValue().splice(index,1);delete this.routeIndex[id]}catch(error){console.log(error)}},getRoute:function(sourceNode,fromField,destinationNode,toField){if(!sourceNode.getValue())throw new Error("Bad ROUTE specification: sourceNode is NULL.");if(!destinationNode.getValue())throw new Error("Bad ROUTE specification: destinationNode is NULL.");var sourceField=sourceNode.getValue().getField(fromField),destinationField=destinationNode.getValue().getField(toField),id=sourceField.getId()+"."+destinationField.getId();return this.routeIndex[id]},changeViewpoint:function(name){try{var namedNode=this.getNamedNode(name),viewpoint=X3DCast(X3DConstants.X3DViewpointNode,namedNode);if(!viewpoint)throw Error("Node named '"+name+"' is not a viewpoint node.");if(viewpoint.isBound_.getValue())viewpoint.transitionStart(null,viewpoint);else viewpoint.set_bind_=true}catch(error){if(!this.isRootContext())this.getExecutionContext().changeViewpoint(name);else throw error}}});Object.defineProperty(X3DExecutionContext.prototype,"worldURL",{get:function(){return this.url.location},enumerable:true,configurable:false});Object.defineProperty(X3DExecutionContext.prototype,"rootNodes",{get:function(){return this.getRootNodes()},set:function(value){this.setRootNodes(value)},enumerable:true,configurable:false});return X3DExecutionContext}});define("cobweb/Components/Core/X3DPrototypeInstance",["jquery","cobweb/Basic/FieldDefinitionArray","cobweb/Fields","cobweb/Components/Core/X3DNode","cobweb/Execution/X3DExecutionContext","cobweb/Bits/X3DConstants"],function($,FieldDefinitionArray,Fields,X3DNode,X3DExecutionContext,X3DConstants){with(Fields){function X3DPrototypeInstance(executionContext,protoNode){this.protoNode=protoNode;this.fieldDefinitions=new FieldDefinitionArray(protoNode.getFieldDefinitions().getValue().slice(0));this.addChildren("isLiveX3DPrototypeInstance",new SFBool(true));X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DExecutionContext.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.X3DPrototypeInstance);this.getRootNodes().setAccessType(X3DConstants.initializeOnly);if(protoNode.isExternProto())protoNode.requestAsyncLoad(this.construct.bind(this));else this.construct(protoNode)}X3DPrototypeInstance.prototype=$.extend(Object.create(X3DExecutionContext.prototype),X3DNode.prototype,{constructor:X3DPrototypeInstance,create:function(executionContext){return new X3DPrototypeInstance(executionContext,this.protoNode)},getTypeName:function(){return this.protoNode.getName()},getComponentName:function(){return"Core"},getContainerField:function(){return"children"},construct:function(proto){this.proto=proto;if(proto){if(this.protoNode.isExternProto()){var fieldDefinitions=proto.getFieldDefinitions();for(var i=0,length=fieldDefinitions.length;i<length;++i){try{var fieldDefinition=fieldDefinitions[i],protoField=proto.getField(fieldDefinition.name);var field=this.getField(fieldDefinition.name);if(field.getAccessType()!==protoField.getAccessType())continue;if(field.getType()!==protoField.getType())continue;if(!(field.getAccessType()&X3DConstants.initializeOnly))continue;if(field.getFieldValue()===true)continue;if(field.hasReferences())continue;field.set(protoField.getValue())}catch(error){this.addField(fieldDefinition)}}}this.setWorldURL(proto.getWorldURL());this.metadata_=proto.metadata_;for(var i=0,length=proto.externprotos.length;i<length;++i)this.externprotos.push(proto.externprotos[i]);for(var i=0,length=proto.protos.length;i<length;++i)this.protos.push(proto.protos[i]);var rootNodes1=proto.getRootNodes().getValue(),rootNodes2=this.getRootNodes().getValue();for(var i=0,length=rootNodes1.length;i<length;++i){var value=rootNodes1[i].copy(this);value.addParent(this.getRootNodes());rootNodes2.push(value)}}},setup:function(){X3DNode.prototype.setup.call(this);X3DExecutionContext.prototype.setup.call(this)},initialize:function(){if(this.proto){var routes=this.proto.routes;for(var i=0,length=routes.length;i<length;++i){try{var route=routes[i];this.addRoute(this.getNamedNode(route.sourceNode.getNodeName()),route.sourceField,this.getNamedNode(route.destinationNode.getNodeName()),route.destinationField)}catch(error){console.log(error.message)}}}this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.set_live__();X3DExecutionContext.prototype.initialize.call(this);X3DNode.prototype.initialize.call(this)},getExtendedEventHandling:function(){return false},isLive:function(){return this.isLiveX3DPrototypeInstance_},getInnerNode:function(){var rootNodes=this.getRootNodes();if(rootNodes.length){var rootNode=rootNodes[0];if(rootNode)return rootNode.getValue().getInnerNode()}throw new Error("Root node not available.")},set_live__:function(){var live=this.getExecutionContext().isLive().getValue()&&X3DNode.prototype.isLive.call(this).getValue();if(live)this.beginUpdate();else this.endUpdate()}});return X3DPrototypeInstance}});define("cobweb/Prototype/X3DProtoDeclarationNode",["jquery","cobweb/Fields","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DPrototypeInstance","cobweb/Bits/X3DConstants"],function($,Fields,X3DNode,X3DPrototypeInstance,X3DConstants){function X3DProtoDeclarationNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DProtoDeclarationNode)}X3DProtoDeclarationNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DProtoDeclarationNode,hasUserDefinedFields:function(){return true},createInstance:function(parser){var instance=new X3DPrototypeInstance(this.getExecutionContext(),this);if(parser)return instance;instance.setup();return new Fields.SFNode(instance)}});return X3DProtoDeclarationNode});define("cobweb/Prototype/X3DExternProtoDeclaration",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Networking/X3DUrlObject","cobweb/Prototype/X3DProtoDeclarationNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DUrlObject,X3DProtoDeclarationNode,X3DConstants){with(Fields){var fieldDefinitions=[new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode)];function X3DExternProtoDeclaration(executionContext){this.fieldDefinitions=new FieldDefinitionArray(fieldDefinitions.slice(0));X3DProtoDeclarationNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.X3DExternProtoDeclaration);this.addChildren("url",new MFString);this.callbacks=[]}X3DExternProtoDeclaration.prototype=$.extend(Object.create(X3DProtoDeclarationNode.prototype),X3DUrlObject.prototype,{constructor:X3DExternProtoDeclaration,getTypeName:function(){return"EXTERNPROTO"},initialize:function(){X3DProtoDeclarationNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this)},isExternProto:function(){return true},requestAsyncLoad:function(callback){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.FAILED_STATE){callback(this.getProto());
return}this.callbacks.push(callback);if(!this.inlineNode){var Inline=require("cobweb/Components/Networking/Inline");this.inlineNode=new Inline(this.getExecutionContext());this.inlineNode.url_=this.url_;this.inlineNode.loadState_.addInterest(this,"set_loadState__");this.inlineNode.setup();this.getExecutionContext().getScene().addLoadCount(this)}},set_loadState__:function(field){var loadState=field.getValue();switch(loadState){case X3DConstants.NOT_STARTED_STATE:case X3DConstants.IN_PROGRESS_STATE:this.setLoadState(loadState);break;case X3DConstants.COMPLETE_STATE:case X3DConstants.FAILED_STATE:{this.setLoadState(loadState);this.getExecutionContext().getScene().removeLoadCount(this);var proto=this.getProto();for(var i=0;i<this.callbacks.length;++i)this.callbacks[i](proto);this.callbacks.length=0;break}}},getProto:function(){var name=this.inlineNode.getScene().getWorldURL().fragment||this.getName(),proto=this.inlineNode.getScene().protos[name];return proto||null}});return X3DExternProtoDeclaration}});define("cobweb/Prototype/X3DProtoDeclaration",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Execution/X3DExecutionContext","cobweb/Prototype/X3DProtoDeclarationNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DExecutionContext,X3DProtoDeclarationNode,X3DConstants){with(Fields){var fieldDefinitions=[new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode)];function X3DProtoDeclaration(executionContext){this.fieldDefinitions=new FieldDefinitionArray(fieldDefinitions.slice(0));X3DProtoDeclarationNode.call(this,executionContext.getBrowser(),executionContext);X3DExecutionContext.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.X3DProtoDeclaration)}X3DProtoDeclaration.prototype=$.extend(Object.create(X3DExecutionContext.prototype),X3DProtoDeclarationNode.prototype,{constructor:X3DProtoDeclaration,getTypeName:function(){return"PROTO"},isExternProto:function(){return false},getWorldURL:function(){return this.getExecutionContext().getWorldURL()}});return X3DProtoDeclaration}});define("cobweb/Parser/XMLParser",["jquery","cobweb/Basic/X3DField","cobweb/Basic/X3DArrayField","cobweb/Fields","cobweb/Parser/Parser","cobweb/Prototype/X3DExternProtoDeclaration","cobweb/Prototype/X3DProtoDeclaration","cobweb/Bits/X3DConstants"],function($,X3DField,X3DArrayField,Fields,Parser,X3DExternProtoDeclaration,X3DProtoDeclaration,X3DConstants){with(Fields){var AccessType={initializeOnly:X3DConstants.initializeOnly,inputOnly:X3DConstants.inputOnly,outputOnly:X3DConstants.outputOnly,inputOutput:X3DConstants.inputOutput};function XMLParser(scene,xml){this.xml=xml;this.executionContexts=[scene];this.protoDeclarations=[];this.parents=[];this.parser=new Parser(this.scene,"",true);this.url=new MFString}XMLParser.prototype={constructor:XMLParser,getExecutionContext:function(){return this.executionContexts[this.executionContexts.length-1]},pushExecutionContext:function(executionContext){return this.executionContexts.push(executionContext)},popExecutionContext:function(){this.executionContexts.pop()},getParent:function(){return this.parents[this.parents.length-1]},pushParent:function(parent){return this.parents.push(parent)},popParent:function(){this.parents.pop()},parseIntoScene:function(){var t0=performance.now();switch(this.xml.nodeName){case"#document":{var x3d=$(this.xml).children("X3D");if(x3d.length){for(var i=0;i<x3d.length;++i)this.x3d(x3d[i])}else this.scene(this.xml);break}case"X3D":this.x3d(this.xml);break;case"Scene":this.scene(this.xml);break;default:this.statement(this.xml);break}},x3d:function(x3d){var childNodes=x3d.childNodes;for(var i=0;i<childNodes.length;++i){var element=childNodes[i];switch(element.nodeName){case"Scene":this.scene(element);continue}}},scene:function(element){this.statements(element.childNodes)},statements:function(childNodes){for(var i=0;i<childNodes.length;++i)this.statement(childNodes[i])},statement:function(child){switch(child.nodeName){case"#comment":case"#text":case"#cdata-section":return;case"ExternProtoDeclare":this.externProtoDeclare(child);return;case"ProtoDeclare":this.protoDeclare(child);return;case"ProtoInstance":this.protoInstance(child);return;case"ROUTE":this.route(child);return;default:this.node(child);return}},node:function(element){try{if(this.USE(element))return;var node=this.getExecutionContext().createNode(element.nodeName,true);this.DEF(element,node);this.addNode(element,node);this.pushParent(node);this.attributes(element.attributes,node);this.children(element.childNodes,false);this.getExecutionContext().addUninitializedNode(node);this.popParent()}catch(error){console.warn("XML Parser Error: Unknown node type '"+element.nodeName+"'.")}},protoInstance:function(element){try{if(this.USE(element))return;var name=element.getAttribute("name");if(this.id(name)){var node=this.getExecutionContext().createProto(name,true);this.DEF(element,node);this.addNode(element,node);this.pushParent(node);this.children(element.childNodes,true);this.getExecutionContext().addUninitializedNode(node);this.popParent()}}catch(error){console.warn("XML Parser Error: ",error.message)}},children:function(childNodes,protoInstance){for(var i=0;i<childNodes.length;++i)this.child(childNodes[i],protoInstance)},child:function(child,protoInstance){switch(child.nodeName){case"#comment":case"#text":return;case"#cdata-section":this.cdata(child);return;case"IS":this.IS(child);return;case"field":this.field(child);return;case"fieldValue":if(protoInstance)this.fieldValue(child);return;case"ExternProtoDeclare":this.externProtoDeclare(child);return;case"ProtoDeclare":this.protoDeclare(child);return;case"ProtoInstance":this.protoInstance(child);return;case"ROUTE":this.route(child);return;default:this.node(child);return}},DEF:function(element,node){try{var name=element.getAttribute("DEF");if(name)this.getExecutionContext().updateNamedNode(name,node)}catch(error){console.warn("Invalid DEF name: "+error.message)}},USE:function(element){try{var name=element.getAttribute("USE");if(this.id(name)){var node=this.getExecutionContext().getNamedNode(name);this.addNode(element,node.getValue());return true}}catch(error){console.warn("Invalid USE name: "+error.message)}return false},addNode:function(element,node){if(this.parents.length){var parent=this.getParent();if(parent instanceof X3DField){if(parent.getFieldValue()===false)parent.setFieldValue(true);if(parent.getType()===X3DConstants.SFNode)parent.set(node);if(parent.getType()===X3DConstants.MFNode)parent.push(node)}else{try{var containerField=element.getAttribute("containerField");if(containerField){var field=parent.getField(containerField);if(field.getType()===X3DConstants.SFNode)return field.set(node);if(field.getType()===X3DConstants.MFNode)return field.push(node)}}catch(error){}try{var field=parent.getField(node.getContainerField());if(field.getType()===X3DConstants.SFNode)return field.set(node);if(field.getType()===X3DConstants.MFNode)return field.push(node)}catch(error){}}}else this.getExecutionContext().rootNodes.push(node)},attributes:function(attributes,node){for(var i=0;i<attributes.length;++i)this.attribute(attributes[i],node)},attribute:function(attribute,node){try{var name=attribute.name,value=attribute.value,field=node.getField(name),fieldType=this.fieldTypes[field.getType()];this.parser.setInput(value);fieldType.call(this.parser,field)}catch(error){}},cdata:function(element){var node=this.getParent(),field=node.getCDATA();if(field)field.push(element.data)},field:function(element){var node=this.getParent();if(!node.hasUserDefinedFields())return;var accessType=AccessType[element.getAttribute("accessType")];if(accessType===undefined)accessType=X3DConstants.initializeOnly;var type=Fields[element.getAttribute("type")];if(type===undefined)return;var name=element.getAttribute("name");if(!this.id(name))return;var field=new type;if(accessType&X3DConstants.initializeOnly){var value=element.getAttribute("value");if(value!==null){this.parser.setInput(value);this.fieldTypes[field.getType()].call(this.parser,field);field.setFieldValue(true)}this.pushParent(field);this.statements(element.childNodes);this.popParent()}node.addUserDefinedField(accessType,name,field)},fieldValue:function(element){try{var node=this.getParent(),name=element.getAttribute("name");if(!this.id(name))return;var field=node.getField(name),accessType=field.getAccessType();if(accessType&X3DConstants.initializeOnly){var value=element.getAttribute("value");if(value!==null){this.parser.setInput(value);this.fieldTypes[field.getType()].call(this.parser,field);field.setFieldValue(true)}else field.setFieldValue(false);this.pushParent(field);this.statements(element.childNodes);this.popParent()}}catch(error){console.warn("XML Parser Error: Couldn't assign field value: "+error.message)}},IS:function(element){if(this.getExecutionContext()instanceof X3DProtoDeclaration){var childNodes=element.childNodes;for(var i=0;i<childNodes.length;++i){var child=childNodes[i];switch(child.nodeName){case"CONNECT":case"connect":this.connect(child);continue}}}},connect:function(element){var nodeFieldName=element.getAttribute("nodeField"),protoFieldName=element.getAttribute("protoField");if(!nodeFieldName||!protoFieldName)return;try{var node=this.getParent(),proto=this.getExecutionContext(),nodeField=node.getField(nodeFieldName),protoField=proto.getField(protoFieldName);if(nodeField.getAccessType()===protoField.getAccessType()||nodeField.getAccessType()===X3DConstants.inputOutput){if(nodeField.getType()===protoField.getType())nodeField.addReference(protoField);else throw new Error("Field types do not match.")}else throw new Error("Field access types do not match.")}catch(error){console.warn("Couldn't create IS reference: "+error.message)}},externProtoDeclare:function(element){var name=element.getAttribute("name");if(this.id(name)){var url=element.getAttribute("url");if(url!==null){this.parser.setInput(url);Parser.prototype.mfstringValues.call(this.parser,this.url)}else this.url.length=0;var externproto=new X3DExternProtoDeclaration(this.getExecutionContext());this.pushParent(externproto);this.protoInterface(element);this.popParent();externproto.setName(name);externproto.url_=this.url;externproto.setup();this.getExecutionContext().externprotos.push(externproto)}},protoDeclare:function(element){var name=element.getAttribute("name");if(this.id(name)){var proto=new X3DProtoDeclaration(this.getExecutionContext()),childNodes=element.childNodes;for(var i=0;i<childNodes.length;++i){var child=childNodes[i];switch(child.nodeName){case"ProtoInterface":this.pushParent(proto);this.protoInterface(child);this.popParent();continue;case"ProtoBody":this.pushExecutionContext(proto);this.protoBody(child);this.popExecutionContext();continue}}proto.setName(name);proto.setup();this.getExecutionContext().protos.push(proto)}},protoInterface:function(element){var childNodes=element.childNodes;for(var i=0;i<childNodes.length;++i){var child=childNodes[i];switch(child.nodeName){case"FIELD":case"field":this.field(child);continue}}},protoBody:function(element){this.statements(element.childNodes)},route:function(element){var fromNode=element.getAttribute("fromNode"),fromField=element.getAttribute("fromField"),toNode=element.getAttribute("toNode"),toField=element.getAttribute("toField");try{var sourceNode=this.getExecutionContext().getNamedNode(fromNode),destinationNode=this.getExecutionContext().getNamedNode(toNode);this.getExecutionContext().addRoute(sourceNode,fromField,destinationNode,toField)}catch(error){console.warn("XML Parser Error: "+error.message)}},id:function(string){if(string){return true}return false}};XMLParser.prototype.fieldTypes=[];XMLParser.prototype.fieldTypes[X3DConstants.SFBool]=Parser.prototype.sfboolValue;XMLParser.prototype.fieldTypes[X3DConstants.SFColor]=Parser.prototype.sfcolorValue;XMLParser.prototype.fieldTypes[X3DConstants.SFColorRGBA]=Parser.prototype.sfcolorrgbaValue;XMLParser.prototype.fieldTypes[X3DConstants.SFDouble]=Parser.prototype.sfdoubleValue;XMLParser.prototype.fieldTypes[X3DConstants.SFFloat]=Parser.prototype.sffloatValue;XMLParser.prototype.fieldTypes[X3DConstants.SFImage]=Parser.prototype.sfimageValue;XMLParser.prototype.fieldTypes[X3DConstants.SFInt32]=Parser.prototype.sfint32Value;XMLParser.prototype.fieldTypes[X3DConstants.SFMatrix3f]=Parser.prototype.sfmatrix4dValue;XMLParser.prototype.fieldTypes[X3DConstants.SFMatrix3d]=Parser.prototype.sfmatrix4fValue;XMLParser.prototype.fieldTypes[X3DConstants.SFMatrix4f]=Parser.prototype.sfmatrix4dValue;XMLParser.prototype.fieldTypes[X3DConstants.SFMatrix4d]=Parser.prototype.sfmatrix4fValue;XMLParser.prototype.fieldTypes[X3DConstants.SFNode]=function(field){field.set(null)};XMLParser.prototype.fieldTypes[X3DConstants.SFRotation]=Parser.prototype.sfrotationValue;XMLParser.prototype.fieldTypes[X3DConstants.SFString]=function(field){field.set(this.input)};XMLParser.prototype.fieldTypes[X3DConstants.SFTime]=Parser.prototype.sftimeValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec2d]=Parser.prototype.sfvec2dValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec2f]=Parser.prototype.sfvec2fValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec3d]=Parser.prototype.sfvec3dValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec3f]=Parser.prototype.sfvec3fValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec4d]=Parser.prototype.sfvec4dValue;XMLParser.prototype.fieldTypes[X3DConstants.SFVec4f]=Parser.prototype.sfvec4fValue;XMLParser.prototype.fieldTypes[X3DConstants.MFBool]=Parser.prototype.mfboolValues;XMLParser.prototype.fieldTypes[X3DConstants.MFColor]=Parser.prototype.mfcolorValues;XMLParser.prototype.fieldTypes[X3DConstants.MFColorRGBA]=Parser.prototype.mfcolorrgbaValues;XMLParser.prototype.fieldTypes[X3DConstants.MFDouble]=Parser.prototype.mfdoubleValues;XMLParser.prototype.fieldTypes[X3DConstants.MFFloat]=Parser.prototype.mffloatValues;XMLParser.prototype.fieldTypes[X3DConstants.MFImage]=Parser.prototype.mfimageValues;XMLParser.prototype.fieldTypes[X3DConstants.MFInt32]=Parser.prototype.mfint32Values;XMLParser.prototype.fieldTypes[X3DConstants.MFMatrix3d]=Parser.prototype.mfmatrix3dValues;XMLParser.prototype.fieldTypes[X3DConstants.MFMatrix3f]=Parser.prototype.mfmatrix3fValues;XMLParser.prototype.fieldTypes[X3DConstants.MFMatrix4d]=Parser.prototype.mfmatrix4dValues;XMLParser.prototype.fieldTypes[X3DConstants.MFMatrix4f]=Parser.prototype.mfmatrix4fValues;XMLParser.prototype.fieldTypes[X3DConstants.MFNode]=function(){};XMLParser.prototype.fieldTypes[X3DConstants.MFRotation]=Parser.prototype.mfrotationValues;XMLParser.prototype.fieldTypes[X3DConstants.MFString]=Parser.prototype.mfstringValues;XMLParser.prototype.fieldTypes[X3DConstants.MFTime]=Parser.prototype.mftimeValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec2d]=Parser.prototype.mfvec2dValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec2f]=Parser.prototype.mfvec2fValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec3d]=Parser.prototype.mfvec3dValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec3f]=Parser.prototype.mfvec3fValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec4d]=Parser.prototype.mfvec4dValues;XMLParser.prototype.fieldTypes[X3DConstants.MFVec4f]=Parser.prototype.mfvec4fValues;return XMLParser}});define("cobweb/Debug",[],function(){return true});define("cobweb/InputOutput/Loader",["jquery","cobweb/Base/X3DObject","cobweb/Parser/XMLParser","standard/Networking/URI","cobweb/Debug"],function($,X3DObject,XMLParser,URI,DEBUG){var TIMEOUT=16;function Loader(node,external){X3DObject.call(this);this.node=node;this.browser=node.getBrowser();this.external=this.browser.isExternal()||external;this.executionContext=this.external?node.getExecutionContext():this.browser.currentScene;this.URL=new URI}Loader.prototype=$.extend(Object.create(X3DObject.prototype),{constructor:Loader,getWorldURL:function(){return this.URL},createX3DFromString:function(worldURL,string,success,error){var scene=this.browser.createScene();scene.setWorldURL(this.browser.getLocation().transform(worldURL));if(success){try{setTimeout(this.importDocument.bind(this,scene,$.parseXML(string),success,error),TIMEOUT)}catch(exception){error(exception)}}else{this.importDocument(scene,$.parseXML(string));return scene}},importDocument:function(scene,dom,success,error){try{new XMLParser(scene,dom).parseIntoScene();if(success){scene.loadCount_.addInterest(this,"setLoadCount",scene,success);scene.loadCount_.addEvent()}}catch(exception){if(error)error(exception);else throw exception}},setLoadCount:function(field,scene,success){if(field.getValue()===0)success(scene)},createX3DFromURL:function(url,callback,bindViewpoint){this.bindViewpoint=bindViewpoint;if(callback)return setTimeout(this.loadDocument.bind(this,url,this.createX3DFromURLAsync.bind(this,callback)),TIMEOUT);return this.createX3DFromURLSync(url)},createX3DFromURLAsync:function(callback,data){if(data===null)callback(null);else this.createX3DFromString(this.URL,data,callback,this.loadDocumentError.bind(this))},createX3DFromURLSync:function(url){if(url.length===0)throw new Error("No URL given.");var scene=null,success=false;for(var i=0;i<url.length;++i){this.URL=this.transform(url[i]);$.ajax({url:this.URL,dataType:"text",async:false,cache:this.browser.doCaching(),global:false,context:this,success:function(data){try{scene=this.createX3DFromString(this.URL,data);success=true}catch(error){console.log(error)}},error:function(jqXHR,textStatus,errorThrown){}});if(success)break}if(success)return scene;throw Error("Couldn't load any url of '"+url.getValue().join(", ")+"'.")},loadDocument:function(url,callback){this.url=url.copy();this.callback=callback;if(url.length===0)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift())},loadDocumentAsync:function(URL){try{if(this.bindViewpoint){var uri=new URI(URL);if(uri.filename.toString().length===0&&uri.filename.query.length===0){return this.bindViewpoint(uri.fragment)}}}catch(exception){return this.loadDocumentError(exception)}this.URL=this.transform(URL);$.ajax({url:this.URL,dataType:"text",async:true,cache:this.browser.doCaching(),global:false,context:this,success:function(data){try{this.callback(data)}catch(exception){this.loadDocumentError(exception)}},error:function(jqXHR,textStatus,exception){this.loadDocumentError(exception)}})},loadDocumentError:function(exception){if(DEBUG)console.log("In url:",this.URL.toString(),exception);else console.warn("Couldn't load URL '"+this.URL.toString()+"': "+exception.message+".");if(this.url.length)this.loadDocumentAsync(this.url.shift());else this.callback(null)},transform:function(URL){URL=this.getReferer().transform(new URI(URL));URL=URL.isLocal()?this.browser.getLocation().getRelativePath(URL):URL;return URL},getReferer:function(){if(this.node.getTypeName()==="World"){if(this.external)return this.browser.getLocation()}return this.executionContext.getWorldURL()}});return Loader});(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define("lib/opentype.js/dist/opentype.js",[],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.opentype=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){exports.argument=function(predicate,message){if(!predicate){throw new Error(message)}};exports.assert=exports.argument},{}],2:[function(require,module,exports){function line(ctx,x1,y1,x2,y2){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}exports.line=line},{}],3:[function(require,module,exports){var cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];var cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"];var cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"];var standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(font){this.font=font}DefaultEncoding.prototype.charToGlyphIndex=function(c){var code=c.charCodeAt(0);var glyphs=this.font.glyphs;if(glyphs){for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j<glyph.unicodes.length;j+=1){if(glyph.unicodes[j]===code){return i}}}}else{return null}};function CmapEncoding(cmap){this.cmap=cmap}CmapEncoding.prototype.charToGlyphIndex=function(c){return this.cmap.glyphIndexMap[c.charCodeAt(0)]||0};function CffEncoding(encoding,charset){this.encoding=encoding;this.charset=charset}CffEncoding.prototype.charToGlyphIndex=function(s){var code=s.charCodeAt(0);var charName=this.encoding[code];return this.charset.indexOf(charName)};function GlyphNames(post){var i;switch(post.version){case 1:this.names=exports.standardNames.slice();break;case 2:this.names=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]<exports.standardNames.length){this.names[i]=exports.standardNames[post.glyphNameIndex[i]]}else{this.names[i]=post.names[post.glyphNameIndex[i]-exports.standardNames.length]}}break;case 2.5:this.names=new Array(post.numberOfGlyphs);
for(i=0;i<post.numberOfGlyphs;i++){this.names[i]=exports.standardNames[i+post.glyphNameIndex[i]]}break;case 3:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(name){return this.names.indexOf(name)};GlyphNames.prototype.glyphIndexToName=function(gid){return this.names[gid]};function addGlyphNames(font){var glyph;var glyphIndexMap=font.tables.cmap.glyphIndexMap;var charCodes=Object.keys(glyphIndexMap);for(var i=0;i<charCodes.length;i+=1){var c=charCodes[i];var glyphIndex=glyphIndexMap[c];glyph=font.glyphs.get(glyphIndex);glyph.addUnicode(parseInt(c))}for(i=0;i<font.glyphs.length;i+=1){glyph=font.glyphs.get(i);if(font.cffEncoding){glyph.name=font.cffEncoding.charset[i]}else{glyph.name=font.glyphNames.glyphIndexToName(i)}}}exports.cffStandardStrings=cffStandardStrings;exports.cffStandardEncoding=cffStandardEncoding;exports.cffExpertEncoding=cffExpertEncoding;exports.standardNames=standardNames;exports.DefaultEncoding=DefaultEncoding;exports.CmapEncoding=CmapEncoding;exports.CffEncoding=CffEncoding;exports.GlyphNames=GlyphNames;exports.addGlyphNames=addGlyphNames},{}],4:[function(require,module,exports){var path=require("./path");var sfnt=require("./tables/sfnt");var encoding=require("./encoding");var glyphset=require("./glyphset");function Font(options){options=options||{};this.familyName=options.familyName||" ";this.styleName=options.styleName||" ";this.designer=options.designer||" ";this.designerURL=options.designerURL||" ";this.manufacturer=options.manufacturer||" ";this.manufacturerURL=options.manufacturerURL||" ";this.license=options.license||" ";this.licenseURL=options.licenseURL||" ";this.version=options.version||"Version 0.1";this.description=options.description||" ";this.copyright=options.copyright||" ";this.trademark=options.trademark||" ";this.unitsPerEm=options.unitsPerEm||1e3;this.ascender=options.ascender;this.descender=options.descender;this.supported=true;this.glyphs=new glyphset.GlyphSet(this,options.glyphs||[]);this.encoding=new encoding.DefaultEncoding(this);this.tables={}}Font.prototype.hasChar=function(c){return this.encoding.charToGlyphIndex(c)!==null};Font.prototype.charToGlyphIndex=function(s){return this.encoding.charToGlyphIndex(s)};Font.prototype.charToGlyph=function(c){var glyphIndex=this.charToGlyphIndex(c);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.stringToGlyphs=function(s){var glyphs=[];for(var i=0;i<s.length;i+=1){var c=s[i];glyphs.push(this.charToGlyph(c))}return glyphs};Font.prototype.nameToGlyphIndex=function(name){return this.glyphNames.nameToGlyphIndex(name)};Font.prototype.nameToGlyph=function(name){var glyphIndex=this.nametoGlyphIndex(name);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.glyphIndexToName=function(gid){if(!this.glyphNames.glyphIndexToName){return""}return this.glyphNames.glyphIndexToName(gid)};Font.prototype.getKerningValue=function(leftGlyph,rightGlyph){leftGlyph=leftGlyph.index||leftGlyph;rightGlyph=rightGlyph.index||rightGlyph;var gposKerning=this.getGposKerningValue;return gposKerning?gposKerning(leftGlyph,rightGlyph):this.kerningPairs[leftGlyph+","+rightGlyph]||0};Font.prototype.forEachGlyph=function(text,x,y,fontSize,options,callback){x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;options=options||{};var kerning=options.kerning===undefined?true:options.kerning;var fontScale=1/this.unitsPerEm*fontSize;var glyphs=this.stringToGlyphs(text);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs[i];callback(glyph,x,y,fontSize,options);if(glyph.advanceWidth){x+=glyph.advanceWidth*fontScale}if(kerning&&i<glyphs.length-1){var kerningValue=this.getKerningValue(glyph,glyphs[i+1]);x+=kerningValue*fontScale}}};Font.prototype.getPath=function(text,x,y,fontSize,options){var fullPath=new path.Path;this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){var glyphPath=glyph.getPath(gX,gY,gFontSize);fullPath.extend(glyphPath)});return fullPath};Font.prototype.draw=function(ctx,text,x,y,fontSize,options){this.getPath(text,x,y,fontSize,options).draw(ctx)};Font.prototype.drawPoints=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawPoints(ctx,gX,gY,gFontSize)})};Font.prototype.drawMetrics=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawMetrics(ctx,gX,gY,gFontSize)})};Font.prototype.validate=function(){var warnings=[];var _this=this;function assert(predicate,message){if(!predicate){warnings.push(message)}}function assertStringAttribute(attrName){assert(_this[attrName]&&_this[attrName].trim().length>0,"No "+attrName+" specified.")}assertStringAttribute("familyName");assertStringAttribute("weightName");assertStringAttribute("manufacturer");assertStringAttribute("copyright");assertStringAttribute("version");assert(this.unitsPerEm>0,"No unitsPerEm specified.")};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){var sfntTable=this.toTables();var bytes=sfntTable.encode();var buffer=new ArrayBuffer(bytes.length);var intArray=new Uint8Array(buffer);for(var i=0;i<bytes.length;i++){intArray[i]=bytes[i]}return buffer};Font.prototype.download=function(){var fileName=this.familyName.replace(/\s/g,"")+"-"+this.styleName+".otf";var buffer=this.toBuffer();window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;window.requestFileSystem(window.TEMPORARY,buffer.byteLength,function(fs){fs.root.getFile(fileName,{create:true},function(fileEntry){fileEntry.createWriter(function(writer){var dataView=new DataView(buffer);var blob=new Blob([dataView],{type:"font/opentype"});writer.write(blob);writer.addEventListener("writeend",function(){location.href=fileEntry.toURL()},false)})})},function(err){throw err})};exports.Font=Font},{"./encoding":3,"./glyphset":6,"./path":9,"./tables/sfnt":24}],5:[function(require,module,exports){var check=require("./check");var draw=require("./draw");var path=require("./path");function getPathDefinition(glyph,path){var _path=path||{commands:[]};return{configurable:true,get:function(){if(typeof _path==="function"){_path=_path()}return _path},set:function(p){_path=p}}}function Glyph(options){this.bindConstructorValues(options)}Glyph.prototype.bindConstructorValues=function(options){this.index=options.index||0;this.name=options.name||null;this.unicode=options.unicode||undefined;this.unicodes=options.unicodes||options.unicode!==undefined?[options.unicode]:[];if(options.xMin){this.xMin=options.xMin}if(options.yMin){this.yMin=options.yMin}if(options.xMax){this.xMax=options.xMax}if(options.yMax){this.yMax=options.yMax}if(options.advanceWidth){this.advanceWidth=options.advanceWidth}Object.defineProperty(this,"path",getPathDefinition(this,options.path))};Glyph.prototype.addUnicode=function(unicode){if(this.unicodes.length===0){this.unicode=unicode}this.unicodes.push(unicode)};Glyph.prototype.getPath=function(x,y,fontSize){x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;var scale=1/this.path.unitsPerEm*fontSize;var p=new path.Path;var commands=this.path.commands;for(var i=0;i<commands.length;i+=1){var cmd=commands[i];if(cmd.type==="M"){p.moveTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="L"){p.lineTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Q"){p.quadraticCurveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="C"){p.curveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x2*scale,y+-cmd.y2*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Z"){p.closePath()}}return p};Glyph.prototype.getContours=function(){if(this.points===undefined){return[]}var contours=[];var currentContour=[];for(var i=0;i<this.points.length;i+=1){var pt=this.points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours};Glyph.prototype.getMetrics=function(){var commands=this.path.commands;var xCoords=[];var yCoords=[];for(var i=0;i<commands.length;i+=1){var cmd=commands[i];if(cmd.type!=="Z"){xCoords.push(cmd.x);yCoords.push(cmd.y)}if(cmd.type==="Q"||cmd.type==="C"){xCoords.push(cmd.x1);yCoords.push(cmd.y1)}if(cmd.type==="C"){xCoords.push(cmd.x2);yCoords.push(cmd.y2)}}var metrics={xMin:Math.min.apply(null,xCoords),yMin:Math.min.apply(null,yCoords),xMax:Math.max.apply(null,xCoords),yMax:Math.max.apply(null,yCoords),leftSideBearing:0};metrics.rightSideBearing=this.advanceWidth-metrics.leftSideBearing-(metrics.xMax-metrics.xMin);return metrics};Glyph.prototype.draw=function(ctx,x,y,fontSize){this.getPath(x,y,fontSize).draw(ctx)};Glyph.prototype.drawPoints=function(ctx,x,y,fontSize){function drawCircles(l,x,y,scale){var PI_SQ=Math.PI*2;ctx.beginPath();for(var j=0;j<l.length;j+=1){ctx.moveTo(x+l[j].x*scale,y+l[j].y*scale);ctx.arc(x+l[j].x*scale,y+l[j].y*scale,2,0,PI_SQ,false)}ctx.closePath();ctx.fill()}x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;var scale=1/this.path.unitsPerEm*fontSize;var blueCircles=[];var redCircles=[];var path=this.path;for(var i=0;i<path.commands.length;i+=1){var cmd=path.commands[i];if(cmd.x!==undefined){blueCircles.push({x:cmd.x,y:-cmd.y})}if(cmd.x1!==undefined){redCircles.push({x:cmd.x1,y:-cmd.y1})}if(cmd.x2!==undefined){redCircles.push({x:cmd.x2,y:-cmd.y2})}}ctx.fillStyle="blue";drawCircles(blueCircles,x,y,scale);ctx.fillStyle="red";drawCircles(redCircles,x,y,scale)};Glyph.prototype.drawMetrics=function(ctx,x,y,fontSize){var scale;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;scale=1/this.path.unitsPerEm*fontSize;ctx.lineWidth=1;ctx.strokeStyle="black";draw.line(ctx,x,-1e4,x,1e4);draw.line(ctx,-1e4,y,1e4,y);var xMin=this.xMin||0;var yMin=this.yMin||0;var xMax=this.xMax||0;var yMax=this.yMax||0;var advanceWidth=this.advanceWidth||0;ctx.strokeStyle="blue";draw.line(ctx,x+xMin*scale,-1e4,x+xMin*scale,1e4);draw.line(ctx,x+xMax*scale,-1e4,x+xMax*scale,1e4);draw.line(ctx,-1e4,y+-yMin*scale,1e4,y+-yMin*scale);draw.line(ctx,-1e4,y+-yMax*scale,1e4,y+-yMax*scale);ctx.strokeStyle="green";draw.line(ctx,x+advanceWidth*scale,-1e4,x+advanceWidth*scale,1e4)};exports.Glyph=Glyph},{"./check":1,"./draw":2,"./path":9}],6:[function(require,module,exports){var _glyph=require("./glyph");function GlyphSet(font,glyphs){this.font=font;this.glyphs={};if(Array.isArray(glyphs)){for(var i=0;i<glyphs.length;i++){this.glyphs[i]=glyphs[i]}}this.length=glyphs&&glyphs.length||0}GlyphSet.prototype.get=function(index){if(typeof this.glyphs[index]==="function"){this.glyphs[index]=this.glyphs[index]()}return this.glyphs[index]};GlyphSet.prototype.push=function(index,loader){this.glyphs[index]=loader;this.length++};function glyphLoader(font,index){return new _glyph.Glyph({index:index,font:font})}function ttfGlyphLoader(font,index,parseGlyph,data,position,buildPath){return function(){var glyph=new _glyph.Glyph({index:index,font:font});glyph.path=function(){parseGlyph(glyph,data,position);var path=buildPath(font.glyphs,glyph);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}function cffGlyphLoader(font,index,parseCFFCharstring,charstring){return function(){var glyph=new _glyph.Glyph({index:index,font:font});glyph.path=function(){var path=parseCFFCharstring(font,glyph,charstring);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}exports.GlyphSet=GlyphSet;exports.glyphLoader=glyphLoader;exports.ttfGlyphLoader=ttfGlyphLoader;exports.cffGlyphLoader=cffGlyphLoader},{"./glyph":5}],7:[function(require,module,exports){var encoding=require("./encoding");var _font=require("./font");var glyph=require("./glyph");var parse=require("./parse");var path=require("./path");var cmap=require("./tables/cmap");var cff=require("./tables/cff");var glyf=require("./tables/glyf");var gpos=require("./tables/gpos");var head=require("./tables/head");var hhea=require("./tables/hhea");var hmtx=require("./tables/hmtx");var kern=require("./tables/kern");var loca=require("./tables/loca");var maxp=require("./tables/maxp");var _name=require("./tables/name");var os2=require("./tables/os2");var post=require("./tables/post");function toArrayBuffer(buffer){var arrayBuffer=new ArrayBuffer(buffer.length);var data=new Uint8Array(arrayBuffer);for(var i=0;i<buffer.length;i+=1){data[i]=buffer[i]}return arrayBuffer}function loadFromFile(path,callback){var fs=require("fs");fs.readFile(path,function(err,buffer){if(err){return callback(err.message)}callback(null,toArrayBuffer(buffer))})}function loadFromUrl(url,callback){var request=new XMLHttpRequest;request.open("get",url,true);request.responseType="arraybuffer";request.onload=function(){if(request.status!==200){return callback("Font could not be loaded: "+request.statusText)}return callback(null,request.response)};request.send()}function parseBuffer(buffer){var indexToLocFormat;var hmtxOffset;var glyfOffset;var locaOffset;var cffOffset;var kernOffset;var gposOffset;var font=new _font.Font;var data=new DataView(buffer,0);var version=parse.getFixed(data,0);if(version===1){font.outlinesFormat="truetype"}else{version=parse.getTag(data,0);if(version==="OTTO"){font.outlinesFormat="cff"}else{throw new Error("Unsupported OpenType version "+version)}}var numTables=parse.getUShort(data,4);var p=12;for(var i=0;i<numTables;i+=1){var tag=parse.getTag(data,p);var offset=parse.getULong(data,p+8);switch(tag){case"cmap":font.tables.cmap=cmap.parse(data,offset);font.encoding=new encoding.CmapEncoding(font.tables.cmap);break;case"head":font.tables.head=head.parse(data,offset);font.unitsPerEm=font.tables.head.unitsPerEm;indexToLocFormat=font.tables.head.indexToLocFormat;break;case"hhea":font.tables.hhea=hhea.parse(data,offset);font.ascender=font.tables.hhea.ascender;font.descender=font.tables.hhea.descender;font.numberOfHMetrics=font.tables.hhea.numberOfHMetrics;break;case"hmtx":hmtxOffset=offset;break;case"maxp":font.tables.maxp=maxp.parse(data,offset);font.numGlyphs=font.tables.maxp.numGlyphs;break;case"name":font.tables.name=_name.parse(data,offset);font.familyName=font.tables.name.fontFamily;font.styleName=font.tables.name.fontSubfamily;break;case"OS/2":font.tables.os2=os2.parse(data,offset);break;case"post":font.tables.post=post.parse(data,offset);font.glyphNames=new encoding.GlyphNames(font.tables.post);break;case"glyf":glyfOffset=offset;break;case"loca":locaOffset=offset;break;case"CFF ":cffOffset=offset;break;case"kern":kernOffset=offset;break;case"GPOS":gposOffset=offset;break}p+=16}if(glyfOffset&&locaOffset){var shortVersion=indexToLocFormat===0;var locaTable=loca.parse(data,locaOffset,font.numGlyphs,shortVersion);font.glyphs=glyf.parse(data,glyfOffset,locaTable,font);hmtx.parse(data,hmtxOffset,font.numberOfHMetrics,font.numGlyphs,font.glyphs);encoding.addGlyphNames(font)}else if(cffOffset){cff.parse(data,cffOffset,font);encoding.addGlyphNames(font)}else{throw new Error("Font doesn't contain TrueType or CFF outlines.")}if(kernOffset){font.kerningPairs=kern.parse(data,kernOffset)}else{font.kerningPairs={}}if(gposOffset){gpos.parse(data,gposOffset,font)}return font}function load(url,callback){var isNode=typeof window==="undefined";var loadFn=isNode?loadFromFile:loadFromUrl;loadFn(url,function(err,arrayBuffer){if(err){return callback(err)}var font=parseBuffer(arrayBuffer);return callback(null,font)})}function loadSync(url){var fs=require("fs");var buffer=fs.readFileSync(url);return parseBuffer(toArrayBuffer(buffer))}exports._parse=parse;exports.Font=_font.Font;exports.Glyph=glyph.Glyph;exports.Path=path.Path;exports.parse=parseBuffer;exports.load=load;exports.loadSync=loadSync},{"./encoding":3,"./font":4,"./glyph":5,"./parse":8,"./path":9,"./tables/cff":11,"./tables/cmap":12,"./tables/glyf":13,"./tables/gpos":14,"./tables/head":15,"./tables/hhea":16,"./tables/hmtx":17,"./tables/kern":18,"./tables/loca":19,"./tables/maxp":20,"./tables/name":21,"./tables/os2":22,"./tables/post":23,fs:undefined}],8:[function(require,module,exports){exports.getByte=function getByte(dataView,offset){return dataView.getUint8(offset)};exports.getCard8=exports.getByte;exports.getUShort=function(dataView,offset){return dataView.getUint16(offset,false)};exports.getCard16=exports.getUShort;exports.getShort=function(dataView,offset){return dataView.getInt16(offset,false)};exports.getULong=function(dataView,offset){return dataView.getUint32(offset,false)};exports.getFixed=function(dataView,offset){var decimal=dataView.getInt16(offset,false);var fraction=dataView.getUint16(offset+2,false);return decimal+fraction/65535};exports.getTag=function(dataView,offset){var tag="";for(var i=offset;i<offset+4;i+=1){tag+=String.fromCharCode(dataView.getInt8(i))}return tag};exports.getOffset=function(dataView,offset,offSize){var v=0;for(var i=0;i<offSize;i+=1){v<<=8;v+=dataView.getUint8(offset+i)}return v};exports.getBytes=function(dataView,startOffset,endOffset){var bytes=[];for(var i=startOffset;i<endOffset;i+=1){bytes.push(dataView.getUint8(i))}return bytes};exports.bytesToString=function(bytes){var s="";for(var i=0;i<bytes.length;i+=1){s+=String.fromCharCode(bytes[i])}return s};var typeOffsets={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(data,offset){this.data=data;this.offset=offset;this.relativeOffset=0}Parser.prototype.parseByte=function(){var v=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseChar=function(){var v=this.data.getInt8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var v=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var v=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseF2Dot14=function(){var v=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return v};Parser.prototype.parseULong=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseFixed=function(){var v=exports.getFixed(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(count){var offsets=new Array(count);var dataView=this.data;var offset=this.offset+this.relativeOffset;for(var i=0;i<count;i++){offsets[i]=exports.getUShort(dataView,offset);offset+=2}this.relativeOffset+=count*2;return offsets};Parser.prototype.parseString=function(length){var dataView=this.data;var offset=this.offset+this.relativeOffset;var string="";this.relativeOffset+=length;for(var i=0;i<length;i++){string+=String.fromCharCode(dataView.getUint8(offset+i))}return string};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return v};Parser.prototype.parseFixed=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v/65536};Parser.prototype.parseVersion=function(){var major=exports.getUShort(this.data,this.offset+this.relativeOffset);var minor=exports.getUShort(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;return major+minor/4096/10};Parser.prototype.skip=function(type,amount){if(amount===undefined){amount=1}this.relativeOffset+=typeOffsets[type]*amount};exports.Parser=Parser},{}],9:[function(require,module,exports){function Path(){this.commands=[];this.fill="black";this.stroke=null;this.strokeWidth=1}Path.prototype.moveTo=function(x,y){this.commands.push({type:"M",x:x,y:y})};Path.prototype.lineTo=function(x,y){this.commands.push({type:"L",x:x,y:y})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(x1,y1,x2,y2,x,y){this.commands.push({type:"C",x1:x1,y1:y1,x2:x2,y2:y2,x:x,y:y})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(x1,y1,x,y){this.commands.push({type:"Q",x1:x1,y1:y1,x:x,y:y})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})};Path.prototype.extend=function(pathOrCommands){if(pathOrCommands.commands){pathOrCommands=pathOrCommands.commands}Array.prototype.push.apply(this.commands,pathOrCommands)};Path.prototype.draw=function(ctx){ctx.beginPath();for(var i=0;i<this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type==="M"){ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type==="L"){ctx.lineTo(cmd.x,cmd.y)}else if(cmd.type==="C"){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){ctx.closePath()}}if(this.fill){ctx.fillStyle=this.fill;ctx.fill()}if(this.stroke){ctx.strokeStyle=this.stroke;ctx.lineWidth=this.strokeWidth;ctx.stroke()}};Path.prototype.toPathData=function(decimalPlaces){decimalPlaces=decimalPlaces!==undefined?decimalPlaces:2;function floatToString(v){if(Math.round(v)===v){return""+Math.round(v)}else{return v.toFixed(decimalPlaces)}}function packValues(){var s="";for(var i=0;i<arguments.length;i+=1){var v=arguments[i];if(v>=0&&i>0){s+=" "}s+=floatToString(v)}return s}var d="";for(var i=0;i<this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type==="M"){d+="M"+packValues(cmd.x,cmd.y)}else if(cmd.type==="L"){d+="L"+packValues(cmd.x,cmd.y)}else if(cmd.type==="C"){d+="C"+packValues(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){d+="Q"+packValues(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){d+="Z"}}return d};Path.prototype.toSVG=function(decimalPlaces){var svg='<path d="';svg+=this.toPathData(decimalPlaces);svg+='"';if(this.fill&this.fill!=="black"){if(this.fill===null){svg+=' fill="none"'}else{svg+=' fill="'+this.fill+'"'}}if(this.stroke){svg+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'}svg+="/>";return svg};exports.Path=Path},{}],10:[function(require,module,exports){var check=require("./check");var encode=require("./types").encode;var sizeOf=require("./types").sizeOf;function Table(tableName,fields,options){var i;for(i=0;i<fields.length;i+=1){var field=fields[i];this[field.name]=field.value}this.tableName=tableName;this.fields=fields;if(options){var optionKeys=Object.keys(options);for(i=0;i<optionKeys.length;i+=1){var k=optionKeys[i];var v=options[k];if(this[k]!==undefined){this[k]=v}}}}Table.prototype.sizeOf=function(){var v=0;for(var i=0;i<this.fields.length;i+=1){var field=this.fields[i];var value=this[field.name];if(value===undefined){value=field.value}if(typeof value.sizeOf==="function"){v+=value.sizeOf()}else{var sizeOfFunction=sizeOf[field.type];check.assert(typeof sizeOfFunction==="function","Could not find sizeOf function for field"+field.name);v+=sizeOfFunction(value)}}return v};Table.prototype.encode=function(){return encode.TABLE(this)};exports.Table=Table},{"./check":1,"./types":25}],11:[function(require,module,exports){var encoding=require("../encoding");var glyphset=require("../glyphset");var parse=require("../parse");var path=require("../path");var table=require("../table");function equals(a,b){if(a===b){return true}else if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length){return false}for(var i=0;i<a.length;i+=1){if(!equals(a[i],b[i])){return false}}return true}else{return false}}function parseCFFIndex(data,start,conversionFn){var offsets=[];var objects=[];var count=parse.getCard16(data,start);var i;var objectOffset;var endOffset;if(count!==0){var offsetSize=parse.getByte(data,start+2);objectOffset=start+(count+1)*offsetSize+2;var pos=start+3;for(i=0;i<count+1;i+=1){offsets.push(parse.getOffset(data,pos,offsetSize));pos+=offsetSize}endOffset=objectOffset+offsets[count]}else{endOffset=start+2}for(i=0;i<offsets.length-1;i+=1){var value=parse.getBytes(data,objectOffset+offsets[i],objectOffset+offsets[i+1]);if(conversionFn){value=conversionFn(value)}objects.push(value)}return{objects:objects,startOffset:start,endOffset:endOffset}}function parseFloatOperand(parser){var s="";var eof=15;var lookup=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];while(true){var b=parser.parseByte();var n1=b>>4;var n2=b&15;if(n1===eof){break}s+=lookup[n1];if(n2===eof){break}s+=lookup[n2]}return parseFloat(s)}function parseOperand(parser,b0){var b1;var b2;var b3;var b4;if(b0===28){b1=parser.parseByte();b2=parser.parseByte();return b1<<8|b2}if(b0===29){b1=parser.parseByte();b2=parser.parseByte();b3=parser.parseByte();b4=parser.parseByte();return b1<<24|b2<<16|b3<<8|b4}if(b0===30){return parseFloatOperand(parser)}if(b0>=32&&b0<=246){return b0-139}if(b0>=247&&b0<=250){b1=parser.parseByte();return(b0-247)*256+b1+108}if(b0>=251&&b0<=254){b1=parser.parseByte();return-(b0-251)*256-b1-108}throw new Error("Invalid b0 "+b0)}function entriesToObject(entries){var o={};for(var i=0;i<entries.length;i+=1){var key=entries[i][0];var values=entries[i][1];var value;if(values.length===1){value=values[0]}else{value=values}if(o.hasOwnProperty(key)){throw new Error("Object "+o+" already has key "+key)}o[key]=value}return o}function parseCFFDict(data,start,size){start=start!==undefined?start:0;var parser=new parse.Parser(data,start);var entries=[];var operands=[];size=size!==undefined?size:data.length;while(parser.relativeOffset<size){var op=parser.parseByte();if(op<=21){if(op===12){op=1200+parser.parseByte()}entries.push([op,operands]);operands=[]}else{operands.push(parseOperand(parser,op))}}return entriesToObject(entries)}function getCFFString(strings,index){if(index<=390){index=encoding.cffStandardStrings[index]}else{index=strings[index-391]}return index}function interpretDict(dict,meta,strings){var newDict={};for(var i=0;i<meta.length;i+=1){var m=meta[i];var value=dict[m.op];if(value===undefined){value=m.value!==undefined?m.value:null}if(m.type==="SID"){value=getCFFString(strings,value)}newDict[m.name]=value}return newDict}function parseCFFHeader(data,start){var header={};header.formatMajor=parse.getCard8(data,start);header.formatMinor=parse.getCard8(data,start+1);header.size=parse.getCard8(data,start+2);header.offsetSize=parse.getCard8(data,start+3);header.startOffset=start;header.endOffset=start+4;return header}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}];var PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(data,strings){var dict=parseCFFDict(data,0,data.byteLength);return interpretDict(dict,TOP_DICT_META,strings)}function parseCFFPrivateDict(data,start,size,strings){var dict=parseCFFDict(data,start,size);return interpretDict(dict,PRIVATE_DICT_META,strings)}function parseCFFCharset(data,start,nGlyphs,strings){var i;var sid;var count;var parser=new parse.Parser(data,start);nGlyphs-=1;var charset=[".notdef"];var format=parser.parseCard8();if(format===0){for(i=0;i<nGlyphs;i+=1){sid=parser.parseSID();charset.push(getCFFString(strings,sid))}}else if(format===1){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard8();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else if(format===2){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard16();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else{throw new Error("Unknown charset format "+format)}return charset}function parseCFFEncoding(data,start,charset){var i;var code;var enc={};var parser=new parse.Parser(data,start);var format=parser.parseCard8();if(format===0){var nCodes=parser.parseCard8();for(i=0;i<nCodes;i+=1){code=parser.parseCard8();enc[code]=i}}else if(format===1){var nRanges=parser.parseCard8();code=1;for(i=0;i<nRanges;i+=1){var first=parser.parseCard8();var nLeft=parser.parseCard8();for(var j=first;j<=first+nLeft;j+=1){enc[j]=code;code+=1}}}else{throw new Error("Unknown encoding format "+format)}return new encoding.CffEncoding(enc,charset)}function parseCFFCharstring(font,glyph,code){var c1x;var c1y;var c2x;var c2y;var p=new path.Path;var stack=[];var nStems=0;var haveWidth=false;var width=font.defaultWidthX;var open=false;var x=0;var y=0;function newContour(x,y){if(open){p.closePath()}p.moveTo(x,y);open=true}function parseStems(){var hasWidthArg;hasWidthArg=stack.length%2!==0;if(hasWidthArg&&!haveWidth){width=stack.shift()+font.nominalWidthX}nStems+=stack.length>>1;stack.length=0;haveWidth=true}function parse(code){var b1;var b2;var b3;var b4;var codeIndex;var subrCode;var jpx;var jpy;var c3x;var c3y;var c4x;var c4y;var i=0;while(i<code.length){var v=code[i];i+=1;switch(v){case 1:parseStems();break;case 3:parseStems();break;case 4:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();newContour(x,y);break;case 5:while(stack.length>0){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}break;case 6:while(stack.length>0){x+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}y+=stack.shift();p.lineTo(x,y)}break;case 7:while(stack.length>0){y+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}x+=stack.shift();p.lineTo(x,y)}break;case 8:while(stack.length>0){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 10:codeIndex=stack.pop()+font.subrsBias;subrCode=font.subrs[codeIndex];if(subrCode){parse(subrCode)}break;case 11:return;case 12:v=code[i];i+=1;switch(v){case 35:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();y=c4y+stack.shift();stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 34:c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=y;x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 36:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 37:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();if(Math.abs(c4x-x)>Math.abs(c4y-y)){x=c4x+stack.shift()
}else{y=c4y+stack.shift()}p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;default:console.log("Glyph "+glyph.index+": unknown operator "+1200+v);stack.length=0}break;case 14:if(stack.length>0&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}if(open){p.closePath();open=false}break;case 18:parseStems();break;case 19:case 20:parseStems();i+=nStems+7>>3;break;case 21:if(stack.length>2&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();x+=stack.pop();newContour(x,y);break;case 22:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}x+=stack.pop();newContour(x,y);break;case 23:parseStems();break;case 24:while(stack.length>2){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}x+=stack.shift();y+=stack.shift();p.lineTo(x,y);break;case 25:while(stack.length>6){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y);break;case 26:if(stack.length%2){x+=stack.shift()}while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x;y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 27:if(stack.length%2){y+=stack.shift()}while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y;p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 28:b1=code[i];b2=code[i+1];stack.push((b1<<24|b2<<16)>>16);i+=2;break;case 29:codeIndex=stack.pop()+font.gsubrsBias;subrCode=font.gsubrs[codeIndex];if(subrCode){parse(subrCode)}break;case 30:while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 31:while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;default:if(v<32){console.log("Glyph "+glyph.index+": unknown operator "+v)}else if(v<247){stack.push(v-139)}else if(v<251){b1=code[i];i+=1;stack.push((v-247)*256+b1+108)}else if(v<255){b1=code[i];i+=1;stack.push(-(v-251)*256-b1-108)}else{b1=code[i];b2=code[i+1];b3=code[i+2];b4=code[i+3];i+=4;stack.push((b1<<24|b2<<16|b3<<8|b4)/65536)}}}}parse(code);glyph.advanceWidth=width;return p}function calcCFFSubroutineBias(subrs){var bias;if(subrs.length<1240){bias=107}else if(subrs.length<33900){bias=1131}else{bias=32768}return bias}function parseCFFTable(data,start,font){font.tables.cff={};var header=parseCFFHeader(data,start);var nameIndex=parseCFFIndex(data,header.endOffset,parse.bytesToString);var topDictIndex=parseCFFIndex(data,nameIndex.endOffset);var stringIndex=parseCFFIndex(data,topDictIndex.endOffset,parse.bytesToString);var globalSubrIndex=parseCFFIndex(data,stringIndex.endOffset);font.gsubrs=globalSubrIndex.objects;font.gsubrsBias=calcCFFSubroutineBias(font.gsubrs);var topDictData=new DataView(new Uint8Array(topDictIndex.objects[0]).buffer);var topDict=parseCFFTopDict(topDictData,stringIndex.objects);font.tables.cff.topDict=topDict;var privateDictOffset=start+topDict["private"][1];var privateDict=parseCFFPrivateDict(data,privateDictOffset,topDict["private"][0],stringIndex.objects);font.defaultWidthX=privateDict.defaultWidthX;font.nominalWidthX=privateDict.nominalWidthX;if(privateDict.subrs!==0){var subrOffset=privateDictOffset+privateDict.subrs;var subrIndex=parseCFFIndex(data,subrOffset);font.subrs=subrIndex.objects;font.subrsBias=calcCFFSubroutineBias(font.subrs)}else{font.subrs=[];font.subrsBias=0}var charStringsIndex=parseCFFIndex(data,start+topDict.charStrings);font.nGlyphs=charStringsIndex.objects.length;var charset=parseCFFCharset(data,start+topDict.charset,font.nGlyphs,stringIndex.objects);if(topDict.encoding===0){font.cffEncoding=new encoding.CffEncoding(encoding.cffStandardEncoding,charset)}else if(topDict.encoding===1){font.cffEncoding=new encoding.CffEncoding(encoding.cffExpertEncoding,charset)}else{font.cffEncoding=parseCFFEncoding(data,start+topDict.encoding,charset)}font.encoding=font.encoding||font.cffEncoding;font.glyphs=new glyphset.GlyphSet(font);for(var i=0;i<font.nGlyphs;i+=1){var charString=charStringsIndex.objects[i];font.glyphs.push(i,glyphset.cffGlyphLoader(font,i,parseCFFCharstring,charString))}}function encodeString(s,strings){var sid;var i=encoding.cffStandardStrings.indexOf(s);if(i>=0){sid=i}i=strings.indexOf(s);if(i>=0){sid=i+encoding.cffStandardStrings.length}else{sid=encoding.cffStandardStrings.length+strings.length;strings.push(s)}return sid}function makeHeader(){return new table.Table("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(fontNames){var t=new table.Table("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var i=0;i<fontNames.length;i+=1){t.names.push({name:"name_"+i,type:"NAME",value:fontNames[i]})}return t}function makeDict(meta,attrs,strings){var m={};for(var i=0;i<meta.length;i+=1){var entry=meta[i];var value=attrs[entry.name];if(value!==undefined&&!equals(value,entry.value)){if(entry.type==="SID"){value=encodeString(value,strings)}m[entry.op]={name:entry.name,type:entry.type,value:value}}}return m}function makeTopDict(attrs,strings){var t=new table.Table("Top DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(TOP_DICT_META,attrs,strings);return t}function makeTopDictIndex(topDict){var t=new table.Table("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);t.topDicts=[{name:"topDict_0",type:"TABLE",value:topDict}];return t}function makeStringIndex(strings){var t=new table.Table("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var i=0;i<strings.length;i+=1){t.strings.push({name:"string_"+i,type:"STRING",value:strings[i]})}return t}function makeGlobalSubrIndex(){return new table.Table("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(glyphNames,strings){var t=new table.Table("Charsets",[{name:"format",type:"Card8",value:0}]);for(var i=0;i<glyphNames.length;i+=1){var glyphName=glyphNames[i];var glyphSID=encodeString(glyphName,strings);t.fields.push({name:"glyph_"+i,type:"SID",value:glyphSID})}return t}function glyphToOps(glyph){var ops=[];var path=glyph.path;ops.push({name:"width",type:"NUMBER",value:glyph.advanceWidth});var x=0;var y=0;for(var i=0;i<path.commands.length;i+=1){var dx;var dy;var cmd=path.commands[i];if(cmd.type==="Q"){var _13=1/3;var _23=2/3;cmd={type:"C",x:cmd.x,y:cmd.y,x1:_13*x+_23*cmd.x1,y1:_13*y+_23*cmd.y1,x2:_13*cmd.x+_23*cmd.x1,y2:_13*cmd.y+_23*cmd.y1}}if(cmd.type==="M"){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rmoveto",type:"OP",value:21});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type==="L"){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rlineto",type:"OP",value:5});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type==="C"){var dx1=Math.round(cmd.x1-x);var dy1=Math.round(cmd.y1-y);var dx2=Math.round(cmd.x2-cmd.x1);var dy2=Math.round(cmd.y2-cmd.y1);dx=Math.round(cmd.x-cmd.x2);dy=Math.round(cmd.y-cmd.y2);ops.push({name:"dx1",type:"NUMBER",value:dx1});ops.push({name:"dy1",type:"NUMBER",value:dy1});ops.push({name:"dx2",type:"NUMBER",value:dx2});ops.push({name:"dy2",type:"NUMBER",value:dy2});ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rrcurveto",type:"OP",value:8});x=Math.round(cmd.x);y=Math.round(cmd.y)}}ops.push({name:"endchar",type:"OP",value:14});return ops}function makeCharStringsIndex(glyphs){var t=new table.Table("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);var ops=glyphToOps(glyph);t.charStrings.push({name:glyph.name,type:"CHARSTRING",value:ops})}return t}function makePrivateDict(attrs,strings){var t=new table.Table("Private DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(PRIVATE_DICT_META,attrs,strings);return t}function makePrivateDictIndex(privateDict){var t=new table.Table("Private DICT INDEX",[{name:"privateDicts",type:"INDEX",value:[]}]);t.privateDicts=[{name:"privateDict_0",type:"TABLE",value:privateDict}];return t}function makeCFFTable(glyphs,options){var t=new table.Table("CFF ",[{name:"header",type:"TABLE"},{name:"nameIndex",type:"TABLE"},{name:"topDictIndex",type:"TABLE"},{name:"stringIndex",type:"TABLE"},{name:"globalSubrIndex",type:"TABLE"},{name:"charsets",type:"TABLE"},{name:"charStringsIndex",type:"TABLE"},{name:"privateDictIndex",type:"TABLE"}]);var fontScale=1/options.unitsPerEm;var attrs={version:options.version,fullName:options.fullName,familyName:options.familyName,weight:options.weightName,fontMatrix:[fontScale,0,0,fontScale,0,0],charset:999,encoding:0,charStrings:999,"private":[0,999]};var privateAttrs={};var glyphNames=[];var glyph;for(var i=1;i<glyphs.length;i+=1){glyph=glyphs.get(i);glyphNames.push(glyph.name)}var strings=[];t.header=makeHeader();t.nameIndex=makeNameIndex([options.postScriptName]);var topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);t.globalSubrIndex=makeGlobalSubrIndex();t.charsets=makeCharsets(glyphNames,strings);t.charStringsIndex=makeCharStringsIndex(glyphs);var privateDict=makePrivateDict(privateAttrs,strings);t.privateDictIndex=makePrivateDictIndex(privateDict);t.stringIndex=makeStringIndex(strings);var startOffset=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();attrs.charset=startOffset;attrs.encoding=0;attrs.charStrings=attrs.charset+t.charsets.sizeOf();attrs.private[1]=attrs.charStrings+t.charStringsIndex.sizeOf();topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);return t}exports.parse=parseCFFTable;exports.make=makeCFFTable},{"../encoding":3,"../glyphset":6,"../parse":8,"../path":9,"../table":10}],12:[function(require,module,exports){var check=require("../check");var parse=require("../parse");var table=require("../table");function parseCmapTable(data,start){var i;var cmap={};cmap.version=parse.getUShort(data,start);check.argument(cmap.version===0,"cmap table version should be 0.");cmap.numTables=parse.getUShort(data,start+2);var offset=-1;for(i=0;i<cmap.numTables;i+=1){var platformId=parse.getUShort(data,start+4+i*8);var encodingId=parse.getUShort(data,start+4+i*8+2);if(platformId===3&&(encodingId===1||encodingId===0)){offset=parse.getULong(data,start+4+i*8+4);break}}if(offset===-1){return null}var p=new parse.Parser(data,start+offset);cmap.format=p.parseUShort();check.argument(cmap.format===4,"Only format 4 cmap tables are supported.");cmap.length=p.parseUShort();cmap.language=p.parseUShort();var segCount;cmap.segCount=segCount=p.parseUShort()>>1;p.skip("uShort",3);cmap.glyphIndexMap={};var endCountParser=new parse.Parser(data,start+offset+14);var startCountParser=new parse.Parser(data,start+offset+16+segCount*2);var idDeltaParser=new parse.Parser(data,start+offset+16+segCount*4);var idRangeOffsetParser=new parse.Parser(data,start+offset+16+segCount*6);var glyphIndexOffset=start+offset+16+segCount*8;for(i=0;i<segCount-1;i+=1){var glyphIndex;var endCount=endCountParser.parseUShort();var startCount=startCountParser.parseUShort();var idDelta=idDeltaParser.parseShort();var idRangeOffset=idRangeOffsetParser.parseUShort();for(var c=startCount;c<=endCount;c+=1){if(idRangeOffset!==0){glyphIndexOffset=idRangeOffsetParser.offset+idRangeOffsetParser.relativeOffset-2;glyphIndexOffset+=idRangeOffset;glyphIndexOffset+=(c-startCount)*2;glyphIndex=parse.getUShort(data,glyphIndexOffset);if(glyphIndex!==0){glyphIndex=glyphIndex+idDelta&65535}}else{glyphIndex=c+idDelta&65535}cmap.glyphIndexMap[c]=glyphIndex}}return cmap}function addSegment(t,code,glyphIndex){t.segments.push({end:code,start:code,delta:-(code-glyphIndex),offset:0})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(glyphs){var i;var t=new table.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.segments=[];for(i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j<glyph.unicodes.length;j+=1){addSegment(t,glyph.unicodes[j],i)}t.segments=t.segments.sort(function(a,b){return a.start-b.start})}addTerminatorSegment(t);var segCount;segCount=t.segments.length;t.segCountX2=segCount*2;t.searchRange=Math.pow(2,Math.floor(Math.log(segCount)/Math.log(2)))*2;t.entrySelector=Math.log(t.searchRange/2)/Math.log(2);t.rangeShift=t.segCountX2-t.searchRange;var endCounts=[];var startCounts=[];var idDeltas=[];var idRangeOffsets=[];var glyphIds=[];for(i=0;i<segCount;i+=1){var segment=t.segments[i];endCounts=endCounts.concat({name:"end_"+i,type:"USHORT",value:segment.end});startCounts=startCounts.concat({name:"start_"+i,type:"USHORT",value:segment.start});idDeltas=idDeltas.concat({name:"idDelta_"+i,type:"SHORT",value:segment.delta});idRangeOffsets=idRangeOffsets.concat({name:"idRangeOffset_"+i,type:"USHORT",value:segment.offset});if(segment.glyphId!==undefined){glyphIds=glyphIds.concat({name:"glyph_"+i,type:"USHORT",value:segment.glyphId})}}t.fields=t.fields.concat(endCounts);t.fields.push({name:"reservedPad",type:"USHORT",value:0});t.fields=t.fields.concat(startCounts);t.fields=t.fields.concat(idDeltas);t.fields=t.fields.concat(idRangeOffsets);t.fields=t.fields.concat(glyphIds);t.length=14+endCounts.length*2+2+startCounts.length*2+idDeltas.length*2+idRangeOffsets.length*2+glyphIds.length*2;return t}exports.parse=parseCmapTable;exports.make=makeCmapTable},{"../check":1,"../parse":8,"../table":10}],13:[function(require,module,exports){var check=require("../check");var glyphset=require("../glyphset");var parse=require("../parse");var path=require("../path");function parseGlyphCoordinate(p,flag,previousValue,shortVectorBitMask,sameBitMask){var v;if((flag&shortVectorBitMask)>0){v=p.parseByte();if((flag&sameBitMask)===0){v=-v}v=previousValue+v}else{if((flag&sameBitMask)>0){v=previousValue}else{v=previousValue+p.parseShort()}}return v}function parseGlyph(glyph,data,start){var p=new parse.Parser(data,start);glyph.numberOfContours=p.parseShort();glyph.xMin=p.parseShort();glyph.yMin=p.parseShort();glyph.xMax=p.parseShort();glyph.yMax=p.parseShort();var flags;var flag;if(glyph.numberOfContours>0){var i;var endPointIndices=glyph.endPointIndices=[];for(i=0;i<glyph.numberOfContours;i+=1){endPointIndices.push(p.parseUShort())}glyph.instructionLength=p.parseUShort();glyph.instructions=[];for(i=0;i<glyph.instructionLength;i+=1){glyph.instructions.push(p.parseByte())}var numberOfCoordinates=endPointIndices[endPointIndices.length-1]+1;flags=[];for(i=0;i<numberOfCoordinates;i+=1){flag=p.parseByte();flags.push(flag);if((flag&8)>0){var repeatCount=p.parseByte();for(var j=0;j<repeatCount;j+=1){flags.push(flag);i+=1}}}check.argument(flags.length===numberOfCoordinates,"Bad flags.");if(endPointIndices.length>0){var points=[];var point;if(numberOfCoordinates>0){for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point={};point.onCurve=!!(flag&1);point.lastPointOfContour=endPointIndices.indexOf(i)>=0;points.push(point)}var px=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.x=parseGlyphCoordinate(p,flag,px,2,16);px=point.x}var py=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.y=parseGlyphCoordinate(p,flag,py,4,32);py=point.y}}glyph.points=points}else{glyph.points=[]}}else if(glyph.numberOfContours===0){glyph.points=[]}else{glyph.isComposite=true;glyph.points=[];glyph.components=[];var moreComponents=true;while(moreComponents){flags=p.parseUShort();var component={glyphIndex:p.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};if((flags&1)>0){component.dx=p.parseShort();component.dy=p.parseShort()}else{component.dx=p.parseChar();component.dy=p.parseChar()}if((flags&8)>0){component.xScale=component.yScale=p.parseF2Dot14()}else if((flags&64)>0){component.xScale=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}else if((flags&128)>0){component.xScale=p.parseF2Dot14();component.scale01=p.parseF2Dot14();component.scale10=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}glyph.components.push(component);moreComponents=!!(flags&32)}}}function transformPoints(points,transform){var newPoints=[];for(var i=0;i<points.length;i+=1){var pt=points[i];var newPt={x:transform.xScale*pt.x+transform.scale01*pt.y+transform.dx,y:transform.scale10*pt.x+transform.yScale*pt.y+transform.dy,onCurve:pt.onCurve,lastPointOfContour:pt.lastPointOfContour};newPoints.push(newPt)}return newPoints}function getContours(points){var contours=[];var currentContour=[];for(var i=0;i<points.length;i+=1){var pt=points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours}function getPath(points){var p=new path.Path;if(!points){return p}var contours=getContours(points);for(var i=0;i<contours.length;i+=1){var contour=contours[i];var firstPt=contour[0];var lastPt=contour[contour.length-1];var curvePt;var realFirstPoint;if(firstPt.onCurve){curvePt=null;realFirstPoint=true}else{if(lastPt.onCurve){firstPt=lastPt}else{firstPt={x:(firstPt.x+lastPt.x)/2,y:(firstPt.y+lastPt.y)/2}}curvePt=firstPt;realFirstPoint=false}p.moveTo(firstPt.x,firstPt.y);for(var j=realFirstPoint?1:0;j<contour.length;j+=1){var pt=contour[j];var prevPt=j===0?firstPt:contour[j-1];if(prevPt.onCurve&&pt.onCurve){p.lineTo(pt.x,pt.y)}else if(prevPt.onCurve&&!pt.onCurve){curvePt=pt}else if(!prevPt.onCurve&&!pt.onCurve){var midPt={x:(prevPt.x+pt.x)/2,y:(prevPt.y+pt.y)/2};p.quadraticCurveTo(prevPt.x,prevPt.y,midPt.x,midPt.y);curvePt=pt}else if(!prevPt.onCurve&&pt.onCurve){p.quadraticCurveTo(curvePt.x,curvePt.y,pt.x,pt.y);curvePt=null}else{throw new Error("Invalid state.")}}if(firstPt!==lastPt){if(curvePt){p.quadraticCurveTo(curvePt.x,curvePt.y,firstPt.x,firstPt.y)}else{p.lineTo(firstPt.x,firstPt.y)}}}p.closePath();return p}function buildPath(glyphs,glyph){if(glyph.isComposite){for(var j=0;j<glyph.components.length;j+=1){var component=glyph.components[j];var componentGlyph=glyphs.get(component.glyphIndex);if(componentGlyph.points){var transformedPoints=transformPoints(componentGlyph.points,component);glyph.points=glyph.points.concat(transformedPoints)}}}return getPath(glyph.points)}function parseGlyfTable(data,start,loca,font){var glyphs=new glyphset.GlyphSet(font);var i;for(i=0;i<loca.length-1;i+=1){var offset=loca[i];var nextOffset=loca[i+1];if(offset!==nextOffset){glyphs.push(i,glyphset.ttfGlyphLoader(font,i,parseGlyph,data,start+offset,buildPath))}else{glyphs.push(i,glyphset.glyphLoader(font,i))}}return glyphs}exports.parse=parseGlyfTable},{"../check":1,"../glyphset":6,"../parse":8,"../path":9}],14:[function(require,module,exports){var check=require("../check");var parse=require("../parse");function parseTaggedListTable(data,start){var p=new parse.Parser(data,start);var n=p.parseUShort();var list=[];for(var i=0;i<n;i++){list[p.parseTag()]={offset:p.parseUShort()}}return list}function parseCoverageTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();var count=p.parseUShort();if(format===1){return p.parseUShortList(count)}else if(format===2){var coverage=[];for(;count--;){var begin=p.parseUShort();var end=p.parseUShort();var index=p.parseUShort();for(var i=begin;i<=end;i++){coverage[index++]=i}}return coverage}}function parseClassDefTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();if(format===1){var startGlyph=p.parseUShort();var glyphCount=p.parseUShort();var classes=p.parseUShortList(glyphCount);return function(glyphID){return classes[glyphID-startGlyph]||0}}else if(format===2){var rangeCount=p.parseUShort();var startGlyphs=[];var endGlyphs=[];var classValues=[];for(var i=0;i<rangeCount;i++){startGlyphs[i]=p.parseUShort();endGlyphs[i]=p.parseUShort();classValues[i]=p.parseUShort()}return function(glyphID){var l=0;var r=startGlyphs.length-1;while(l<r){var c=l+r+1>>1;if(glyphID<startGlyphs[c]){r=c-1}else{l=c}}if(startGlyphs[l]<=glyphID&&glyphID<=endGlyphs[l]){return classValues[l]||0}return 0}}}function parsePairPosSubTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();var coverageOffset=p.parseUShort();var coverage=parseCoverageTable(data,start+coverageOffset);var valueFormat1=p.parseUShort();var valueFormat2=p.parseUShort();var value1;var value2;if(valueFormat1!==4||valueFormat2!==0)return;var sharedPairSets={};if(format===1){var pairSetCount=p.parseUShort();var pairSet=[];var pairSetOffsets=p.parseOffset16List(pairSetCount);for(var firstGlyph=0;firstGlyph<pairSetCount;firstGlyph++){var pairSetOffset=pairSetOffsets[firstGlyph];var sharedPairSet=sharedPairSets[pairSetOffset];if(!sharedPairSet){sharedPairSet={};p.relativeOffset=pairSetOffset;var pairValueCount=p.parseUShort();for(;pairValueCount--;){var secondGlyph=p.parseUShort();if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();sharedPairSet[secondGlyph]=value1}}pairSet[coverage[firstGlyph]]=sharedPairSet}return function(leftGlyph,rightGlyph){var pairs=pairSet[leftGlyph];if(pairs)return pairs[rightGlyph]}}else if(format===2){var classDef1Offset=p.parseUShort();var classDef2Offset=p.parseUShort();var class1Count=p.parseUShort();var class2Count=p.parseUShort();var getClass1=parseClassDefTable(data,start+classDef1Offset);var getClass2=parseClassDefTable(data,start+classDef2Offset);var kerningMatrix=[];for(var i=0;i<class1Count;i++){var kerningRow=kerningMatrix[i]=[];for(var j=0;j<class2Count;j++){if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();kerningRow[j]=value1}}var covered={};for(i=0;i<coverage.length;i++)covered[coverage[i]]=1;return function(leftGlyph,rightGlyph){if(!covered[leftGlyph])return;var class1=getClass1(leftGlyph);var class2=getClass2(rightGlyph);var kerningRow=kerningMatrix[class1];if(kerningRow){return kerningRow[class2]}}}}function parseLookupTable(data,start){var p=new parse.Parser(data,start);var lookupType=p.parseUShort();var lookupFlag=p.parseUShort();var useMarkFilteringSet=lookupFlag&16;var subTableCount=p.parseUShort();var subTableOffsets=p.parseOffset16List(subTableCount);var table={lookupType:lookupType,lookupFlag:lookupFlag,markFilteringSet:useMarkFilteringSet?p.parseUShort():-1};if(lookupType===2){var subtables=[];for(var i=0;i<subTableCount;i++){subtables.push(parsePairPosSubTable(data,start+subTableOffsets[i]))}table.getKerningValue=function(leftGlyph,rightGlyph){for(var i=subtables.length;i--;){var value=subtables[i](leftGlyph,rightGlyph);if(value!==undefined)return value}return 0}}return table}function parseGposTable(data,start,font){var p=new parse.Parser(data,start);var tableVersion=p.parseFixed();check.argument(tableVersion===1,"Unsupported GPOS table version.");parseTaggedListTable(data,start+p.parseUShort());parseTaggedListTable(data,start+p.parseUShort());var lookupListOffset=p.parseUShort();p.relativeOffset=lookupListOffset;var lookupCount=p.parseUShort();var lookupTableOffsets=p.parseOffset16List(lookupCount);var lookupListAbsoluteOffset=start+lookupListOffset;for(var i=0;i<lookupCount;i++){var table=parseLookupTable(data,lookupListAbsoluteOffset+lookupTableOffsets[i]);if(table.lookupType===2&&!font.getGposKerningValue)font.getGposKerningValue=table.getKerningValue}}exports.parse=parseGposTable},{"../check":1,"../parse":8}],15:[function(require,module,exports){var check=require("../check");var parse=require("../parse");var table=require("../table");function parseHeadTable(data,start){var head={};var p=new parse.Parser(data,start);head.version=p.parseVersion();head.fontRevision=Math.round(p.parseFixed()*1e3)/1e3;head.checkSumAdjustment=p.parseULong();head.magicNumber=p.parseULong();check.argument(head.magicNumber===1594834165,"Font header has wrong magic number.");head.flags=p.parseUShort();head.unitsPerEm=p.parseUShort();head.created=p.parseLongDateTime();head.modified=p.parseLongDateTime();head.xMin=p.parseShort();head.yMin=p.parseShort();head.xMax=p.parseShort();head.yMax=p.parseShort();head.macStyle=p.parseUShort();head.lowestRecPPEM=p.parseUShort();head.fontDirectionHint=p.parseShort();head.indexToLocFormat=p.parseShort();head.glyphDataFormat=p.parseShort();return head}function makeHeadTable(options){return new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],options)}exports.parse=parseHeadTable;exports.make=makeHeadTable},{"../check":1,"../parse":8,"../table":10}],16:[function(require,module,exports){var parse=require("../parse");var table=require("../table");function parseHheaTable(data,start){var hhea={};var p=new parse.Parser(data,start);hhea.version=p.parseVersion();hhea.ascender=p.parseShort();hhea.descender=p.parseShort();hhea.lineGap=p.parseShort();hhea.advanceWidthMax=p.parseUShort();hhea.minLeftSideBearing=p.parseShort();hhea.minRightSideBearing=p.parseShort();hhea.xMaxExtent=p.parseShort();hhea.caretSlopeRise=p.parseShort();hhea.caretSlopeRun=p.parseShort();hhea.caretOffset=p.parseShort();p.relativeOffset+=8;hhea.metricDataFormat=p.parseShort();hhea.numberOfHMetrics=p.parseUShort();return hhea}function makeHheaTable(options){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],options)}exports.parse=parseHheaTable;exports.make=makeHheaTable},{"../parse":8,"../table":10}],17:[function(require,module,exports){var parse=require("../parse");var table=require("../table");function parseHmtxTable(data,start,numMetrics,numGlyphs,glyphs){var advanceWidth;var leftSideBearing;var p=new parse.Parser(data,start);for(var i=0;i<numGlyphs;i+=1){if(i<numMetrics){advanceWidth=p.parseUShort();leftSideBearing=p.parseShort()}var glyph=glyphs.get(i);glyph.advanceWidth=advanceWidth;glyph.leftSideBearing=leftSideBearing}}function makeHmtxTable(glyphs){var t=new table.Table("hmtx",[]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);var advanceWidth=glyph.advanceWidth||0;var leftSideBearing=glyph.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+i,type:"USHORT",value:advanceWidth});t.fields.push({name:"leftSideBearing_"+i,type:"SHORT",value:leftSideBearing})}return t}exports.parse=parseHmtxTable;exports.make=makeHmtxTable},{"../parse":8,"../table":10}],18:[function(require,module,exports){var check=require("../check");var parse=require("../parse");function parseKernTable(data,start){var pairs={};var p=new parse.Parser(data,start);var tableVersion=p.parseUShort();check.argument(tableVersion===0,"Unsupported kern table version.");p.skip("uShort",1);var subTableVersion=p.parseUShort();check.argument(subTableVersion===0,"Unsupported kern sub-table version.");p.skip("uShort",2);var nPairs=p.parseUShort();p.skip("uShort",3);for(var i=0;i<nPairs;i+=1){var leftIndex=p.parseUShort();var rightIndex=p.parseUShort();var value=p.parseShort();pairs[leftIndex+","+rightIndex]=value}return pairs}exports.parse=parseKernTable},{"../check":1,"../parse":8}],19:[function(require,module,exports){var parse=require("../parse");function parseLocaTable(data,start,numGlyphs,shortVersion){var p=new parse.Parser(data,start);var parseFn=shortVersion?p.parseUShort:p.parseULong;var glyphOffsets=[];for(var i=0;i<numGlyphs+1;i+=1){var glyphOffset=parseFn.call(p);if(shortVersion){glyphOffset*=2}glyphOffsets.push(glyphOffset)}return glyphOffsets}exports.parse=parseLocaTable},{"../parse":8}],20:[function(require,module,exports){var parse=require("../parse");var table=require("../table");function parseMaxpTable(data,start){var maxp={};var p=new parse.Parser(data,start);maxp.version=p.parseVersion();maxp.numGlyphs=p.parseUShort();if(maxp.version===1){maxp.maxPoints=p.parseUShort();maxp.maxContours=p.parseUShort();maxp.maxCompositePoints=p.parseUShort();maxp.maxCompositeContours=p.parseUShort();maxp.maxZones=p.parseUShort();maxp.maxTwilightPoints=p.parseUShort();maxp.maxStorage=p.parseUShort();maxp.maxFunctionDefs=p.parseUShort();maxp.maxInstructionDefs=p.parseUShort();maxp.maxStackElements=p.parseUShort();maxp.maxSizeOfInstructions=p.parseUShort();maxp.maxComponentElements=p.parseUShort();maxp.maxComponentDepth=p.parseUShort()}return maxp}function makeMaxpTable(numGlyphs){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:numGlyphs}])}exports.parse=parseMaxpTable;exports.make=makeMaxpTable},{"../parse":8,"../table":10}],21:[function(require,module,exports){var encode=require("../types").encode;var parse=require("../parse");var table=require("../table");var nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","licence","licenceURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"];function parseNameTable(data,start){var name={};var p=new parse.Parser(data,start);name.format=p.parseUShort();var count=p.parseUShort();var stringOffset=p.offset+p.parseUShort();var unknownCount=0;for(var i=0;i<count;i++){var platformID=p.parseUShort();var encodingID=p.parseUShort();var languageID=p.parseUShort();var nameID=p.parseUShort();var property=nameTableNames[nameID];var byteLength=p.parseUShort();var offset=p.parseUShort();if(platformID===3&&encodingID===1&&languageID===1033){var codePoints=[];
var length=byteLength/2;for(var j=0;j<length;j++,offset+=2){codePoints[j]=parse.getShort(data,stringOffset+offset)}var str=String.fromCharCode.apply(null,codePoints);if(property){name[property]=str}else{unknownCount++;name["unknown"+unknownCount]=str}}}if(name.format===1){name.langTagCount=p.parseUShort()}return name}function makeNameRecord(platformID,encodingID,languageID,nameID,length,offset){return new table.Table("NameRecord",[{name:"platformID",type:"USHORT",value:platformID},{name:"encodingID",type:"USHORT",value:encodingID},{name:"languageID",type:"USHORT",value:languageID},{name:"nameID",type:"USHORT",value:nameID},{name:"length",type:"USHORT",value:length},{name:"offset",type:"USHORT",value:offset}])}function addMacintoshNameRecord(t,recordID,s,offset){var stringBytes=encode.STRING(s);t.records.push(makeNameRecord(1,0,0,recordID,stringBytes.length,offset));t.strings.push(stringBytes);offset+=stringBytes.length;return offset}function addWindowsNameRecord(t,recordID,s,offset){var utf16Bytes=encode.UTF16(s);t.records.push(makeNameRecord(3,1,1033,recordID,utf16Bytes.length,offset));t.strings.push(utf16Bytes);offset+=utf16Bytes.length;return offset}function makeNameTable(options){var t=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:0},{name:"stringOffset",type:"USHORT",value:0}]);t.records=[];t.strings=[];var offset=0;var i;var s;for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addMacintoshNameRecord(t,i,s,offset)}}for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addWindowsNameRecord(t,i,s,offset)}}t.count=t.records.length;t.stringOffset=6+t.count*12;for(i=0;i<t.records.length;i+=1){t.fields.push({name:"record_"+i,type:"TABLE",value:t.records[i]})}for(i=0;i<t.strings.length;i+=1){t.fields.push({name:"string_"+i,type:"LITERAL",value:t.strings[i]})}return t}exports.parse=parseNameTable;exports.make=makeNameTable},{"../parse":8,"../table":10,"../types":25}],22:[function(require,module,exports){var parse=require("../parse");var table=require("../table");var unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(unicode){for(var i=0;i<unicodeRanges.length;i+=1){var range=unicodeRanges[i];if(unicode>=range.begin&&unicode<range.end){return i}}return-1}function parseOS2Table(data,start){var os2={};var p=new parse.Parser(data,start);os2.version=p.parseUShort();os2.xAvgCharWidth=p.parseShort();os2.usWeightClass=p.parseUShort();os2.usWidthClass=p.parseUShort();os2.fsType=p.parseUShort();os2.ySubscriptXSize=p.parseShort();os2.ySubscriptYSize=p.parseShort();os2.ySubscriptXOffset=p.parseShort();os2.ySubscriptYOffset=p.parseShort();os2.ySuperscriptXSize=p.parseShort();os2.ySuperscriptYSize=p.parseShort();os2.ySuperscriptXOffset=p.parseShort();os2.ySuperscriptYOffset=p.parseShort();os2.yStrikeoutSize=p.parseShort();os2.yStrikeoutPosition=p.parseShort();os2.sFamilyClass=p.parseShort();os2.panose=[];for(var i=0;i<10;i++){os2.panose[i]=p.parseByte()}os2.ulUnicodeRange1=p.parseULong();os2.ulUnicodeRange2=p.parseULong();os2.ulUnicodeRange3=p.parseULong();os2.ulUnicodeRange4=p.parseULong();os2.achVendID=String.fromCharCode(p.parseByte(),p.parseByte(),p.parseByte(),p.parseByte());os2.fsSelection=p.parseUShort();os2.usFirstCharIndex=p.parseUShort();os2.usLastCharIndex=p.parseUShort();os2.sTypoAscender=p.parseShort();os2.sTypoDescender=p.parseShort();os2.sTypoLineGap=p.parseShort();os2.usWinAscent=p.parseUShort();os2.usWinDescent=p.parseUShort();if(os2.version>=1){os2.ulCodePageRange1=p.parseULong();os2.ulCodePageRange2=p.parseULong()}if(os2.version>=2){os2.sxHeight=p.parseShort();os2.sCapHeight=p.parseShort();os2.usDefaultChar=p.parseUShort();os2.usBreakChar=p.parseUShort();os2.usMaxContent=p.parseUShort()}return os2}function makeOS2Table(options){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],options)}exports.unicodeRanges=unicodeRanges;exports.getUnicodeRange=getUnicodeRange;exports.parse=parseOS2Table;exports.make=makeOS2Table},{"../parse":8,"../table":10}],23:[function(require,module,exports){var encoding=require("../encoding");var parse=require("../parse");var table=require("../table");function parsePostTable(data,start){var post={};var p=new parse.Parser(data,start);var i;post.version=p.parseVersion();post.italicAngle=p.parseFixed();post.underlinePosition=p.parseShort();post.underlineThickness=p.parseShort();post.isFixedPitch=p.parseULong();post.minMemType42=p.parseULong();post.maxMemType42=p.parseULong();post.minMemType1=p.parseULong();post.maxMemType1=p.parseULong();switch(post.version){case 1:post.names=encoding.standardNames.slice();break;case 2:post.numberOfGlyphs=p.parseUShort();post.glyphNameIndex=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.glyphNameIndex[i]=p.parseUShort()}post.names=[];for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]>=encoding.standardNames.length){var nameLength=p.parseChar();post.names.push(p.parseString(nameLength))}}break;case 2.5:post.numberOfGlyphs=p.parseUShort();post.offset=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.offset[i]=p.parseChar()}break}return post}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}exports.parse=parsePostTable;exports.make=makePostTable},{"../encoding":3,"../parse":8,"../table":10}],24:[function(require,module,exports){var check=require("../check");var table=require("../table");var cmap=require("./cmap");var cff=require("./cff");var head=require("./head");var hhea=require("./hhea");var hmtx=require("./hmtx");var maxp=require("./maxp");var _name=require("./name");var os2=require("./os2");var post=require("./post");function log2(v){return Math.log(v)/Math.log(2)|0}function computeCheckSum(bytes){while(bytes.length%4!==0){bytes.push(0)}var sum=0;for(var i=0;i<bytes.length;i+=4){sum+=(bytes[i]<<24)+(bytes[i+1]<<16)+(bytes[i+2]<<8)+bytes[i+3]}sum%=Math.pow(2,32);return sum}function makeTableRecord(tag,checkSum,offset,length){return new table.Table("Table Record",[{name:"tag",type:"TAG",value:tag!==undefined?tag:""},{name:"checkSum",type:"ULONG",value:checkSum!==undefined?checkSum:0},{name:"offset",type:"ULONG",value:offset!==undefined?offset:0},{name:"length",type:"ULONG",value:length!==undefined?length:0}])}function makeSfntTable(tables){var sfnt=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);sfnt.tables=tables;sfnt.numTables=tables.length;var highestPowerOf2=Math.pow(2,log2(sfnt.numTables));sfnt.searchRange=16*highestPowerOf2;sfnt.entrySelector=log2(highestPowerOf2);sfnt.rangeShift=sfnt.numTables*16-sfnt.searchRange;var recordFields=[];var tableFields=[];var offset=sfnt.sizeOf()+makeTableRecord().sizeOf()*sfnt.numTables;while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}for(var i=0;i<tables.length;i+=1){var t=tables[i];check.argument(t.tableName.length===4,"Table name"+t.tableName+" is invalid.");var tableLength=t.sizeOf();var tableRecord=makeTableRecord(t.tableName,computeCheckSum(t.encode()),offset,tableLength);recordFields.push({name:tableRecord.tag+" Table Record",type:"TABLE",value:tableRecord});tableFields.push({name:t.tableName+" table",type:"TABLE",value:t});offset+=tableLength;check.argument(!isNaN(offset),"Something went wrong calculating the offset.");while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}}recordFields.sort(function(r1,r2){if(r1.value.tag>r2.value.tag){return 1}else{return-1}});sfnt.fields=sfnt.fields.concat(recordFields);sfnt.fields=sfnt.fields.concat(tableFields);return sfnt}function metricsForChar(font,chars,notFoundMetrics){for(var i=0;i<chars.length;i+=1){var glyphIndex=font.charToGlyphIndex(chars[i]);if(glyphIndex>0){var glyph=font.glyphs.get(glyphIndex);return glyph.getMetrics()}}return notFoundMetrics}function average(vs){var sum=0;for(var i=0;i<vs.length;i+=1){sum+=vs[i]}return sum/vs.length}function fontToSfntTable(font){var xMins=[];var yMins=[];var xMaxs=[];var yMaxs=[];var advanceWidths=[];var leftSideBearings=[];var rightSideBearings=[];var firstCharIndex;var lastCharIndex=0;var ulUnicodeRange1=0;var ulUnicodeRange2=0;var ulUnicodeRange3=0;var ulUnicodeRange4=0;for(var i=0;i<font.glyphs.length;i+=1){var glyph=font.glyphs.get(i);var unicode=glyph.unicode|0;if(firstCharIndex>unicode||firstCharIndex===null){firstCharIndex=unicode}if(lastCharIndex<unicode){lastCharIndex=unicode}var position=os2.getUnicodeRange(unicode);if(position<32){ulUnicodeRange1|=1<<position}else if(position<64){ulUnicodeRange2|=1<<position-32}else if(position<96){ulUnicodeRange3|=1<<position-64}else if(position<123){ulUnicodeRange4|=1<<position-96}else{throw new Error("Unicode ranges bits > 123 are reserved for internal usage")}if(glyph.name===".notdef")continue;var metrics=glyph.getMetrics();xMins.push(metrics.xMin);yMins.push(metrics.yMin);xMaxs.push(metrics.xMax);yMaxs.push(metrics.yMax);leftSideBearings.push(metrics.leftSideBearing);rightSideBearings.push(metrics.rightSideBearing);advanceWidths.push(glyph.advanceWidth)}var globals={xMin:Math.min.apply(null,xMins),yMin:Math.min.apply(null,yMins),xMax:Math.max.apply(null,xMaxs),yMax:Math.max.apply(null,yMaxs),advanceWidthMax:Math.max.apply(null,advanceWidths),advanceWidthAvg:average(advanceWidths),minLeftSideBearing:Math.min.apply(null,leftSideBearings),maxLeftSideBearing:Math.max.apply(null,leftSideBearings),minRightSideBearing:Math.min.apply(null,rightSideBearings)};globals.ascender=font.ascender!==undefined?font.ascender:globals.yMax;globals.descender=font.descender!==undefined?font.descender:globals.yMin;var headTable=head.make({unitsPerEm:font.unitsPerEm,xMin:globals.xMin,yMin:globals.yMin,xMax:globals.xMax,yMax:globals.yMax});var hheaTable=hhea.make({ascender:globals.ascender,descender:globals.descender,advanceWidthMax:globals.advanceWidthMax,minLeftSideBearing:globals.minLeftSideBearing,minRightSideBearing:globals.minRightSideBearing,xMaxExtent:globals.maxLeftSideBearing+(globals.xMax-globals.xMin),numberOfHMetrics:font.glyphs.length});var maxpTable=maxp.make(font.glyphs.length);var os2Table=os2.make({xAvgCharWidth:Math.round(globals.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:firstCharIndex,usLastCharIndex:lastCharIndex,ulUnicodeRange1:ulUnicodeRange1,ulUnicodeRange2:ulUnicodeRange2,ulUnicodeRange3:ulUnicodeRange3,ulUnicodeRange4:ulUnicodeRange4,sTypoAscender:globals.ascender,sTypoDescender:globals.descender,sTypoLineGap:0,usWinAscent:globals.ascender,usWinDescent:-globals.descender,sxHeight:metricsForChar(font,"xyvw",{yMax:0}).yMax,sCapHeight:metricsForChar(font,"HIKLEFJMNTZBDPRAGOQSUVWXY",globals).yMax,usBreakChar:font.hasChar(" ")?32:0});var hmtxTable=hmtx.make(font.glyphs);var cmapTable=cmap.make(font.glyphs);var fullName=font.familyName+" "+font.styleName;var postScriptName=font.familyName.replace(/\s/g,"")+"-"+font.styleName;var nameTable=_name.make({copyright:font.copyright,fontFamily:font.familyName,fontSubfamily:font.styleName,uniqueID:font.manufacturer+":"+fullName,fullName:fullName,version:font.version,postScriptName:postScriptName,trademark:font.trademark,manufacturer:font.manufacturer,designer:font.designer,description:font.description,manufacturerURL:font.manufacturerURL,designerURL:font.designerURL,license:font.license,licenseURL:font.licenseURL,preferredFamily:font.familyName,preferredSubfamily:font.styleName});var postTable=post.make();var cffTable=cff.make(font.glyphs,{version:font.version,fullName:fullName,familyName:font.familyName,weightName:font.styleName,postScriptName:postScriptName,unitsPerEm:font.unitsPerEm});var tables=[headTable,hheaTable,maxpTable,os2Table,nameTable,cmapTable,postTable,cffTable,hmtxTable];var sfntTable=makeSfntTable(tables);var bytes=sfntTable.encode();var checkSum=computeCheckSum(bytes);var tableFields=sfntTable.fields;var checkSumAdjusted=false;for(i=0;i<tableFields.length;i+=1){if(tableFields[i].name==="head table"){tableFields[i].value.checkSumAdjustment=2981146554-checkSum;checkSumAdjusted=true;break}}if(!checkSumAdjusted){throw new Error("Could not find head table with checkSum to adjust.")}return sfntTable}exports.computeCheckSum=computeCheckSum;exports.make=makeSfntTable;exports.fontToTable=fontToSfntTable},{"../check":1,"../table":10,"./cff":11,"./cmap":12,"./head":15,"./hhea":16,"./hmtx":17,"./maxp":20,"./name":21,"./os2":22,"./post":23}],25:[function(require,module,exports){var check=require("./check");var LIMIT16=32768;var LIMIT32=2147483648;var decode={};var encode={};var sizeOf={};function constant(v){return function(){return v}}encode.BYTE=function(v){check.argument(v>=0&&v<=255,"Byte value should be between 0 and 255.");return[v]};sizeOf.BYTE=constant(1);encode.CHAR=function(v){return[v.charCodeAt(0)]};sizeOf.CHAR=constant(1);encode.CHARARRAY=function(v){var b=[];for(var i=0;i<v.length;i+=1){b.push(v.charCodeAt(i))}return b};sizeOf.CHARARRAY=function(v){return v.length};encode.USHORT=function(v){return[v>>8&255,v&255]};sizeOf.USHORT=constant(2);encode.SHORT=function(v){if(v>=LIMIT16){v=-(2*LIMIT16-v)}return[v>>8&255,v&255]};sizeOf.SHORT=constant(2);encode.UINT24=function(v){return[v>>16&255,v>>8&255,v&255]};sizeOf.UINT24=constant(3);encode.ULONG=function(v){return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.ULONG=constant(4);encode.LONG=function(v){if(v>=LIMIT32){v=-(2*LIMIT32-v)}return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(v){check.argument(v.length===4,"Tag should be exactly 4 ASCII characters.");return[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(v){if(v>=-107&&v<=107){return[v+139]}else if(v>=108&&v<=1131){v=v-108;return[(v>>8)+247,v&255]}else if(v>=-1131&&v<=-108){v=-v-108;return[(v>>8)+251,v&255]}else if(v>=-32768&&v<=32767){return encode.NUMBER16(v)}else{return encode.NUMBER32(v)}};sizeOf.NUMBER=function(v){return encode.NUMBER(v).length};encode.NUMBER16=function(v){return[28,v>>8&255,v&255]};sizeOf.NUMBER16=constant(3);encode.NUMBER32=function(v){return[29,v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.NUMBER32=constant(5);encode.REAL=function(v){var value=v.toString();var m=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(value);if(m){var epsilon=parseFloat("1e"+((m[2]?+m[2]:0)+m[1].length));value=(Math.round(v*epsilon)/epsilon).toString()}var nibbles="";var i;var ii;for(i=0,ii=value.length;i<ii;i+=1){var c=value[i];if(c==="e"){nibbles+=value[++i]==="-"?"c":"b"}else if(c==="."){nibbles+="a"}else if(c==="-"){nibbles+="e"}else{nibbles+=c}}nibbles+=nibbles.length&1?"f":"ff";var out=[30];for(i=0,ii=nibbles.length;i<ii;i+=2){out.push(parseInt(nibbles.substr(i,2),16))}return out};sizeOf.REAL=function(v){return encode.REAL(v).length};encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;encode.UTF16=function(v){var b=[];for(var i=0;i<v.length;i+=1){var codepoint=v.charCodeAt(i);b.push(codepoint>>8&255);b.push(codepoint&255)}return b};sizeOf.UTF16=function(v){return v.length*2};encode.INDEX=function(l){var i;var offset=1;var offsets=[offset];var data=[];var dataSize=0;for(i=0;i<l.length;i+=1){var v=encode.OBJECT(l[i]);Array.prototype.push.apply(data,v);dataSize+=v.length;offset+=v.length;offsets.push(offset)}if(data.length===0){return[0,0]}var encodedOffsets=[];var offSize=1+Math.floor(Math.log(dataSize)/Math.log(2))/8|0;var offsetEncoder=[undefined,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][offSize];for(i=0;i<offsets.length;i+=1){var encodedOffset=offsetEncoder(offsets[i]);Array.prototype.push.apply(encodedOffsets,encodedOffset)}return Array.prototype.concat(encode.Card16(l.length),encode.OffSize(offSize),encodedOffsets,data)};sizeOf.INDEX=function(v){return encode.INDEX(v).length};encode.DICT=function(m){var d=[];var keys=Object.keys(m);var length=keys.length;for(var i=0;i<length;i+=1){var k=parseInt(keys[i],0);var v=m[k];d=d.concat(encode.OPERAND(v.value,v.type));d=d.concat(encode.OPERATOR(k))}return d};sizeOf.DICT=function(m){return encode.DICT(m).length};encode.OPERATOR=function(v){if(v<1200){return[v]}else{return[12,v-1200]}};encode.OPERAND=function(v,type){var d=[];if(Array.isArray(type)){for(var i=0;i<type.length;i+=1){check.argument(v.length===type.length,"Not enough arguments given for type"+type);d=d.concat(encode.OPERAND(v[i],type[i]))}}else{if(type==="SID"){d=d.concat(encode.NUMBER(v))}else if(type==="offset"){d=d.concat(encode.NUMBER32(v))}else if(type==="number"){d=d.concat(encode.NUMBER(v))}else if(type==="real"){d=d.concat(encode.REAL(v))}else{throw new Error("Unknown operand type "+type)}}return d};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap==="function"&&new WeakMap;encode.CHARSTRING=function(ops){if(wmm&&wmm.has(ops)){return wmm.get(ops)}var d=[];var length=ops.length;for(var i=0;i<length;i+=1){var op=ops[i];d=d.concat(encode[op.type](op.value))}if(wmm){wmm.set(ops,d)}return d};sizeOf.CHARSTRING=function(ops){return encode.CHARSTRING(ops).length};encode.OBJECT=function(v){var encodingFunction=encode[v.type];check.argument(encodingFunction!==undefined,"No encoding function for type "+v.type);return encodingFunction(v.value)};sizeOf.OBJECT=function(v){var sizeOfFunction=sizeOf[v.type];check.argument(sizeOfFunction!==undefined,"No sizeOf function for type "+v.type);return sizeOfFunction(v.value)};encode.TABLE=function(table){var d=[];var length=table.fields.length;for(var i=0;i<length;i+=1){var field=table.fields[i];var encodingFunction=encode[field.type];check.argument(encodingFunction!==undefined,"No encoding function for field type "+field.type);var value=table[field.name];if(value===undefined){value=field.value}var bytes=encodingFunction(value);d=d.concat(bytes)}return d};sizeOf.TABLE=function(table){var numBytes=0;var length=table.fields.length;for(var i=0;i<length;i+=1){var field=table.fields[i];var sizeOfFunction=sizeOf[field.type];check.argument(sizeOfFunction!==undefined,"No sizeOf function for field type "+field.type);var value=table[field.name];if(value===undefined){value=field.value}numBytes+=sizeOfFunction(value)}return numBytes};encode.LITERAL=function(v){return v};sizeOf.LITERAL=function(v){return v.length};exports.decode=decode;exports.encode=encode;exports.sizeOf=sizeOf},{"./check":1}]},{},[7])(7)});define("cobweb/Components/Text/X3DFontStyleNode",["jquery","cobweb/Components/Core/X3DNode","cobweb/InputOutput/Loader","cobweb/Bits/X3DConstants","lib/opentype.js/dist/opentype.js"],function($,X3DNode,Loader,X3DConstants,opentype){var FontDirectories=["http://titania.create3000.de/fileadmin/cobweb/fonts/","https://cdn.rawgit.com/create3000/cobweb/master/cobweb.js/fonts/","https://rawgit.com/create3000/cobweb/master/cobweb.js/fonts/"];var Fonts={SERIF:{PLAIN:"DroidSerif-Regular.ttf",ITALIC:"DroidSerif-Italic.ttf",BOLD:"DroidSerif-Bold.ttf",BOLDITALIC:"DroidSerif-BoldItalic.ttf"},SANS:{PLAIN:"Ubuntu-R.ttf",ITALIC:"Ubuntu-RI.ttf",BOLD:"Ubuntu-B.ttf",BOLDITALIC:"Ubuntu-BI.ttf"},TYPEWRITER:{PLAIN:"UbuntuMono-R.ttf",ITALIC:"UbuntuMono-RI.ttf",BOLD:"UbuntuMono-B.ttf",BOLDITALIC:"UbuntuMono-BI.ttf"}};var i=0;var Alignment={BEGIN:++i,FIRST:++i,MIDDLE:++i,END:++i};function X3DFontStyleNode(browser,executionContext){X3DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DFontStyleNode);this.family=[];this.alignments=[];this.loader=new Loader(this,true)}X3DFontStyleNode.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:X3DFontStyleNode,initialize:function(){X3DNode.prototype.initialize.call(this);this.style_.addInterest(this,"set_style__");this.justify_.addInterest(this,"set_justify__");this.font=null;this.familyIndex=0;this.set_justify__();this.set_style__()},getMajorAlignment:function(){return this.alignments[0]},getMinorAlignment:function(){return this.alignments[1]},set_style__:function(){this.requestAsyncLoad()},set_justify__:function(){var majorNormal=this.horizontal_.getValue()?this.leftToRight_.getValue():this.topToBottom_.getValue();this.alignments[0]=this.justify_.length>0?this.getAlignment(0,majorNormal):majorNormal?Alignment.BEGIN:Alignment.END;var minorNormal=this.horizontal_.getValue()?this.topToBottom_.getValue():this.leftToRight_.getValue();this.alignments[1]=this.justify_.length>1?this.getAlignment(1,minorNormal):minorNormal?Alignment.FIRST:Alignment.END},getAlignment:function(index,normal){if(normal){switch(this.justify_[index]){case"FIRST":return Alignment.FIRST;case"BEGIN":return Alignment.BEGIN;case"MIDDLE":return Alignment.MIDDLE;case"END":return Alignment.END}}else{switch(this.justify_[index]){case"FIRST":return Alignment.END;case"BEGIN":return Alignment.END;case"MIDDLE":return Alignment.MIDDLE;case"END":return Alignment.BEGIN}}return index?Alignment.FIRST:Alignment.BEGIN},requestAsyncLoad:function(){this.familyIndex=0;this.family.length=0;var family=this.family_.copy();family.push("SERIF");for(var i=0;i<family.length;++i){var familyName=family[i],defaultFont=this.getDefaultFont(familyName);if(defaultFont){for(var d=0;d<FontDirectories.length;++d)this.family.push(FontDirectories[d]+defaultFont)}else this.family.push(familyName)}this.loadFont()},loadFont:function(){try{if(this.familyIndex<this.family.length){var familyName=this.family[this.familyIndex],fontPath=this.loader.transform(familyName);opentype.load(fontPath,this.setFont.bind(this))}}catch(error){this.setError(error.message)}},getDefaultFont:function(familyName){var family=Fonts[familyName];if(family){var style=family[this.style_.getValue()];if(style)return style;return family.PLAIN}return},setFont:function(error,font){if(error){this.setError(error)}else{this.font=font;font.fontName=font.familyName+font.styleName;for(var i=0;i<this.font.numGlyphs;++i)this.font.glyphs.get(i).getPath(0,0,1);this.addNodeEvent()}},getFont:function(){return this.font},setError:function(error){console.warn("Font error: "+error+' in url "'+this.family[this.familyIndex]+'"');this.font=null;this.familyIndex++;this.loadFont()}});X3DFontStyleNode.Alignment=Alignment;return X3DFontStyleNode});define("standard/Math/Geometry/Box2",["standard/Math/Numbers/Matrix3","standard/Math/Numbers/Vector2"],function(Matrix3,Vector2){var x=new Vector2(0,0),y=new Vector2(0,0),min=new Vector2(0,0),max=new Vector2(0,0),p1=new Vector2(0,0);function Box2(size,center){switch(arguments.length){case 0:{this.matrix=new Matrix3(.5,0,0,0,.5,0,0,0,0);return}case 2:{this.matrix=new Matrix3(size.x/2,0,0,0,size.y/2,0,center.x,center.y,1);return}case 3:{var min=arguments[0],max=arguments[1],sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2;this.matrix=new Matrix3(sx,0,0,0,sy,0,cx,cy,1);return}}}Box2.prototype={constructor:Box2,copy:function(){var copy=Object.create(Box2.prototype);copy.matrix=this.matrix.copy();return copy},assign:function(box){this.matrix.assign(box.matrix);return this},set:function(size,center){var m=this.matrix;m[0]=size.x/2;m[1]=0;m[2]=0;m[3]=0;m[4]=size.y/2;m[5]=0;m[6]=center.x;m[7]=center.y;m[8]=1;return this},set:function(size,center){var m=this.matrix;switch(arguments.length){case 0:{m[0]=.5;m[1]=0;m[2]=0;m[3]=0;m[4]=.5;m[5]=0;m[6]=0;m[7]=0;m[8]=0;return this}case 2:{m[0]=size.x/2;m[1]=0;m[2]=0;m[3]=0;m[4]=size.y/2;m[5]=0;m[6]=center.x;m[7]=center.y;m[8]=1;return this}case 3:{var min=arguments[0],max=arguments[1],sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2;m[0]=sx;m[1]=0;m[2]=0;m[3]=0;m[4]=sy;m[5]=0;m[6]=cx;m[7]=cy;m[8]=1;return this}}},setExtents:function(min,max){var m=this.matrix,sx=(max.x-min.x)/2,sy=(max.y-min.y)/2,cx=(max.x+min.x)/2,cy=(max.y+min.y)/2;m[0]=sx;m[1]=0;m[2]=0;m[3]=0;m[4]=sy;m[5]=0;m[6]=cx;m[7]=cy;m[8]=1;return this},isEmpty:function(){return this.matrix[8]===0},add:function(box){if(this.isEmpty())return this.assign(box);if(box.isEmpty())return this;var lhs_min=new Vector2(0,0),lhs_max=new Vector2(0,0),rhs_min=new Vector2(0,0),rhs_max=new Vector2(0,0);this.getExtents(lhs_min,lhs_max);box.getExtents(rhs_min,rhs_max);return this.assign(new Box2(lhs_min.min(rhs_min),lhs_max.max(rhs_max),true))},multLeft:function(matrix){this.matrix.multLeft(matrix);return this},multRight:function(matrix){this.matrix.multRight(matrix);return this},getExtents:function(min,max){this.getAbsoluteExtents(min,max);min.add(this.center);max.add(this.center)},getAbsoluteExtents:function(min,max){var m=this.matrix;x.set(m[0],m[1]);y.set(m[3],m[4]);p1.assign(x).add(y);var p2=y.subtract(x);min.assign(p1).min(p2);max.assign(p1).max(p2);p1.negate();p2.negate();min.min(p1,p2);max.max(p1,p2)},intersectsPoint:function(point){this.getExtents(min,max);return min.x<=point.x&&max.x>=point.x&&min.y<=point.y&&max.y>=point.y},toString:function(){return this.size+", "+this.center}};Object.defineProperty(Box2.prototype,"size",{get:function(){var max=new Vector2(0,0);this.getAbsoluteExtents(min,max);return max.subtract(min)},enumerable:true,configurable:false});Object.defineProperty(Box2.prototype,"center",{get:function(){return this.matrix.origin},enumerable:true,configurable:false});return Box2});define("standard/Math/Geometry/Triangle2",[],function(){return{isPointInTriangle:function(a,b,c,point){var det=(b.y-c.y)*(a.x-c.x)+(c.x-b.x)*(a.y-c.y);var u=((b.y-c.y)*(point.x-c.x)+(c.x-b.x)*(point.y-c.y))/det;if(u<0||u>1)return false;var v=((c.y-a.y)*(point.x-c.x)+(a.x-c.x)*(point.y-c.y))/det;if(v<0||v>1)return false;var t=1-u-v;if(t<0||t>1)return false;return true}}});define("lib/bezierjs/bezier.js",[],function(){var abs=Math.abs,min=Math.min,max=Math.max,cos=Math.cos,sin=Math.sin,acos=Math.acos,asin=Math.asin,atan2=Math.atan2,sqrt=Math.sqrt,crt=function(v){if(v<0)return-Math.pow(-v,1/3);return Math.pow(v,1/3)},pi=Math.PI,tau=2*pi,quart=pi/2;var ZERO={x:0,y:0,z:0};var utils={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,derivativeFn){var d=derivativeFn(t);
var l=d.x*d.x+d.y*d.y;if(typeof d.z!=="undefined"){l+=d.z*d.z}return sqrt(l)},length:function(derivativeFn){var z=.5,sum=0,len=this.Tvalues.length,i,t;for(i=0;i<len;i++){t=z*this.Tvalues[i]+z;sum+=this.Cvalues[i]*this.arcfn(t,derivativeFn)}return z*sum},map:function(v,ds,de,ts,te){var d1=de-ds,d2=te-ts,v2=v-ds,r=v2/d1;return ts+d2*r},lerp:function(r,v1,v2){var ret={x:v1.x+r*(v2.x-v1.x),y:v1.y+r*(v2.y-v1.y)};if(!!v1.z&&!!v2.z){ret.z=v1.z+r*(v2.z-v1.z)}return ret},pointToString:function(p){var s=p.x+"/"+p.y;if(typeof p.z!=="undefined"){s+="/"+p.z}return s},pointsToString:function(points){return"["+points.map(this.pointToString).join(", ")+"]"},copy:function(obj){return JSON.parse(JSON.stringify(obj))},angle:function(o,v1,v2){var dx1=v1.x-o.x,dy1=v1.y-o.y,dx2=v2.x-o.x,dy2=v2.y-o.y,cross=dx1*dy2-dy1*dx2,m1=sqrt(dx1*dx1+dy1*dy1),m2=sqrt(dx2*dx2+dy2*dy2),dot;dx1/=m1;dy1/=m1;dx2/=m2;dy2/=m2;dot=dx1*dx2+dy1*dy2;return atan2(cross,dot)},dist:function(p1,p2){var dx=p1.x-p2.x,dy=p1.y-p2.y;return sqrt(dx*dx+dy*dy)},lli8:function(x1,y1,x2,y2,x3,y3,x4,y4){var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),d=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(d==0){return false}return{x:nx/d,y:ny/d}},lli4:function(p1,p2,p3,p4){var x1=p1.x,y1=p1.y,x2=p2.x,y2=p2.y,x3=p3.x,y3=p3.y,x4=p4.x,y4=p4.y;return this.lli8(x1,y1,x2,y2,x3,y3,x4,y4)},lli:function(v1,v2){return this.lli4(v1,v1.c,v2,v2.c)},makeline:function(p1,p2){var x1=p1.x,y1=p1.y,x2=p2.x,y2=p2.y,dx=(x2-x1)/3,dy=(y2-y1)/3;return new Bezier(x1,y1,x1+dx,y1+dy,x1+2*dx,y1+2*dy,x2,y2)},findbbox:function(sections){var mx=99999999,my=mx,MX=-mx,MY=MX;sections.forEach(function(s){var bbox=s.bbox();if(mx>bbox.x.min)mx=bbox.x.min;if(my>bbox.y.min)my=bbox.y.min;if(MX<bbox.x.max)MX=bbox.x.max;if(MY<bbox.y.max)MY=bbox.y.max});return{x:{min:mx,mid:(mx+MX)/2,max:MX,size:MX-mx},y:{min:my,mid:(my+MY)/2,max:MY,size:MY-my}}},shapeintersections:function(s1,bbox1,s2,bbox2){if(!this.bboxoverlap(bbox1,bbox2))return[];var intersections=[];var a1=[s1.startcap,s1.forward,s1.back,s1.endcap];var a2=[s2.startcap,s2.forward,s2.back,s2.endcap];a1.forEach(function(l1){if(l1.virtual)return;a2.forEach(function(l2){if(l2.virtual)return;var iss=l1.intersects(l2);if(iss.length>0){iss.c1=l1;iss.c2=l2;iss.s1=s1;iss.s2=s2;intersections.push(iss)}})});return intersections},makeshape:function(forward,back){var bpl=back.points.length;var fpl=forward.points.length;var start=this.makeline(back.points[bpl-1],forward.points[0]);var end=this.makeline(forward.points[fpl-1],back.points[0]);var shape={startcap:start,forward:forward,back:back,endcap:end,bbox:this.findbbox([start,forward,back,end])};var self=this;shape.intersections=function(s2){return self.shapeintersections(shape,shape.bbox,s2,s2.bbox)};return shape},getminmax:function(curve,d,list){if(!list)return{min:0,max:0};var min=0x10000000000000000,max=-min,t,c;if(list.indexOf(0)===-1){list=[0].concat(list)}if(list.indexOf(1)===-1){list.push(1)}for(var i=0,len=list.length;i<len;i++){t=list[i];c=curve.get(t);if(c[d]<min){min=c[d]}if(c[d]>max){max=c[d]}}return{min:min,mid:(min+max)/2,max:max,size:max-min}},align:function(points,line){var tx=line.p1.x,ty=line.p1.y,a=-atan2(line.p2.y-ty,line.p2.x-tx),d=function(v){return{x:(v.x-tx)*cos(a)-(v.y-ty)*sin(a),y:(v.x-tx)*sin(a)+(v.y-ty)*cos(a)}};return points.map(d)},roots:function(points,line){line=line||{p1:{x:0,y:0},p2:{x:1,y:0}};var order=points.length-1;var p=this.align(points,line);var reduce=function(t){return 0<=t&&t<=1};if(order===2){var a=p[0].y,b=p[1].y,c=p[2].y,d=a-2*b+c;if(d!==0){var m1=-sqrt(b*b-a*c),m2=-a+b,v1=-(m1+m2)/d,v2=-(-m1+m2)/d;return[v1,v2].filter(reduce)}else if(b!==c&&d===0){return[(2*b-c)/2*(b-c)].filter(reduce)}return[]}var pa=p[0].y,pb=p[1].y,pc=p[2].y,pd=p[3].y,d=-pa+3*pb-3*pc+pd,a=(3*pa-6*pb+3*pc)/d,b=(-3*pa+3*pb)/d,c=pa/d,p=(3*b-a*a)/3,p3=p/3,q=(2*a*a*a-9*a*b+27*c)/27,q2=q/2,discriminant=q2*q2+p3*p3*p3,u1,v1,x1,x2,x3;if(discriminant<0){var mp3=-p/3,mp33=mp3*mp3*mp3,r=sqrt(mp33),t=-q/(2*r),cosphi=t<-1?-1:t>1?1:t,phi=acos(cosphi),crtr=crt(r),t1=2*crtr;x1=t1*cos(phi/3)-a/3;x2=t1*cos((phi+tau)/3)-a/3;x3=t1*cos((phi+2*tau)/3)-a/3;return[x1,x2,x3].filter(reduce)}else if(discriminant===0){u1=q2<0?crt(-q2):-crt(q2);x1=2*u1-a/3;x2=-u1-a/3;return[x1,x2].filter(reduce)}else{var sd=sqrt(discriminant);u1=crt(-q2+sd);v1=crt(q2+sd);return[u1-v1-a/3].filter(reduce)}},droots:function(p){if(p.length===3){var a=p[0],b=p[1],c=p[2],d=a-2*b+c;if(d!==0){var m1=-sqrt(b*b-a*c),m2=-a+b,v1=-(m1+m2)/d,v2=-(-m1+m2)/d;return[v1,v2]}else if(b!==c&&d===0){return[(2*b-c)/(2*(b-c))]}return[]}if(p.length===2){var a=p[0],b=p[1];if(a!==b){return[a/(a-b)]}return[]}},bboxoverlap:function(b1,b2){var dims=["x","y"],len=dims.length,i,dim,l,t,d;for(i=0;i<len;i++){dim=dims[i];l=b1[dim].mid;t=b2[dim].mid;d=(b1[dim].size+b2[dim].size)/2;if(abs(l-t)>=d)return false}return true},expandbox:function(bbox,_bbox){if(_bbox.x.min<bbox.x.min){bbox.x.min=_bbox.x.min}if(_bbox.y.min<bbox.y.min){bbox.y.min=_bbox.y.min}if(_bbox.z&&_bbox.z.min<bbox.z.min){bbox.z.min=_bbox.z.min}if(_bbox.x.max>bbox.x.max){bbox.x.max=_bbox.x.max}if(_bbox.y.max>bbox.y.max){bbox.y.max=_bbox.y.max}if(_bbox.z&&_bbox.z.max>bbox.z.max){bbox.z.max=_bbox.z.max}bbox.x.mid=(bbox.x.min+bbox.x.max)/2;bbox.y.mid=(bbox.y.min+bbox.y.max)/2;if(bbox.z){bbox.z.mid=(bbox.z.min+bbox.z.max)/2}bbox.x.size=bbox.x.max-bbox.x.min;bbox.y.size=bbox.y.max-bbox.y.min;if(bbox.z){bbox.z.size=bbox.z.max-bbox.z.min}},pairiteration:function(c1,c2){var c1b=c1.bbox(),c2b=c2.bbox(),r=1e5,threshold=.5;if(c1b.x.size+c1b.y.size<threshold&&c2b.x.size+c2b.y.size<threshold){return[(r*(c1._t1+c1._t2)/2|0)/r+"/"+(r*(c2._t1+c2._t2)/2|0)/r]}var cc1=c1.split(.5),cc2=c2.split(.5),pairs=[{left:cc1.left,right:cc2.left},{left:cc1.left,right:cc2.right},{left:cc1.right,right:cc2.right},{left:cc1.right,right:cc2.left}];pairs=pairs.filter(function(pair){return utils.bboxoverlap(pair.left.bbox(),pair.right.bbox())});var results=[];if(pairs.length===0)return results;pairs.forEach(function(pair){results=results.concat(utils.pairiteration(pair.left,pair.right))});results=results.filter(function(v,i){return results.indexOf(v)===i});return results},getccenter:function(p1,p2,p3){var dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=p3.x-p2.x,dy2=p3.y-p2.y;var dx1p=dx1*cos(quart)-dy1*sin(quart),dy1p=dx1*sin(quart)+dy1*cos(quart),dx2p=dx2*cos(quart)-dy2*sin(quart),dy2p=dx2*sin(quart)+dy2*cos(quart);var mx1=(p1.x+p2.x)/2,my1=(p1.y+p2.y)/2,mx2=(p2.x+p3.x)/2,my2=(p2.y+p3.y)/2;var mx1n=mx1+dx1p,my1n=my1+dy1p,mx2n=mx2+dx2p,my2n=my2+dy2p;var arc=utils.lli8(mx1,my1,mx1n,my1n,mx2,my2,mx2n,my2n),r=utils.dist(arc,p1),s=atan2(p1.y-arc.y,p1.x-arc.x),m=atan2(p2.y-arc.y,p2.x-arc.x),e=atan2(p3.y-arc.y,p3.x-arc.x),_;if(s<e){if(s>m||m>e){s+=tau}if(s>e){_=e;e=s;s=_}}else{if(e<m&&m<s){_=e;e=s;s=_}else{e+=tau}}arc.s=s;arc.e=e;arc.r=r;return arc}};var PolyBezier=function(curves){this.curves=[];this._3d=false;if(!!curves){this.curves=curves;this._3d=this.curves[0]._3d}};PolyBezier.prototype={valueOf:function(){return this.toString()},toString:function(){return utils.pointsToString(this.points)},addCurve:function(curve){this.curves.push(curve);this._3d=this._3d||curve._3d},length:function(){return this.curves.map(function(v){return v.length()}).reduce(function(a,b){return a+b})},curve:function(idx){return this.curves[idx]},bbox:function(){var c=this.curves;var bbox=c[0].bbox();for(var i=1;i<c.length;i++){utils.expandbox(bbox,c[i].bbox())}return bbox},offset:function(d){var offset=[];this.curves.forEach(function(v){offset=offset.concat(v.offset(d))});return new PolyBezier(offset)}};var Bezier=function(coords){var args=coords&&coords.forEach?coords:arguments;if(typeof args[0]==="object"){args=[];for(var i=0;i<coords.length;i++){["x","y","z"].forEach(function(d){if(typeof coords[i][d]!=="undefined"){args.push(coords[i][d])}})}}var len=args.length;if(len!==6&&len!==8&&len!==9&&len!==12){console.log(coords);throw new Error("This Bezier curve library only supports quadratic and cubic curves (in 2d and 3d)")}var _3d=len===9||len===12;this._3d=_3d;var points=[];for(var idx=0,step=_3d?3:2;idx<len;idx+=step){var point={x:args[idx],y:args[idx+1]};if(_3d){point.z=args[idx+2]}points.push(point)}this.order=points.length-1;this.points=points;var dims=["x","y"];if(_3d)dims.push("z");this.dims=dims;this.dimlen=dims.length;(function(curve){var a=utils.align(points,{p1:points[0],p2:points[curve.order]});for(var i=0;i<a.length;i++){if(abs(a[i].y)>1e-4){curve._linear=false;return}}curve._linear=true})(this);this._t1=0;this._t2=1;this.update()};Bezier.fromSVG=function(svgString){var list=svgString.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/g).map(parseFloat);var relative=/[cq]/.test(svgString);if(!relative)return new Bezier(list);list=list.map(function(v,i){return i<2?v:v+list[i%2]});return new Bezier(list)};Bezier.utils=utils;Bezier.prototype={valueOf:function(){return this.toString()},toString:function(){return utils.pointsToString(this.points)},toSVG:function(relative){if(this._3d)return false;var p=this.points,x=p[0].x,y=p[0].y,s=["M",x,y,this.order===2?"Q":"C"];for(var i=1,last=p.length;i<last;i++){s.push(p[i].x);s.push(p[i].y)}return s.join(" ")},update:function(){this.dpoints=[];for(var p=this.points,d=p.length,c=d-1;d>1;d--,c--){var list=[];for(var j=0,dpt;j<c;j++){dpt={x:c*(p[j+1].x-p[j].x),y:c*(p[j+1].y-p[j].y)};if(this._3d){dpt.z=c*(p[j+1].z-p[j].z)}list.push(dpt)}this.dpoints.push(list);p=list}this.computedirection()},computedirection:function(){var points=this.points;var angle=utils.angle(points[0],points[this.order],points[1]);this.clockwise=angle>0},length:function(){return utils.length(this.derivative.bind(this))},getLUT:function(steps){steps=steps||100;var points=[];for(var t=0;t<=steps;t++){points.push(this.compute(t/steps))}return points},get:function(t){return this.compute(t)},point:function(idx){return this.points[idx]},compute:function(t){if(t===0){return this.points[0]}if(t===1){return this.points[this.order]}var mt=1-t,mt2=mt*mt,t2=t*t,a,b,c,d=0,p=this.points;if(this.order===2){p=[p[0],p[1],p[2],ZERO];a=mt2;b=mt*t*2;c=t2}if(this.order===3){a=mt2*mt;b=mt2*t*3;c=mt*t2*3;d=t*t2}var ret={x:a*p[0].x+b*p[1].x+c*p[2].x+d*p[3].x,y:a*p[0].y+b*p[1].y+c*p[2].y+d*p[3].y};if(this._3d){ret.z=a*p[0].z+b*p[1].z+c*p[2].z+d*p[3].z}return ret},raise:function(){var p=this.points,np=[p[0]],i,k=p.length,pi,pim;for(var i=1;i<k;i++){pi=p[i];pim=p[i-1];np[i]={x:(k-i)/k*pi.x+i/k*pim.x,y:(k-i)/k*pi.y+i/k*pim.y}}np[k]=p[k-1];return new Bezier(np)},derivative:function(t){var mt=1-t,a,b,c=0,p=this.dpoints[0];if(this.order===2){p=[p[0],p[1],ZERO];a=mt;b=t}if(this.order===3){a=mt*mt;b=mt*t*2;c=t*t}var ret={x:a*p[0].x+b*p[1].x+c*p[2].x,y:a*p[0].y+b*p[1].y+c*p[2].y};if(this._3d){ret.z=a*p[0].z+b*p[1].z+c*p[2].z}return ret},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var d=this.derivative(t);var q=sqrt(d.x*d.x+d.y*d.y);return{x:-d.y/q,y:d.x/q}},__normal3:function(){var r1=this.derivative(t),r2=this.derivative(t+.01),q1=sqrt(r1.x*r1.x+r1.y*r1.y+r1.z*r1.z),q2=sqrt(r2.x*r2.x+r2.y*r2.y+r2.z*r2.z);r1.x/=q1;r1.y/=q1;r1.z/=q1;r2.x/=q2;r2.y/=q2;r2.z/=q2;var c={x:r2.y*r1.z-r2.z*r1.y,y:r2.z*r1.x-r2.x*r1.z,z:r2.x*r1.y-r2.y*r1.x};var m=sqrt(c.x*c.x+c.y*c.y+c.z*c.z);c.x/=m;c.y/=m;c.z/=m;var R=[c.x*c.x,c.x*c.y-c.z,c.x*c.z+c.y,c.x*c.y+c.z,c.y*c.y,c.y*c.z-c.x,c.x*c.z-c.y,c.y*c.z+c.x,c.z*c.z];var n={x:R[0]*r1.x+R[1]*r1.y+R[2]*r1.z,y:R[3]*r1.x+R[4]*r1.y+R[5]*r1.z,z:R[6]*r1.x+R[7]*r1.y+R[8]*r1.z};return n},split:function(t1,t2){if(t1===0&&!!t2){return this.split(t2).left}if(t2===1){return this.split(t1).right}var p=this.points,_p=[],pt,q=[],idx=0,i=0,l=0;q[idx++]=p[0];q[idx++]=p[1];q[idx++]=p[2];if(this.order===3){q[idx++]=p[3]}while(p.length>1){_p=[];for(i=0,l=p.length-1;i<l;i++){pt=utils.lerp(t1,p[i],p[i+1]);q[idx++]=pt;_p.push(pt)}p=_p}var result={left:this.order===2?new Bezier([q[0],q[3],q[5]]):new Bezier([q[0],q[4],q[7],q[9]]),right:this.order===2?new Bezier([q[5],q[4],q[2]]):new Bezier([q[9],q[8],q[6],q[3]]),span:q};result.left._t1=utils.map(0,0,1,this._t1,this._t2);result.left._t2=utils.map(t1,0,1,this._t1,this._t2);result.right._t1=utils.map(t1,0,1,this._t1,this._t2);result.right._t2=utils.map(1,0,1,this._t1,this._t2);if(!t2){return result}t2=utils.map(t2,t1,1,0,1);var subsplit=result.right.split(t2);return subsplit.left},inflections:function(){var dims=this.dims,len=this.dimlen,result={},roots=[],p,mfn;dims.forEach(function(dim){mfn=function(v){return v[dim]};p=this.dpoints[0].map(mfn);result[dim]=utils.droots(p);if(this.order===3){p=this.dpoints[1].map(mfn);result[dim]=result[dim].concat(utils.droots(p))}result[dim]=result[dim].filter(function(t){return t>=0&&t<=1});roots=roots.concat(result[dim].sort())}.bind(this));roots.sort();result.values=roots;return result},bbox:function(){var inflections=this.inflections(),result={};this.dims.forEach(function(d){result[d]=utils.getminmax(this,d,inflections[d])}.bind(this));return result},overlaps:function(curve){var lbbox=this.bbox(),tbbox=curve.bbox();return utils.bboxoverlap(lbbox,tbbox)},offset:function(t,d){if(typeof d!=="undefined"){var c=this.get(t);var n=this.normal(t);var ret={c:c,n:n,x:c.x+n.x*d,y:c.y+n.y*d};if(this._3d){ret.z=c.z+n.z*d}return ret}if(this._linear){var nv=this.normal(0);var coords=this.points.map(function(p){var ret={x:p.x+t*nv.x,y:p.y+t*nv.y};if(p.z&&n.z){ret.z=p.z+t*nv.z}return ret});return[new Bezier(coords)]}var reduced=this.reduce();return reduced.map(function(s){return s.scale(t)})},simple:function(){if(this.order===3){var a1=utils.angle(this.points[0],this.points[3],this.points[1]);var a2=utils.angle(this.points[0],this.points[3],this.points[2]);if(a1>0&&a2<0||a1<0&&a2>0)return false}var n1=this.normal(0);var n2=this.normal(1);var s=n1.x*n2.x+n1.y*n2.y;if(this._3d){s+=n1.z*n2.z}var angle=abs(acos(s));return angle<pi/3},reduce:function(){var i,t1=0,t2=0,step=.01,segment,pass1=[],pass2=[];var inflections=this.inflections().values;if(inflections.indexOf(0)===-1){inflections=[0].concat(inflections)}if(inflections.indexOf(1)===-1){inflections.push(1)}for(t1=inflections[0],i=1;i<inflections.length;i++){t2=inflections[i];segment=this.split(t1,t2);segment._t1=t1;segment._t2=t2;pass1.push(segment);t1=t2}pass1.forEach(function(p1){t1=0;t2=0;while(t2<=1){for(t2=t1+step;t2<=1+step;t2+=step){segment=p1.split(t1,t2);if(!segment.simple()){t2-=step;if(abs(t1-t2)<step){return[]}segment=p1.split(t1,t2);segment._t1=utils.map(t1,0,1,p1._t1,p1._t2);segment._t2=utils.map(t2,0,1,p1._t1,p1._t2);pass2.push(segment);t1=t2;break}}}if(t1<1){segment=p1.split(t1,1);segment._t1=utils.map(t1,0,1,p1._t1,p1._t2);segment._t2=p1._t2;pass2.push(segment)}});return pass2},scale:function(d){var order=this.order;var distanceFn=false;if(typeof d==="function"){distanceFn=d}if(distanceFn&&order===2){return this.raise().scale(distanceFn)}var clockwise=this.clockwise;var r1=distanceFn?distanceFn(0):d;var r2=distanceFn?distanceFn(1):d;var v=[this.offset(0,10),this.offset(1,10)];var o=utils.lli4(v[0],v[0].c,v[1],v[1].c);if(!o){throw"cannot scale this curve. Try reducing it first."}var points=this.points,np=[];[0,1].forEach(function(t){var p=np[t*order]=utils.copy(points[t*order]);p.x+=(t?r2:r1)*v[t].n.x;p.y+=(t?r2:r1)*v[t].n.y}.bind(this));if(!distanceFn){[0,1].forEach(function(t){if(this.order===2&&!!t)return;var p=np[t*order];var d=this.derivative(t);var p2={x:p.x+d.x,y:p.y+d.y};np[t+1]=utils.lli4(p,p2,o,points[t+1])}.bind(this));return new Bezier(np)}[0,1].forEach(function(t){if(this.order===2&&!!t)return;var p=points[t+1];var ov={x:p.x-o.x,y:p.y-o.y};var rc=distanceFn?distanceFn((t+1)/order):d;if(distanceFn&&!clockwise)rc=-rc;var m=sqrt(ov.x*ov.x+ov.y*ov.y);ov.x/=m;ov.y/=m;np[t+1]={x:p.x+rc*ov.x,y:p.y+rc*ov.y}}.bind(this));return new Bezier(np)},outline:function(d1,d2,d3,d4){d2=typeof d2==="undefined"?d1:d2;var reduced=this.reduce(),len=reduced.length,order=this.order,fcurves=[],bcurves=[],i,p,last,alen=0,tlen=this.length();var graduated=typeof d3!=="undefined"&&typeof d4!=="undefined";function linearDistanceFunction(s,e,tlen,alen,slen){return function(v){var f1=alen/tlen,f2=(alen+slen)/tlen,d=e-s;return utils.map(v,0,1,s+f1*d,s+f2*d)}}reduced.forEach(function(segment){slen=segment.length();if(graduated){fcurves.push(segment.scale(linearDistanceFunction(d1,d3,tlen,alen,slen)));bcurves.push(segment.scale(linearDistanceFunction(-d2,-d4,tlen,alen,slen)))}else{fcurves.push(segment.scale(d1));bcurves.push(segment.scale(-d2))}alen+=slen});bcurves=bcurves.map(function(s){p=s.points;if(p[3]){s.points=[p[3],p[2],p[1],p[0]]}else{s.points=[p[2],p[1],p[0]]}return s}).reverse();var fs=fcurves[0].points[0],fe=fcurves[len-1].points[fcurves[len-1].points.length-1],bs=bcurves[len-1].points[bcurves[len-1].points.length-1],be=bcurves[0].points[0],ls=utils.makeline(bs,fs),le=utils.makeline(fe,be),segments=[ls].concat(fcurves).concat([le]).concat(bcurves),slen=segments.length;return new PolyBezier(segments)},outlineshapes:function(d1,d2){d2=d2||d1;var outline=this.outline(d1,d2).curves;var shapes=[];for(var i=1,len=outline.length;i<len/2;i++){var shape=utils.makeshape(outline[i],outline[len-i]);shape.startcap.virtual=i>1;shape.endcap.virtual=i<len/2-1;shapes.push(shape)}return shapes},intersects:function(curve){if(!curve)return this.selfintersects();if(curve.p1&&curve.p2){return this.lineIntersects(curve)}if(curve instanceof Bezier){curve=curve.reduce()}return this.curveintersects(this.reduce(),curve)},lineIntersects:function(line){var mx=min(line.p1.x,line.p2.x),my=min(line.p1.y,line.p2.y),MX=max(line.p1.x,line.p2.x),MY=max(line.p1.y,line.p2.y),self=this;return utils.roots(this.points,line).filter(function(t){var p=self.get(t);return mx<=p.x&&p.x<=MX&&my<=p.y&&p.y<=MY})},selfintersects:function(){var reduced=this.reduce();var i,len=reduced.length-2,results=[],result,left,right;for(i=0;i<len;i++){left=reduced.slice(i,i+1);right=reduced.slice(i+2);result=this.curveintersects(left,right);results=results.concat(result)}return results},curveintersects:function(c1,c2){var pairs=[];c1.forEach(function(l){c2.forEach(function(r){if(l.overlaps(r)){pairs.push({left:l,right:r})}})});var intersections=[];pairs.forEach(function(pair){var result=utils.pairiteration(pair.left,pair.right);if(result.length>0){intersections=intersections.concat(result)}});return intersections},arcs:function(errorThreshold){errorThreshold=errorThreshold||.5;var circles=[];return this._iterate(errorThreshold,circles)},_error:function(pc,np1,s,e){var q=(e-s)/4,c1=this.get(s+q),c2=this.get(e-q),ref=utils.dist(pc,np1),d1=utils.dist(pc,c1),d2=utils.dist(pc,c2);return abs(d1-ref)+abs(d2-ref)},_iterate:function(errorThreshold,circles){var s=0,e=1,safety;do{safety=0;e=1;var np1=this.get(s),np2,o_np2,np3,o_np3,arc,prev_arc;var curr_good=false,prev_good=false,done;var m=e,prev_e=1,step=0;do{prev_good=curr_good;prev_arc=arc;m=(s+e)/2;step++;np2=this.get(m);np3=this.get(e);arc=utils.getccenter(np1,np2,np3);var error=this._error(arc,np1,s,e);curr_good=error<=errorThreshold;done=prev_good&&!curr_good;if(!done)prev_e=e;if(curr_good){if(e>=1){prev_e=1;prev_arc=arc;break}e=e+(e-s)/2}else{e=m}}while(!done&&safety++<100);if(safety>=100){console.error("arc abstraction somehow failed...");break}prev_arc=prev_arc?prev_arc:arc;circles.push(prev_arc);s=prev_e}while(e<1);return circles}};return Bezier});define("lib/earcut/src/earcut.js",[],function(){function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=filterPoints(data,linkedList(data,0,outerLen,dim,true)),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(data,outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var sum=0,i,j,last;for(i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}if(clockwise===sum>0){for(i=start;i<end;i+=dim)last=insertNode(i,last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,last)}return last}function filterPoints(data,start,end){if(!end)end=start;var node=start,again;do{again=false;if(!node.steiner&&(equals(data,node.i,node.next.i)||orient(data,node.prev.i,node.i,node.next.i)===0)){node.prev.next=node.next;node.next.prev=node.prev;if(node.prevZ)node.prevZ.nextZ=node.nextZ;if(node.nextZ)node.nextZ.prevZ=node.prevZ;node=end=node.prev;if(node===node.next)return null;again=true}else{node=node.next}}while(again||node!==end);return end}function earcutLinked(data,ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&minX!==undefined)indexCurve(data,ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(isEar(data,ear,minX,minY,size)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);next.prev=prev;prev.next=next;if(ear.prevZ)ear.prevZ.nextZ=ear.nextZ;if(ear.nextZ)ear.nextZ.prevZ=ear.prevZ;ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(data,filterPoints(data,ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(data,ear,triangles,dim);earcutLinked(data,ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(data,ear,triangles,dim,minX,minY,size)}break}}}function isEar(data,ear,minX,minY,size){var a=ear.prev.i,b=ear.i,c=ear.next.i,ax=data[a],ay=data[a+1],bx=data[b],by=data[b+1],cx=data[c],cy=data[c+1],abd=ax*by-ay*bx,acd=ax*cy-ay*cx,cbd=cx*by-cy*bx,A=abd-acd-cbd;if(A<=0)return false;var cay=cy-ay,acx=ax-cx,aby=ay-by,bax=bx-ax,i,px,py,s,t,k,node;if(minX!==undefined){var minTX=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,minTY=ay<by?ay<cy?ay:cy:by<cy?by:cy,maxTX=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,maxTY=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);node=ear.nextZ;while(node&&node.z<=maxZ){i=node.i;node=node.nextZ;if(i===a||i===c)continue;px=data[i];py=data[i+1];s=cay*px+acx*py-acd;if(s>=0){t=aby*px+bax*py+abd;if(t>=0){k=A-s-t;if(k>=0&&(s&&t||s&&k||t&&k))return false}}}node=ear.prevZ;while(node&&node.z>=minZ){i=node.i;node=node.prevZ;if(i===a||i===c)continue;px=data[i];py=data[i+1];s=cay*px+acx*py-acd;if(s>=0){t=aby*px+bax*py+abd;if(t>=0){k=A-s-t;if(k>=0&&(s&&t||s&&k||t&&k))return false}}}}else{node=ear.next.next;while(node!==ear.prev){i=node.i;node=node.next;px=data[i];py=data[i+1];s=cay*px+acx*py-acd;if(s>=0){t=aby*px+bax*py+abd;if(t>=0){k=A-s-t;if(k>=0&&(s&&t||s&&k||t&&k))return false}}}}return true}function cureLocalIntersections(data,start,triangles,dim){var node=start;do{var a=node.prev,b=node.next.next;if(a.i!==b.i&&intersects(data,a.i,node.i,node.next.i,b.i)&&locallyInside(data,a,b)&&locallyInside(data,b,a)){triangles.push(a.i/dim);triangles.push(node.i/dim);triangles.push(b.i/dim);a.next=b;b.prev=a;var az=node.prevZ,bz=node.nextZ&&node.nextZ.nextZ;if(az)az.nextZ=bz;if(bz)bz.prevZ=az;node=start=b}node=node.next}while(node!==start);return node}function splitEarcut(data,start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(data,a,b)){var c=splitPolygon(a,b);a=filterPoints(data,a,a.next);c=filterPoints(data,c,c.next);earcutLinked(data,a,triangles,dim,minX,minY,size);earcutLinked(data,c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;list=filterPoints(data,list);if(list)queue.push(getLeftmost(data,list))}queue.sort(function(a,b){return data[a.i]-data[b.i]});for(i=0;i<queue.length;i++){eliminateHole(data,queue[i],outerNode);outerNode=filterPoints(data,outerNode,outerNode.next)}return outerNode}function eliminateHole(data,holeNode,outerNode){outerNode=findHoleBridge(data,holeNode,outerNode);if(outerNode){var b=splitPolygon(outerNode,holeNode);filterPoints(data,b,b.next)}}function findHoleBridge(data,holeNode,outerNode){var node=outerNode,i=holeNode.i,px=data[i],py=data[i+1],qMax=-Infinity,mNode,a,b;do{a=node.i;b=node.next.i;if(py<=data[a+1]&&py>=data[b+1]){var qx=data[a]+(py-data[a+1])*(data[b]-data[a])/(data[b+1]-data[a+1]);if(qx<=px&&qx>qMax){qMax=qx;mNode=data[a]<data[b]?node:node.next}}node=node.next}while(node!==outerNode);if(!mNode)return null;var bx=data[mNode.i],by=data[mNode.i+1],pbd=px*by-py*bx,pcd=px*py-py*qMax,cpy=py-py,pcx=px-qMax,pby=py-by,bpx=bx-px,A=pbd-pcd-(qMax*by-py*bx),sign=A<=0?-1:1,stop=mNode,tanMin=Infinity,mx,my,amx,s,t,tan;node=mNode.next;while(node!==stop){mx=data[node.i];my=data[node.i+1];amx=px-mx;if(amx>=0&&mx>=bx){s=(cpy*mx+pcx*my-pcd)*sign;if(s>=0){t=(pby*mx+bpx*my+pbd)*sign;if(t>=0&&A*sign-s-t>=0){tan=Math.abs(py-my)/amx;if(tan<tanMin&&locallyInside(data,node,holeNode)){mNode=node;tanMin=tan}}}}node=node.next}return mNode}function indexCurve(data,start,minX,minY,size){var node=start;do{if(node.z===null)node.z=zOrder(data[node.i],data[node.i+1],minX,minY,size);node.prevZ=node.prev;node.nextZ=node.next;node=node.next}while(node!==start);node.prevZ.nextZ=null;node.prevZ=null;sortLinked(node)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=1e3*(x-minX)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=1e3*(y-minY)/size;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(data,start){var node=start,leftmost=start;do{if(data[node.i]<data[leftmost.i])leftmost=node;node=node.next}while(node!==start);return leftmost}function isValidDiagonal(data,a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(data,a,a.i,b.i)&&locallyInside(data,a,b)&&locallyInside(data,b,a)&&middleInside(data,a,a.i,b.i)}function orient(data,p,q,r){var o=(data[q+1]-data[p+1])*(data[r]-data[q])-(data[q]-data[p])*(data[r+1]-data[q+1]);return o>0?1:o<0?-1:0}function equals(data,p1,p2){return data[p1]===data[p2]&&data[p1+1]===data[p2+1]}function intersects(data,p1,q1,p2,q2){return orient(data,p1,q1,p2)!==orient(data,p1,q1,q2)&&orient(data,p2,q2,p1)!==orient(data,p2,q2,q1)}function intersectsPolygon(data,start,a,b){var node=start;do{var p1=node.i,p2=node.next.i;if(p1!==a&&p2!==a&&p1!==b&&p2!==b&&intersects(data,p1,p2,a,b))return true;node=node.next}while(node!==start);return false}function locallyInside(data,a,b){return orient(data,a.prev.i,a.i,a.next.i)===-1?orient(data,a.i,b.i,a.next.i)!==-1&&orient(data,a.i,a.prev.i,b.i)!==-1:orient(data,a.i,b.i,a.prev.i)===-1||orient(data,a.i,a.next.i,b.i)===-1}function middleInside(data,start,a,b){var node=start,inside=false,px=(data[a]+data[b])/2,py=(data[a+1]+data[b+1])/2;do{var p1=node.i,p2=node.next.i;if(data[p1+1]>py!==data[p2+1]>py&&px<(data[p2]-data[p1])*(py-data[p1+1])/(data[p2+1]-data[p1+1])+data[p1])inside=!inside;node=node.next}while(node!==start);return inside}function splitPolygon(a,b){var a2=new Node(a.i),b2=new Node(b.i),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,last){var node=new Node(i);if(!last){node.prev=node;node.next=node}else{node.next=last.next;node.prev=last;last.next.prev=node;last.next=node}return node}function Node(i){this.i=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}return earcut});define("cobweb/Components/Text/FontStyle",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Text/X3DFontStyleNode","cobweb/Bits/X3DConstants","cobweb/Browser/Core/PrimitiveQuality","standard/Math/Geometry/Box2","standard/Math/Geometry/Box3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector3","standard/Math/Geometry/Triangle2","standard/Math/Algorithm","lib/bezierjs/bezier.js","lib/poly2tri.js/dist/poly2tri.js","lib/earcut/src/earcut.js"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DFontStyleNode,X3DConstants,PrimitiveQuality,Box2,Box3,Vector2,Vector3,Vector3,Triangle2,Algorithm,Bezier,poly2tri,earcut){with(Fields){var min=new Vector2(0,0),max=new Vector2(0,0),glyphMin=new Vector2(0,0),glyphMax=new Vector2(0,0),min3=new Vector3(0,0,0),max3=new Vector3(0,0,0),size=new Vector2(0,0),center=new Vector2(0,0),lineBound=new Vector2(0,0),origin=new Vector3(0,0,0),box2=new Box2,zero2=new Vector2(0,0),zero3=new Vector3(0,0,0),FONT_SIZE=1;function X3DTextGeometry(text,fontStyle){this.text=text;this.fontStyle=fontStyle;this.glyphs=[];this.minorAlignment=new Vector2(0,0);this.translations=[];this.charSpacings=[];this.bearing=new Vector2(0,0);this.bbox=new Box3}X3DTextGeometry.prototype={constructor:X3DTextGeometry,getBrowser:function(){return this.text.getBrowser()},getText:function(){return this.text},getFontStyle:function(){return this.fontStyle},getGlyphs:function(){return this.glyphs},getMinorAlignment:function(){return this.minorAlignment},getTranslations:function(){return this.translations},getCharSpacings:function(){return this.charSpacings},getBearing:function(){return this.bearing},update:function(){var text=this.text,fontStyle=this.fontStyle,numLines=text.string_.length;text.lineBounds_.length=numLines;this.glyphs.length=0;this.resizeArray(this.translations,Vector2,numLines,0,0);this.resizeArray(this.charSpacings,Vector2,numLines,0,0);if(numLines===0||!fontStyle.getFont()){text.origin_.setValue(zero3);text.textBounds_.setValue(zero2);this.bbox.set();return}if(fontStyle.horizontal_.getValue())this.horizontal(text,fontStyle);else this.horizontal(text,fontStyle)},resizeArray:function(array,constructor,size){var args=Array.prototype.slice.call(arguments,3);for(var i=array.length;i<size;++i){var value=Object.create(constructor.prototype);constructor.apply(value,args);array.push(value)}},horizontal:function(text,fontStyle){var bbox=new Box2,numLines=text.string_.length,topToBottom=fontStyle.topToBottom_.getValue(),lineHeight=fontStyle.spacing_.getValue(),scale=fontStyle.getScale();var first=topToBottom?0:numLines-1,last=topToBottom?numLines:-1,step=topToBottom?1:-1;for(var l=first;l!==last;l+=step){var line=text.string_[l];var glyphs=this.getLineExtents(fontStyle,line,min,max);this.glyphs.push(glyphs);size.assign(max).subtract(min);var lineNumber=topToBottom?l:numLines-l-1;var charSpacing=0,length=text.getLength(l);lineBound.set(size.x,lineNumber==0?size.y:lineHeight).multiply(scale);if(text.maxExtent_.getValue()){if(length)length=Math.min(text.maxExtent_.getValue(),length);else length=Math.min(text.maxExtent_.getValue(),size.x*scale)}if(length){charSpacing=(length-lineBound.x)/(glyphs.length-1);lineBound.x=length;size.x=length/scale}this.charSpacings[l]=charSpacing;text.lineBounds_[l]=lineBound;switch(fontStyle.getMajorAlignment()){case X3DFontStyleNode.Alignment.BEGIN:case X3DFontStyleNode.Alignment.FIRST:this.translations[l].set(0,-(l*lineHeight));break;case X3DFontStyleNode.Alignment.MIDDLE:this.translations[l].set(-min.x-size.x/2,-(l*lineHeight));break;case X3DFontStyleNode.Alignment.END:this.translations[l].set(-min.x-size.x,-(l*lineHeight));break}center.assign(min).add(size).divide(2);bbox.add(box2.set(size.multiply(scale),center.add(this.translations[l]).multiply(scale)));
this.translations[l].multiply(scale)}bbox.getExtents(min,max);size.assign(max).subtract(min);text.textBounds_=size;this.bearing.set(0,-max.y);switch(fontStyle.getMinorAlignment()){case X3DFontStyleNode.Alignment.BEGIN:this.minorAlignment.assign(this.bearing);break;case X3DFontStyleNode.Alignment.FIRST:this.minorAlignment.set(0,0);break;case X3DFontStyleNode.Alignment.MIDDLE:this.minorAlignment.set(0,size.y/2-max.y);break;case X3DFontStyleNode.Alignment.END:this.minorAlignment.set(0,(numLines-1)*lineHeight*scale);break}min.add(this.minorAlignment);max.add(this.minorAlignment);text.origin_.setValue(origin.set(min.x,max.y,0));this.bbox.set(min3.set(min.x,min.y,0),max3.set(max.x,max.y,0),true)},vertical:function(text,fontStyle){},getLineExtents:function(fontStyle,line,min,max){var font=fontStyle.getFont(),normal=fontStyle.horizontal_.getValue()?fontStyle.leftToRight_.getValue():fontStyle.topToBottom_.getValue(),glyphs=font.stringToGlyphs(normal?line:line.split("").reverse().join("")),primitiveQuality=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),xMin=0,xMax=0,yMin=Number.POSITIVE_INFINITY,yMax=Number.NEGATIVE_INFINITY;for(var g=0,length=glyphs.length;g<length;++g){var glyph=glyphs[g],kerning=g+1<length?font.getKerningValue(glyph,glyphs[g+1]):0;this.getGlyphExtents(glyph,primitiveQuality,glyphMin,glyphMax);xMax+=glyph.advanceWidth+kerning;yMin=Math.min(yMin,glyphMin.y);yMax=Math.max(yMax,glyphMax.y)}if(glyphs.length){this.getGlyphExtents(glyphs[0],primitiveQuality,glyphMin,glyphMax);xMin=glyphMin.x}else{yMin=0;yMax=0}min.set(xMin,yMin);max.set(xMax/font.unitsPerEm,yMax);switch(fontStyle.getMajorAlignment()){case X3DFontStyleNode.Alignment.BEGIN:case X3DFontStyleNode.Alignment.FIRST:min.x=0;break;case X3DFontStyleNode.Alignment.MIDDLE:case X3DFontStyleNode.Alignment.END:break}return glyphs}};var normal=new Vector3(0,0,1),vertex=new Vector3(0,0,0);function PolygonText(text,fontStyle){X3DTextGeometry.call(this,text,fontStyle)}PolygonText.prototype=$.extend(Object.create(X3DTextGeometry.prototype),{constructor:PolygonText,build:function(){var fontStyle=this.getFontStyle();if(!fontStyle.getFont())return;if(fontStyle.horizontal_.getValue()){var size=fontStyle.getScale();for(var i=0;i<this.getGlyphs().length;++i)this.render(this.getGlyphs()[i],this.getMinorAlignment(),size,this.getTranslations()[i],this.getCharSpacings()[i])}else{}},render:function(glyphs,minorAlignment,size,translation,charSpacing){var text=this.getText(),fontStyle=this.getFontStyle(),font=fontStyle.getFont(),offset=0,primitiveQuality=this.getBrowser().getBrowserOptions().getPrimitiveQuality(),fontSize=size/FONT_SIZE,sizeUnitsPerEm=size/font.unitsPerEm;for(var g=0;g<glyphs.length;++g){var glyph=glyphs[g],vertices=this.getGlyphGeometry(glyph,primitiveQuality);for(var v=0;v<vertices.length;++v){text.addNormal(normal);text.addVertex(vertex.set(vertices[v].x*fontSize+minorAlignment.x+g*charSpacing+translation.x+offset,vertices[v].y*fontSize+minorAlignment.y+translation.y,0))}var kerning=0;if(g+1<glyphs.length)kerning=font.getKerningValue(glyph,glyphs[g+1]);offset+=(glyph.advanceWidth+kerning)*sizeUnitsPerEm}},getGlyphExtents:function(glyph,primitiveQuality,min,max){var vertices=this.getGlyphGeometry(glyph,primitiveQuality);if(vertices.length){min.assign(vertices[0]);max.assign(vertices[0]);Vector2.prototype.min.apply(min,vertices);Vector2.prototype.max.apply(max,vertices)}else{min.set(0,0,0);max.set(0,0,0)}},getGlyphGeometry:function(glyph,primitiveQuality){var fontStyle=this.getFontStyle(),font=fontStyle.getFont(),glyphCache=this.getBrowser().getGlyphCache();var cachedFont=glyphCache[font.fontName];if(!cachedFont)glyphCache[font.fontName]=cachedFont=[[],[],[]];var cachedGeometry=cachedFont[primitiveQuality][glyph.index];if(cachedGeometry)return cachedGeometry;cachedGeometry=cachedFont[primitiveQuality][glyph.index]=[];this.createGlyphGeometry(glyph,cachedGeometry,primitiveQuality);return cachedGeometry},createGlyphGeometry:function(glyph,vertices,primitiveQuality){var fontStyle=this.getFontStyle(),font=fontStyle.getFont(),paths=[],points=[],curves=[],dimension=this.getBezierDimension(primitiveQuality),reverse=font.outlinesFormat==="cff";paths.length=0;points.length=0;curves.length=0;if(glyph.isComposite){for(var c=0;c<glyph.components.length;++c){var component=glyph.components[c];paths.push(font.glyphs.get(component.glyphIndex).getPath(component.dx/font.unitsPerEm,component.dy/-font.unitsPerEm,FONT_SIZE))}}else paths.push(glyph.getPath(0,0,FONT_SIZE));var x=0,y=0;for(var p=0;p<paths.length;++p){var path=paths[p];for(var i=0;i<path.commands.length;++i){var command=path.commands[i];switch(command.type){case"M":case"Z":{if(points.length>2){if(points[0].x===points[points.length-1].x&&points[0].y===points[points.length-1].y)points.pop();curves.push(reverse?points.reverse().slice():points.slice())}points.length=0;if(command.type==="M")points.push({x:command.x,y:-command.y});break}case"L":{points.push({x:command.x,y:-command.y});break}case"C":{var curve=new Bezier(x,-y,command.x1,-command.y1,command.x2,-command.y2,command.x,-command.y),lut=curve.getLUT(dimension);for(var l=1;l<lut.length;++l)points.push(lut[l]);break}case"Q":{var curve=new Bezier(x,-y,command.x1,-command.y1,command.x,-command.y),lut=curve.getLUT(dimension);for(var l=1;l<lut.length;++l)points.push(lut[l]);break}default:continue}x=command.x;y=command.y}}var contours=[],holes=[];switch(curves.length){case 0:break;case 1:contours=curves;break;default:{for(var i=0;i<curves.length;++i){var curve=curves[i],orientation=this.getCurveOrientation(curve);if(orientation<0)contours.push(curve);else holes.push(curve)}break}}contours.map(this.removeCollinearPoints);holes.map(this.removeCollinearPoints);switch(contours.length){case 0:break;case 1:contours[0].holes=holes;break;default:{for(var c=0;c<contours.length;++c)contours[c].holes=[];for(var h=0;h<holes.length;++h){var hole=holes[h];for(var c=0;c<contours.length;++c){var contour=contours[c];if(this.isPointInPolygon(contour.slice(),hole[0])){contour.holes.push(hole);break}}}break}}for(var i=0;i<contours.length;++i)this.triangulate(contours[i],contours[i].holes,vertices)},getBezierDimension:function(primitiveQuality){switch(primitiveQuality){case PrimitiveQuality.LOW:return 2;case PrimitiveQuality.HIGH:return 5;default:return 3}},getCurveOrientation:function(curve){var minX=Number.POSITIVE_INFINITY,minIndex=0,orientation=0;for(var i=0;i<curve.length;++i){if(curve[i].x<minX){minX=curve[i].x;minIndex=i}}var a=curve[(minIndex+curve.length-1)%curve.length],b=curve[minIndex],c=curve[(minIndex+2)%curve.length];return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)},isPointInPolygon:function(polygon,point){try{var context=new poly2tri.SweepContext(polygon),ts=context.triangulate().getTriangles();for(var i=0;i<ts.length;++i){var a=ts[i].getPoint(0),b=ts[i].getPoint(1),c=ts[i].getPoint(2);if(Triangle2.isPointInTriangle(a,b,c,point))return true}return false}catch(error){}},removeCollinearPoints:function(contour){function isCollinear(a,b,c){return Math.abs((a.y-b.y)*(a.x-c.x)-(a.y-c.y)*(a.x-b.x))<1e-8}var k=0;for(var i=0;i<contour.length;++i){var i0=(i-1+contour.length)%contour.length,i1=(i+1)%contour.length;if(isCollinear(contour[i0],contour[i],contour[i1]))continue;contour[k++]=contour[i]}contour.length=k},triangulate:function(contour,holes,vertices){try{var context=new poly2tri.SweepContext(contour).addHoles(holes),ts=context.triangulate().getTriangles();for(var i=0;i<ts.length;++i){vertices.push(ts[i].getPoint(0));vertices.push(ts[i].getPoint(1));vertices.push(ts[i].getPoint(2))}}catch(error){this.earcutTriangulate(contour,holes,vertices)}},earcutTriangulate:function(contour,holes,vertices){try{var coords=[],holesIndices=[];for(var p=0;p<contour.length;++p)coords.push(contour[p].x,contour[p].y);for(var h=0;h<holes.length;++h){var hole=holes[h];for(var p=0;p<hole.length;++p){holesIndices.push(coords.length/2);coords.push(hole[p].x,hole[p].y);contour.push(hole)}}var t=earcut(coords,holesIndices);for(var i=0;i<t.length;++i)vertices.push(contour[t[i]])}catch(error){}},draw:function(){}});function FontStyle(executionContext){X3DFontStyleNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.FontStyle)}FontStyle.prototype=$.extend(Object.create(X3DFontStyleNode.prototype),{constructor:FontStyle,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"language",new SFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"family",new MFString("SERIF")),new X3DFieldDefinition(X3DConstants.initializeOnly,"style",new SFString("PLAIN")),new X3DFieldDefinition(X3DConstants.initializeOnly,"size",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"spacing",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"horizontal",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"leftToRight",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"topToBottom",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"justify",new MFString("BEGIN"))]),getTypeName:function(){return"FontStyle"},getComponentName:function(){return"Text"},getContainerField:function(){return"fontStyle"},getTextGeometry:function(text){return new PolygonText(text,this)},getScale:function(){return this.size_.getValue()}});return FontStyle}});define("cobweb/Browser/Text/X3DTextContext",["cobweb/Components/Text/FontStyle"],function(FontStyle){function X3DTextContext(){this.glyphCache={}}X3DTextContext.prototype={initialize:function(){this.getBrowser().shutdown().addInterest(this,"set_shutdown_TextContext")},getDefaultFontStyle:function(){if(!this.defaultFontStyle){this.defaultFontStyle=new FontStyle(this.getPrivateScene());this.defaultFontStyle.setup()}return this.defaultFontStyle},getGlyphCache:function(){return this.glyphCache},set_shutdown_TextContext:function(){this.glyphCache={}}};return X3DTextContext});define("cobweb/Components/Texturing/X3DTextureTransformNode",["jquery","cobweb/Components/Shape/X3DAppearanceChildNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Matrix4"],function($,X3DAppearanceChildNode,X3DConstants,Matrix4){function X3DTextureTransformNode(browser,executionContext){X3DAppearanceChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTextureTransformNode);this.matrix=new Matrix4;this.matrixArray=new Float32Array(this.matrix)}X3DTextureTransformNode.prototype=$.extend(Object.create(X3DAppearanceChildNode.prototype),{constructor:X3DTextureTransformNode,setMatrix:function(value){this.matrixArray.set(value)},getMatrix:function(){return this.matrix},getMatrixArray:function(){return this.matrixArray},traverse:function(){this.getBrowser().getTextureTransform()[0]=this}});return X3DTextureTransformNode});define("cobweb/Components/Texturing/TextureTransform",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Texturing/X3DTextureTransformNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2","standard/Math/Numbers/Matrix3","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTextureTransformNode,X3DConstants,Vector2,Matrix3,Matrix4){with(Fields){function TextureTransform(executionContext){X3DTextureTransformNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TextureTransform);this.matrix3=new Matrix3}TextureTransform.prototype=$.extend(Object.create(X3DTextureTransformNode.prototype),{constructor:TextureTransform,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"translation",new SFVec2f),new X3DFieldDefinition(X3DConstants.inputOutput,"rotation",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"scale",new SFVec2f(1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"center",new SFVec2f)]),getTypeName:function(){return"TextureTransform"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"textureTransform"},initialize:function(){X3DTextureTransformNode.prototype.initialize.call(this);this.addInterest(this,"eventsProcessed");this.eventsProcessed()},eventsProcessed:function(){X3DTextureTransformNode.prototype.eventsProcessed.call(this);var matrix3=this.matrix3;matrix3.identity();if(!this.center_.getValue().equals(Vector2.Zero))matrix3.translate(Vector2.negate(this.center_.getValue()));if(!this.scale_.getValue().equals(Vector2.One))matrix3.scale(this.scale_.getValue());if(this.rotation_.getValue()!==0)matrix3.rotate(this.rotation_.getValue());if(!this.center_.getValue().equals(Vector2.Zero))matrix3.translate(this.center_.getValue());if(!this.translation_.getValue().equals(Vector2.Zero))matrix3.translate(this.translation_.getValue());var matrix4=this.getMatrix();matrix4[0]=matrix3[0];matrix4[1]=matrix3[1];matrix4[4]=matrix3[3];matrix4[5]=matrix3[4];matrix4[12]=matrix3[6];matrix4[13]=matrix3[7];this.setMatrix(matrix4)}});return TextureTransform}});define("cobweb/Browser/Texturing/X3DTexturingContext",["cobweb/Components/Texturing/TextureProperties","cobweb/Components/Texturing/TextureTransform","cobweb/Components/Texturing/TextureCoordinate","standard/Math/Numbers/Matrix4","standard/Math/Utility/MatrixStack"],function(TextureProperties,TextureTransform,TextureCoordinate,Matrix4,MatrixStack){function X3DTexturingContext(){this.textureStages=1;this.texture=null;this.textureTransform=[];this.defaultTextureProperties=new TextureProperties(this);this.defaultTextureTransform=new TextureTransform(this);this.defaultTextureCoordinate=new TextureCoordinate(this)}X3DTexturingContext.prototype={initialize:function(){var gl=this.getBrowser().getContext();{this.defaultTextureProperties.magnificationFilter_.setValue("NICEST");this.defaultTextureProperties.minificationFilter_.setValue("AVG_PIXEL_AVG_MIPMAP");this.defaultTextureProperties.textureCompression_.setValue("NICEST");this.defaultTextureProperties.generateMipMaps_.setValue(true)}this.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);this.maxTextureUnits=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.maxCombinedTextureUnits=gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.defaultTextureProperties.setup();this.defaultTextureTransform.setup();this.defaultTextureCoordinate.setup()},getMinTextureSize:function(){return 16},getMaxTextureSize:function(){return this.maxTextureSize},getMaxTextureUnits:function(){return this.maxTextureUnits},getMaxCombinedTextureUnits:function(){return this.maxCombinedTextureUnits},setTexture:function(value){this.texture=value},getTexture:function(){return this.texture},getTextureTransform:function(){return this.textureTransform},getDefaultTextureProperties:function(){return this.defaultTextureProperties},getDefaultTextureTransform:function(){return this.defaultTextureTransform},getDefaultTextureCoordinate:function(){return this.defaultTextureCoordinate}};return X3DTexturingContext});define("cobweb/Browser/Time/X3DTimeContext",["standard/Math/Numbers/Vector3"],function(Vector3){var lastPosition=new Vector3(0,0,0);function X3DTimeContext(){this.currentPosition=new Vector3(0,0,0)}X3DTimeContext.prototype={initialize:function(){this.advanceTime(performance.now())},getCurrentTime:function(){return this.currentTime},advanceTime:function(time){time+=performance.timing.navigationStart;var lastTime=this.currentTime;this.currentTime=time/1e3;this.currentFrameRate=1/(this.currentTime-lastTime);if(this.getWorld()&&this.getActiveLayer()){var cameraSpaceMatrix=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();lastPosition.assign(this.currentPosition);this.currentPosition.set(cameraSpaceMatrix[12],cameraSpaceMatrix[13],cameraSpaceMatrix[14]);this.currentSpeed=lastPosition.subtract(this.currentPosition).abs()*this.currentFrameRate}else this.currentSpeed=0}};return X3DTimeContext});define("cobweb/Routing/X3DRoutingContext",[],function(){function X3DRoutingContext(){this.taintedFields=[];this.taintedFieldsTemp=[];this.taintedNodes=[];this.taintedNodesTemp=[]}X3DRoutingContext.prototype={constructor:X3DRoutingContext,initialize:function(){},addTaintedField:function(field,event){this.taintedFields.push(field,event)},addTaintedNode:function(node){this.taintedNodes.push(node)},processEvents:function(){do{do{var taintedFields=this.taintedFields;this.taintedFields=this.taintedFieldsTemp;this.taintedFields.length=0;for(var i=0,length=taintedFields.length;i<length;i+=2)taintedFields[i].processEvent(taintedFields[i+1]);this.taintedFieldsTemp=taintedFields}while(this.taintedFields.length);do{var taintedNodes=this.taintedNodes;this.taintedNodes=this.taintedNodesTemp;this.taintedNodes.length=0;for(var i=0,length=taintedNodes.length;i<length;++i)taintedNodes[i].processEvents();this.taintedNodesTemp=taintedNodes}while(!this.taintedFields.length&&this.taintedNodes.length)}while(this.taintedFields.length)}};return X3DRoutingContext});define("cobweb/Rendering/DepthBuffer",[],function(){function DepthBuffer(browser,width,height){var gl=browser.getContext();this.browser=browser;this.width=width;this.height=height;this.array=new Uint8Array(width*height*4);this.buffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,this.buffer);this.depthTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.depthTexture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.depthTexture,0);gl.bindTexture(gl.TEXTURE_2D,null);var depthBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,width,height);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthBuffer);if(gl.checkFramebufferStatus(gl.FRAMEBUFFER)!==gl.FRAMEBUFFER_COMPLETE)throw new Error("Couldn't create frame buffer.");gl.bindFramebuffer(gl.FRAMEBUFFER,null)}DepthBuffer.prototype={constructor:DepthBuffer,getDistance:function(radius,zNear,zFar){var gl=this.browser.getContext();gl.readPixels(0,0,this.width,this.height,gl.RGBA,gl.UNSIGNED_BYTE,this.array);var array=this.array,distance=Number.POSITIVE_INFINITY,w1=2/(this.width-1),h1=2/(this.height-1),zWidth=zFar-zNear;for(var py=0,i=0;py<this.height;++py){var y2=Math.pow((py*h1-1)*radius,2);for(var px=0;px<this.width;++px,i+=4){var x=(px*w1-1)*radius,z=zNear+zWidth*(array[i]/255+array[i+1]/65025+array[i+2]/16581375);distance=Math.min(distance,Math.sqrt(x*x+y2+z*z))}}return distance},bind:function(){var gl=this.browser.getContext();gl.bindFramebuffer(gl.FRAMEBUFFER,this.buffer);gl.viewport(0,0,this.width,this.height);gl.scissor(0,0,this.width,this.height);gl.clearColor(1,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)},unbind:function(){var gl=this.browser.getContext();gl.bindFramebuffer(gl.FRAMEBUFFER,null)}};return DepthBuffer});define("standard/Math/Algorithms/QuickSort",[],function(){function QuickSort(array,compare){this.array=array;if(compare)this.compare=compare}QuickSort.prototype={compare:function(lhs,rhs){return lhs<rhs},sort:function(first,last){if(last-first>1)this.quicksort(first,last-1)},quicksort:function(lo,hi){var i=lo,j=hi,array=this.array,compare=this.compare;var x=array[lo+hi>>>1];for(;;){while(compare(array[i],x))++i;while(compare(x,array[j]))--j;if(i<j){var t=array[i];array[i]=array[j];array[j]=t;i++;j--}else{if(i===j)++i,--j;break}}if(lo<j)this.quicksort(lo,j);if(i<hi)this.quicksort(i,hi)}};return QuickSort});define("standard/Math/Geometry/Sphere3",["standard/Math/Numbers/Vector3"],function(Vector3){var L=new Vector3(0,0,0),AB=new Vector3(0,0,0),AC=new Vector3(0,0,0),BC=new Vector3(0,0,0),CA=new Vector3(0,0,0),Q1=new Vector3(0,0,0),Q2=new Vector3(0,0,0),Q3=new Vector3(0,0,0);function Sphere3(radius,center){this.radius=radius;this.center=center.copy()}Sphere3.prototype={constructor:Sphere3,set:function(radius,center){this.radius=radius;this.center.assign(center)},intersectsLine:function(line,intersection1,intersection2){L.assign(this.center).subtract(line.point);var tca=Vector3.dot(L,line.direction);if(tca<0)return false;var d2=Vector3.dot(L,L)-Math.pow(tca,2),r2=Math.pow(this.radius,2);if(d2>r2)return false;var thc=Math.sqrt(r2-d2);var t1=tca-thc,t2=tca+thc;intersection1.assign(line.direction).multiply(t1).add(line.point);intersection2.assign(line.direction).multiply(t2).add(line.point);return true},intersectsTriangle:function(A,B,C){var P=this.center,r=this.radius;A.subtract(P);B.subtract(P);C.subtract(P);AB.assign(B).subtract(A);AC.assign(C).subtract(A);var rr=r*r,V=AB.cross(AC),d=Vector3.dot(A,V),e=Vector3.dot(V,V),sep1=d*d>rr*e;if(sep1)return false;var aa=Vector3.dot(A,A),ab=Vector3.dot(A,B),ac=Vector3.dot(A,C),bb=Vector3.dot(B,B),bc=Vector3.dot(B,C),cc=Vector3.dot(C,C),sep2=aa>rr&&ab>aa&&ac>aa,sep3=bb>rr&&ab>bb&&bc>bb,sep4=cc>rr&&ac>cc&&bc>cc;if(sep2||sep3||sep4)return false;AB.assign(B).subtract(A);BC.assign(C).subtract(B);CA.assign(A).subtract(C);var d1=ab-aa,d2=bc-bb,d3=ac-cc,e1=Vector3.dot(AB,AB),e2=Vector3.dot(BC,BC),e3=Vector3.dot(CA,CA);Q1.assign(A).multiply(e1).subtract(AB.multiply(d1));Q2.assign(B).multiply(e2).subtract(BC.multiply(d2));Q3.assign(C).multiply(e3).subtract(CA.multiply(d3));var QC=C.multiply(e1).subtract(Q1),QA=A.multiply(e2).subtract(Q2),QB=B.multiply(e3).subtract(Q3),sep5=Vector3.dot(Q1,Q1)>rr*e1*e1&&Vector3.dot(Q1,QC)>0,sep6=Vector3.dot(Q2,Q2)>rr*e2*e2&&Vector3.dot(Q2,QA)>0,sep7=Vector3.dot(Q3,Q3)>rr*e3*e3&&Vector3.dot(Q3,QB)>0;if(sep5||sep6||sep7)return false;return true},toString:function(){return this.radius+" "+this.center.toString()}};return Sphere3});define("cobweb/Rendering/X3DRenderer",["jquery","cobweb/Rendering/DepthBuffer","cobweb/Bits/TraverseType","standard/Math/Algorithms/QuickSort","standard/Math/Geometry/Camera","standard/Math/Geometry/Sphere3","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Algorithm"],function($,DepthBuffer,TraverseType,QuickSort,Camera,Sphere3,Vector3,Vector4,Rotation4,Matrix4,Algorithm){var DEPTH_BUFFER_WIDTH=16,DEPTH_BUFFER_HEIGHT=16,projectionMatrix=new Matrix4,modelViewMatrix=new Matrix4,localOrientation=new Rotation4(0,0,1,0),positionOffset=new Vector3(0,0,0),yAxis=new Vector3(0,1,0),zAxis=new Vector3(0,0,1),upVector=new Vector3(0,1,0),vector=new Vector3(0,0,0),rotation=new Rotation4(0,0,1,0);function compareDistance(lhs,rhs){return lhs.distance<rhs.distance}function X3DRenderer(browser,executionContext){this.viewVolumes=[];this.localLights=[];this.numOpaqueShapes=0;this.numTransparentShapes=0;this.numCollisionShapes=0;this.opaqueShapes=[];this.transparentShapes=[];this.transparencySorter=new QuickSort(this.transparentShapes,compareDistance);this.collisionShapes=[];this.activeCollisions={};this.collisionSphere=new Sphere3(0,Vector3.Zero);this.invModelViewMatrix=new Matrix4;this.speed=0;try{this.depthBuffer=new DepthBuffer(this.getBrowser(),DEPTH_BUFFER_WIDTH,DEPTH_BUFFER_HEIGHT)}catch(error){this.distance=0;this.navigate=function(){}}}X3DRenderer.prototype={constructor:X3DRenderer,bboxSize:new Vector3(0,0,0),bboxCenter:new Vector3(0,0,0),translation:new Vector3(0,0,0),initialize:function(){},getViewVolumes:function(){return this.viewVolumes},getViewVolume:function(){return this.viewVolumes[this.viewVolumes.length-1]},getLocalLights:function(){return this.localLights},addShape:function(shape){var modelViewMatrix=this.getBrowser().getModelViewMatrix().get(),bboxSize=modelViewMatrix.multDirMatrix(this.bboxSize.assign(shape.getBBoxSize())),bboxCenter=modelViewMatrix.multVecMatrix(this.bboxCenter.assign(shape.getBBoxCenter())),radius=bboxSize.abs()/2,distance=bboxCenter.z,viewVolume=this.viewVolumes[this.viewVolumes.length-1];if(viewVolume.intersectsSphere(radius,bboxCenter)){if(shape.isTransparent()){if(this.numTransparentShapes===this.transparentShapes.length)this.transparentShapes.push({transparent:true,modelViewMatrix:new Float32Array(16),scissor:new Vector4(0,0,0,0),localLights:[],geometryType:3});var context=this.transparentShapes[this.numTransparentShapes];++this.numTransparentShapes}else{if(this.numOpaqueShapes===this.opaqueShapes.length)this.opaqueShapes.push({transparent:false,modelViewMatrix:new Float32Array(16),scissor:new Vector4(0,0,0,0),localLights:[],geometryType:3});var context=this.opaqueShapes[this.numOpaqueShapes];++this.numOpaqueShapes}context.modelViewMatrix.set(modelViewMatrix);context.shape=shape;context.scissor.assign(viewVolume.getScissor());context.distance=distance;context.fog=this.getFog();var sourceLights=this.localLights,destLights=context.localLights;for(var i=0,length=sourceLights.length;i<length;++i)destLights[i]=sourceLights[i];destLights.length=sourceLights.length}},addCollision:function(shape){var modelViewMatrix=this.getBrowser().getModelViewMatrix().get(),viewVolume=this.viewVolumes[this.viewVolumes.length-1];if(this.numCollisionShapes===this.collisionShapes.length)this.collisionShapes.push({modelViewMatrix:new Float32Array(16),collisions:[]});var context=this.collisionShapes[this.numCollisionShapes];++this.numCollisionShapes;context.modelViewMatrix.set(modelViewMatrix);context.geometry=shape.getGeometry();context.scissor=viewVolume.getScissor();var sourceCollisions=this.getBrowser().getCollisions(),destCollisions=context.collisions;for(var i=0,length=sourceCollisions.length;i<length;++i)destCollisions[i]=sourceCollisions[i];destCollisions.length=sourceCollisions.length},constrainTranslation:function(translation){var t0=performance.now();var navigationInfo=this.getNavigationInfo(),distance=this.getDistance(translation),zFar=navigationInfo.getFarPlane(this.getViewpoint());if(zFar-distance>0){var collisionRadius=navigationInfo.getCollisionRadius();distance-=collisionRadius;if(distance>0){var length=translation.abs();if(length>distance){return translation.normalize().multiply(distance)}return translation}return translation.normalize().multiply(distance)}this.collisionTime+=performance.now()-t0;return translation},getDistance:function(translation){try{var viewpoint=this.getViewpoint(),navigationInfo=this.getNavigationInfo(),collisionRadius=navigationInfo.getCollisionRadius(),bottom=navigationInfo.getStepHeight()-navigationInfo.getAvatarHeight(),zNear=navigationInfo.getNearPlane(),zFar=navigationInfo.getFarPlane(viewpoint);Camera.ortho(-collisionRadius,collisionRadius,bottom,collisionRadius,zNear,zFar,projectionMatrix);localOrientation.assign(viewpoint.orientation_.getValue()).inverse().multRight(viewpoint.getOrientation());rotation.setFromToVec(zAxis,vector.assign(translation).negate()).multRight(localOrientation);modelViewMatrix.assign(viewpoint.getTransformationMatrix());modelViewMatrix.translate(viewpoint.getUserPosition());modelViewMatrix.rotate(rotation);modelViewMatrix.inverse();this.getBrowser().setProjectionMatrix(modelViewMatrix.multRight(projectionMatrix));return this.getDepth()}catch(error){console.log(error)}},getDepth:function(){var browser=this.getBrowser(),gl=browser.getContext(),shader=browser.getDepthShader(),collisionShapes=this.collisionShapes;shader.use();gl.uniformMatrix4fv(shader.projectionMatrix,false,browser.getProjectionMatrixArray());this.depthBuffer.bind();gl.enable(gl.DEPTH_TEST);gl.depthMask(true);gl.disable(gl.BLEND);for(var i=0,length=this.numCollisionShapes;i<length;++i){var context=collisionShapes[i],scissor=context.scissor;gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);gl.uniformMatrix4fv(shader.modelViewMatrix,false,context.modelViewMatrix);context.geometry.collision(shader)}var navigationInfo=this.getNavigationInfo(),viewpoint=this.getViewpoint(),zNear=navigationInfo.getNearPlane(),zFar=navigationInfo.getFarPlane(viewpoint),radius=navigationInfo.getCollisionRadius();var distance=this.depthBuffer.getDistance(radius,zNear,zFar);this.depthBuffer.unbind();return distance},render:function(type){switch(type){case TraverseType.COLLISION:{this.numCollisionShapes=0;this.collect(type);this.collide();this.gravite();break}case TraverseType.DISPLAY:{this.numOpaqueShapes=0;this.numTransparentShapes=0;this.collect(type);this.draw();break}}},collide:function(){var activeCollisions={};this.collisionSphere.radius=this.getNavigationInfo().getCollisionRadius()*1.2;for(var i=0;i<this.numCollisionShapes;++i){try{var context=this.collisionShapes[i],collisions=context.collisions;if(collisions.length){this.invModelViewMatrix.assign(context.modelViewMatrix).multRight(this.getViewpoint().getInverseCameraSpaceMatrix()).inverse();this.collisionSphere.center.set(this.invModelViewMatrix[12],this.invModelViewMatrix[13],this.invModelViewMatrix[14]);if(context.geometry.intersectsSphere(this.collisionSphere)){for(var c=0;c<collisions.length;++c)activeCollisions[collisions[c].getId()]=collisions[c]}}}catch(error){}}if(!$.isEmptyObject(this.activeCollisions)){var inActiveCollisions=$.isEmptyObject(activeCollisions)?this.activeCollisions:Algorithm.set_difference(this.activeCollisions,activeCollisions,{});for(var key in inActiveCollisions)inActiveCollisions[key].set_active(false)}this.activeCollisions=activeCollisions;for(var key in activeCollisions)activeCollisions[key].set_active(true)},gravite:function(){try{if(this.getNavigationInfo().getViewer()!=="WALK")return;var navigationInfo=this.getNavigationInfo(),viewpoint=this.getViewpoint(),collisionRadius=navigationInfo.getCollisionRadius(),zNear=navigationInfo.getNearPlane(),zFar=navigationInfo.getFarPlane(viewpoint),height=navigationInfo.getAvatarHeight(),stepHeight=navigationInfo.getStepHeight();Camera.ortho(-collisionRadius,collisionRadius,-collisionRadius,collisionRadius,zNear,zFar,projectionMatrix);var upVector=viewpoint.getUpVector(),down=rotation.setFromToVec(zAxis,upVector);modelViewMatrix.assign(viewpoint.getTransformationMatrix());modelViewMatrix.translate(viewpoint.getUserPosition());modelViewMatrix.rotate(down);modelViewMatrix.inverse();this.getBrowser().setProjectionMatrix(modelViewMatrix.multRight(projectionMatrix));var distance=this.getDepth();if(zFar-distance>0){distance-=height;var up=rotation.setFromToVec(yAxis,upVector);if(distance>0){var currentFrameRate=this.speed?this.getBrowser().getCurrentFrameRate():1e6;this.speed-=this.getBrowser().getBrowserOptions().Gravity_.getValue()/currentFrameRate;var translation=this.speed/currentFrameRate;if(translation<-distance){translation=-distance;this.speed=0}viewpoint.positionOffset_=viewpoint.positionOffset_.getValue().add(up.multVecRot(vector.set(0,translation,0)))}else{this.speed=0;distance=-distance;if(distance>.01&&distance<stepHeight){var translation=this.constrainTranslation(up.multVecRot(this.translation.set(0,distance,0)));viewpoint.positionOffset_=translation.add(viewpoint.positionOffset_.getValue())}}}else{this.speed=0}}catch(error){console.log(error)}},draw:function(){var browser=this.getBrowser(),gl=browser.getContext(),opaqueShapes=this.opaqueShapes,transparentShapes=this.transparentShapes;browser.getPointShader().setGlobalUniforms();browser.getLineShader().setGlobalUniforms();browser.getDefaultShader().setGlobalUniforms();gl.enable(gl.DEPTH_TEST);gl.depthMask(true);gl.disable(gl.BLEND);for(var i=0,length=this.numOpaqueShapes;i<length;++i){var context=opaqueShapes[i],scissor=context.scissor;gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);context.shape.draw(context)}gl.depthMask(false);gl.enable(gl.BLEND);this.transparencySorter.sort(0,this.numTransparentShapes);for(var i=0,length=this.numTransparentShapes;i<length;++i){var context=transparentShapes[i],scissor=context.scissor;gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);context.shape.draw(context)
}gl.depthMask(true);gl.disable(gl.BLEND);var lights=this.getBrowser().getGlobalLights();for(var i=0;i<lights.length;++i)lights[i].recycle();lights.length=0;var lights=this.getBrowser().getLocalLights();for(var i=0;i<lights.length;++i)lights[i].recycle();lights.length=0}};return X3DRenderer});define("cobweb/Execution/BindableStack",["jquery","cobweb/Basic/X3DBaseNode"],function($,X3DBaseNode){function BindableStack(executionContext,layer,bottom){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.layer=layer;this.array=[bottom];this.setup()}BindableStack.prototype=$.extend(Object.create(X3DBaseNode.prototype),{get:function(){return this.array},top:function(){return this.array[this.array.length-1]},forcePush:function(node){node.isBound_=true;node.bindTime_=this.getBrowser().getCurrentTime();this.push(node)},push:function(node){if(node===this.array[0])return;var top=this.top();if(node!==top){if(top.isBound_.getValue()){top.set_bind_=false;top.isBound_=false}this.pushOnTop(node);if(!node.isBound_.getValue()){node.isBound_=true;node.bindTime_=this.getBrowser().getCurrentTime();node.transitionStart(this.layer,top)}this.addNodeEvent()}},pushOnTop:function(node){var index=this.array.indexOf(node);if(index>-1)this.array.splice(index,1);this.array.push(node)},remove:function(node){if(node===this.array[0])return;var top=this.top();if(node===top)return this.pop(node);var index=this.array.indexOf(node);if(index>-1)this.array.splice(index,1)},pop:function(node){if(node===this.array[0])return;var top=this.top();if(node===top){if(node.isBound_.getValue())node.isBound_=false;this.array.pop();top=this.top();if(!top.isBound_.getValue()){top.set_bind_=true;top.isBound_=true;top.bindTime_=this.getBrowser().getCurrentTime();top.transitionStart(this.layer,node)}this.addNodeEvent()}}});return BindableStack});define("cobweb/Execution/BindableList",["jquery","cobweb/Basic/X3DBaseNode"],function($,X3DBaseNode){function equals(lhs,rhs){if(lhs.length!==rhs.length)return false;for(var i=0;i<lhs.length;++i){if(lhs[i]!==rhs[i])return false}return true}function BindableList(executionContext,layer){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.layer=layer;this.collected=[];this.array=[];this.setup()}BindableList.prototype=$.extend(Object.create(X3DBaseNode.prototype),{get:function(){return this.array},getBound:function(){for(var i=1;i<this.array.length;++i){var node=this.array[i];if(node.isBound_.getValue())return node}if(this.array.length>1)return this.array[1];return this.array[0]},push:function(node){return this.collected.push(node)},update:function(){if(!equals(this.collected,this.array)){for(var i=0;i<this.array.length;++i)this.array[i].set_bind_.removeInterest(this,"set_bind__",this.array[i]);var tmp=this.array;this.array=this.collected;this.collected=tmp;for(var i=0;i<this.array.length;++i)this.array[i].set_bind_.addInterest(this,"set_bind__",this.array[i])}this.collected.length=0},set_bind__:function(bind,node){if(bind.getValue())node.bindToLayer(this.layer);else node.unbindFromLayer(this.layer)}});return BindableList});define("cobweb/Components/Navigation/NavigationInfo",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DBindableNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DBindableNode,TraverseType,X3DConstants){with(Fields){var TransitionType={TELEPORT:true,LINEAR:true,ANIMATE:true};function NavigationInfo(executionContext){X3DBindableNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.NavigationInfo);this.addChildren("availableViewers",new MFString,"viewer",new SFString("EXAMINE"))}NavigationInfo.prototype=$.extend(Object.create(X3DBindableNode.prototype),{constructor:NavigationInfo,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"type",new MFString(["EXAMINE","ANY"])),new X3DFieldDefinition(X3DConstants.inputOutput,"avatarSize",new MFFloat([.25,1.6,.75])),new X3DFieldDefinition(X3DConstants.inputOutput,"speed",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"headlight",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"visibilityLimit",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"transitionType",new MFString("LINEAR")),new X3DFieldDefinition(X3DConstants.inputOutput,"transitionTime",new SFTime(1)),new X3DFieldDefinition(X3DConstants.outputOnly,"transitionComplete",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime)]),getTypeName:function(){return"NavigationInfo"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){X3DBindableNode.prototype.initialize.call(this);this.type_.addInterest(this,"set_type__");this.headlight_.addInterest(this,"set_headlight__");this.set_type__();this.set_headlight__()},set_type__:function(){this.availableViewers_.length=0;var examineViewer=false,walkViewer=false,flyViewer=false,planeViewer=false,noneViewer=false,lookAt=false;this.viewer_="EXAMINE";for(var i=0;i<this.type_.length;++i){var string=this.type_[i];switch(string){case"LOOKAT":continue;case"EXAMINE":case"WALK":case"FLY":case"PLANE":case"NONE":this.viewer_=string;break;case"PLANE_create3000.de":this.viewer_="PLANE";break;default:continue}break}if(!this.type_.length){examineViewer=true;walkViewer=true;flyViewer=true;planeViewer=true;noneViewer=true;lookAt=true}else{for(var i=0;i<this.type_.length;++i){var string=this.type_[i];switch(string){case"EXAMINE":examineViewer=true;continue;case"WALK":walkViewer=true;continue;case"FLY":flyViewer=true;continue;case"PLANE":planeViewer=true;continue;case"NONE":noneViewer=true;continue;case"LOOKAT":lookAt=true;continue}if(string=="ANY"){examineViewer=true;walkViewer=true;flyViewer=true;planeViewer=true;noneViewer=true;lookAt=true;break}examineViewer=true}if(examineViewer)this.availableViewers_.push("EXAMINE");if(walkViewer)this.availableViewers_.push("WALK");if(flyViewer)this.availableViewers_.push("FLY");if(planeViewer)this.availableViewers_.push("PLANE");if(noneViewer)this.availableViewers_.push("NONE");if(lookAt){if(!this.availableViewers_.length){this.viewer_="NONE";this.availableViewers_.push("NONE")}this.availableViewers_.push("LOOKAT")}}},set_headlight__:function(){if(this.headlight_.getValue())this.enable=enable;else delete this.enable},bindToLayer:function(layer){X3DBindableNode.prototype.bindToLayer.call(this,layer);layer.getNavigationInfoStack().push(this)},unbindFromLayer:function(layer){X3DBindableNode.prototype.unbindFromLayer.call(this,layer);layer.getNavigationInfoStack().pop(this)},removeFromLayer:function(layer){layer.getNavigationInfoStack().remove(this)},getViewer:function(){return this.viewer_.getValue()},getCollisionRadius:function(){if(this.avatarSize_.length>0){if(this.avatarSize_[0]>0)return this.avatarSize_[0]}return.25},getAvatarHeight:function(){if(this.avatarSize_.length>1)return this.avatarSize_[1];return 1.6},getStepHeight:function(){if(this.avatarSize_.length>2)return this.avatarSize_[2];return.75},getNearPlane:function(){var zNear=this.getCollisionRadius();if(zNear===0)return 1e-5;else return zNear/2},getFarPlane:function(viewpoint){return this.visibilityLimit_.getValue()?this.visibilityLimit_.getValue():viewpoint.getMaxZFar()},getTransitionType:function(){for(var i=0,length=this.transitionType_.length;i<length;++i){var value=this.transitionType_[i],transitionType=TransitionType[value];if(transitionType)return value}return"LINEAR"},enable:function(){},traverse:function(type){if(type===TraverseType.CAMERA)this.getCurrentLayer().getNavigationInfos().push(this)}});function enable(){this.getBrowser().getGlobalLights().push(this.getBrowser().getHeadlight())}return NavigationInfo}});define("cobweb/Components/EnvironmentalEffects/X3DFogObject",["jquery","cobweb/Bits/X3DConstants"],function($,X3DConstants){function X3DFogObject(browser,executionContext){this.addType(X3DConstants.X3DFogObject);this.hidden=false}X3DFogObject.prototype={constructor:X3DFogObject,initialize:function(){this.fogType_.addInterest(this,"set_fogType__");this.set_fogType__()},set_fogType__:function(){switch(this.fogType_.getValue()){case"EXPONENTIAL":this.fogType=2;break;default:this.fogType=1;break}},setHidden:function(value){this.hidden=value;this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},use:function(gl,shader){if(this.hidden)gl.uniform1i(shader.fogType,0);else{var color=this.color_.getValue(),visibilityRange=Math.max(0,this.visibilityRange_.getValue());if(visibilityRange===0)visibilityRange=this.getCurrentNavigationInfo().getFarPlane(this.getCurrentViewpoint());gl.uniform1i(shader.fogType,this.fogType);gl.uniform3f(shader.fogColor,color.r,color.g,color.b);gl.uniform1f(shader.fogVisibilityRange,visibilityRange)}}};return X3DFogObject});define("cobweb/Components/EnvironmentalEffects/Fog",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DBindableNode","cobweb/Components/EnvironmentalEffects/X3DFogObject","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DBindableNode,X3DFogObject,TraverseType,X3DConstants){with(Fields){function Fog(executionContext){X3DBindableNode.call(this,executionContext.getBrowser(),executionContext);X3DFogObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Fog)}Fog.prototype=$.extend(Object.create(X3DBindableNode.prototype),X3DFogObject.prototype,{constructor:Fog,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"fogType",new SFString("LINEAR")),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFColor(1,1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"visibilityRange",new SFFloat),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime)]),getTypeName:function(){return"Fog"},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){X3DBindableNode.prototype.initialize.call(this);X3DFogObject.prototype.initialize.call(this)},bindToLayer:function(layer){X3DBindableNode.prototype.bindToLayer.call(this,layer);layer.getFogStack().push(this)},unbindFromLayer:function(layer){X3DBindableNode.prototype.unbindFromLayer.call(this,layer);layer.getFogStack().pop(this)},removeFromLayer:function(layer){layer.getFogStack().remove(this)},traverse:function(type){if(type===TraverseType.CAMERA)this.getCurrentLayer().getFogs().push(this)}});return Fog}});define("cobweb/Components/EnvironmentalEffects/X3DBackgroundNode",["jquery","cobweb/Components/Core/X3DBindableNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Numbers/Complex","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Algorithm","standard/Math/Geometry/Camera"],function($,X3DBindableNode,TraverseType,X3DConstants,Complex,Vector3,Rotation4,Matrix4,Algorithm,Camera){var SIZE=1e4,U_DIMENSION=20;var s=Math.sqrt(Math.pow(2*SIZE,2)/2)/2;var texCoords=[1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1];var frontVertices=[s,s,-s,1,-s,s,-s,1,-s,-s,-s,1,s,s,-s,1,-s,-s,-s,1,s,-s,-s,1];var backVertices=[-s,s,s,1,s,s,s,1,s,-s,s,1,-s,s,s,1,s,-s,s,1,-s,-s,s,1];var leftVertices=[-s,s,-s,1,-s,s,s,1,-s,-s,s,1,-s,s,-s,1,-s,-s,s,1,-s,-s,-s,1];var rightVertices=[s,s,s,1,s,s,-s,1,s,-s,-s,1,s,s,s,1,s,-s,-s,1,s,-s,s,1];var topVertices=[s,s,s,1,-s,s,s,1,-s,s,-s,1,s,s,s,1,-s,s,-s,1,s,s,-s,1];var bottomVertices=[s,-s,-s,1,-s,-s,-s,1,-s,-s,s,1,s,-s,-s,1,-s,-s,s,1,s,-s,s,1];var z1=new Complex(0,0),z2=new Complex(0,0),y1=new Complex(0,0),y2=new Complex(0,0),y3=new Complex(0,0),y4=new Complex(0,0);function X3DBackgroundNode(browser,executionContext){X3DBindableNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DBackgroundNode);this.hidden=false;this.modelViewMatrix=new Matrix4;this.modelViewMatrixArray=new Float32Array(16);this.colors=[];this.sphere=[];this.textures=0;this.plane=false}X3DBackgroundNode.prototype=$.extend(Object.create(X3DBindableNode.prototype),{constructor:X3DBackgroundNode,rotation:new Rotation4,orthoMatrix:Camera.ortho(-1,1,-1,1,-1,1,new Matrix4),textureMatrixArray:new Float32Array(new Matrix4),rectangleCount:6,initialize:function(){X3DBindableNode.prototype.initialize.call(this);var gl=this.getBrowser().getContext();this.colorBuffer=gl.createBuffer();this.sphereBuffer=gl.createBuffer();this.texCoordBuffer=gl.createBuffer();this.cubeBuffer=gl.createBuffer();this.texCoordsBuffer=gl.createBuffer();this.frontBuffer=gl.createBuffer();this.backBuffer=gl.createBuffer();this.leftBuffer=gl.createBuffer();this.rightBuffer=gl.createBuffer();this.topBuffer=gl.createBuffer();this.bottomBuffer=gl.createBuffer();this.groundAngle_.addInterest(this,"build");this.groundColor_.addInterest(this,"build");this.skyAngle_.addInterest(this,"build");this.skyColor_.addInterest(this,"build");this.transparency_.addInterest(this,"build");this.build();this.transferRectangle()},set_frontTexture__:function(value){this.setTexture("frontTexture",value,0)},set_backTexture__:function(value){this.setTexture("backTexture",value,1)},set_leftTexture__:function(value){this.setTexture("leftTexture",value,2)},set_rightTexture__:function(value){this.setTexture("rightTexture",value,3)},set_topTexture__:function(value){this.setTexture("topTexture",value,4)},set_bottomTexture__:function(value){this.setTexture("bottomTexture",value,5)},setTexture:function(key,texture,bit){if(this[key])this[key].loadState_.removeInterest(this,"setTextureBit");this[key]=texture;if(texture){texture.loadState_.addInterest(this,"setTextureBit",bit);this.setTextureBit(texture.loadState_,bit)}else this.textures&=~(1<<bit)},setTextureBit:function(loadState,bit){if(loadState.getValue()===X3DConstants.COMPLETE_STATE)this.textures|=1<<bit;else this.textures&=~(1<<bit)},bindToLayer:function(layer){X3DBindableNode.prototype.bindToLayer.call(this,layer);layer.getBackgroundStack().push(this)},unbindFromLayer:function(layer){X3DBindableNode.prototype.unbindFromLayer.call(this,layer);layer.getBackgroundStack().pop(this)},removeFromLayer:function(layer){layer.getBackgroundStack().remove(this)},setHidden:function(value){this.hidden=value;this.getBrowser().addBrowserEvent()},getHidden:function(){return this.hidden},getColor:function(theta,color,angle){var index=Algorithm.upperBound(angle,0,angle.length,theta,Algorithm.less);return color[index]},build:function(){this.colors.length=0;this.sphere.length=0;if(this.transparency_.getValue()>=1)return;var alpha=1-Algorithm.clamp(this.transparency_.getValue(),0,1);if(this.groundColor_.length===0&&this.skyColor_.length==1){this.plane=true;var c=this.skyColor_[0];this.sphere.push(1,1,0,1,-1,1,0,1,-1,-1,0,1);this.sphere.push(1,1,0,1,-1,-1,0,1,1,-1,0,1);this.sphere.vertices=6;for(var i=0,vertices=this.sphere.vertices;i<vertices;++i)this.colors.push(c.r,c.g,c.b,alpha)}else{this.plane=false;var radius=Math.sqrt(2*Math.pow(SIZE,2));if(this.skyColor_.length>this.skyAngle_.length){var vAngle=[];for(var i=0,length=this.skyAngle_.length;i<length;++i)vAngle.push(this.skyAngle_[i]);if(vAngle.length===0||vAngle[0]>0)vAngle.unshift(0);var vAngleMax=this.groundColor_.length>this.groundAngle_.length?Math.PI/2:Math.PI;if(vAngle[vAngle.length-1]<vAngleMax)vAngle.push(vAngleMax);this.buildSphere(radius,vAngle,this.skyAngle_,this.skyColor_,alpha,false)}if(this.groundColor_.length>this.groundAngle_.length){var vAngle=[];for(var i=0,length=this.groundAngle_.length;i<length;++i)vAngle.push(this.groundAngle_[i]);vAngle.reverse();if(vAngle.length===0||vAngle[0]<Math.PI/2)vAngle.unshift(Math.PI/2);if(vAngle[vAngle.length-1]>0)vAngle.push(0);this.buildSphere(radius,vAngle,this.groundAngle_,this.groundColor_,alpha,true)}}this.transferSphere()},buildSphere:function(radius,vAngle,angle,color,alpha,bottom){var phi=0,vAngleMax=bottom?Math.PI/2:Math.PI,V_DIMENSION=vAngle.length-1;for(var v=0;v<V_DIMENSION;++v){var theta1=Algorithm.clamp(vAngle[v],0,vAngleMax),theta2=Algorithm.clamp(vAngle[v+1],0,vAngleMax);if(bottom){theta1=Math.PI-theta1;theta2=Math.PI-theta2}z1.setPolar(radius,theta1);z2.setPolar(radius,theta2);var c1=this.getColor(vAngle[v],color,angle),c2=this.getColor(vAngle[v+1],color,angle);for(var u=0;u<U_DIMENSION;++u){var u1=u<U_DIMENSION-1?u+1:0;phi=2*Math.PI*(u/U_DIMENSION);y1.setPolar(-z1.imag,phi);y2.setPolar(-z2.imag,phi);phi=2*Math.PI*(u1/U_DIMENSION);y3.setPolar(-z2.imag,phi);y4.setPolar(-z1.imag,phi);this.colors.push(c1.r,c1.g,c1.b,alpha,c2.r,c2.g,c2.b,alpha,c2.r,c2.g,c2.b,alpha,c1.r,c1.g,c1.b,alpha,c1.r,c1.g,c1.b,alpha,c2.r,c2.g,c2.b,alpha);this.sphere.push(y1.imag,z1.real,y1.real,1,y3.imag,z2.real,y3.real,1,y2.imag,z2.real,y2.real,1,y1.imag,z1.real,y1.real,1,y4.imag,z1.real,y4.real,1,y3.imag,z2.real,y3.real,1)}}},transferSphere:function(){var gl=this.getBrowser().getContext();gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.colors),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.sphereBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.sphere),gl.STATIC_DRAW);this.sphereCount=this.sphere.length/4},transferRectangle:function(){var gl=this.getBrowser().getContext();gl.bindBuffer(gl.ARRAY_BUFFER,this.texCoordsBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(texCoords),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.frontBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(frontVertices),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.backBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(backVertices),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.leftBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(leftVertices),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.rightBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(rightVertices),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.topBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(topVertices),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.bottomBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(bottomVertices),gl.STATIC_DRAW)},traverse:function(type){switch(type){case TraverseType.CAMERA:{this.getCurrentLayer().getBackgrounds().push(this);break}case TraverseType.DISPLAY:{this.modelViewMatrix.assign(this.getBrowser().getModelViewMatrix().get());break}}},draw:function(viewport){if(this.hidden)return;if(this.plane&&!this.textures){var modelViewMatrix=this.modelViewMatrix;this.getBrowser().setProjectionMatrix(this.orthoMatrix);modelViewMatrix.identity();this.modelViewMatrixArray.set(modelViewMatrix)}else{var viewpoint=this.getCurrentViewpoint(),scale=viewpoint.getScreenScale(SIZE,viewport),rotation=this.rotation,modelViewMatrix=this.modelViewMatrix;scale.multiply(Math.max(viewport[2],viewport[3]));viewpoint.reshapeWithLimits(1,Math.max(2,3*SIZE*scale.z));modelViewMatrix.get(null,rotation);modelViewMatrix.identity();modelViewMatrix.scale(scale);modelViewMatrix.rotate(rotation);this.modelViewMatrixArray.set(modelViewMatrix)}this.drawSphere();if(this.textures)this.drawCube()},drawSphere:function(){var transparency=this.transparency_.getValue();if(transparency>=1)return;var browser=this.getBrowser(),gl=browser.getContext(),shader=browser.getBackgroundSphereShader();shader.use();gl.uniformMatrix4fv(shader.projectionMatrix,false,browser.getProjectionMatrixArray());gl.uniformMatrix4fv(shader.modelViewMatrix,false,this.modelViewMatrixArray);gl.disable(gl.DEPTH_TEST);gl.depthMask(false);if(transparency)gl.enable(gl.BLEND);else gl.disable(gl.BLEND);gl.enableVertexAttribArray(shader.color);gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.vertexAttribPointer(shader.color,4,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(shader.vertex);gl.bindBuffer(gl.ARRAY_BUFFER,this.sphereBuffer);gl.vertexAttribPointer(shader.vertex,4,gl.FLOAT,false,0,0);gl.enable(gl.CULL_FACE);gl.frontFace(gl.CCW);gl.drawArrays(gl.TRIANGLES,0,this.sphereCount);gl.disableVertexAttribArray(shader.color);gl.disableVertexAttribArray(shader.vertex)},drawCube:function(){var browser=this.getBrowser(),gl=browser.getContext(),shader=browser.getGouraudShader();shader.use();gl.uniform1i(shader.fogType,0);gl.uniform1i(shader.colorMaterial,false);gl.uniform1i(shader.lighting,false);gl.uniform1i(shader.texturing,true);gl.uniformMatrix4fv(shader.textureMatrix,false,this.textureMatrixArray);gl.uniformMatrix4fv(shader.projectionMatrix,false,browser.getProjectionMatrixArray());gl.uniformMatrix4fv(shader.modelViewMatrix,false,this.modelViewMatrixArray);gl.disable(gl.DEPTH_TEST);gl.depthMask(false);gl.enable(gl.CULL_FACE);gl.frontFace(gl.CCW);gl.enableVertexAttribArray(shader.texCoord);gl.bindBuffer(gl.ARRAY_BUFFER,this.texCoordsBuffer);gl.vertexAttribPointer(shader.texCoord,4,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(shader.vertex);this.drawRectangle(gl,shader,this.frontTexture,this.frontBuffer);this.drawRectangle(gl,shader,this.backTexture,this.backBuffer);this.drawRectangle(gl,shader,this.leftTexture,this.leftBuffer);this.drawRectangle(gl,shader,this.rightTexture,this.rightBuffer);this.drawRectangle(gl,shader,this.topTexture,this.topBuffer);this.drawRectangle(gl,shader,this.bottomTexture,this.bottomBuffer);gl.disableVertexAttribArray(shader.texCoord);gl.disableVertexAttribArray(shader.vertex)},drawRectangle:function(gl,shader,texture,buffer){if(texture&&texture.checkLoadState()===X3DConstants.COMPLETE_STATE){texture.traverse();if(texture.transparent_.getValue())gl.enable(gl.BLEND);else gl.disable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.vertexAttribPointer(shader.vertex,4,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLES,0,this.rectangleCount)}}});return X3DBackgroundNode});define("cobweb/Components/Texturing/X3DTextureNode",["jquery","cobweb/Fields","cobweb/Components/Shape/X3DAppearanceChildNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DAppearanceChildNode,X3DConstants){with(Fields){var ANISOTROPIC_EXT=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];function X3DTextureNode(browser,executionContext){X3DAppearanceChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTextureNode);this.addChildren("transparent",new SFBool)}X3DTextureNode.prototype=$.extend(Object.create(X3DAppearanceChildNode.prototype),{constructor:X3DTextureNode,initialize:function(){X3DAppearanceChildNode.prototype.initialize.call(this);var gl=this.getBrowser().getContext();this.texture=gl.createTexture()},getTexture:function(){return this.texture},updateTextureProperties:function(target,haveTextureProperties,textureProperties,width,height,repeatS,repeatT,repeatR){var gl=this.getBrowser().getContext();gl.bindTexture(target,this.getTexture());if(Math.max(width,height)<this.getBrowser().getMinTextureSize()&&!haveTextureProperties){gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}else{if(textureProperties.generateMipMaps_.getValue())gl.generateMipmap(gl.TEXTURE_2D);gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,gl[textureProperties.getMinificationFilter()]);gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,gl[textureProperties.getMagnificationFilter()])}if(haveTextureProperties){gl.texParameteri(target,gl.TEXTURE_WRAP_S,gl[textureProperties.getBoundaryModeS()]);gl.texParameteri(target,gl.TEXTURE_WRAP_T,gl[textureProperties.getBoundaryModeT()])}else{gl.texParameteri(target,gl.TEXTURE_WRAP_S,repeatS?gl.REPEAT:gl.CLAMP_TO_EDGE);gl.texParameteri(target,gl.TEXTURE_WRAP_T,repeatT?gl.REPEAT:gl.CLAMP_TO_EDGE)}for(var i=0;i<ANISOTROPIC_EXT.length;++i){var ext=gl.getExtension(ANISOTROPIC_EXT[i]);if(ext){gl.texParameterf(gl.TEXTURE_2D,ext.TEXTURE_MAX_ANISOTROPY_EXT,textureProperties.anisotropicDegree_.getValue());break}}gl.bindTexture(target,null)}});return X3DTextureNode}});define("cobweb/Components/Texturing/X3DTexture2DNode",["jquery","cobweb/Components/Texturing/X3DTextureNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,X3DTextureNode,X3DCast,X3DConstants){function X3DTexture2DNode(browser,executionContext){X3DTextureNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTexture2DNode);this.width=0;this.height=0}X3DTexture2DNode.prototype=$.extend(Object.create(X3DTextureNode.prototype),{constructor:X3DTexture2DNode,initialize:function(){X3DTextureNode.prototype.initialize.call(this);this.repeatS_.addInterest(this,"updateTextureProperties");this.repeatT_.addInterest(this,"updateTextureProperties");this.textureProperties_.addInterest(this,"set_textureProperties__");this.set_textureProperties__()},set_textureProperties__:function(){if(this.texturePropertiesNode)this.texturePropertiesNode.removeInterest(this,"updateTextureProperties");this.texturePropertiesNode=X3DCast(X3DConstants.TextureProperties,this.textureProperties_);if(!this.texturePropertiesNode)this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties();this.texturePropertiesNode.addInterest(this,"updateTextureProperties");this.updateTextureProperties()},getWidth:function(){return this.width},getHeight:function(){return this.height},setTexture:function(width,height,transparent,data,flipY){this.transparent_=transparent;this.width=width;this.height=height;var gl=this.getBrowser().getContext();gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY);gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);gl.bindTexture(gl.TEXTURE_2D,this.getTexture());gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,data);gl.bindTexture(gl.TEXTURE_2D,null);this.updateTextureProperties();this.getBrowser().addBrowserEvent()},updateTexture:function(object){var gl=this.getBrowser().getContext();gl.bindTexture(gl.TEXTURE_2D,this.getTexture());gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,object);if(this.texturePropertiesNode.generateMipMaps_.getValue())gl.generateMipmap(gl.TEXTURE_2D);gl.bindTexture(gl.TEXTURE_2D,null)},updateTextureProperties:function(){var gl=this.getBrowser().getContext();X3DTextureNode.prototype.updateTextureProperties.call(this,gl.TEXTURE_2D,this.textureProperties_.getValue(),this.texturePropertiesNode,this.width,this.height,this.repeatS_.getValue(),this.repeatT_.getValue(),false)},clear:function(){this.setTexture(1,1,false,new Uint8Array([255,255,255,255]),false)},resize:function(input,inputWidth,inputHeight,outputWidth,outputHeight){var output=new Uint8Array(outputWidth*outputHeight*4),scaleX=outputWidth/inputWidth,scaleY=outputHeight/inputHeight;for(var y=0;y<outputHeight;++y){var inputW=Math.floor(y/scaleY)*inputWidth,outputW=y*outputWidth;for(var x=0;x<outputWidth;++x){var index=(inputW+Math.floor(x/scaleX))*4,indexScaled=(outputW+x)*4;output[indexScaled]=input[index];output[indexScaled+1]=input[index+1];output[indexScaled+2]=input[index+2];output[indexScaled+3]=input[index+3]}}return output},traverse:function(){var gl=this.getBrowser().getContext();gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.texture)}});return X3DTexture2DNode});define("cobweb/Components/Texturing/ImageTexture",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Texturing/X3DTexture2DNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Bits/X3DConstants","standard/Networking/URI","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTexture2DNode,X3DUrlObject,X3DConstants,URI,Algorithm){with(Fields){function ImageTexture(executionContext){X3DTexture2DNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ImageTexture);this.urlStack=new MFString}ImageTexture.prototype=$.extend(Object.create(X3DTexture2DNode.prototype),X3DUrlObject.prototype,{constructor:ImageTexture,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatS",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatT",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"textureProperties",new SFNode)]),getTypeName:function(){return"ImageTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){X3DTexture2DNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);this.url_.addInterest(this,"set_url__");this.canvas=$("<canvas>");this.image=$("<img>");this.image.load(this.setImage.bind(this));this.image.error(this.setError.bind(this));this.image.bind("abort",this.setError.bind(this));this.image.attr("crossOrigin","anonymous");this.requestAsyncLoad()},set_url__:function(){this.setLoadState(X3DConstants.NOT_STARTED_STATE);this.requestAsyncLoad()},requestAsyncLoad:function(){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.IN_PROGRESS_STATE)return;this.setLoadState(X3DConstants.IN_PROGRESS_STATE);this.urlStack.setValue(this.url_);this.loadNext()},loadNext:function(){if(this.urlStack.length===0){this.clear();this.setLoadState(X3DConstants.FAILED_STATE);return}this.URL=new URI(this.urlStack.shift());this.URL=this.getExecutionContext().getWorldURL().transform(this.URL);this.image.attr("src",this.URL)},setError:function(){console.warn("Error loading image:",this.URL.toString());this.loadNext()},setImage:function(){try{var image=this.image[0],width=image.width,height=image.height;var canvas=this.canvas[0],cx=canvas.getContext("2d");if(!Algorithm.isPowerOfTwo(width)||!Algorithm.isPowerOfTwo(height)){width=Algorithm.nextPowerOfTwo(width);height=Algorithm.nextPowerOfTwo(height);canvas.width=width;canvas.height=height;cx.drawImage(image,0,0,image.width,image.height,0,0,width,height)}else{canvas.width=width;canvas.height=height;cx.drawImage(image,0,0)}var data=cx.getImageData(0,0,width,height).data,opaque=true;for(var i=3;i<data.length;i+=4){if(data[i]!==255){opaque=false;break}}setTimeout(function(){this.setTexture(width,height,!opaque,new Uint8Array(data),true);this.setLoadState(X3DConstants.COMPLETE_STATE)}.bind(this),16)}catch(error){console.log(error.message);this.setError()}}});return ImageTexture}});define("cobweb/Components/EnvironmentalEffects/Background",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/EnvironmentalEffects/X3DBackgroundNode","cobweb/Components/Texturing/ImageTexture","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DBackgroundNode,ImageTexture,X3DConstants){with(Fields){function Background(executionContext){X3DBackgroundNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Background)}Background.prototype=$.extend(Object.create(X3DBackgroundNode.prototype),{constructor:Background,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_bind",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"frontUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"backUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"leftUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"rightUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"topUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"bottomUrl",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"skyAngle",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"skyColor",new MFColor(new SFColor)),new X3DFieldDefinition(X3DConstants.inputOutput,"groundAngle",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"groundColor",new MFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"transparency",new SFFloat),new X3DFieldDefinition(X3DConstants.outputOnly,"isBound",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"bindTime",new SFTime)]),getTypeName:function(){return"Background"
},getComponentName:function(){return"EnvironmentalEffects"},getContainerField:function(){return"children"},initialize:function(){X3DBackgroundNode.prototype.initialize.call(this);var frontTexture=new ImageTexture(this.getExecutionContext()),backTexture=new ImageTexture(this.getExecutionContext()),leftTexture=new ImageTexture(this.getExecutionContext()),rightTexture=new ImageTexture(this.getExecutionContext()),topTexture=new ImageTexture(this.getExecutionContext()),bottomTexture=new ImageTexture(this.getExecutionContext()),textureProperties=this.getBrowser().getBackgroundTextureProperties();this.frontUrl_.addFieldInterest(frontTexture.url_);this.backUrl_.addFieldInterest(backTexture.url_);this.leftUrl_.addFieldInterest(leftTexture.url_);this.rightUrl_.addFieldInterest(rightTexture.url_);this.topUrl_.addFieldInterest(topTexture.url_);this.bottomUrl_.addFieldInterest(bottomTexture.url_);frontTexture.url_=this.frontUrl_;backTexture.url_=this.backUrl_;leftTexture.url_=this.leftUrl_;rightTexture.url_=this.rightUrl_;topTexture.url_=this.topUrl_;bottomTexture.url_=this.bottomUrl_;frontTexture.textureProperties_=textureProperties;backTexture.textureProperties_=textureProperties;leftTexture.textureProperties_=textureProperties;rightTexture.textureProperties_=textureProperties;topTexture.textureProperties_=textureProperties;bottomTexture.textureProperties_=textureProperties;frontTexture.setup();backTexture.setup();leftTexture.setup();rightTexture.setup();topTexture.setup();bottomTexture.setup();this.set_frontTexture__(frontTexture);this.set_backTexture__(backTexture);this.set_leftTexture__(leftTexture);this.set_rightTexture__(rightTexture);this.set_topTexture__(topTexture);this.set_bottomTexture__(bottomTexture)}});return Background}});define("cobweb/Components/Layering/X3DLayerNode",["jquery","cobweb/Components/Core/X3DNode","cobweb/Rendering/X3DRenderer","cobweb/Components/Layering/X3DViewportNode","cobweb/Execution/BindableStack","cobweb/Execution/BindableList","cobweb/Components/Navigation/NavigationInfo","cobweb/Components/EnvironmentalEffects/Fog","cobweb/Components/EnvironmentalEffects/Background","cobweb/Bits/X3DCast","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Geometry/Line3","standard/Math/Numbers/Vector3"],function($,X3DNode,X3DRenderer,X3DViewportNode,BindableStack,BindableList,NavigationInfo,Fog,Background,X3DCast,TraverseType,X3DConstants,Line3,Vector3){var line=new Line3(new Vector3(0,0,0),new Vector3(0,0,0));function X3DLayerNode(browser,executionContext,defaultViewpoint,group){X3DNode.call(this,browser,executionContext);X3DRenderer.call(this,browser,executionContext);this.addType(X3DConstants.X3DLayerNode);this.defaultNavigationInfo=new NavigationInfo(executionContext);this.defaultBackground=new Background(executionContext);this.defaultFog=new Fog(executionContext);this.defaultViewpoint=defaultViewpoint;this.group=group;this.currentViewport=null;this.navigationInfoStack=new BindableStack(this.getExecutionContext(),this,this.defaultNavigationInfo);this.backgroundStack=new BindableStack(this.getExecutionContext(),this,this.defaultBackground);this.fogStack=new BindableStack(this.getExecutionContext(),this,this.defaultFog);this.viewpointStack=new BindableStack(this.getExecutionContext(),this,this.defaultViewpoint);this.navigationInfos=new BindableList(this.getExecutionContext(),this);this.backgrounds=new BindableList(this.getExecutionContext(),this);this.fogs=new BindableList(this.getExecutionContext(),this);this.viewpoints=new BindableList(this.getExecutionContext(),this);this.defaultBackground.setHidden(true);this.defaultFog.setHidden(true);this.hitRay=line;this.collisionTime=0}X3DLayerNode.prototype=$.extend(Object.create(X3DNode.prototype),X3DRenderer.prototype,{constructor:X3DLayerNode,layer0:false,initialize:function(){X3DNode.prototype.initialize.call(this);X3DRenderer.prototype.initialize.call(this);this.defaultNavigationInfo.setup();this.defaultBackground.setup();this.defaultFog.setup();this.defaultViewpoint.setup();this.group.children_=this.children_;this.group.setup();this.collect=this.group.traverse.bind(this.group);this.viewport_.addInterest(this,"set_viewport__");this.addChildren_.addFieldInterest(this.group.addChildren_);this.removeChildren_.addFieldInterest(this.group.removeChildren_);this.children_.addFieldInterest(this.group.children_);this.set_viewport__()},isLayer0:function(value){this.layer0=value;this.defaultBackground.setHidden(!value)},getViewport:function(){return this.currentViewport},getNavigationInfo:function(){return this.navigationInfoStack.top()},getBackground:function(){return this.backgroundStack.top()},getFog:function(){return this.fogStack.top()},getViewpoint:function(){return this.viewpointStack.top()},getNavigationInfos:function(){return this.navigationInfos},getBackgrounds:function(){return this.backgrounds},getFogs:function(){return this.fogs},getViewpoints:function(){return this.viewpoints},getUserViewpoints:function(){var userViewpoints=[];for(var i=0;i<this.viewpoints.get().length;++i){var viewpoint=this.viewpoints.get()[i];if(viewpoint.description_.length)userViewpoints.push(viewpoint)}return userViewpoints},getNavigationInfoStack:function(){return this.navigationInfoStack},getBackgroundStack:function(){return this.backgroundStack},getFogStack:function(){return this.fogStack},getViewpointStack:function(){return this.viewpointStack},getHitRay:function(){return this.hitRay},set_viewport__:function(){this.currentViewport=X3DCast(X3DConstants.X3DViewportNode,this.viewport_);if(!this.currentViewport)this.currentViewport=this.getBrowser().getDefaultViewport()},bind:function(){this.traverse(TraverseType.CAMERA);if(this.navigationInfos.get().length){var navigationInfo=this.navigationInfos.getBound();this.navigationInfoStack.forcePush(navigationInfo);navigationInfo.bindToLayer(this)}if(this.backgrounds.get().length){var background=this.backgrounds.getBound();this.backgroundStack.forcePush(background);background.bindToLayer(this)}if(this.fogs.get().length){var fog=this.fogs.getBound();this.fogStack.forcePush(fog);fog.bindToLayer(this)}if(this.viewpoints.get().length){var viewpoint=this.viewpoints.getBound();this.viewpointStack.forcePush(viewpoint);viewpoint.bindToLayer(this)}},traverse:function(type){var browser=this.getBrowser();browser.getLayers().push(this);switch(type){case TraverseType.POINTER:this.pointer();break;case TraverseType.CAMERA:this.camera();break;case TraverseType.COLLISION:this.collision();break;case TraverseType.DISPLAY:this.display();break}browser.getLayers().pop()},pointer:function(){if(this.isPickable_.getValue()){var viewport=this.currentViewport.getRectangle();if(this.getBrowser().getSelectedLayer()){if(this.getBrowser().getSelectedLayer()!==this)return}else{if(!this.getBrowser().isPointerInRectangle(viewport))return}this.getViewpoint().reshape();this.getViewpoint().transform();this.hitRay=this.getBrowser().setHitRay(viewport);this.currentViewport.push();this.collect(TraverseType.POINTER);this.currentViewport.pop()}},camera:function(){this.getViewpoint().reshape();this.getBrowser().getModelViewMatrix().identity();this.defaultNavigationInfo.traverse(TraverseType.CAMERA);this.defaultBackground.traverse(TraverseType.CAMERA);this.defaultViewpoint.traverse(TraverseType.CAMERA);this.currentViewport.push();this.collect(TraverseType.CAMERA);this.currentViewport.pop();this.navigationInfos.update();this.backgrounds.update();this.fogs.update();this.viewpoints.update()},collision:function(){this.collisionTime=0;this.getViewpoint().reshape();this.getBrowser().getModelViewMatrix().identity();this.currentViewport.push();this.render(TraverseType.COLLISION);this.currentViewport.pop()},display:function(type){var gl=this.getBrowser().getContext(),viewport=this.currentViewport.getRectangle();gl.viewport(viewport[0],viewport[1],viewport[2],viewport[3]);gl.scissor(viewport[0],viewport[1],viewport[2],viewport[3]);gl.clear(gl.DEPTH_BUFFER_BIT);this.getBackground().draw(viewport);this.getNavigationInfo().enable();this.getViewpoint().reshape();this.getViewpoint().transform();this.currentViewport.push();this.render(TraverseType.DISPLAY);this.currentViewport.pop()},collect:function(type){}});return X3DLayerNode});define("cobweb/Components/Grouping/Group",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DConstants){with(Fields){function Group(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Group)}Group.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:Group,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Group"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});return Group}});define("cobweb/Components/Layering/Layer",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Layering/X3DLayerNode","cobweb/Components/Navigation/Viewpoint","cobweb/Components/Grouping/Group","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DLayerNode,Viewpoint,Group,X3DConstants){with(Fields){function Layer(executionContext){X3DLayerNode.call(this,executionContext.getBrowser(),executionContext,new Viewpoint(executionContext),new Group(executionContext));this.addType(X3DConstants.Layer)}Layer.prototype=$.extend(Object.create(X3DLayerNode.prototype),{constructor:Layer,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"isPickable",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"viewport",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Layer"},getComponentName:function(){return"Layering"},getContainerField:function(){return"layers"}});return Layer}});define("cobweb/Components/Layering/LayerSet",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Layering/Layer","cobweb/Bits/X3DCast","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,Layer,X3DCast,TraverseType,X3DConstants){with(Fields){function LayerSet(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.LayerSet);this.layerNodes=[new Layer(executionContext)];this.layerNode0=this.layerNodes[0];this.activeLayerNode=null}LayerSet.prototype=$.extend(Object.create(X3DNode.prototype),{constructor:LayerSet,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"activeLayer",new SFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"order",new MFInt32(0)),new X3DFieldDefinition(X3DConstants.inputOutput,"layers",new MFNode)]),getTypeName:function(){return"LayerSet"},getComponentName:function(){return"Layering"},getContainerField:function(){return"children"},initialize:function(){X3DNode.prototype.initialize.call(this);this.layerNode0.setup();this.layerNode0.isLayer0(true);this.activeLayer_.addInterest(this,"set_activeLayer");this.order_.addInterest(this,"set_layers");this.layers_.addInterest(this,"set_layers");this.set_layers()},getActiveLayer:function(){return this.activeLayerNode},setLayer0:function(value){this.layerNode0=value;this.set_layers()},getLayer0:function(){return this.layerNode0},getLayers:function(){return this.layerNodes},set_activeLayer:function(){if(this.activeLayer_.getValue()===0){if(this.activeLayerNode!==this.layerNode0)this.activeLayerNode=this.layerNode0}else{var index=this.activeLayer_-1;if(index>=0&&index<this.layers_.length){if(this.activeLayerNode!==this.layers_[index].getValue())this.activeLayerNode=this.layers_[index].getValue()}else{if(this.activeLayerNode!==null)this.activeLayerNode=null}}},set_layers:function(){this.layerNodes.length=0;for(var i=0;i<this.order_.length;++i){var index=this.order_[i];if(index===0)this.layerNodes.push(this.layerNode0);else{--index;if(index>=0&&index<this.layers_.length){var layerNode=X3DCast(X3DConstants.X3DLayerNode,this.layers_[index]);if(layerNode)this.layerNodes.push(layerNode)}}}this.set_activeLayer()},bind:function(){this.layerNode0.bind();for(var i=0;i<this.layers_.length;++i){var layer=this.layers_[i];var layerNode=X3DCast(X3DConstants.X3DLayerNode,layer);if(layerNode)layerNode.bind()}},traverse:function(type){if(type===TraverseType.POINTER){var layerNumber=0;for(var i=0;i<this.layerNodes.length;++i){var layerNode=this.layerNodes[i];this.getBrowser().setLayerNumber(layerNumber++);layerNode.traverse(type)}}else{for(var i=0;i<this.layerNodes.length;++i){this.layerNodes[i].traverse(type)}}}});return LayerSet}});define("cobweb/Execution/World",["jquery","cobweb/Fields/SFNode","cobweb/Basic/X3DBaseNode","cobweb/Components/Layering/LayerSet","cobweb/Components/Layering/Layer","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,SFNode,X3DBaseNode,LayerSet,Layer,X3DCast,X3DConstants){function World(executionContext){X3DBaseNode.call(this,executionContext.getBrowser(),executionContext);this.layerSet=new LayerSet(executionContext);this.defaultLayerSet=this.layerSet;this.layer0=new Layer(executionContext);this.addChildren("activeLayer",new SFNode(this.layer0))}World.prototype=$.extend(Object.create(X3DBaseNode.prototype),{constructor:World,getTypeName:function(){return"World"},initialize:function(){X3DBaseNode.prototype.initialize.call(this);this.layerSet.setup();this.layerSet.setLayer0(this.layer0);this.layerSet.activeLayer_.addInterest(this,"set_activeLayer");this.getExecutionContext().getRootNodes().addInterest(this,"set_rootNodes");this.getExecutionContext().setup();this.set_rootNodes();this.layer0.isLayer0(true);this.layer0.setup();this.bind()},getLayerSet:function(){return this.layerSet},getActiveLayer:function(){return this.activeLayer_.getValue()},set_rootNodes:function(){var oldLayerSet=this.layerSet;this.layerSet=this.defaultLayerSet;var rootNodes=this.getExecutionContext().getRootNodes();this.layer0.children_=rootNodes;for(var i=0;i<rootNodes.length;++i){var rootLayerSet=X3DCast(X3DConstants.LayerSet,rootNodes[i]);if(rootLayerSet){rootLayerSet.setLayer0(this.layer0);this.layerSet=rootLayerSet}}if(this.layerSet!==oldLayerSet){oldLayerSet.activeLayer_.removeInterest(this,"set_activeLayer");this.layerSet.activeLayer_.addInterest(this,"set_activeLayer");this.set_activeLayer()}this.traverse=this.layerSet.traverse.bind(this.layerSet)},set_activeLayer:function(){this.activeLayer_=this.layerSet.getActiveLayer()},bind:function(){this.layerSet.bind();try{var fragment=this.getExecutionContext().getWorldURL().fragment;if(fragment.length)this.getExecutionContext().changeViewpoint(fragment)}catch(error){}}});return World});define("cobweb/Browser/X3DBrowserContext",["jquery","cobweb/Fields/SFTime","cobweb/Basic/X3DBaseNode","cobweb/Browser/Core/X3DCoreContext","cobweb/Browser/Networking/X3DNetworkingContext","cobweb/Browser/Rendering/X3DRenderingContext","cobweb/Browser/Geometry2D/X3DGeometry2DContext","cobweb/Browser/Geometry3D/X3DGeometry3DContext","cobweb/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext","cobweb/Browser/KeyDeviceSensor/X3DKeyDeviceSensorContext","cobweb/Browser/Navigation/X3DNavigationContext","cobweb/Browser/Layering/X3DLayeringContext","cobweb/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext","cobweb/Browser/Lighting/X3DLightingContext","cobweb/Browser/Scripting/X3DScriptingContext","cobweb/Browser/Shaders/X3DShadersContext","cobweb/Browser/Shape/X3DShapeContext","cobweb/Browser/Sound/X3DSoundContext","cobweb/Browser/Text/X3DTextContext","cobweb/Browser/Texturing/X3DTexturingContext","cobweb/Browser/Time/X3DTimeContext","cobweb/Routing/X3DRoutingContext","cobweb/Execution/World","cobweb/Bits/TraverseType"],function($,SFTime,X3DBaseNode,X3DCoreContext,X3DNetworkingContext,X3DRenderingContext,X3DGeometry2DContext,X3DGeometry3DContext,X3DPointingDeviceSensorContext,X3DKeyDeviceSensorContext,X3DNavigationContext,X3DLayeringContext,X3DEnvironmentalEffectsContext,X3DLightingContext,X3DScriptingContext,X3DShadersContext,X3DShapeContext,X3DSoundContext,X3DTextContext,X3DTexturingContext,X3DTimeContext,X3DRoutingContext,World,TraverseType){function X3DBrowserContext(xml){X3DBaseNode.call(this,this,this);X3DCoreContext.call(this,xml);X3DNetworkingContext.call(this);X3DRenderingContext.call(this);X3DGeometry2DContext.call(this);X3DGeometry3DContext.call(this);X3DPointingDeviceSensorContext.call(this);X3DKeyDeviceSensorContext.call(this);X3DNavigationContext.call(this);X3DLayeringContext.call(this);X3DEnvironmentalEffectsContext.call(this);X3DLightingContext.call(this);X3DScriptingContext.call(this);X3DShadersContext.call(this);X3DShapeContext.call(this);X3DSoundContext.call(this);X3DTextContext.call(this);X3DTexturingContext.call(this);X3DTimeContext.call(this);X3DRoutingContext.call(this);this.changedTime=0;this.renderCallback=this.traverse.bind(this);this.systemTime=0;this.systemStartTime=0;this.browserTime=0;this.pickingTime=0;this.cameraTime=0;this.collisionTime=0;this.displayTime=0}X3DBrowserContext.prototype=$.extend(Object.create(X3DBaseNode.prototype),X3DCoreContext.prototype,X3DNetworkingContext.prototype,X3DRenderingContext.prototype,X3DGeometry2DContext.prototype,X3DGeometry3DContext.prototype,X3DPointingDeviceSensorContext.prototype,X3DKeyDeviceSensorContext.prototype,X3DNavigationContext.prototype,X3DLayeringContext.prototype,X3DEnvironmentalEffectsContext.prototype,X3DLightingContext.prototype,X3DScriptingContext.prototype,X3DShadersContext.prototype,X3DShapeContext.prototype,X3DSoundContext.prototype,X3DTextContext.prototype,X3DTexturingContext.prototype,X3DTimeContext.prototype,X3DRoutingContext.prototype,{constructor:X3DBrowserContext,initialize:function(){this.addChildren("initialized",new SFTime,"shutdown",new SFTime,"prepareEvents",new SFTime,"sensors",new SFTime,"finished",new SFTime);X3DBaseNode.prototype.initialize.call(this);X3DCoreContext.prototype.initialize.call(this);X3DNetworkingContext.prototype.initialize.call(this);X3DRenderingContext.prototype.initialize.call(this);X3DGeometry2DContext.prototype.initialize.call(this);X3DGeometry3DContext.prototype.initialize.call(this);X3DPointingDeviceSensorContext.prototype.initialize.call(this);X3DKeyDeviceSensorContext.prototype.initialize.call(this);X3DNavigationContext.prototype.initialize.call(this);X3DLayeringContext.prototype.initialize.call(this);X3DEnvironmentalEffectsContext.prototype.initialize.call(this);X3DLightingContext.prototype.initialize.call(this);X3DScriptingContext.prototype.initialize.call(this);X3DShadersContext.prototype.initialize.call(this);X3DShapeContext.prototype.initialize.call(this);X3DSoundContext.prototype.initialize.call(this);X3DTextContext.prototype.initialize.call(this);X3DTexturingContext.prototype.initialize.call(this);X3DTimeContext.prototype.initialize.call(this);X3DRoutingContext.prototype.initialize.call(this)},initialized:function(){return this.initialized_},shutdown:function(){return this.shutdown_},prepareEvents:function(){return this.prepareEvents_},sensors:function(){return this.sensors_},finished:function(){return this.finished_},getWorld:function(){return this.world},setExecutionContext:function(executionContext){this.world=new World(executionContext);this.world.setup()},getExecutionContext:function(){return this.world.getExecutionContext()},addBrowserEvent:function(){if(this.changedTime===this.getCurrentTime())return;this.changedTime=this.getCurrentTime();requestAnimationFrame(this.renderCallback)},traverse:function(time){var t0=performance.now();this.systemTime=t0-this.systemStartTime;this.advanceTime(time);this.prepareEvents_.processInterests();this.processEvents();var t1=performance.now();this.world.traverse(TraverseType.CAMERA);this.cameraTime=performance.now()-t1;var t2=performance.now();if(this.getCollisionCount())this.world.traverse(TraverseType.COLLISION);this.collisionTime=performance.now()-t2;this.sensors_.processInterests();this.processEvents();var t3=performance.now();this.context.clearColor(0,0,0,0);this.context.clear(this.context.COLOR_BUFFER_BIT);this.world.traverse(TraverseType.DISPLAY);this.displayTime=performance.now()-t3;this.browserTime=performance.now()-t0;this.systemStartTime=performance.now();this.finished_.processInterests()}});return X3DBrowserContext});define("cobweb/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",["jquery","cobweb/Components/Core/X3DSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector4","standard/Math/Numbers/Matrix4"],function($,X3DSensorNode,X3DConstants,Vector4,Matrix4){function X3DPointingDeviceSensorNode(browser,executionContext){X3DSensorNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DPointingDeviceSensorNode)}X3DPointingDeviceSensorNode.prototype=$.extend(Object.create(X3DSensorNode.prototype),{constructor:X3DPointingDeviceSensorNode,initialize:function(){X3DSensorNode.prototype.initialize.call(this);this.enabled_.addInterest(this,"set_enabled__");this.matrices={}},getMatrices:function(){return this.matrices},set_enabled__:function(){if(this.enabled_.getValue())return;if(this.isActive_.getValue())this.isActive_=false;if(this.isOver_.getValue())this.isOver_=false},set_over__:function(hit,value){if(value!==this.isOver_.getValue()){this.isOver_=value;if(this.isOver_.getValue())this.getBrowser().getNotification().string_=this.description_}},set_active__:function(hit,value){if(value!==this.isActive_.getValue())this.isActive_=value},traverse:function(sensors){if(this.enabled_.getValue()){var currentLayer=this.getCurrentLayer();sensors[this.getId()]=this;if(!(currentLayer.getId()in this.matrices)){this.matrices[currentLayer.getId()]={modelViewMatrix:new Matrix4,projectionMatrix:new Matrix4,viewport:new Vector4}}var matrices=this.matrices[currentLayer.getId()];matrices.modelViewMatrix.assign(this.getBrowser().getModelViewMatrix().get());matrices.projectionMatrix.assign(this.getBrowser().getProjectionMatrix());matrices.viewport.assign(currentLayer.getViewport().getRectangle())}}});return X3DPointingDeviceSensorNode});define("cobweb/Components/PointingDeviceSensor/X3DTouchSensorNode",["jquery","cobweb/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode","cobweb/Bits/X3DConstants"],function($,X3DPointingDeviceSensorNode,X3DConstants){function X3DTouchSensorNode(browser,executionContext){X3DPointingDeviceSensorNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTouchSensorNode)}X3DTouchSensorNode.prototype=$.extend(Object.create(X3DPointingDeviceSensorNode.prototype),{constructor:X3DTouchSensorNode,set_active__:function(hit,value){X3DPointingDeviceSensorNode.prototype.set_active__.call(this,hit,value);if(this.enabled_.getValue()&&this.isOver_.getValue()&&!value)this.touchTime_=this.getBrowser().getCurrentTime()}});return X3DTouchSensorNode});define("cobweb/Components/PointingDeviceSensor/TouchSensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/PointingDeviceSensor/X3DTouchSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTouchSensorNode,X3DConstants,Vector2,Matrix4){with(Fields){function TouchSensor(executionContext){X3DTouchSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TouchSensor)}TouchSensor.prototype=$.extend(Object.create(X3DTouchSensorNode.prototype),{constructor:TouchSensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.outputOnly,"hitTexCoord_changed",new SFVec2f),new X3DFieldDefinition(X3DConstants.outputOnly,"hitNormal_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"hitPoint_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"isOver",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"touchTime",new SFTime)]),getTypeName:function(){return"TouchSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},set_over__:function(hit,value){try{X3DTouchSensorNode.prototype.set_over__.call(this,hit,value);if(this.isOver_.getValue()){var intersection=hit.intersection,modelViewMatrix=this.getMatrices()[hit.layer.getId()].modelViewMatrix,invModelViewMatrix=Matrix4.inverse(modelViewMatrix);this.hitTexCoord_changed_=intersection.texCoord;this.hitNormal_changed_=modelViewMatrix.multMatrixDir(intersection.normal.copy()).normalize();this.hitPoint_changed_=invModelViewMatrix.multVecMatrix(intersection.point.copy())}}catch(error){console.log(error)}}});return TouchSensor}});define("cobweb/Components/Networking/Anchor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Components/PointingDeviceSensor/TouchSensor","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","cobweb/InputOutput/Loader"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DUrlObject,TouchSensor,TraverseType,X3DConstants,Loader){with(Fields){function Anchor(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Anchor)}Anchor.prototype=$.extend(Object.create(X3DGroupingNode.prototype),X3DUrlObject.prototype,{constructor:Anchor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"parameter",new MFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Anchor"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){X3DGroupingNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);this.touchSensorNode=new TouchSensor(this.getExecutionContext());this.touchSensorNode.touchTime_.addInterest(this,"requestAsyncLoad");this.description_.addFieldInterest(this.touchSensorNode.description_);this.touchSensorNode.description_=this.description_;this.touchSensorNode.setup()},requestAsyncLoad:function(){this.setLoadState(X3DConstants.IN_PROGRESS_STATE,false);new Loader(this).createX3DFromURL(this.url_,function(scene){if(scene){this.getBrowser().replaceWorld(scene);this.setLoadState(X3DConstants.COMPLETE_STATE,false)}else this.setLoadState(X3DConstants.FAILED_STATE,false)}.bind(this),function(fragment){try{this.getExecutionContext().changeViewpoint(fragment)}catch(error){}this.setLoadState(X3DConstants.COMPLETE_STATE,false)}.bind(this))},traverse:function(type){if(type===TraverseType.POINTER){var sensors={};this.getBrowser().getSensors().push(sensors);this.touchSensorNode.traverse(sensors);X3DGroupingNode.prototype.traverse.call(this,type);this.getBrowser().getSensors().pop()}else X3DGroupingNode.prototype.traverse.call(this,type)}});return Anchor}});define("cobweb/Components/Sound/X3DSoundSourceNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Components/Time/X3DTimeDependentNode","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DTimeDependentNode,X3DConstants){function X3DSoundSourceNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);X3DTimeDependentNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DSoundSourceNode);this.volume=0;this.media=null}X3DSoundSourceNode.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DTimeDependentNode.prototype,{constructor:X3DSoundSourceNode,initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DTimeDependentNode.prototype.initialize.call(this)},set_live__:function(){X3DTimeDependentNode.prototype.set_live__.call(this);if(this.disabled){this.getBrowser().volume_.removeInterest(this,"set_volume__");this.getBrowser().mute_.removeInterest(this,"set_volume__")}else{this.getBrowser().volume_.addInterest(this,"set_volume__");this.getBrowser().mute_.addInterest(this,"set_volume__");this.set_volume__()}},setMedia:function(value){if(this.media){this.media[0].volume=0;this.media[0].pause();this.media.unbind("ended")}this.media=value;if(this.media){this.media[0].volume=0;this.duration_changed_=this.media[0].duration;if(this.isActive_.getValue()){this.media[0].currentTime=this.getElapsedTime()%this.media[0].duration;if(!this.isPaused_.getValue()){if(this.speed_.getValue()){this.media.bind("ended",this.set_ended.bind(this));this.media[0].currentTime=this.getElapsedTime();this.media[0].play()}}}}},getMedia:function(){return this.media},setVolume:function(volume){this.volume=volume;this.set_volume__()},set_volume__:function(){if(this.media)this.media[0].volume=!this.getBrowser().mute_.getValue()*this.getBrowser().volume_.getValue()*this.volume},set_speed:function(){},set_pitch:function(){},set_start:function(){if(this.media){if(this.speed_.getValue()){this.media.bind("ended",this.set_ended.bind(this));this.media[0].currentTime=0;this.media[0].play()}}},set_pause:function(){if(this.media){this.media.unbind("ended");this.media[0].pause()}},set_resume:function(){if(this.media){if(this.speed_.getValue()){this.media.bind("ended",this.set_ended.bind(this));this.media[0].play()}}},set_stop:function(){if(this.media){this.media.unbind("ended");this.media[0].pause()}},set_ended:function(){if(this.media){if(this.loop_.getValue()){if(this.speed_.getValue())this.media[0].play();this.elapsedTime_=this.getElapsedTime();this.cycleTime_=this.getBrowser().getCurrentTime()}else this.stop()}},prepareEvents:function(){this.elapsedTime_=this.getElapsedTime()}});return X3DSoundSourceNode});define("cobweb/Components/Sound/AudioClip",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Sound/X3DSoundSourceNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Bits/X3DConstants","standard/Networking/URI"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DSoundSourceNode,X3DUrlObject,X3DConstants,URI){with(Fields){function AudioClip(executionContext){X3DSoundSourceNode.call(this,executionContext.getBrowser(),executionContext);
X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.AudioClip);this.urlStack=new MFString}AudioClip.prototype=$.extend(Object.create(X3DSoundSourceNode.prototype),X3DUrlObject.prototype,{constructor:AudioClip,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"speed",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"pitch",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"loop",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"startTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"resumeTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"pauseTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"stopTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"isPaused",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"cycleTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"elapsedTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"duration_changed",new SFTime(-1))]),getTypeName:function(){return"AudioClip"},getComponentName:function(){return"Sound"},getContainerField:function(){return"source"},initialize:function(){X3DSoundSourceNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);this.url_.addInterest(this,"set_url__");this.audio=$("<audio>");this.audio.error(this.setError.bind(this));this.audio.bind("abort",this.setError.bind(this));this.audio.attr("preload","auto");this.audio.attr("volume",0);this.audio.attr("crossOrigin","anonymous");this.requestAsyncLoad()},set_url__:function(){this.setLoadState(X3DConstants.NOT_STARTED_STATE);this.requestAsyncLoad()},requestAsyncLoad:function(){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.IN_PROGRESS_STATE)return;this.setLoadState(X3DConstants.IN_PROGRESS_STATE);this.setMedia(null);this.urlStack.setValue(this.url_);this.audio.bind("canplaythrough",this.setAudio.bind(this));this.loadNext()},loadNext:function(){if(this.urlStack.length===0){this.duration_changed_=-1;this.setLoadState(X3DConstants.FAILED_STATE);return}this.URL=new URI(this.urlStack.shift());this.URL=this.getExecutionContext().getWorldURL().transform(this.URL);this.audio.attr("src",this.URL)},setError:function(){console.warn("Error loading audio:",this.URL.toString());this.loadNext()},setAudio:function(){this.audio.unbind("canplaythrough");this.setMedia(this.audio);this.setLoadState(X3DConstants.COMPLETE_STATE)}});return AudioClip}});define("cobweb/Components/Navigation/Billboard",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DConstants,Vector3,Rotation4,Matrix4){with(Fields){var inverseModelViewMatrix=new Matrix4,xAxis=new Vector3(1,0,0),yAxis=new Vector3(0,1,0),zAxis=new Vector3(0,0,1),viewerYAxis=new Vector3(0,0,0),billboardToViewer=new Vector3(0,0,0),x=new Vector3(0,0,0),y=new Vector3(0,0,0),N1=new Vector3(0,0,0),N2=new Vector3(0,0,0),rotation=new Rotation4(0,0,1,0);function Billboard(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Billboard);this.matrix=new Matrix4}Billboard.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:Billboard,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"axisOfRotation",new SFVec3f(0,1,0)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Billboard"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},rotate:function(type){try{this.getModelViewMatrix(type,inverseModelViewMatrix).inverse();billboardToViewer.set(inverseModelViewMatrix[12],inverseModelViewMatrix[13],inverseModelViewMatrix[14]).normalize();if(this.axisOfRotation_.getValue().equals(Vector3.Zero)){inverseModelViewMatrix.multDirMatrix(viewerYAxis.assign(yAxis)).normalize();x.assign(viewerYAxis).cross(billboardToViewer);y.assign(billboardToViewer).cross(x);var z=billboardToViewer;x.normalize();y.normalize();this.matrix.set(x[0],x[1],x[2],0,y[0],y[1],y[2],0,z[0],z[1],z[2],0,0,0,0,1)}else{N1.assign(this.axisOfRotation_.getValue()).cross(billboardToViewer);N2.assign(this.axisOfRotation_.getValue()).cross(zAxis);this.matrix.setRotation(rotation.setFromToVec(N2,N1))}this.getBrowser().getModelViewMatrix().multLeft(this.matrix)}catch(error){}},traverse:function(type){this.getBrowser().getModelViewMatrix().push();this.rotate(type);X3DGroupingNode.prototype.traverse.call(this,type);this.getBrowser().getModelViewMatrix().pop()}});return Billboard}});define("cobweb/Components/Geometry3D/Box",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Vector3){var defaultSize=new Vector3(2,2,2);with(Fields){function Box(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Box)}Box.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Box,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"size",new SFVec3f(2,2,2)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true))]),getTypeName:function(){return"Box"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},build:function(){var options=this.getBrowser().getBoxOptions(),size=this.size_.getValue();this.setNormals(options.getGeometry().getNormals());this.setTexCoords(options.getGeometry().getTexCoords());if(size.equals(defaultSize)){this.setVertices(options.getGeometry().getVertices());this.setExtents(options.getGeometry().getExtents())}else{var scale=Vector3.divide(size,2),x=scale.x,y=scale.y,z=scale.z,defaultVertices=options.getGeometry().getVertices(),vertices=this.getVertices();for(var i=0;i<defaultVertices.length;i+=4){vertices.push(x*defaultVertices[i],y*defaultVertices[i+1],z*defaultVertices[i+2],1)}this.setVertices(vertices);this.setExtents([Vector3.negate(scale),scale])}this.setSolid(this.solid_.getValue());this.setCurrentTexCoord(null)}});return Box}});define("cobweb/Components/Navigation/Collision",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Components/Core/X3DSensorNode","cobweb/Bits/X3DCast","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DSensorNode,X3DCast,TraverseType,X3DConstants){with(Fields){function Collision(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);X3DSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Collision);this.addAlias("collide",this.enabled_)}Collision.prototype=$.extend(Object.create(X3DGroupingNode.prototype),X3DSensorNode.prototype,{constructor:Collision,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"collideTime",new SFTime),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.initializeOnly,"proxy",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Collision"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){X3DGroupingNode.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.enabled_.addInterest(this,"set_live__");this.proxy_.addInterest(this,"set_proxy__");this.set_live__();this.set_proxy__()},set_live__:function(){if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue()&&this.enabled_.getValue())this.getBrowser().addCollision(this);else this.getBrowser().removeCollision(this)},set_active:function(value){if(this.isActive_.getValue()!==value){this.isActive_=value;if(value)this.collideTime_=this.getBrowser().getCurrentTime()}},set_proxy__:function(){this.proxyNode=X3DCast(X3DConstants.X3DChildNode,this.proxy_)},traverse:function(type){switch(type){case TraverseType.COLLISION:{if(this.enabled_.getValue()){var collisions=this.getBrowser().getCollisions();collisions.push(this);if(this.proxyNode)this.proxyNode.traverse(type);else X3DGroupingNode.prototype.traverse.call(this,type);collisions.pop()}break}default:X3DGroupingNode.prototype.traverse.call(this,type);break}}});return Collision}});define("cobweb/Components/Rendering/X3DColorNode",["jquery","cobweb/Components/Rendering/X3DGeometricPropertyNode","cobweb/Bits/X3DConstants"],function($,X3DGeometricPropertyNode,X3DConstants){function X3DColorNode(browser,executionContext){X3DGeometricPropertyNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DColorNode)}X3DColorNode.prototype=$.extend(Object.create(X3DGeometricPropertyNode.prototype),{constructor:X3DColorNode});return X3DColorNode});define("cobweb/Components/Rendering/Color",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DColorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Color3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DColorNode,X3DConstants,Color3){with(Fields){function Color(executionContext){X3DColorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Color)}Color.prototype=$.extend(Object.create(X3DColorNode.prototype),{constructor:Color,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new MFColor)]),getTypeName:function(){return"Color"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},isTransparent:function(){return false},getColor:function(index){if(index>=0&&index<this.color_.length)return this.color_[index].getValue();return new Color3(1,1,1)}});return Color}});define("cobweb/Components/Interpolation/ColorInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Color3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Color3){with(Fields){function ColorInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ColorInterpolator);this.hsv=[]}ColorInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:ColorInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFColor),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new SFColor)]),value:[],getTypeName:function(){return"ColorInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){var keyValue=this.keyValue_.getValue();if(keyValue.length<this.key_.length)this.keyValue_.resize(this.key_.length,keyValue.length?keyValue[this.keyValue_.length-1]:new SFColor);this.hsv.length=0;for(var i=0,length=keyValue.length;i<length;++i)this.hsv.push(keyValue[i].getHSV())},interpolate:function(index0,index1,weight){var value=Color3.lerp(this.hsv[index0],this.hsv[index1],weight,this.value);this.value_changed_.setHSV(value[0],value[1],value[2])}});return ColorInterpolator}});define("cobweb/Components/Rendering/ColorRGBA",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DColorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Color4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DColorNode,X3DConstants,Color4){with(Fields){function ColorRGBA(executionContext){X3DColorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ColorRGBA)}ColorRGBA.prototype=$.extend(Object.create(X3DColorNode.prototype),{constructor:ColorRGBA,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new MFColorRGBA)]),getTypeName:function(){return"ColorRGBA"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"color"},isTransparent:function(){return true},getColor:function(index){if(index>=0&&index<this.color_.length)return this.color_[index].getValue();return new Color4(1,1,1,1)}});return ColorRGBA}});define("cobweb/Components/Geometry3D/Cone",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Complex","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Complex,Vector2,Vector3){with(Fields){function Cone(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Cone)}Cone.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Cone,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"side",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bottom",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"height",new SFFloat(2)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bottomRadius",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true))]),getTypeName:function(){return"Cone"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){X3DGeometryNode.prototype.set_live__.call(this);if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue())this.getBrowser().getConeOptions().addInterest(this,"eventsProcessed");else this.getBrowser().getConeOptions().removeInterest(this,"eventsProcessed")},build:function(){var options=this.getBrowser().getConeOptions(),vDimension=options.vDimension_.getValue(),height=this.height_.getValue(),bottomRadius=this.bottomRadius_.getValue(),texCoords=[],normals=this.getNormals(),vertices=this.getVertices();this.getTexCoords().push(texCoords);var y1=height/2,y2=-y1,nz=Complex.Polar(1,-Math.PI/2+Math.atan(bottomRadius/height));if(this.side_.getValue()){for(var i=0;i<vDimension;++i){var u1=(i+.5)/vDimension,theta1=2*Math.PI*u1,n1=Complex.Polar(nz.imag,theta1);var u2=i/vDimension,theta2=2*Math.PI*u2,p2=Complex.Polar(-bottomRadius,theta2),n2=Complex.Polar(nz.imag,theta2);var u3=(i+1)/vDimension,theta3=2*Math.PI*u3,p3=Complex.Polar(-bottomRadius,theta3),n3=Complex.Polar(nz.imag,theta3);texCoords.push(u1,1,0,1);normals.push(n1.imag,nz.real,n1.real);vertices.push(0,y1,0,1);texCoords.push(u2,0,0,1);normals.push(n2.imag,nz.real,n2.real);vertices.push(p2.imag,y2,p2.real,1);texCoords.push(u3,0,0,1);normals.push(n3.imag,nz.real,n3.real);vertices.push(p3.imag,y2,p3.real,1)}}if(this.bottom_.getValue()){var texCoord=[],points=[];for(var i=vDimension-1;i>-1;--i){var u=i/vDimension,theta=2*Math.PI*u,t=Complex.Polar(-1,theta),p=Complex.multiply(t,bottomRadius);texCoord.push(new Vector2((t.imag+1)/2,(t.real+1)/2));points.push(new Vector3(p.imag,y2,p.real))}var t0=texCoord[0],p0=points[0];for(var i=1,length=points.length-1;i<length;++i){var t1=texCoord[i],t2=texCoord[i+1],p1=points[i],p2=points[i+1];texCoords.push(t0.x,t0.y,0,1);normals.push(0,-1,0);vertices.push(p0.x,p0.y,p0.z,1);texCoords.push(t1.x,t1.y,0,1);normals.push(0,-1,0);vertices.push(p1.x,p1.y,p1.z,1);texCoords.push(t2.x,t2.y,0,1);normals.push(0,-1,0);vertices.push(p2.x,p2.y,p2.z,1)}}this.setSolid(this.solid_.getValue());this.setCurrentTexCoord(null);this.setNormals(normals);this.setVertices(vertices);this.setExtents(this.createExtents())},createExtents:function(){var bottomRadius=this.bottomRadius_.getValue(),y1=this.height_.getValue()/2,y2=-y1;if(!this.side_.getValue()&&!this.bottom_.getValue())return[new Vector3(0,0,0),new Vector3(0,0,0)];else if(!this.side_.getValue())return[new Vector3(-bottomRadius,y2,-bottomRadius),new Vector3(bottomRadius,y2,bottomRadius)];else return[new Vector3(-bottomRadius,y2,-bottomRadius),new Vector3(bottomRadius,y1,bottomRadius)]}});return Cone}});define("cobweb/Components/Interpolation/CoordinateInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Vector3){with(Fields){function CoordinateInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.CoordinateInterpolator)}CoordinateInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:CoordinateInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new MFVec3f)]),keyValue:new Vector3(0,0,0),getTypeName:function(){return"CoordinateInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(index0,index1,weight){var keyValue=this.keyValue_.getValue(),value_changed=this.value_changed_.getValue(),size=this.key_.length>1?Math.floor(keyValue.length/this.key_.length):0;index0*=size;index1=index0+size;this.value_changed_.length=size;for(var i=0;i<size;++i){value_changed[i].set(this.keyValue.assign(keyValue[index0+i].getValue()).lerp(keyValue[index1+i].getValue(),weight))}this.value_changed_.addEvent()}});return CoordinateInterpolator}});define("cobweb/Components/Interpolation/CoordinateInterpolator2D",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Vector2){with(Fields){function CoordinateInterpolator2D(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.CoordinateInterpolator2D)}CoordinateInterpolator2D.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:CoordinateInterpolator2D,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFVec2f),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new MFVec2f)]),keyValue:new Vector2(0,0),getTypeName:function(){return"CoordinateInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},set_keyValue__:function(){},interpolate:function(index0,index1,weight){var keyValue=this.keyValue_.getValue(),value_changed=this.value_changed_.getValue(),size=this.key_.length>1?Math.floor(this.keyValue_.length/this.key_.length):0;index0*=size;index1=index0+size;this.value_changed_.length=size;for(var i=0;i<size;++i){value_changed[i].set(this.keyValue.assign(keyValue[index0+i].getValue()).lerp(keyValue[index1+i].getValue(),weight))}this.value_changed_.addEvent()}});return CoordinateInterpolator2D}});define("cobweb/Components/Geometry3D/Cylinder",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Complex","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Complex,Vector2,Vector3){with(Fields){function Cylinder(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Cylinder)}Cylinder.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Cylinder,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"top",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"side",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bottom",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"height",new SFFloat(2)),new X3DFieldDefinition(X3DConstants.initializeOnly,"radius",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true))]),getTypeName:function(){return"Cylinder"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){X3DGeometryNode.prototype.set_live__.call(this);if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue())this.getBrowser().getCylinderOptions().addInterest(this,"eventsProcessed");else this.getBrowser().getCylinderOptions().removeInterest(this,"eventsProcessed")},build:function(){var options=this.getBrowser().getCylinderOptions(),vDimension=options.vDimension_.getValue(),texCoords=[],normals=this.getNormals(),vertices=this.getVertices();this.getTexCoords().push(texCoords);var radius=this.radius_.getValue(),y1=this.height_.getValue()/2,y2=-y1;if(this.side_.getValue()){for(var i=0;i<vDimension;++i){var u1=i/vDimension,theta1=2*Math.PI*u1,n1=Complex.Polar(-1,theta1),p1=Complex.multiply(n1,radius);var u2=(i+1)/vDimension,theta2=2*Math.PI*u2,n2=Complex.Polar(-1,theta2),p2=Complex.multiply(n2,radius);texCoords.push(u1,1,0,1);normals.push(n1.imag,0,n1.real);vertices.push(p1.imag,y1,p1.real,1);texCoords.push(u1,0,0,1);normals.push(n1.imag,0,n1.real);vertices.push(p1.imag,y2,p1.real,1);texCoords.push(u2,0,0,1);normals.push(n2.imag,0,n2.real);vertices.push(p2.imag,y2,p2.real,1);texCoords.push(u1,1,0,1);normals.push(n1.imag,0,n1.real);vertices.push(p1.imag,y1,p1.real,1);texCoords.push(u2,0,0,1);normals.push(n2.imag,0,n2.real);vertices.push(p2.imag,y2,p2.real,1);texCoords.push(u2,1,0,1);normals.push(n2.imag,0,n2.real);vertices.push(p2.imag,y1,p2.real,1)}}if(this.top_.getValue()){var texCoord=[],points=[];for(var i=0;i<vDimension;++i){var u=i/vDimension,theta=2*Math.PI*u,t=Complex.Polar(-1,theta);texCoord.push(new Vector2((t.imag+1)/2,-(t.real-1)/2));points.push(new Vector3(t.imag*radius,y1,t.real*radius))}var t0=texCoord[0],p0=points[0];for(var i=1,length=points.length-1;i<length;++i){var t1=texCoord[i],t2=texCoord[i+1],p1=points[i],p2=points[i+1];texCoords.push(t0.x,t0.y,0,1);normals.push(0,1,0);vertices.push(p0.x,p0.y,p0.z,1);texCoords.push(t1.x,t1.y,0,1);normals.push(0,1,0);vertices.push(p1.x,p1.y,p1.z,1);texCoords.push(t2.x,t2.y,0,1);normals.push(0,1,0);vertices.push(p2.x,p2.y,p2.z,1)}}if(this.bottom_.getValue()){var texCoord=[],points=[];for(var i=vDimension-1;i>-1;--i){var u=i/vDimension,theta=2*Math.PI*u,t=Complex.Polar(-1,theta);texCoord.push(new Vector2((t.imag+1)/2,(t.real+1)/2));points.push(new Vector3(t.imag*radius,y2,t.real*radius))}var t0=texCoord[0],p0=points[0];for(var i=1,length=points.length-1;i<length;++i){var t1=texCoord[i],t2=texCoord[i+1],p1=points[i],p2=points[i+1];texCoords.push(t0.x,t0.y,0,1);normals.push(0,-1,0);vertices.push(p0.x,p0.y,p0.z,1);texCoords.push(t1.x,t1.y,0,1);normals.push(0,-1,0);vertices.push(p1.x,p1.y,p1.z,1);texCoords.push(t2.x,t2.y,0,1);normals.push(0,-1,0);vertices.push(p2.x,p2.y,p2.z,1)}}this.setSolid(this.solid_.getValue());this.setCurrentTexCoord(null);this.setNormals(normals);this.setVertices(vertices);this.setExtents(this.createExtents())},createExtents:function(){var radius=this.radius_.getValue(),y1=this.height_.getValue()/2,y2=-y1;if(!this.top_.getValue()&&!this.side_.getValue()&&!this.bottom_.getValue())return[new Vector3(0,0,0),new Vector3(0,0,0)];if(!this.top_.getValue()&&!this.side_.getValue())return[new Vector3(-radius,y2,-radius),new Vector3(radius,y2,radius)];if(!this.bottom_.getValue()&&!this.side_.getValue())return[new Vector3(-radius,y1,-radius),new Vector3(radius,y1,radius)];else return[new Vector3(-radius,y2,-radius),new Vector3(radius,y1,radius)]}});return Cylinder}});define("cobweb/Components/PointingDeviceSensor/X3DDragSensorNode",["jquery","cobweb/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode","cobweb/Bits/X3DConstants"],function($,X3DPointingDeviceSensorNode,X3DConstants){function X3DDragSensorNode(browser,executionContext){X3DPointingDeviceSensorNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DDragSensorNode)}X3DDragSensorNode.prototype=$.extend(Object.create(X3DPointingDeviceSensorNode.prototype),{constructor:X3DDragSensorNode,set_motion__:function(hit){}});return X3DDragSensorNode});define("standard/Math/Geometry/Cylinder3",["standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Line3"],function(Vector3,Rotation4,Matrix4,Line3){function Cylinder3(axis,radius){this.axis=axis.copy();this.radius=radius}Cylinder3.prototype={constructor:Cylinder3,intersectsLine:function(line,enter,exit){var rotToYAxis=new Rotation4(this.axis.direction,new Vector3(0,1,0)),mtxToYAxis=Matrix4.Rotation(rotToYAxis);var scaleFactor=1/this.radius,toUnitCylSpace=new Matrix4;toUnitCylSpace.scale(new Vector3(scaleFactor,scaleFactor,scaleFactor));toUnitCylSpace.multLeft(mtxToYAxis);var point=Vector3.subtract(line.point,this.axis.point),noTranslationLine=new Line3(point,line.direction);var cylLine=noTranslationLine.multLineMatrix(toUnitCylSpace);var intersected=this.unitCylinderIntersectsLine(cylLine,enter,exit);if(intersected){var fromUnitCylSpace=toUnitCylSpace.inverse();fromUnitCylSpace.multVecMatrix(enter);enter.add(this.axis.point);fromUnitCylSpace.multVecMatrix(exit);exit.add(this.axis.point)}return intersected},unitCylinderIntersectsLine:function(line,enter,exit){var t0,t1;var pos=line.point,dir=line.direction;var A=dir[0]*dir[0]+dir[2]*dir[2],B=2*(pos[0]*dir[0]+pos[2]*dir[2]),C=pos[0]*pos[0]+pos[2]*pos[2]-1;var discr=B*B-4*A*C;if(discr<0)return false;var sqroot=Math.sqrt(discr);if(B>0){t0=-(2*C)/(sqroot+B);t1=-(sqroot+B)/(2*A)}else{t0=2*C/(sqroot-B);t1=(sqroot-B)/(2*A)}enter.assign(dir).multiply(t0).add(pos);exit.assign(dir).multiply(t1).add(pos);return true},toString:function(){return this.axis.toString()+" "+this.radius}};return Cylinder3});define("cobweb/Components/PointingDeviceSensor/CylinderSensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/PointingDeviceSensor/X3DDragSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Line3","standard/Math/Geometry/Plane3","standard/Math/Geometry/Cylinder3","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DDragSensorNode,X3DConstants,Vector3,Rotation4,Matrix4,Line3,Plane3,Cylinder3,Algorithm){with(Fields){function CylinderSensor(executionContext){X3DDragSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.CylinderSensor)}CylinderSensor.prototype=$.extend(Object.create(X3DDragSensorNode.prototype),{constructor:CylinderSensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"axisRotation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"diskAngle",new SFFloat(.261799)),new X3DFieldDefinition(X3DConstants.inputOutput,"minAngle",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"maxAngle",new SFFloat(-1)),new X3DFieldDefinition(X3DConstants.inputOutput,"offset",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"autoOffset",new SFBool(true)),new X3DFieldDefinition(X3DConstants.outputOnly,"trackPoint_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"rotation_changed",new SFRotation),new X3DFieldDefinition(X3DConstants.outputOnly,"isOver",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool)]),getTypeName:function(){return"CylinderSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){X3DDragSensorNode.prototype.initialize.call(this);this.modelViewMatrix=new Matrix4;this.invModelViewMatrix=new Matrix4;this.cylinder=new Cylinder3(new Line3(new Vector3(0,0,0),new Vector3(0,0,0)),0);this.disk=false;this.yPlane=null;this.zPlane=null;this.sxPlane=null;this.szNormal=null;this.behind=false;this.fromVector=new Vector3(0,0,0);this.startOffset=new Rotation4(0,0,1,0)},isBehind:function(hitRay,hitPoint){var enter=new Vector3(0,0,0),exit=new Vector3(0,0,0);this.cylinder.intersectsLine(hitRay,enter,exit);return Vector3.subtract(hitPoint,enter).abs()>Vector3.subtract(hitPoint,exit).abs()},getTrackPoint:function(hitRay,trackPoint){var zPoint=new Vector3(0,0,0);
this.zPlane.intersectsLine(hitRay,zPoint);var axisPoint=Vector3.add(zPoint,this.cylinder.axis.getPerpendicularVector(zPoint)),distance=this.sxPlane.getDistanceToPoint(zPoint)/this.cylinder.radius,section=Math.floor((distance+1)/2);var sinp=Algorithm.interval(distance,-1,1),phi=section===0?Math.asin(sinp):sinp*Math.PI/2,angle=phi+section*Math.PI;var rotation=new Rotation4(this.cylinder.axis.direction,angle);rotation.multVecRot(trackPoint.assign(this.szNormal).multiply(this.cylinder.radius));trackPoint.add(axisPoint)},getAngle:function(rotation){if(Vector3.dot(rotation.getAxis(),this.cylinder.axis.direction)>0)return rotation.angle;else return-rotation.angle},set_active__:function(hit,active){X3DDragSensorNode.prototype.set_active__.call(this,hit,active);try{if(this.isActive_.getValue()){var matrices=this.getMatrices()[hit.layer.getId()];this.modelViewMatrix.assign(matrices.modelViewMatrix);this.invModelViewMatrix.assign(this.modelViewMatrix).inverse();var hitRay=hit.hitRay.copy().multLineMatrix(this.invModelViewMatrix),hitPoint=this.invModelViewMatrix.multVecMatrix(hit.intersection.point.copy());var yAxis=this.axisRotation_.getValue().multVecRot(new Vector3(0,1,0)),cameraBack=this.invModelViewMatrix.multDirMatrix(new Vector3(0,0,1)).normalize();var axis=new Line3(new Vector3(0,0,0),yAxis),radius=axis.getPerpendicularVector(hitPoint).abs();this.cylinder=new Cylinder3(axis,radius);this.disk=Math.abs(Vector3.dot(cameraBack,yAxis))>Math.cos(this.diskAngle_.getValue());this.behind=this.isBehind(hitRay,hitPoint);this.yPlane=new Plane3(hitPoint,yAxis);this.zPlane=new Plane3(hitPoint,cameraBack);var billboardToViewer=this.invModelViewMatrix.origin,sxNormal=Vector3.cross(yAxis,billboardToViewer).normalize();this.sxPlane=new Plane3(new Vector3(0,0,0),sxNormal);this.szNormal=Vector3.cross(sxNormal,yAxis).normalize();var trackPoint=new Vector3(0,0,0);if(this.disk)this.yPlane.intersectsLine(hitRay,trackPoint);else this.getTrackPoint(hitRay,trackPoint);this.fromVector=this.cylinder.axis.getPerpendicularVector(trackPoint).negate();this.startOffset=new Rotation4(yAxis,this.offset_.getValue())}else{if(this.autoOffset_.getValue())this.offset_=this.getAngle(this.rotation_changed_.getValue())}}catch(error){}},set_motion__:function(hit){try{var hitRay=hit.hitRay.copy().multLineMatrix(this.invModelViewMatrix),trackPoint=new Vector3(0,0,0);if(this.disk)this.yPlane.intersectsLine(hitRay,trackPoint);else this.getTrackPoint(hitRay,trackPoint);this.trackPoint_changed_=trackPoint;var toVector=this.cylinder.axis.getPerpendicularVector(trackPoint).negate(),rotation=new Rotation4(this.fromVector,toVector);if(this.disk){var trackPoint_=this.modelViewMatrix.multVecMatrix(trackPoint.copy());if(trackPoint_.z>0)rotation.multRight(new Rotation4(this.yPlane.normal,Math.PI))}else{if(this.behind)rotation.inverse()}rotation.multLeft(this.startOffset);if(this.minAngle_.getValue()>this.maxAngle_.getValue())this.rotation_changed_=rotation;else{var angle=Algorithm.interval(this.getAngle(rotation),-Math.PI,Math.PI),min=Algorithm.interval(this.minAngle_.getValue(),-Math.PI,Math.PI),max=Algorithm.interval(this.maxAngle_.getValue(),-Math.PI,Math.PI);if(angle>min&&angle<max)this.rotation_change_=rotation}}catch(error){this.trackPoint_changed_.addEvent();this.rotation_changed_.addEvent()}}});return CylinderSensor}});define("cobweb/Components/Geometry3D/ElevationGrid",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DCast,X3DConstants,Triangle3,Vector2,Vector3){with(Fields){function ElevationGrid(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ElevationGrid);this.attribNodes=[];this.colorNode=null;this.texCoordNode=null;this.normalNode=null;this.coordNode=null}ElevationGrid.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:ElevationGrid,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"xDimension",new SFInt32),new X3DFieldDefinition(X3DConstants.initializeOnly,"zDimension",new SFInt32),new X3DFieldDefinition(X3DConstants.initializeOnly,"xSpacing",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"zSpacing",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"ccw",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"creaseAngle",new SFFloat),new X3DFieldDefinition(X3DConstants.initializeOnly,"colorPerVertex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"normalPerVertex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"attrib",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"fogCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"texCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"normal",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"height",new MFFloat)]),getTypeName:function(){return"ElevationGrid"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},initialize:function(){X3DGeometryNode.prototype.initialize.call(this);this.attrib_.addInterest(this,"set_attrib__");this.color_.addInterest(this,"set_color__");this.texCoord_.addInterest(this,"set_texCoord__");this.normal_.addInterest(this,"set_normal__");this.set_attrib__();this.set_color__();this.set_texCoord__();this.set_normal__()},set_attrib__:function(){for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].removeInterest(this,"addNodeEvent");this.attribNodes.length=0;for(var i=0,length=this.attrib_.length;i<length;++i){var attribNode=X3DCast(X3DConstants.X3DVertexAttributeNode,this.attrib_[i]);if(attribNode)this.attribNodes.push(attribNode)}for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].addInterest(this,"addNodeEvent")},set_color__:function(){if(this.colorNode){this.colorNode.removeInterest(this,"addNodeEvent");this.colorNode.removeInterest(this,"set_transparent__")}this.colorNode=X3DCast(X3DConstants.X3DColorNode,this.color_);if(this.colorNode){this.colorNode.addInterest(this,"addNodeEvent");this.colorNode.addInterest(this,"set_transparent__");this.set_transparent__()}else this.transparent_=false},set_transparent__:function(){this.transparent_=this.colorNode.isTransparent()},set_texCoord__:function(){if(this.texCoordNode)this.texCoordNode.removeInterest(this,"addNodeEvent");this.texCoordNode=X3DCast(X3DConstants.X3DTextureCoordinateNode,this.texCoord_);if(this.texCoordNode)this.texCoordNode.addInterest(this,"addNodeEvent")},set_normal__:function(){if(this.normalNode)this.normalNode.removeInterest(this,"addNodeEvent");this.normalNode=X3DCast(X3DConstants.X3DNormalNode,this.normal_);if(this.normalNode)this.normalNode.addInterest(this,"addNodeEvent")},getAttrib:function(){return this.attribNodes},getColor:function(){return this.colorNode},getTexCoord:function(){return this.texCoordNode},getNormal:function(){return this.normalNode},getHeight:function(index){if(index<this.height_.length)return this.height_[index];return 0},createTexCoords:function(){var texCoords=[],xDimension=this.xDimension_.getValue(),zDimension=this.zDimension_.getValue(),xSize=xDimension-1,zSize=zDimension-1;for(var z=0;z<zDimension;++z){for(var x=0;x<xDimension;++x)texCoords.push(new Vector2(x/xSize,z/zSize))}return texCoords},createNormals:function(points,coordIndex,creaseAngle){var cw=!this.ccw_.getValue(),normalIndex=[],normals=[];for(var p=0;p<points.length;++p)normalIndex[p]=[];for(var c=0;c<coordIndex.length;c+=3){var c0=coordIndex[c],c1=coordIndex[c+1],c2=coordIndex[c+2];normalIndex[c0].push(normals.length);normalIndex[c1].push(normals.length+1);normalIndex[c2].push(normals.length+2);var normal=Triangle3.normal(points[c0],points[c1],points[c2],new Vector3(0,0,0));if(cw)normal.negate();normals.push(normal);normals.push(normal);normals.push(normal)}return this.refineNormals(normalIndex,normals,this.creaseAngle_.getValue())},createCoordIndex:function(){var coordIndex=[],xDimension=this.xDimension_.getValue(),zDimension=this.zDimension_.getValue(),xSize=xDimension-1,zSize=zDimension-1;for(var z=0;z<zSize;++z){for(var x=0;x<zSize;++x){var i1=z*xDimension+x,i2=(z+1)*xDimension+x,i3=(z+1)*xDimension+(x+1),i4=z*xDimension+(x+1);coordIndex.push(i1);coordIndex.push(i2);coordIndex.push(i3);coordIndex.push(i1);coordIndex.push(i3);coordIndex.push(i4)}}return coordIndex},createPoints:function(){var points=[],xDimension=this.xDimension_.getValue(),zDimension=this.zDimension_.getValue(),xSpacing=this.xSpacing_.getValue(),zSpacing=this.zSpacing_.getValue();for(var z=0;z<zDimension;++z){for(var x=0;x<xDimension;++x){points.push(new Vector3(xSpacing*x,this.getHeight(x+z*xDimension),zSpacing*z))}}return points},build:function(){if(this.xDimension_.getValue()<2||this.zDimension_.getValue()<2)return;var colorPerVertex=this.colorPerVertex_.getValue(),normalPerVertex=this.normalPerVertex_.getValue(),coordIndex=this.createCoordIndex(),colorNode=this.getColor(),texCoordNode=this.getTexCoord(),normalNode=this.getNormal(),points=this.createPoints(),face=0;if(texCoordNode)texCoordNode.init(this.getTexCoords());else{var texCoords=this.createTexCoords();this.getTexCoords().push([])}for(var c=0;c<coordIndex.length;++face){for(var p=0;p<6;++p,++c){var index=coordIndex[c];if(colorNode){if(colorPerVertex)this.addColor(colorNode.getColor(index));else this.addColor(colorNode.getColor(face))}if(texCoordNode)texCoordNode.addTexCoord(this.getTexCoords(),index);else{var t=texCoords[index];this.getTexCoords()[0].push(t.x,t.y,0,1)}if(normalNode){if(normalPerVertex)this.addNormal(normalNode.getVector(index));else this.addNormal(normalNode.getVector(face))}this.addVertex(points[index])}}if(!normalNode){var normals=this.createNormals(points,coordIndex);for(var i=0;i<normals.length;++i)this.addNormal(normals[i])}this.setSolid(this.solid_.getValue());this.setCCW(this.ccw_.getValue());this.setCurrentTexCoord(this.getTexCoord())}});return ElevationGrid}});define("cobweb/Components/Geometry3D/Extrusion",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","lib/poly2tri.js/dist/poly2tri.js"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Triangle3,Vector2,Vector3,Rotation4,Matrix4,poly2tri){with(Fields){function Extrusion(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Extrusion)}Extrusion.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Extrusion,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"beginCap",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"endCap",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"ccw",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"convex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"creaseAngle",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"crossSection",new MFVec2f(new Vector2(1,1),new Vector2(1,-1),new Vector2(-1,-1),new Vector2(-1,1),new Vector2(1,1))),new X3DFieldDefinition(X3DConstants.inputOutput,"orientation",new MFRotation(new Rotation4)),new X3DFieldDefinition(X3DConstants.inputOutput,"scale",new MFVec2f(new Vector2(1,1))),new X3DFieldDefinition(X3DConstants.inputOutput,"spine",new MFVec3f(new Vector3(0,0,0),new Vector3(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},createPoints:function(){var crossSection=this.crossSection_.getValue(),orientation=this.orientation_.getValue(),scale=this.scale_.getValue(),spine=this.spine_.getValue(),points=[];var rotations=this.createRotations();var matrix=new Matrix4;for(var i=0,length=spine.length;i<length;++i){matrix.identity();matrix.translate(spine[i].getValue());if(orientation.length)matrix.rotate(orientation[Math.min(i,orientation.length-1)].getValue());matrix.multLeft(rotations[i]);if(scale.length){var s=scale[Math.min(i,scale.length-1)].getValue();matrix.scale(new Vector3(s.x,1,s.y))}for(var cs=0,csLength=crossSection.length;cs<csLength;++cs){var vector=crossSection[cs].getValue();points.push(matrix.multVecMatrix(new Vector3(vector.x,0,vector.y)))}}return points},createRotations:function(){var rotations=[];var spine=this.spine_.getValue(),firstSpine=spine[0].getValue(),lastSpine=spine[spine.length-1].getValue(),closedSpine=firstSpine.equals(lastSpine);var SCPxAxis,SCPyAxis,SCPzAxis=new Vector3(0,0,0);if(closedSpine){SCPyAxis=Vector3.subtract(spine[1].getValue(),spine[spine.length-2].getValue()).normalize();SCPzAxis=Vector3.subtract(spine[1].getValue(),spine[0].getValue()).cross(Vector3.subtract(spine[spine.length-2].getValue(),spine[0].getValue())).normalize()}else{SCPyAxis=Vector3.subtract(spine[1].getValue(),spine[0].getValue()).normalize();for(var i=1,length=spine.length-1;i<length;++i){SCPzAxis=Vector3.subtract(spine[i+1].getValue(),spine[i].getValue()).cross(Vector3.subtract(spine[i-1].getValue(),spine[i].getValue())).normalize();if(!SCPzAxis.equals(Vector3.Zero))break}}if(SCPzAxis.equals(Vector3.Zero))SCPzAxis=new Rotation4(new Vector3(0,1,0),SCPyAxis).multVecRot(new Vector3(0,0,1));SCPxAxis=Vector3.cross(SCPyAxis,SCPzAxis);rotations.push(new Matrix4(SCPxAxis.x,SCPxAxis.y,SCPxAxis.z,0,SCPyAxis.x,SCPyAxis.y,SCPyAxis.z,0,SCPzAxis.x,SCPzAxis.y,SCPzAxis.z,0,0,0,0,1));var SCPzAxisPrevious=SCPzAxis;for(var i=1,length=spine.length-1;i<length;++i){SCPyAxis=Vector3.subtract(spine[i+1].getValue(),spine[i-1].getValue()).normalize();SCPzAxis=Vector3.subtract(spine[i+1].getValue(),spine[i].getValue()).cross(Vector3.subtract(spine[i-1].getValue(),spine[i].getValue())).normalize();if(SCPzAxisPrevious.dot(SCPzAxis)<0)SCPzAxis.negate();if(SCPzAxis.equals(Vector3.Zero))SCPzAxis=SCPzAxisPrevious;else SCPzAxisPrevious=SCPzAxis;SCPxAxis=Vector3.cross(SCPyAxis,SCPzAxis);rotations.push(new Matrix4(SCPxAxis.x,SCPxAxis.y,SCPxAxis.z,0,SCPyAxis.x,SCPyAxis.y,SCPyAxis.z,0,SCPzAxis.x,SCPzAxis.y,SCPzAxis.z,0,0,0,0,1))}if(closedSpine){rotations.push(rotations[0])}else{SCPyAxis=Vector3.subtract(spine[spine.length-1].getValue(),spine[spine.length-2].getValue()).normalize();if(spine.length>2){SCPzAxis=Vector3.subtract(spine[spine.length-1].getValue(),spine[spine.length-2].getValue()).cross(Vector3.subtract(spine[spine.length-3].getValue(),spine[spine.length-2].getValue())).normalize()}if(SCPzAxisPrevious.dot(SCPzAxis)<0)SCPzAxis.negate();if(SCPzAxis.equals(Vector3.Zero))SCPzAxis=SCPzAxisPrevious;SCPxAxis=Vector3.cross(SCPyAxis,SCPzAxis);rotations.push(new Matrix4(SCPxAxis.x,SCPxAxis.y,SCPxAxis.z,0,SCPyAxis.x,SCPyAxis.y,SCPyAxis.z,0,SCPzAxis.x,SCPzAxis.y,SCPzAxis.z,0,0,0,0,1))}return rotations},build:function(){var cw=!this.ccw_.getValue(),crossSection=this.crossSection_.getValue(),spine=this.spine_.getValue(),texCoords=[];if(spine.length<2||crossSection.length<2)return;this.getTexCoords().push(texCoords);var crossSectionSize=crossSection.length;function INDEX(n,k){return n*crossSectionSize+k}var firstSpine=spine[0].getValue(),lastSpine=spine[spine.length-1].getValue(),closedSpine=firstSpine.equals(lastSpine);var firstCrossSection=crossSection[0].getValue(),lastCrossSection=crossSection[crossSection.length-1].getValue(),closedCrossSection=firstCrossSection.equals(lastCrossSection);var min=crossSection[0].getValue().copy(),max=crossSection[0].getValue().copy();for(var k=1,length=crossSection.length;k<length;++k){min.min(crossSection[k].getValue());max.max(crossSection[k].getValue())}var capSize=Vector2.subtract(max,min),capMax=Math.max(capSize.x,capSize.y),numCapPoints=closedCrossSection?crossSection.length-1:crossSection.length;var normalIndex=[],normals=[],points=this.createPoints();for(var p=0;p<points.length;++p)normalIndex[p]=[];var numCrossSection_1=crossSection.length-1,numSpine_1=spine.length-1;for(var n=0;n<numSpine_1;++n){for(var k=0;k<numCrossSection_1;++k){var n1=closedSpine&&n===spine.length-2?0:n+1,k1=closedCrossSection&&k===crossSection.length-2?0:k+1;var i1=INDEX(n,k),i2=INDEX(n,k1),i3=INDEX(n1,k1),i4=INDEX(n1,k),p1=points[i1],p2=points[i2],p3=points[i3],p4=points[i4];if(cw){var normal1=Triangle3.normal(p3,p2,p1,new Vector3(0,0,0)),normal2=Triangle3.normal(p4,p3,p1,new Vector3(0,0,0))}else{var normal1=Triangle3.normal(p1,p2,p3,new Vector3(0,0,0)),normal2=Triangle3.normal(p1,p3,p4,new Vector3(0,0,0))}texCoords.push(k/numCrossSection_1,n/numSpine_1,0,1);normalIndex[i1].push(normals.length);normals.push(normal1);this.addVertex(p1);texCoords.push((k+1)/numCrossSection_1,n/numSpine_1,0,1);normalIndex[i2].push(normals.length);normals.push(normal1);this.addVertex(p2);texCoords.push((k+1)/numCrossSection_1,(n+1)/numSpine_1,0,1);normalIndex[i3].push(normals.length);normals.push(normal1);this.addVertex(p3);texCoords.push(k/numCrossSection_1,n/numSpine_1,0,1);normalIndex[i1].push(normals.length);normals.push(normal2);this.addVertex(p1);texCoords.push((k+1)/numCrossSection_1,(n+1)/numSpine_1,0,1);normalIndex[i3].push(normals.length);normals.push(normal2);this.addVertex(p3);texCoords.push(k/numCrossSection_1,(n+1)/numSpine_1,0,1);normalIndex[i4].push(normals.length);normals.push(normal2);this.addVertex(p4)}}normals=this.refineNormals(normalIndex,normals,this.creaseAngle_.getValue());for(var i=0;i<normals.length;++i)this.addNormal(normals[i]);if(capMax&&crossSection.length>2){if(this.beginCap_.getValue()){var j=0,vertices=[],triangles=[];for(var k=0;k<numCapPoints;++k){var point=points[INDEX(j,numCapPoints-1-k)];point.texCoord=Vector2.subtract(crossSection[numCapPoints-1-k].getValue(),min).divide(capMax);vertices.push(point)}if(this.convex_.getValue())this.triangulateConvexPolygon(vertices,triangles);else this.triangulatePolygon(vertices,triangles);var normal=Triangle3.normal(vertices[triangles[0]],vertices[triangles[1]],vertices[triangles[2]],new Vector3(0,0,0));if(cw)normal.negate();this.addCap(texCoords,normal,vertices,triangles)}if(this.endCap_.getValue()){var j=spine.length-1,vertices=[],triangles=[];for(var k=0;k<numCapPoints;++k){var point=points[INDEX(j,k)];point.texCoord=Vector2.subtract(crossSection[k].getValue(),min).divide(capMax);vertices.push(point)}if(this.convex_.getValue())this.triangulateConvexPolygon(vertices,triangles);else this.triangulatePolygon(vertices,triangles);var normal=Triangle3.normal(vertices[triangles[0]],vertices[triangles[1]],vertices[triangles[2]],new Vector3(0,0,0));if(cw)normal.negate();this.addCap(texCoords,normal,vertices,triangles)}}this.setSolid(this.solid_.getValue());this.setCCW(this.ccw_.getValue());this.setCurrentTexCoord(null)},addCap:function(texCoords,normal,vertices,triangles){for(var i=0;i<triangles.length;i+=3){var p0=vertices[triangles[i]],p1=vertices[triangles[i+1]],p2=vertices[triangles[i+2]],t0=p0.texCoord,t1=p1.texCoord,t2=p2.texCoord;texCoords.push(t0.x,t0.y,0,1);texCoords.push(t1.x,t1.y,0,1);texCoords.push(t2.x,t2.y,0,1);this.addNormal(normal);this.addNormal(normal);this.addNormal(normal);this.addVertex(p0);this.addVertex(p1);this.addVertex(p2)}},triangulatePolygon:function(vertices,triangles){try{var p0=vertices[0],p1=vertices[1];var zAxis=this.getPolygonNormal(vertices),xAxis=Vector3.subtract(p1,p0),yAxis=Vector3.cross(zAxis,xAxis);xAxis.normalize();yAxis.normalize();var matrix=new Matrix4(xAxis.x,xAxis.y,xAxis.z,0,yAxis.x,yAxis.y,yAxis.z,0,zAxis.x,zAxis.y,zAxis.z,0,p0.x,p0.y,p0.z,1);matrix.inverse();var contour=[];for(var i=0;i<vertices.length;++i){var point=matrix.multVecMatrix(vertices[i].copy());point.index=i;contour.push(point)}var context=new poly2tri.SweepContext(contour),ts=context.triangulate().getTriangles();for(var i=0;i<ts.length;++i)triangles.push(ts[i].getPoint(0).index,ts[i].getPoint(1).index,ts[i].getPoint(2).index)}catch(error){this.triangulateConvexPolygon(vertices,triangles)}},triangulateConvexPolygon:function(vertices,triangles){for(var i=1,length=vertices.length-1;i<length;++i)triangles.push(0,i,i+1)},getPolygonNormal:function(vertices){var normal=new Vector3(0,0,0),next=vertices[0];for(var i=0,length=vertices.length;i<length;++i){var current=next,next=vertices[(i+1)%length];normal.x+=(current.y-next.y)*(current.z+next.z);normal.y+=(current.z-next.z)*(current.x+next.x);normal.z+=(current.x-next.x)*(current.y+next.y)}return normal.normalize()}});return Extrusion}});define("cobweb/Components/Rendering/IndexedLineSet",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DCast,X3DConstants){with(Fields){function IndexedLineSet(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.IndexedLineSet);this.attribNodes=[];this.colorNode=null;this.coordNode=null}IndexedLineSet.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:IndexedLineSet,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"colorPerVertex",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"colorIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"coordIndex",new MFInt32),new X3DFieldDefinition(X3DConstants.inputOutput,"attrib",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"fogCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"coord",new SFNode)]),getTypeName:function(){return"IndexedLineSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){X3DGeometryNode.prototype.initialize.call(this);this.attrib_.addInterest(this,"set_attrib__");this.color_.addInterest(this,"set_color__");this.coord_.addInterest(this,"set_coord__");this.setPrimitiveMode(this.getBrowser().getContext().LINES);this.set_attrib__();this.set_color__();this.set_coord__()},isLineGeometry:function(){return true},set_attrib__:function(){for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].removeInterest(this,"addNodeEvent");this.attribNodes.length=0;for(var i=0,length=this.attrib_.length;i<length;++i){var attribNode=X3DCast(X3DConstants.X3DVertexAttributeNode,this.attrib_[i]);if(attribNode)this.attribNodes.push(attribNode)}for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].addInterest(this,"addNodeEvent")},set_color__:function(){if(this.colorNode){this.colorNode.removeInterest(this,"addNodeEvent");this.colorNode.removeInterest(this,"set_transparent__")}this.colorNode=X3DCast(X3DConstants.X3DColorNode,this.color_);if(this.colorNode){this.colorNode.addInterest(this,"addNodeEvent");this.colorNode.addInterest(this,"set_transparent__");this.set_transparent__()}else this.transparent_=false},set_transparent__:function(){this.transparent_=this.colorNode.isTransparent()},set_coord__:function(){if(this.coordNode)this.coordNode.removeInterest(this,"addNodeEvent");this.coordNode=X3DCast(X3DConstants.X3DCoordinateNode,this.coord_);if(this.coordNode)this.coordNode.addInterest(this,"addNodeEvent")},getColorPerVertexIndex:function(index){if(index<this.colorIndex_.length)return this.colorIndex_[index];return this.coordIndex_[index]},getColorIndex:function(index){if(index<this.colorIndex_.length)return this.colorIndex_[index];return index},getPolylineIndices:function(){var coordIndex=this.coordIndex_.getValue(),polylines=[],polyline=[];if(this.coordIndex_.length){var i=0;for(var i=0;i<coordIndex.length;++i){var index=coordIndex[i].getValue();if(index>=0)polyline.push(i);else{if(polyline.length>1){polylines.push(polyline)}polyline=[]}}if(coordIndex[coordIndex.length-1].getValue()>=0){if(polyline.length>1)polylines.push(polyline)}}return polylines},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;var coordIndex=this.coordIndex_.getValue(),polylines=this.getPolylineIndices(),colorPerVertex=this.colorPerVertex_.getValue(),attribArrays=[];var face=0;for(var p=0;p<polylines.length;++p){var polyline=polylines[p];for(var line=0,l_end=polyline.length-1;line<l_end;++line){for(var index=line,i_end=line+2;index<i_end;++index){var i=polyline[index];if(this.colorNode){if(colorPerVertex)this.addColor(this.colorNode.getColor(this.getColorPerVertexIndex(i)));else this.addColor(this.colorNode.getColor(this.getColorIndex(face)))}this.addVertex(this.coordNode.getPoint(coordIndex[i].getValue()))}}++face}this.setSolid(false)},traverse:function(context){var browser=this.getBrowser();if(browser.getShader()===browser.getDefaultShader()){browser.setTexture(null);browser.setShader(browser.getLineShader())}X3DGeometryNode.prototype.traverse.call(this,context)}});return IndexedLineSet}});define("cobweb/Components/Networking/Inline",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DChildNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Components/Grouping/X3DBoundedObject","cobweb/Components/Grouping/Group","cobweb/Bits/X3DConstants","cobweb/InputOutput/Loader"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DChildNode,X3DUrlObject,X3DBoundedObject,Group,X3DConstants,Loader){with(Fields){function Inline(executionContext){X3DChildNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);X3DBoundedObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Inline);this.addChildren("buffer",new SFTime);this.scene=this.getBrowser().getDefaultScene();this.group=new Group(executionContext);this.getBBox=this.group.getBBox.bind(this.group);this.traverse=this.group.traverse.bind(this.group)}Inline.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DUrlObject.prototype,X3DBoundedObject.prototype,{constructor:Inline,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"load",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f)]),getTypeName:function(){return"Inline"},getComponentName:function(){return"Networking"},getContainerField:function(){return"children"},initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);X3DBoundedObject.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.group.setup();this.group.isCameraObject_.addFieldInterest(this.isCameraObject_);this.load_.addInterest(this,"set_load__");this.url_.addInterest(this,"set_url__");this.buffer_.addInterest(this,"set_buffer__");this.requestAsyncLoad()},set_live__:function(){if(this.checkLoadState()==X3DConstants.COMPLETE_STATE){var live=this.getExecutionContext().isLive().getValue()&&this.isLive().getValue();if(live)this.scene.beginUpdate();else this.scene.endUpdate()}},set_load__:function(){if(this.load_.getValue())this.buffer_.addEvent();else this.requestUnload()},set_url__:function(){this.buffer_.addEvent()},set_buffer__:function(){if(!this.load_.getValue())return;this.setLoadState(X3DConstants.NOT_STARTED_STATE);this.requestAsyncLoad()},requestImmediateLoad:function(){try{this.setScene(new Loader(this).createX3DFromURL(this.url_))}catch(error){console.log(error);this.setScene(this.getBrowser().getDefaultScene())}},requestAsyncLoad:function(){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.IN_PROGRESS_STATE)return;this.setLoadState(X3DConstants.IN_PROGRESS_STATE);new Loader(this).createX3DFromURL(this.url_,this.setSceneAsync.bind(this))},requestUnload:function(){if(this.checkLoadState()===X3DConstants.NOT_STARTED_STATE||this.checkLoadState()===X3DConstants.FAILED_STATE)return;this.setLoadState(X3DConstants.NOT_STARTED_STATE);this.setScene(this.getBrowser().getDefaultScene())},setSceneAsync:function(scene){if(scene){this.setLoadState(X3DConstants.COMPLETE_STATE);this.setScene(scene)}else{this.setLoadState(X3DConstants.FAILED_STATE);this.setScene(this.getBrowser().getDefaultScene())}},setScene:function(scene){this.scene.endUpdate();this.scene.rootNodes.removeInterest(this.group.children_,"setValue");this.scene=scene;this.scene.setup();this.scene.rootNodes.addInterest(this.group.children_,"setValue");this.group.children_=this.scene.rootNodes;this.set_live__();this.getBrowser().addBrowserEvent()},getScene:function(){return this.scene}});return Inline}});define("cobweb/Components/KeyDeviceSensor/X3DKeyDeviceSensorNode",["jquery","cobweb/Components/Core/X3DSensorNode","cobweb/Bits/X3DConstants"],function($,X3DSensorNode,X3DConstants){function X3DKeyDeviceSensorNode(browser,executionContext){X3DSensorNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DKeyDeviceSensorNode)}X3DKeyDeviceSensorNode.prototype=$.extend(Object.create(X3DSensorNode.prototype),{constructor:X3DKeyDeviceSensorNode,initialize:function(){X3DSensorNode.prototype.initialize.call(this);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.set_live__()},set_live__:function(){if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue()){this.enabled_.addInterest(this,"set_enabled__");if(this.enabled_.getValue())this.enable()}else{this.enabled_.removeInterest(this,"set_enabled__");if(this.enabled_.getValue())this.disable()}},set_enabled__:function(){if(this.enabled_.getValue())this.enable();else this.disable()},enable:function(){if(this.isActive_.getValue())return;var keyDeviceSensorNode=this.getBrowser().getKeyDeviceSensorNode();if(keyDeviceSensorNode){keyDeviceSensorNode.enabled_=false;keyDeviceSensorNode.isActive_=false}this.getBrowser().setKeyDeviceSensorNode(this);this.isActive_=true},disable:function(){if(!this.isActive_.getValue())return;this.getBrowser().setKeyDeviceSensorNode(null);this.release();this.isActive_=false},keydown:function(){},keyup:function(){},release:function(){}});return X3DKeyDeviceSensorNode});define("cobweb/Components/KeyDeviceSensor/KeySensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/KeyDeviceSensor/X3DKeyDeviceSensorNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DKeyDeviceSensorNode,X3DConstants){with(Fields){var KEY_F1=1,KEY_F2=2,KEY_F3=3,KEY_F4=4,KEY_F5=5,KEY_F6=6,KEY_F7=7,KEY_F8=8,KEY_F9=9,KEY_F10=10,KEY_F11=11,KEY_F12=12,KEY_HOME=13,KEY_END=14,KEY_PGUP=15,KEY_PGDN=16,KEY_UP=17,KEY_DOWN=18,KEY_LEFT=19,KEY_RIGHT=20,Control_R=1,Control_L=2,Shift_R=1,Shift_L=2;function KeySensor(executionContext){X3DKeyDeviceSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.KeySensor)
}KeySensor.prototype=$.extend(Object.create(X3DKeyDeviceSensorNode.prototype),{constructor:KeySensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.outputOnly,"controlKey",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"shiftKey",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"altKey",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"actionKeyPress",new SFInt32),new X3DFieldDefinition(X3DConstants.outputOnly,"actionKeyRelease",new SFInt32),new X3DFieldDefinition(X3DConstants.outputOnly,"keyPress",new SFString),new X3DFieldDefinition(X3DConstants.outputOnly,"keyRelease",new SFString),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool)]),getTypeName:function(){return"KeySensor"},getComponentName:function(){return"KeyDeviceSensor"},getContainerField:function(){return"children"},keydown:function(event){switch(event.which){case 16:this.shiftKey_=true;break;case 17:this.controlKey_=true;break;case 18:this.altKey_=true;break;case 112:this.actionKeyPress_=KEY_F1;break;case 113:this.actionKeyPress_=KEY_F2;break;case 114:this.actionKeyPress_=KEY_F3;break;case 115:this.actionKeyPress_=KEY_F4;break;case 116:this.actionKeyPress_=KEY_F5;break;case 117:this.actionKeyPress_=KEY_F6;break;case 118:this.actionKeyPress_=KEY_F7;break;case 119:this.actionKeyPress_=KEY_F8;break;case 120:this.actionKeyPress_=KEY_F9;break;case 121:this.actionKeyPress_=KEY_F10;break;case 122:this.actionKeyPress_=KEY_F11;break;case 123:this.actionKeyPress_=KEY_F12;break;case 36:this.actionKeyPress_=KEY_HOME;break;case 35:this.actionKeyPress_=KEY_END;break;case 33:this.actionKeyPress_=KEY_PGUP;break;case 34:this.actionKeyPress_=KEY_PGDN;break;case 38:this.actionKeyPress_=KEY_UP;break;case 40:this.actionKeyPress_=KEY_DOWN;break;case 37:this.actionKeyPress_=KEY_LEFT;break;case 39:this.actionKeyPress_=KEY_RIGHT;break;default:{if(event.charCode)this.keyPress_=event.key;break}}},keyup:function(event){switch(event.which){case 16:{this.shiftKey_=false;break}case 17:{this.controlKey_=false;break}case 18:{this.altKey_=false;break}case 112:this.actionKeyRelease_=KEY_F1;break;case 113:this.actionKeyRelease_=KEY_F2;break;case 114:this.actionKeyRelease_=KEY_F3;break;case 115:this.actionKeyRelease_=KEY_F4;break;case 116:this.actionKeyRelease_=KEY_F5;break;case 117:this.actionKeyRelease_=KEY_F6;break;case 118:this.actionKeyRelease_=KEY_F7;break;case 119:this.actionKeyRelease_=KEY_F8;break;case 120:this.actionKeyRelease_=KEY_F9;break;case 121:this.actionKeyRelease_=KEY_F10;break;case 122:this.actionKeyRelease_=KEY_F11;break;case 123:this.actionKeyRelease_=KEY_F12;break;case 36:this.actionKeyRelease_=KEY_HOME;break;case 35:this.actionKeyRelease_=KEY_END;break;case 33:this.actionKeyRelease_=KEY_PGUP;break;case 34:this.actionKeyRelease_=KEY_PGDN;break;case 38:this.actionKeyRelease_=KEY_UP;break;case 40:this.actionKeyRelease_=KEY_DOWN;break;case 37:this.actionKeyRelease_=KEY_LEFT;break;case 39:this.actionKeyRelease_=KEY_RIGHT;break;default:{if(event.charCode)this.keyRelease_=event.key;break}}},release:function(){if(this.shiftKey_.getValue())this.shiftKey_=false;if(this.controlKey_.getValue())this.controlKey_=false;if(this.altKey_.getValue())this.altKey_=false}});return KeySensor}});define("cobweb/Components/Navigation/LOD",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Matrix4","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DConstants,Matrix4,Algorithm){with(Fields){var FRAMES=180,FRAME_RATE_MIN=20,FRAME_RATE_MAX=55;function LOD(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.LOD);this.addAlias("level",this.children_);this.frameRate=60;this.keepCurrentLevel=false}LOD.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:LOD,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"forceTransitions",new SFBool),new X3DFieldDefinition(X3DConstants.initializeOnly,"center",new SFVec3f),new X3DFieldDefinition(X3DConstants.initializeOnly,"range",new MFFloat),new X3DFieldDefinition(X3DConstants.outputOnly,"level_changed",new SFInt32(-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),modelViewMatrix:new Matrix4,getTypeName:function(){return"LOD"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){X3DGroupingNode.prototype.initialize.call(this);this.child=this.getChild(this.level_changed_.getValue());this.set_cameraObjects__()},set_cameraObjects__:function(){if(this.child&&this.child.getCameraObject)this.setCameraObject(this.child.getCameraObject());else this.setCameraObject(false)},getBBox:function(){if(this.bboxSize_.getValue().equals(this.defaultBBoxSize)){var boundedObject=X3DCast(X3DConstants.X3DBoundedObject,this.child);if(boundedObject)return boundedObject.getBBox();return new Box3}return new Box3(this.bboxSize_.getValue(),this.bboxCenter_.getValue())},getLevel:function(type){if(this.range_.length===0){var size=this.children_.length;if(size<2)return 0;this.frameRate=((FRAMES-1)*this.frameRate+this.getBrowser().currentFrameRate)/FRAMES;if(size===2)return Number(this.frameRate>FRAME_RATE_MAX);var n=size-1,fraction=Math.max((this.frameRate-FRAME_RATE_MIN)/(FRAME_RATE_MAX-FRAME_RATE_MIN),0);return Math.min(Math.ceil(fraction*(n-1)),n)}var distance=this.getDistance(type);return Algorithm.upperBound(this.range_,0,this.range_.length,distance,Algorithm.less)},getDistance:function(type){var modelViewMatrix=this.getModelViewMatrix(type,this.modelViewMatrix);modelViewMatrix.translate(this.center_.getValue());return modelViewMatrix.origin.abs()},traverse:function(type){if(!this.keepCurrentLevel){var level=this.getLevel(type),currentLevel=this.level_changed_.getValue();if(level!==currentLevel){if(this.forceTransitions_.getValue()){if(type===TraverseType.DISPLAY){if(level>currentLevel)this.level_changed_=currentLevel+1;else this.level_changed_=currentLevel-1}}else this.level_changed_=level;this.child=this.getChild(Math.min(level,this.children_.length-1));this.set_cameraObjects__()}}if(this.child)this.child.traverse(type)}});return LOD}});define("cobweb/Components/Shape/X3DMaterialNode",["jquery","cobweb/Components/Shape/X3DAppearanceChildNode","cobweb/Bits/X3DConstants"],function($,X3DAppearanceChildNode,X3DConstants){function X3DMaterialNode(browser,executionContext){X3DAppearanceChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DMaterialNode)}X3DMaterialNode.prototype=$.extend(Object.create(X3DAppearanceChildNode.prototype),{constructor:X3DMaterialNode});return X3DMaterialNode});define("cobweb/Components/Shape/Material",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Shape/X3DMaterialNode","cobweb/Bits/X3DConstants","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DMaterialNode,X3DConstants,Algorithm){with(Fields){function Material(executionContext){X3DMaterialNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Material);this.diffuseColor=new Float32Array(3);this.specularColor=new Float32Array(3);this.emissiveColor=new Float32Array(3)}Material.prototype=$.extend(Object.create(X3DMaterialNode.prototype),{constructor:Material,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"ambientIntensity",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"diffuseColor",new SFColor(.8,.8,.8)),new X3DFieldDefinition(X3DConstants.inputOutput,"specularColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"emissiveColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"shininess",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"transparency",new SFFloat)]),getTypeName:function(){return"Material"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){X3DMaterialNode.prototype.initialize.call(this);this.addChildren("transparent",new SFBool);this.ambientIntensity_.addInterest(this,"set_ambientIntensity__");this.diffuseColor_.addInterest(this,"set_diffuseColor__");this.specularColor_.addInterest(this,"set_specularColor__");this.emissiveColor_.addInterest(this,"set_emissiveColor__");this.shininess_.addInterest(this,"set_shininess__");this.transparency_.addInterest(this,"set_transparency__");this.set_ambientIntensity__();this.set_diffuseColor__();this.set_specularColor__();this.set_emissiveColor__();this.set_shininess__();this.set_transparency__()},getSeparateBackColor:function(){return false},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this.ambientIntensity_.getValue(),0)},set_diffuseColor__:function(){this.diffuseColor.set(this.diffuseColor_.getValue())},set_specularColor__:function(){this.specularColor.set(this.specularColor_.getValue())},set_emissiveColor__:function(){this.emissiveColor.set(this.emissiveColor_.getValue())},set_shininess__:function(){this.shininess=Algorithm.clamp(this.shininess_.getValue(),0,1)*128},set_transparency__:function(){var transparency=Algorithm.clamp(this.transparency_.getValue(),0,1);this.transparency=transparency;if(transparency!=this.transparent_.getValue())this.transparent_=transparency}});return Material}});define("cobweb/Components/Core/X3DMetadataObject",["jquery","cobweb/Bits/X3DConstants"],function($,X3DConstants){function X3DMetadataObject(browser,executionContext){this.addType(X3DConstants.X3DMetadataObject)}X3DMetadataObject.prototype={constructor:X3DMetadataObject,initialize:function(){}};return X3DMetadataObject});define("cobweb/Components/Core/MetadataBoolean",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataBoolean(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataBoolean)}MetadataBoolean.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataBoolean,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFBool)]),getTypeName:function(){return"MetadataBoolean"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataBoolean}});define("cobweb/Components/Core/MetadataDouble",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataDouble(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataDouble)}MetadataDouble.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataDouble,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFDouble)]),getTypeName:function(){return"MetadataDouble"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataDouble}});define("cobweb/Components/Core/MetadataFloat",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataFloat(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataFloat)}MetadataFloat.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataFloat,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFFloat)]),getTypeName:function(){return"MetadataFloat"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataFloat}});define("cobweb/Components/Core/MetadataInteger",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataInteger(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataInteger)}MetadataInteger.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataInteger,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFInt32)]),getTypeName:function(){return"MetadataInteger"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataInteger}});define("cobweb/Components/Core/MetadataSet",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataSet(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataSet)}MetadataSet.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataSet,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFNode)]),getTypeName:function(){return"MetadataSet"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataSet}});define("cobweb/Components/Core/MetadataString",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DNode","cobweb/Components/Core/X3DMetadataObject","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNode,X3DMetadataObject,X3DConstants){with(Fields){function MetadataString(executionContext){X3DNode.call(this,executionContext.getBrowser(),executionContext);X3DMetadataObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MetadataString)}MetadataString.prototype=$.extend(Object.create(X3DNode.prototype),X3DMetadataObject.prototype,{constructor:MetadataString,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"name",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"reference",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"value",new MFString)]),getTypeName:function(){return"MetadataString"},getComponentName:function(){return"Core"},getContainerField:function(){return"metadata"}});return MetadataString}});define("cobweb/Components/Texturing/MovieTexture",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Texturing/X3DTexture2DNode","cobweb/Components/Sound/X3DSoundSourceNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Bits/X3DConstants","standard/Networking/URI"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTexture2DNode,X3DSoundSourceNode,X3DUrlObject,X3DConstants,URI){with(Fields){function MovieTexture(executionContext){X3DTexture2DNode.call(this,executionContext.getBrowser(),executionContext);X3DSoundSourceNode.call(this,executionContext.getBrowser(),executionContext);X3DUrlObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.MovieTexture);this.urlStack=new MFString}MovieTexture.prototype=$.extend(Object.create(X3DTexture2DNode.prototype),X3DSoundSourceNode.prototype,X3DUrlObject.prototype,{constructor:MovieTexture,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"speed",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"pitch",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"loop",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"startTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"resumeTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"pauseTime",new SFTime),new X3DFieldDefinition(X3DConstants.inputOutput,"stopTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"isPaused",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"cycleTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"elapsedTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"duration_changed",new SFTime(-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatS",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatT",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"textureProperties",new SFNode)]),getTypeName:function(){return"MovieTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){X3DTexture2DNode.prototype.initialize.call(this);X3DSoundSourceNode.prototype.initialize.call(this);X3DUrlObject.prototype.initialize.call(this);this.url_.addInterest(this,"set_url__");this.canvas=$("<canvas>");this.video=$("<video>");this.video.error(this.setError.bind(this));this.video.bind("abort",this.setError.bind(this));this.video.attr("preload","auto");this.video.attr("volume",0);this.video.attr("crossOrigin","anonymous");this.requestAsyncLoad()},set_url__:function(){this.setLoadState(X3DConstants.NOT_STARTED_STATE);this.requestAsyncLoad()},requestAsyncLoad:function(){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.IN_PROGRESS_STATE)return;this.setLoadState(X3DConstants.IN_PROGRESS_STATE);this.setMedia(null);this.urlStack.setValue(this.url_);this.video.bind("canplaythrough",this.setVideo.bind(this));this.loadNext()},loadNext:function(){if(this.urlStack.length===0){this.duration_changed_=-1;this.clear();this.setLoadState(X3DConstants.FAILED_STATE);return}this.URL=new URI(this.urlStack.shift());this.URL=this.getExecutionContext().getWorldURL().transform(this.URL);this.video.attr("src",this.URL)},setError:function(){console.warn("Error loading movie:",this.URL.toString());this.loadNext()},setVideo:function(){var video=this.video[0];try{var width=video.videoWidth,height=video.videoHeight,canvas=this.canvas[0],cx=canvas.getContext("2d");canvas.width=width;canvas.height=height;cx.drawImage(video,0,0);var data=cx.getImageData(0,0,width,height).data;setTimeout(function(){this.video.unbind("canplaythrough");this.setMedia(this.video);this.setTexture(width,height,false,new Uint8Array(data),true);this.setLoadState(X3DConstants.COMPLETE_STATE)}.bind(this),16)}catch(error){console.log(error.message);this.setError()}},prepareEvents:function(){X3DSoundSourceNode.prototype.prepareEvents.call(this);var video=this.getMedia();if(video)this.updateTexture(video[0])},traverse:X3DTexture2DNode.prototype.traverse});return MovieTexture}});define("cobweb/Components/Rendering/X3DNormalNode",["jquery","cobweb/Components/Rendering/X3DGeometricPropertyNode","cobweb/Bits/X3DConstants"],function($,X3DGeometricPropertyNode,X3DConstants){function X3DNormalNode(browser,executionContext){X3DGeometricPropertyNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DNormalNode)}X3DNormalNode.prototype=$.extend(Object.create(X3DGeometricPropertyNode.prototype),{constructor:X3DNormalNode});return X3DNormalNode});define("cobweb/Components/Rendering/Normal",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DNormalNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DNormalNode,X3DConstants,Vector3){with(Fields){function Normal(executionContext){X3DNormalNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Normal)}Normal.prototype=$.extend(Object.create(X3DNormalNode.prototype),{constructor:Normal,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"vector",new MFVec3f)]),getTypeName:function(){return"Normal"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"normal"},getVector:function(index){if(index>=0&&index<this.vector_.length)return this.vector_[index].getValue();return new Vector3(0,0,0)}});return Normal}});define("cobweb/Components/Interpolation/NormalInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Vector3,Algorithm){with(Fields){function NormalInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.NormalInterpolator)}NormalInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:NormalInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new MFVec3f)]),keyValue:new Vector3(0,0,0),getTypeName:function(){return"NormalInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){},interpolate:function(index0,index1,weight){var keyValue=this.keyValue_.getValue(),value_changed=this.value_changed_.getValue(),size=this.key_.length>1?Math.floor(keyValue.length/this.key_.length):0;index0*=size;index1=index0+size;this.value_changed_.length=size;for(var i=0;i<size;++i){value_changed[i].set(this.keyValue.assign(keyValue[index0+i].getValue()).slerp(keyValue[index1+i].getValue(),weight))}this.value_changed_.addEvent()}});return NormalInterpolator}});define("cobweb/Components/Texturing/PixelTexture",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Texturing/X3DTexture2DNode","cobweb/Bits/X3DConstants","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTexture2DNode,X3DConstants,Algorithm){with(Fields){function PixelTexture(executionContext){X3DTexture2DNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PixelTexture)}PixelTexture.prototype=$.extend(Object.create(X3DTexture2DNode.prototype),{constructor:PixelTexture,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"image",new SFImage(0,0,0,[])),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatS",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"repeatT",new SFBool(true)),new X3DFieldDefinition(X3DConstants.initializeOnly,"textureProperties",new SFNode)]),getTypeName:function(){return"PixelTexture"},getComponentName:function(){return"Texturing"},getContainerField:function(){return"texture"},initialize:function(){X3DTexture2DNode.prototype.initialize.call(this);this.addChildren("loadState",new SFInt32(X3DConstants.NOT_STARTED_STATE));this.image_.addInterest(this,"set_image__");this.set_image__()},checkLoadState:function(){return this.loadState_.getValue()},getData:function(data,comp,array){switch(comp){case 1:{for(var i=0,index=0,length=array.length;i<length;++i,index+=4){var pixel=array[i].getValue();data[index]=data[index+1]=data[index+2]=pixel&255;data[index+3]=255}break}case 2:{for(var i=0,index=0,length=array.length;i<length;++i,index+=4){var pixel=array[i].getValue();data[index]=data[index+1]=data[index+2]=pixel>>>8&255;data[index+3]=pixel&255}break}case 3:{for(var i=0,index=0,length=array.length;i<length;++i,index+=4){var pixel=array[i].getValue();data[index]=pixel>>>16&255;data[index+1]=pixel>>>8&255;data[index+2]=pixel&255;data[index+3]=255}break}case 4:{for(var i=0,index=0,length=array.length;i<length;++i,index+=4){var pixel=array[i].getValue();data[index]=pixel>>>24;data[index+1]=pixel>>>16&255;data[index+2]=pixel>>>8&255;data[index+3]=pixel&255}break}}},set_image__:function(){var width=this.image_.width,height=this.image_.height,comp=this.image_.comp,array=this.image_.array.getValue(),transparent=!(comp%2),data=null;if(width>0&&height>0&&comp>0&&comp<5){if(Algorithm.isPowerOfTwo(width)&&Algorithm.isPowerOfTwo(height)){data=new Uint8Array(width*height*4);this.getData(data,comp,array)}else if(Math.max(width,height)<this.getBrowser().getMinTextureSize()&&!this.textureProperties_.getValue()){data=new Uint8Array(width*height*4);this.getData(data,comp,array);var inputWidth=width,inputHeight=height;width=Algorithm.nextPowerOfTwo(inputWidth)*4;height=Algorithm.nextPowerOfTwo(inputHeight)*4;data=this.resize(data,inputWidth,inputHeight,width,height)}else{var canvas1=$("<canvas/>")[0],canvas2=$("<canvas/>")[0],cx1=canvas1.getContext("2d"),cx2=canvas2.getContext("2d"),imageData=cx1.createImageData(width,height);canvas1.width=width;canvas1.height=height;this.getData(imageData.data,comp,array);cx1.putImageData(imageData,0,0);width=Algorithm.nextPowerOfTwo(width);height=Algorithm.nextPowerOfTwo(height);canvas2.width=width;canvas2.height=height;cx2.drawImage(canvas1,0,0,canvas1.width,canvas1.height,0,0,width,height);data=cx2.getImageData(0,0,width,height).data}this.setTexture(width,height,transparent,new Uint8Array(data),false);this.loadState_=X3DConstants.COMPLETE_STATE}else{this.clear();this.loadState_=X3DConstants.FAILED_STATE}}});return PixelTexture}});define("cobweb/Components/PointingDeviceSensor/PlaneSensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/PointingDeviceSensor/X3DDragSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Line3","standard/Math/Geometry/Plane3","standard/Math/Geometry/ViewVolume","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DDragSensorNode,X3DConstants,Rotation4,Vector3,Vector4,Matrix4,Line3,Plane3,ViewVolume,Algorithm){with(Fields){function PlaneSensor(executionContext){X3DDragSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PlaneSensor)}PlaneSensor.prototype=$.extend(Object.create(X3DDragSensorNode.prototype),{constructor:PlaneSensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"axisRotation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"autoOffset",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"offset",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"minPosition",new SFVec2f),new X3DFieldDefinition(X3DConstants.inputOutput,"maxPosition",new SFVec2f(-1,-1)),new X3DFieldDefinition(X3DConstants.outputOnly,"trackPoint_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"translation_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"isOver",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool)]),getTypeName:function(){return"PlaneSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){X3DDragSensorNode.prototype.initialize.call(this);this.modelViewMatrix=new Matrix4;this.invModelViewMatrix=new Matrix4;this.projectionMatrix=new Matrix4;this.viewport=new Vector4;this.planeSensor=true;this.plane=null;this.line=null;this.startOffset=new Vector3(0,0,0);this.startPoint=new Vector3(0,0,0)},getLineTrackPoint:function(hit,line,trackPoint){var screenLine=ViewVolume.projectLine(line,this.modelViewMatrix,this.projectionMatrix,this.viewport),trackPoint1=screenLine.getClosestPointToPoint(new Vector3(hit.pointer.x,hit.pointer.y,0)),trackPointLine=ViewVolume.unProjectLine(trackPoint1.x,trackPoint1.y,this.modelViewMatrix,this.projectionMatrix,this.viewport);
return line.getClosestPointToLine(trackPointLine,trackPoint)},set_active__:function(hit,active){X3DDragSensorNode.prototype.set_active__.call(this,hit,active);try{if(this.isActive_.getValue()){var matrices=this.getMatrices()[hit.layer.getId()];this.modelViewMatrix.assign(matrices.modelViewMatrix);this.projectionMatrix.assign(matrices.projectionMatrix);this.viewport.assign(matrices.viewport);this.invModelViewMatrix.assign(this.modelViewMatrix).inverse();var hitRay=hit.hitRay.copy().multLineMatrix(this.invModelViewMatrix),hitPoint=this.invModelViewMatrix.multVecMatrix(hit.intersection.point.copy());var axisRotation=this.axisRotation_.getValue();if(this.minPosition_.x===this.maxPosition_.x){this.planeSensor=false;var direction=axisRotation.multVecRot(new Vector3(0,Math.abs(this.maxPosition_.y-this.minPosition_.y),0));this.line=new Line3(hitPoint,direction.normalize())}else if(this.minPosition_.y===this.maxPosition_.y){this.planeSensor=false;var direction=axisRotation.multVecRot(new Vector3(Math.abs(this.maxPosition_.x-this.minPosition_.x),0,0));this.line=new Line3(hitPoint,direction.normalize())}else{this.planeSensor=true;this.plane=new Plane3(hitPoint,axisRotation.multVecRot(new Vector3(0,0,1)))}if(this.planeSensor)this.plane.intersectsLine(hitRay,this.startPoint);else this.getLineTrackPoint(hit,this.line,this.startPoint);this.startOffset.assign(this.offset_.getValue())}else{if(this.autoOffset_.getValue())this.offset_=this.translation_changed_}}catch(error){}},set_motion__:function(hit){try{if(this.planeSensor){var hitRay=hit.hitRay.copy().multLineMatrix(this.invModelViewMatrix);var endPoint=new Vector3(0,0,0),trackPoint=new Vector3(0,0,0);if(this.plane.intersectsLine(hitRay,endPoint)){new Plane3(new Vector3(0,0,0),this.plane.normal).intersectsLine(hitRay,trackPoint);this.track(endPoint,trackPoint)}else throw new Error("Plane and line are parallel.")}else{var endPoint=new Vector3(0,0,0),trackPoint=new Vector3(0,0,0);if(this.getLineTrackPoint(hit,this.line,endPoint)){try{this.getLineTrackPoint(hit,new Line3(Vector3.Zero,this.line.direction),trackPoint)}catch(error){trackPoint=endPoint}this.track(endPoint,trackPoint)}else throw new Error("Lines are parallel.")}}catch(error){this.trackPoint_changed_.addEvent();this.translation_changed_.addEvent()}},track:function(endPoint,trackPoint){var axisRotation=this.axisRotation_.getValue(),translation=Rotation4.inverse(axisRotation).multVecRot(endPoint.add(this.startOffset).subtract(this.startPoint));if(!(this.minPosition_.x>this.maxPosition_.x))translation.x=Algorithm.clamp(translation.x,this.minPosition_.x,this.maxPosition_.x);if(!(this.minPosition_.y>this.maxPosition_.y))translation.y=Algorithm.clamp(translation.y,this.minPosition_.y,this.maxPosition_.y);this.trackPoint_changed_=trackPoint;this.translation_changed_=axisRotation.multVecRot(translation)}});return PlaneSensor}});define("cobweb/Components/Lighting/PointLight",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Lighting/X3DLightNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Utility/ObjectCache"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DLightNode,X3DConstants,Vector3,ObjectCache){var PointLights=ObjectCache(PointLightContainer);function PointLightContainer(light){this.location=new Vector3(0,0,0);this.set(light)}PointLightContainer.prototype={set:function(light){this.color=light.color_.getValue();this.intensity=light.intensity_.getValue();this.ambientIntensity=light.ambientIntensity_.getValue();this.attenuation=light.attenuation_.getValue();this.radius=light.radius_.getValue();light.getBrowser().getModelViewMatrix().get().multVecMatrix(this.location.assign(light.location_.getValue()))},use:function(gl,shader,i){gl.uniform1i(shader.lightType[i],1);gl.uniform1i(shader.lightOn[i],true);gl.uniform3f(shader.lightColor[i],this.color.r,this.color.g,this.color.b);gl.uniform1f(shader.lightIntensity[i],this.intensity);gl.uniform1f(shader.lightAmbientIntensity[i],this.ambientIntensity);gl.uniform3f(shader.lightAttenuation[i],this.attenuation.x,this.attenuation.y,this.attenuation.z);gl.uniform3f(shader.lightLocation[i],this.location.x,this.location.y,this.location.z);gl.uniform1f(shader.lightRadius[i],this.radius)},recycle:function(){PointLights.push(this)}};with(Fields){function PointLight(executionContext){X3DLightNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PointLight)}PointLight.prototype=$.extend(Object.create(X3DLightNode.prototype),{constructor:PointLight,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"global",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"on",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFColor(1,1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"intensity",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"ambientIntensity",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"attenuation",new SFVec3f(1,0,0)),new X3DFieldDefinition(X3DConstants.inputOutput,"location",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"radius",new SFFloat(100))]),getTypeName:function(){return"PointLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return PointLights}});return PointLight}});define("cobweb/Components/Rendering/PointSet",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Math/Numbers/Color4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DCast,X3DConstants,Color4){with(Fields){function PointSet(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PointSet);this.attribNodes=[];this.colorNode=null;this.coordNode=null}PointSet.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:PointSet,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"attrib",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"fogCoord",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"coord",new SFNode)]),getTypeName:function(){return"PointSet"},getComponentName:function(){return"Rendering"},getContainerField:function(){return"geometry"},initialize:function(){X3DGeometryNode.prototype.initialize.call(this);this.attrib_.addInterest(this,"set_attrib__");this.color_.addInterest(this,"set_color__");this.coord_.addInterest(this,"set_coord__");this.setPrimitiveMode(this.getBrowser().getContext().PONTS);this.set_attrib__();this.set_color__();this.set_coord__()},isLineGeometry:function(){return true},set_attrib__:function(){for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].removeInterest(this,"addNodeEvent");this.attribNodes.length=0;for(var i=0,length=this.attrib_.length;i<length;++i){var attribNode=X3DCast(X3DConstants.X3DVertexAttributeNode,this.attrib_[i]);if(attribNode)this.attribNodes.push(attribNode)}for(var i=0;i<this.attribNodes.length;++i)this.attribNodes[i].addInterest(this,"addNodeEvent")},set_color__:function(){if(this.colorNode){this.colorNode.removeInterest(this,"addNodeEvent");this.colorNode.removeInterest(this,"set_transparent__")}this.colorNode=X3DCast(X3DConstants.X3DColorNode,this.color_);if(this.colorNode){this.colorNode.addInterest(this,"addNodeEvent");this.colorNode.addInterest(this,"set_transparent__");this.set_transparent__()}else this.transparent_=false},set_transparent__:function(){this.transparent_=this.colorNode.isTransparent()},set_coord__:function(){if(this.coordNode)this.coordNode.removeInterest(this,"addNodeEvent");this.coordNode=X3DCast(X3DConstants.X3DCoordinateNode,this.coord_);if(this.coordNode)this.coordNode.addInterest(this,"addNodeEvent")},build:function(){if(!this.coordNode||this.coordNode.isEmpty())return;var attribArrays=[];if(this.colorNode){for(var i=0,length=this.colorNode.color_.length;i<length;++i)this.addColor(this.colorNode.getColor(i));for(var length=this.coordNode.point_.length;i<length;++i)this.addColor(new Color4(1,1,1,1))}for(var i=0,length=this.coordNode.point_.length;i<length;++i)this.addVertex(this.coordNode.getPoint(i));this.setSolid(false)},traverse:function(context){var browser=this.getBrowser();if(browser.getShader()===browser.getDefaultShader()){browser.setTexture(null);browser.setShader(browser.getPointShader())}X3DGeometryNode.prototype.traverse.call(this,context)}});return PointSet}});define("cobweb/Components/Interpolation/PositionInterpolator2D",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Vector2){with(Fields){function PositionInterpolator2D(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.PositionInterpolator2D)}PositionInterpolator2D.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:PositionInterpolator2D,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFVec2f),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new SFVec2f)]),keyValue:new Vector2(0,0),getTypeName:function(){return"PositionInterpolator2D"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){var key=this.key_,keyValue=this.keyValue_;if(keyValue.length<key.length)keyValue.resize(key.length,keyValue.length?keyValue[keyValue.length-1]:new SFVec2f)},interpolate:function(index0,index1,weight){this.value_changed_=this.keyValue.assign(this.keyValue_[index0].getValue()).lerp(this.keyValue_[index1].getValue(),weight)}});return PositionInterpolator2D}});define("cobweb/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",["jquery","cobweb/Components/Core/X3DSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,X3DSensorNode,X3DConstants,Vector3){function X3DEnvironmentalSensorNode(browser,executionContext){X3DSensorNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DEnvironmentalSensorNode);this.traversed=true}X3DEnvironmentalSensorNode.prototype=$.extend(Object.create(X3DSensorNode.prototype),{constructor:X3DEnvironmentalSensorNode,initialize:function(){X3DSensorNode.prototype.initialize.call(this);this.setCameraObject(true);this.getExecutionContext().isLive().addInterest(this,"set_enabled__");this.isLive().addInterest(this,"set_enabled__");this.enabled_.addInterest(this,"set_enabled__");this.size_.addInterest(this,"set_enabled__");this.isCameraObject_.addInterest(this,"set_enabled__");this.set_enabled__()},setTraversed:function(value){if(value)this.setCameraObject(true);else this.setCameraObject(this.traversed);this.traversed=value},getTraversed:function(){return this.traversed},set_enabled__:function(){if(this.getCameraObject()&&this.enabled_.getValue()&&this.isLive().getValue()&&this.getExecutionContext().isLive().getValue()&&!this.size_.getValue().equals(Vector3.Zero))this.getBrowser().sensors().addInterest(this,"update");else{if(this.isActive_.getValue()){this.isActive_=false;this.exitTime_=this.getBrowser().getCurrentTime()}this.getBrowser().sensors().removeInterest(this,"update")}},update:function(){}});return X3DEnvironmentalSensorNode});define("cobweb/Components/EnvironmentalSensor/ProximitySensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Box3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DEnvironmentalSensorNode,TraverseType,X3DConstants,Vector3,Rotation4,Matrix4,Box3){with(Fields){var infinity=new Vector3(-1,-1,-1);function ProximitySensor(executionContext){X3DEnvironmentalSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ProximitySensor);this.viewpoint=null;this.modelViewMatrix=new Matrix4;this.invModelViewMatrix=new Matrix4;this.centerOfRotationMatrix=new Matrix4;this.position=new Vector3;this.orientation=new Rotation4;this.centerOfRotation=new Vector3;this.viewer=new Vector3;this.inside=false}ProximitySensor.prototype=$.extend(Object.create(X3DEnvironmentalSensorNode.prototype),{constructor:ProximitySensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"size",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"center",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"enterTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"exitTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"position_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"orientation_changed",new SFRotation),new X3DFieldDefinition(X3DConstants.outputOnly,"centerOfRotation_changed",new SFVec3f)]),getTypeName:function(){return"ProximitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){X3DEnvironmentalSensorNode.prototype.initialize.call(this);this.enabled_.addInterest(this,"set_enabled___");this.size_.addInterest(this,"set_extents__");this.center_.addInterest(this,"set_extents__");this.min=new Vector3(0,0,0);this.max=new Vector3(0,0,0);this.set_enabled___();this.set_extents__()},set_enabled___:function(){this.setCameraObject(this.enabled_.getValue());if(this.enabled_.getValue())this.traverse=traverse;else delete this.traverse},set_extents__:function(){var s=this.size_.getValue(),c=this.center_.getValue(),sx=s.x/2,sy=s.y/2,sz=s.z/2,cx=c.x,cy=c.y,cz=c.z;this.min.set(cx-sx,cy-sy,cz-sz);this.max.set(cx+sx,cy+sy,cz+sz)},update:function(){try{if(this.inside&&this.getTraversed()){var modelViewMatrix=this.modelViewMatrix,centerOfRotationMatrix=this.centerOfRotationMatrix;centerOfRotationMatrix.assign(this.viewpoint.getTransformationMatrix());centerOfRotationMatrix.translate(this.viewpoint.getUserCenterOfRotation());centerOfRotationMatrix.multRight(this.invModelViewMatrix.assign(modelViewMatrix).inverse());modelViewMatrix.multRight(this.viewpoint.getInverseCameraSpaceMatrix());modelViewMatrix.get(null,this.orientation);modelViewMatrix.inverse();this.position.set(modelViewMatrix[12],modelViewMatrix[13],modelViewMatrix[14]);this.orientation.inverse();this.centerOfRotation.set(centerOfRotationMatrix[12],centerOfRotationMatrix[13],centerOfRotationMatrix[14]);if(this.isActive_.getValue()){if(!this.position_changed_.getValue().equals(this.position))this.position_changed_=this.position;if(!this.orientation_changed_.getValue().equals(this.orientation))this.orientation_changed_=this.orientation;if(!this.centerOfRotation_changed_.getValue().equals(this.centerOfRotation))this.centerOfRotation_changed_=this.centerOfRotation}else{this.isActive_=true;this.enterTime_=this.getBrowser().getCurrentTime();this.position_changed_=this.position;this.orientation_changed_=this.orientation;this.centerOfRotation_changed_=this.centerOfRotation}this.inside=false}else{if(this.isActive_.getValue()){this.isActive_=false;this.exitTime_=this.getBrowser().getCurrentTime()}}}catch(error){}this.setTraversed(false)},traverse:function(){},intersectsPoint:function(point){var min=this.min,max=this.max;return min.x<=point.x&&max.x>=point.x&&min.y<=point.y&&max.y>=point.y&&min.z<=point.z&&max.z>=point.z}});function traverse(type){try{switch(type){case TraverseType.CAMERA:{this.viewpoint=this.getCurrentViewpoint();this.modelViewMatrix.assign(this.getBrowser().getModelViewMatrix().get());return}case TraverseType.DISPLAY:{this.setTraversed(true);if(this.inside)return;if(this.size_.getValue().equals(infinity))this.inside=true;else{var invModelViewMatrix=this.invModelViewMatrix.assign(this.getBrowser().getModelViewMatrix().get()).inverse();this.viewer.set(invModelViewMatrix[12],invModelViewMatrix[13],invModelViewMatrix[14]);this.inside=this.intersectsPoint(this.viewer)}return}}}catch(error){}}return ProximitySensor}});define("cobweb/Components/Geometry2D/Rectangle2D",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Vector2,Vector3){with(Fields){var defaultSize=new Vector2(2,2);function Rectangle2D(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Rectangle2D)}Rectangle2D.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Rectangle2D,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"size",new SFVec2f(2,2)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true))]),getTypeName:function(){return"Rectangle2D"},getComponentName:function(){return"Geometry2D"},getContainerField:function(){return"geometry"},build:function(){var options=this.getBrowser().getRectangle2DOptions(),size=this.size_.getValue();this.setTexCoords(options.getGeometry().getTexCoords());this.setNormals(options.getGeometry().getNormals());if(size.equals(defaultSize)){this.setVertices(options.getGeometry().getVertices());this.setExtents(options.getGeometry().getExtents())}else{var scale=Vector3.divide(size,2),x=scale.x,y=scale.y,defaultVertices=options.getGeometry().getVertices(),vertices=this.getVertices();for(var i=0;i<defaultVertices.length;i+=4){vertices.push(x*defaultVertices[i],y*defaultVertices[i+1],defaultVertices[i+2],1)}this.setVertices(vertices);this.setExtents([new Vector3(-x,-y,1),new Vector3(x,y,1)])}this.setSolid(this.solid_.getValue());this.setCurrentTexCoord(null)},traverse:function(context){context.geometryType=2;X3DGeometryNode.prototype.traverse.call(this,context);context.geometryType=3}});return Rectangle2D}});define("cobweb/Components/Interpolation/ScalarInterpolator",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Interpolation/X3DInterpolatorNode","cobweb/Bits/X3DConstants","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInterpolatorNode,X3DConstants,Algorithm){with(Fields){function ScalarInterpolator(executionContext){X3DInterpolatorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ScalarInterpolator)}ScalarInterpolator.prototype=$.extend(Object.create(X3DInterpolatorNode.prototype),{constructor:ScalarInterpolator,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"set_fraction",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"key",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"keyValue",new MFFloat),new X3DFieldDefinition(X3DConstants.outputOnly,"value_changed",new SFFloat)]),getTypeName:function(){return"ScalarInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){X3DInterpolatorNode.prototype.initialize.call(this);this.keyValue_.addInterest(this,"set_keyValue__")},set_keyValue__:function(){var key=this.key_,keyValue=this.keyValue_;if(keyValue.length<key.length)keyValue.resize(key.length,keyValue.length?keyValue[keyValue.length-1]:0)},interpolate:function(index0,index1,weight){this.value_changed_=Algorithm.lerp(this.keyValue_[index0],this.keyValue_[index1],weight)}});return ScalarInterpolator}});define("cobweb/Execution/X3DScene",["jquery","cobweb/Fields","cobweb/Execution/X3DExecutionContext","cobweb/Bits/X3DConstants"],function($,Fields,X3DExecutionContext,X3DConstants){with(Fields){function X3DScene(browser,executionContext){X3DExecutionContext.call(this,browser,executionContext);this.addChildren("loadCount",new SFInt32);this.getRootNodes().setAccessType(X3DConstants.inputOutput)}X3DScene.prototype=$.extend(Object.create(X3DExecutionContext.prototype),{constructor:X3DScene,isRootContext:function(){return true},setRootNodes:function(value){this.getRootNodes().setValue(value)},addLoadCount:function(){this.loadCount_=this.loadCount_.getValue()+1},removeLoadCount:function(){this.loadCount_=this.loadCount_.getValue()-1}});return X3DScene}});define("cobweb/Browser/Scripting/evaluate",[],function(){return function(){with(arguments[0]){return eval(arguments[1])}}});define("cobweb/Components/Scripting/X3DScriptNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Components/Networking/X3DUrlObject","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DUrlObject,X3DConstants){function X3DScriptNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);X3DUrlObject.call(this,browser,executionContext);this.addType(X3DConstants.X3DScriptNode)}X3DScriptNode.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DUrlObject.prototype,{constructor:X3DScriptNode});return X3DScriptNode});define("cobweb/Components/Scripting/Script",["jquery","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Basic/X3DField","cobweb/Basic/X3DArrayField","cobweb/Fields","cobweb/Browser/X3DBrowser","cobweb/Execution/X3DExecutionContext","cobweb/Execution/X3DScene","cobweb/Prototype/ExternProtoDeclarationArray","cobweb/Prototype/ProtoDeclarationArray","cobweb/Prototype/X3DExternProtoDeclaration","cobweb/Prototype/X3DProtoDeclaration","cobweb/Routing/RouteArray","cobweb/Routing/X3DRoute","cobweb/Browser/Scripting/evaluate","cobweb/Components/Scripting/X3DScriptNode","cobweb/InputOutput/Loader","cobweb/Bits/X3DConstants"],function($,X3DFieldDefinition,FieldDefinitionArray,X3DField,X3DArrayField,Fields,X3DBrowser,X3DExecutionContext,X3DScene,ExternProtoDeclarationArray,ProtoDeclarationArray,X3DExternProtoDeclaration,X3DProtoDeclaration,RouteArray,X3DRoute,evaluate,X3DScriptNode,Loader,X3DConstants){with(Fields){var ECMAScript=/^\s*(?:vrmlscript|javascript|ecmascript)\:((?:.|[\r\n])*)$/,fieldDefinitions=[new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"url",new MFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"directOutput",new SFBool),new X3DFieldDefinition(X3DConstants.initializeOnly,"mustEvaluate",new SFBool)];function Script(executionContext){this.fieldDefinitions=new FieldDefinitionArray(fieldDefinitions.slice(0));X3DScriptNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Script)}Script.prototype=$.extend(Object.create(X3DScriptNode.prototype),{constructor:Script,getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){X3DScriptNode.prototype.initialize.call(this);this.url_.addInterest(this,"set_url__");this.requestAsyncLoad()},getExtendedEventHandling:function(){return false},hasUserDefinedFields:function(){return true},getCDATA:function(){return this.url_},requestAsyncLoad:function(){if(this.checkLoadState()===X3DConstants.COMPLETE_STATE||this.checkLoadState()===X3DConstants.IN_PROGRESS_STATE)return;for(var i=0,length=this.url_.length;i<length;++i){var URL=this.url_[i],result=ECMAScript.exec(URL);try{if(result){this.initialize__(result[1]);break}}catch(error){console.error(error.message)}}},set_url__:function(){this.setLoadState(X3DConstants.NOT_STATED_STATE);this.requestAsyncLoad()},getContext:function(text){var callbacks=["initialize","prepareEvents","eventsProcessed","shutdown"],userDefinedFields=this.getUserDefinedFields();for(var name in userDefinedFields){var field=userDefinedFields[name];switch(field.getAccessType()){case X3DConstants.inputOnly:callbacks.push(field.getName());break;case X3DConstants.inputOutput:callbacks.push("set_"+field.getName());break}}text+="\n;var "+callbacks.join(",")+";";text+="\n["+callbacks.join(",")+"];";var global=this.getGlobal(),result=evaluate(global,text),context={};for(var i=0;i<callbacks.length;++i){if(typeof result[i]==="function")context[callbacks[i]]=result[i];else context[callbacks[i]]=null}return context},getGlobal:function(){var browser=this.getBrowser();function SFNode(vrmlSyntax){if(typeof vrmlSyntax==="string"){var scene=browser.createX3DFromString(vrmlSyntax);if(scene.getRootNodes().length&&scene.getRootNodes()[0])return Fields.SFNode.call(this,scene.getRootNodes()[0].getValue())}return Fields.SFNode.call(this)}SFNode.prototype=Fields.SFNode.prototype;var global={NULL:{value:null},FALSE:{value:false},TRUE:{value:true},print:{value:function(){this.print.apply(this,arguments)}.bind(this.getBrowser())},trace:{value:function(){this.print.apply(this,arguments)}.bind(this.getBrowser())},Browser:{value:this.getBrowser()},X3DConstants:{value:X3DConstants},X3DBrowser:{value:X3DBrowser},X3DExecutionContext:{value:X3DExecutionContext},X3DScene:{value:X3DScene},ExternProtoDeclarationArray:{value:ExternProtoDeclarationArray},ProtoDeclarationArray:{value:ProtoDeclarationArray},X3DExternProtoDeclaration:{value:X3DExternProtoDeclaration},X3DProtoDeclaration:{value:X3DProtoDeclaration},RouteArray:{value:RouteArray},X3DRoute:{value:X3DRoute},X3DFieldDefinition:{value:X3DFieldDefinition},FieldDefinitionArray:{value:FieldDefinitionArray},X3DField:{value:X3DField},X3DArrayField:{value:X3DArrayField},SFColor:{value:SFColor},SFColorRGBA:{value:SFColorRGBA},SFImage:{value:SFImage},SFMatrix3d:{value:SFMatrix3d},SFMatrix3f:{value:SFMatrix3f},SFMatrix4d:{value:SFMatrix4d},SFMatrix4f:{value:SFMatrix4f},SFNode:{value:SFNode},SFRotation:{value:SFRotation},SFVec3d:{value:SFVec2d},SFVec2f:{value:SFVec2f},SFVec2d:{value:SFVec3d},SFVec3f:{value:SFVec3f},SFVec4d:{value:SFVec4d},SFVec4f:{value:SFVec4f},VrmlMatrix:{value:VrmlMatrix},MFBool:{value:MFBool},MFColor:{value:MFColor},MFColorRGBA:{value:MFColorRGBA},MFDouble:{value:MFDouble},MFFloat:{value:MFFloat},MFImage:{value:MFImage},MFInt32:{value:MFInt32},MFMatrix3d:{value:MFMatrix3d},MFMatrix3f:{value:MFMatrix3f},MFMatrix4d:{value:MFMatrix4d},MFMatrix4f:{value:MFMatrix4f},MFNode:{value:MFNode},MFRotation:{value:MFRotation},MFString:{value:MFString},MFTime:{value:MFTime},MFVec2d:{value:MFVec2d},MFVec2f:{value:MFVec2f},MFVec3d:{value:MFVec3d},MFVec3f:{value:MFVec3f},MFVec4d:{value:MFVec4d},MFVec4f:{value:MFVec4f}};var userDefinedFields=this.getUserDefinedFields();for(var name in userDefinedFields){var field=userDefinedFields[name];if(field.getAccessType()===X3DConstants.inputOnly)continue;if(!(name in global)){global[name]={get:field.valueOf.bind(field),set:field.setValue.bind(field)}}if(field.getAccessType()===X3DConstants.inputOutput){global[name+"_changed"]={get:field.valueOf.bind(field),set:field.setValue.bind(field)}}}return Object.create(Object.prototype,global)},set_live__:function(){var userDefinedFields=this.getUserDefinedFields();if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue()){if($.isFunction(this.context.prepareEvents))this.getBrowser().prepareEvents().addInterest(this,"prepareEvents__");if($.isFunction(this.context.eventsProcessed))this.addInterest(this,"eventsProcessed__");for(var name in userDefinedFields){var field=userDefinedFields[name];switch(field.getAccessType()){case X3DConstants.inputOnly:{var callback=this.context[field.getName()];if($.isFunction(callback))field.addInterest(this,"set_field__",callback);break}case X3DConstants.inputOutput:{var callback=this.context["set_"+field.getName()];if($.isFunction(callback))field.addInterest(this,"set_field__",callback);break}}}}else{if(this.context.prepareEvents)this.getBrowser().prepareEvents().removeInterest(this,"prepareEvents__");if(this.context.eventsProcessed)this.removeInterest(this,"eventsProcessed__");for(var name in userDefinedFields){var field=userDefinedFields[name];switch(field.getAccessType()){case X3DConstants.inputOnly:case X3DConstants.inputOutput:field.removeInterest(this,"set_field__");break}}}},initialize__:function(text){this.context=this.getContext(text);this.getExecutionContext().isLive().addInterest(this,"set_live__");this.isLive().addInterest(this,"set_live__");this.set_live__();if(this.context.initialize){this.getBrowser().getScriptStack().push(this);try{this.context.initialize()}catch(error){this.setError("initialize",error)}this.getBrowser().getScriptStack().pop()}},prepareEvents__:function(){this.getBrowser().getScriptStack().push(this);try{this.context.prepareEvents()}catch(error){this.setError("prepareEvents",error)}this.getBrowser().getScriptStack().pop()},set_field__:function(field,callback){field.setTainted(true);this.getBrowser().getScriptStack().push(this);try{callback(field.valueOf(),this.getBrowser().getCurrentTime())}catch(error){this.setError(field.getName(),error)}this.getBrowser().getScriptStack().pop();field.setTainted(false)},eventsProcessed__:function(){this.getBrowser().getScriptStack().push(this);try{this.context.eventsProcessed()}catch(error){this.setError("eventsProcessed",error)}this.getBrowser().getScriptStack().pop()},shutdown__:function(){this.getBrowser().getScriptStack().push(this);try{this.context.shutdown()}catch(error){this.setError("shutdown",error)}this.getBrowser().getScriptStack().pop()},setError:function(callback,error){console.error("JavaScript Error from '"+callback+"': ",error)}});return Script}});define("cobweb/Components/Shape/X3DShapeNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Components/Grouping/X3DBoundedObject","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Math/Geometry/Box3"],function($,X3DChildNode,X3DBoundedObject,X3DCast,X3DConstants,Box3){function X3DShapeNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);X3DBoundedObject.call(this,browser,executionContext);this.addType(X3DConstants.X3DShapeNode)}X3DShapeNode.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DBoundedObject.prototype,{constructor:X3DShapeNode,initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DBoundedObject.prototype.initialize.call(this);this.bboxSize_.addInterest(this,"set_bbox__");this.bboxCenter_.addInterest(this,"set_bbox__");this.appearance_.addInterest(this,"set_apparance__");this.geometry_.addInterest(this,"set_geometry__");this.set_apparance__();this.set_geometry__();this.set_bbox__();this.static_=true},getBBox:function(){return this.bbox},getBBoxSize:function(){return this.bboxSize},getBBoxCenter:function(){return this.bboxCenter},getAppearance:function(){return this.apparanceNode},getGeometry:function(){return this.geometryNode},isTransparent:function(){return this.transparent},set_bbox__:function(){if(this.bboxSize_.getValue().equals(this.defaultBBoxSize)){if(this.getGeometry())this.bbox=this.getGeometry().getBBox();
else this.bbox=new Box3}else this.bbox=new Box3(this.bboxSize_.getValue(),this.bboxCenter_.getValue());this.bboxSize=this.bbox.size;this.bboxCenter=this.bbox.center},set_apparance__:function(){if(this.apparanceNode)this.apparanceNode.removeInterest(this,"set_transparent__");this.apparanceNode=X3DCast(X3DConstants.X3DAppearanceNode,this.appearance_);if(this.apparanceNode)this.apparanceNode.addInterest(this,"set_transparent__");else this.apparanceNode=this.getBrowser().getDefaultAppearance();this.set_transparent__()},set_geometry__:function(){if(this.geometryNode){this.geometryNode.removeInterest(this,"set_transparent__");this.geometryNode.removeInterest(this,"set_bbox__")}this.geometryNode=X3DCast(X3DConstants.X3DGeometryNode,this.geometry_);if(this.geometryNode){this.geometryNode.addInterest(this,"set_transparent__");this.geometryNode.addInterest(this,"set_bbox__")}this.set_transparent__();this.set_bbox__()},set_transparent__:function(){this.transparent=this.apparanceNode&&this.apparanceNode.transparent_.getValue()||this.geometryNode&&this.geometryNode.transparent_.getValue()}});return X3DShapeNode});define("cobweb/Components/Shape/Shape",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Shape/X3DShapeNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Algorithm","standard/Math/Geometry/Line3","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","standard/Math/Algorithms/QuickSort","standard/Math/Geometry/ViewVolume"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DShapeNode,TraverseType,X3DConstants,Algorithm,Line3,Vector3,Matrix4,QuickSort,ViewVolume){with(Fields){var intersections=[];function Shape(executionContext){X3DShapeNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Shape)}Shape.prototype=$.extend(Object.create(X3DShapeNode.prototype),{constructor:Shape,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"appearance",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"geometry",new SFNode)]),invModelViewMatrix:new Matrix4,hitRay:new Line3(new Vector3(0,0,0),new Vector3(0,0,0)),intersections:intersections,intersectionSorter:new QuickSort(intersections,function(lhs,rhs){return lhs.point.z>rhs.point.z}),getTypeName:function(){return"Shape"},getComponentName:function(){return"Shape"},getContainerField:function(){return"children"},traverse:function(type){if(this.getGeometry()){switch(type){case TraverseType.POINTER:this.pointer();break;case TraverseType.COLLISION:this.getCurrentLayer().addCollision(this);break;case TraverseType.DISPLAY:this.getCurrentLayer().addShape(this);break}}},pointer:function(){try{if(this.getGeometry().isLineGeometry())return;var browser=this.getBrowser(),modelViewMatrix=browser.getModelViewMatrix().get(),invModelViewMatrix=this.invModelViewMatrix.assign(modelViewMatrix).inverse(),intersections=this.intersections;this.hitRay.assign(browser.getHitRay()).multLineMatrix(invModelViewMatrix);if(this.getGeometry().intersectsLine(this.hitRay,intersections)){for(var i=0;i<intersections.length;++i)modelViewMatrix.multVecMatrix(intersections[i].point);this.intersectionSorter.sort(0,intersections.length);var index=Algorithm.lowerBound(intersections,0,intersections.length,-this.getCurrentNavigationInfo().getNearPlane(),function(lhs,rhs){return lhs.point.z>rhs});if(index!==intersections.length){invModelViewMatrix.multMatrixDir(intersections[index].normal).normalize();browser.addHit(intersections[index],this.getCurrentLayer())}intersections.length=0}}catch(error){}},draw:function(context){this.getAppearance().traverse();this.getGeometry().traverse(context)}});return Shape}});define("cobweb/Components/Sound/X3DSoundNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DConstants){function X3DSoundNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DSoundNode)}X3DSoundNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DSoundNode});return X3DSoundNode});define("cobweb/Components/Sound/Sound",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Sound/X3DSoundNode","cobweb/Bits/X3DCast","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DSoundNode,X3DCast,TraverseType,X3DConstants,Vector2,Vector3,Rotation4,Matrix4){with(Fields){function Sound(executionContext){X3DSoundNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Sound);this.min={radius:0,distance:0};this.max={radius:0,distance:0}}Sound.prototype=$.extend(Object.create(X3DSoundNode.prototype),{constructor:Sound,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"intensity",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"spatialize",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"location",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"direction",new SFVec3f(0,0,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"minBack",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"minFront",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"maxBack",new SFFloat(10)),new X3DFieldDefinition(X3DConstants.inputOutput,"maxFront",new SFFloat(10)),new X3DFieldDefinition(X3DConstants.inputOutput,"priority",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"source",new SFNode)]),transformationMatrix:new Matrix4,translation:new Vector3(0,0,0),rotation:new Rotation4,scale:new Vector3(1,1,1),viewer:new Vector3(0,0,0),zAxis:new Vector3(0,0,1),getTypeName:function(){return"Sound"},getComponentName:function(){return"Sound"},getContainerField:function(){return"children"},initialize:function(){X3DSoundNode.prototype.initialize.call(this);this.source_.addInterest(this,"set_source__");this.set_source__()},set_source__:function(){if(this.sourceNode)this.sourceNode.setVolume(0);this.sourceNode=X3DCast(X3DConstants.X3DSoundSourceNode,this.source_)},traverse:function(type){if(type!==TraverseType.DISPLAY)return;if(!this.sourceNode)return;if(!this.sourceNode.isActive_.getValue()||this.sourceNode.isPaused_.getValue())return;try{this.getEllipsoidParameter(this.maxBack_.getValue(),this.maxFront_.getValue(),this.max);this.getEllipsoidParameter(this.minBack_.getValue(),this.minFront_.getValue(),this.min);if(this.max.distance<this.max.radius){if(this.min.distance<this.min.radius)this.sourceNode.setVolume(this.intensity_.getValue());else{var d1=this.max.radius-this.max.distance,d2=this.max.radius-this.min.radius;this.sourceNode.setVolume(this.intensity_.getValue()*(d1/d2))}}else this.sourceNode.setVolume(0)}catch(error){console.log(error)}},getEllipsoidParameter:function(back,front,value){var a=(back+front)/2,e=a-back,b=Math.sqrt(a*a-e*e);this.translation.z=e;this.rotation.setFromToVec(this.zAxis,this.direction_.getValue());this.scale.z=b/a;var transformationMatrix=this.transformationMatrix;transformationMatrix.assign(this.getBrowser().getModelViewMatrix().get());transformationMatrix.translate(this.location_.getValue());transformationMatrix.rotate(this.rotation);transformationMatrix.translate(this.translation);transformationMatrix.scale(this.scale);transformationMatrix.inverse();this.viewer.set(transformationMatrix[12],transformationMatrix[13],transformationMatrix[14]);value.radius=b;value.distance=this.viewer.abs()}});return Sound}});define("cobweb/Components/Geometry3D/Sphere",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DConstants,Vector3){with(Fields){function Sphere(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Sphere)}Sphere.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Sphere,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"radius",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool(true))]),getTypeName:function(){return"Sphere"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},set_live__:function(){X3DGeometryNode.prototype.set_live__.call(this);if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue())this.getBrowser().getSphereOptions().addInterest(this,"eventsProcessed");else this.getBrowser().getSphereOptions().removeInterest(this,"eventsProcessed")},build:function(){var options=this.getBrowser().getSphereOptions(),radius=this.radius_.getValue();this.setNormals(options.getGeometry().getNormals());this.setTexCoords(options.getGeometry().getTexCoords());if(radius===1){this.setVertices(options.getGeometry().getVertices());this.setExtents(options.getGeometry().getExtents())}else{var defaultVertices=options.getGeometry().getVertices(),vertices=this.getVertices();for(var i=0;i<defaultVertices.length;i+=4){vertices.push(radius*defaultVertices[i],radius*defaultVertices[i+1],radius*defaultVertices[i+2],1)}this.setVertices(vertices);this.setExtents([new Vector3(-radius,-radius,-radius),new Vector3(radius,radius,radius)])}this.setSolid(this.solid_.getValue());this.setCurrentTexCoord(null)}});return Sphere}});define("cobweb/Components/PointingDeviceSensor/SphereSensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/PointingDeviceSensor/X3DDragSensorNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Triangle3","standard/Math/Geometry/Line3","standard/Math/Geometry/Plane3","standard/Math/Geometry/Sphere3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DDragSensorNode,X3DConstants,Vector3,Rotation4,Matrix4,Triangle3,Line3,Plane3,Sphere3){with(Fields){function SphereSensor(executionContext){X3DDragSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.SphereSensor)}SphereSensor.prototype=$.extend(Object.create(X3DDragSensorNode.prototype),{constructor:SphereSensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"autoOffset",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"offset",new SFRotation),new X3DFieldDefinition(X3DConstants.outputOnly,"trackPoint_changed",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"rotation_changed",new SFRotation),new X3DFieldDefinition(X3DConstants.outputOnly,"isOver",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool)]),getTypeName:function(){return"SphereSensor"},getComponentName:function(){return"PointingDeviceSensor"},getContainerField:function(){return"children"},initialize:function(){X3DDragSensorNode.prototype.initialize.call(this);this.modelViewMatrix=new Matrix4;this.invModelViewMatrix=new Matrix4;this.sphere=null;this.zPlane=null;this.behind=false;this.fromVector=new Vector3(0,0,0);this.startPoint=new Vector3(0,0,0);this.startOffset=new Rotation4(0,0,1,0)},getTrackPoint:function(hitRay,trackPoint,behind){var exit=new Vector3(0,0,0);if(this.sphere.intersectsLine(hitRay,trackPoint,exit)){if((Vector3.subtract(hitRay.point,exit).abs()<Vector3.subtract(hitRay.point,trackPoint).abs())-behind)trackPoint.assign(exit);return true}return false},set_active__:function(hit,active){X3DDragSensorNode.prototype.set_active__.call(this,hit,active);try{if(this.isActive_.getValue()){var matrices=this.getMatrices()[hit.layer.getId()];this.modelViewMatrix.assign(matrices.modelViewMatrix);this.invModelViewMatrix.assign(this.modelViewMatrix).inverse();var hitPoint=this.invModelViewMatrix.multVecMatrix(hit.intersection.point.copy()),center=new Vector3(0,0,0);this.zPlane=new Plane3(center,this.invModelViewMatrix.multDirMatrix(new Vector3(0,0,1)).normalize());this.sphere=new Sphere3(hitPoint.abs(),center);this.behind=this.zPlane.getDistanceToPoint(hitPoint)<0;this.fromVector.assign(hitPoint);this.startPoint.assign(hitPoint);this.startOffset.assign(this.offset_.getValue())}else{if(this.autoOffset_.getValue())this.offset_=this.rotation_changed_}}catch(error){}},set_motion__:function(hit){try{var hitRay=hit.hitRay.copy().multLineMatrix(this.invModelViewMatrix),trackPoint=new Vector3(0,0,0);if(this.getTrackPoint(hitRay,trackPoint,this.behind)){var zAxis=this.invModelViewMatrix.multDirMatrix(new Vector3(0,0,1)).normalize();this.zPlane=new Plane3(trackPoint,zAxis)}else{var tangentPoint=new Vector3(0,0,0);this.zPlane.intersectsLine(hitRay,tangentPoint);hitRay=new Line3(tangentPoint,Vector3.subtract(this.sphere.center,tangentPoint).normalize());this.getTrackPoint(hitRay,trackPoint,false);var triNormal=Triangle3.normal(this.sphere.center,trackPoint,this.startPoint,new Vector3(0,0,0)),dirFromCenter=Vector3.subtract(trackPoint,this.sphere.center).normalize(),normal=Vector3.cross(triNormal,dirFromCenter).normalize();var point1=Vector3.subtract(trackPoint,normal.multiply(Vector3.subtract(tangentPoint,trackPoint).abs()));hitRay=new Line3(point1,Vector3.subtract(this.sphere.center,point1).normalize());this.getTrackPoint(hitRay,trackPoint,false)}this.trackPoint_changed_=trackPoint;var toVector=Vector3.subtract(trackPoint,this.sphere.center),rotation=new Rotation4(this.fromVector,toVector);if(this.behind)rotation.inverse();this.rotation_changed_=Rotation4.multRight(this.startOffset,rotation)}catch(error){this.trackPoint_changed_.addEvent();this.rotation_changed_.addEvent()}}});return SphereSensor}});define("cobweb/Components/Lighting/SpotLight",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Lighting/X3DLightNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Utility/ObjectCache"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DLightNode,X3DConstants,Vector3,ObjectCache){var SpotLights=ObjectCache(SpotLightContainer);function SpotLightContainer(light){this.location=new Vector3(0,0,0);this.direction=new Vector3(0,0,0);this.set(light)}SpotLightContainer.prototype={set:function(light){var modelViewMatrix=light.getBrowser().getModelViewMatrix().get();this.color=light.color_.getValue();this.intensity=light.intensity_.getValue();this.ambientIntensity=light.ambientIntensity_.getValue();this.attenuation=light.attenuation_.getValue();this.beamWidth=light.beamWidth_.getValue();this.cutOffAngle=light.cutOffAngle_.getValue();this.radius=light.radius_.getValue();modelViewMatrix.multVecMatrix(this.location.assign(light.location_.getValue()));modelViewMatrix.multDirMatrix(this.direction.assign(light.direction_.getValue())).normalize()},use:function(gl,shader,i){gl.uniform1i(shader.lightType[i],2);gl.uniform1i(shader.lightOn[i],true);gl.uniform3f(shader.lightColor[i],this.color.r,this.color.g,this.color.b);gl.uniform1f(shader.lightIntensity[i],this.intensity);gl.uniform1f(shader.lightAmbientIntensity[i],this.ambientIntensity);gl.uniform3f(shader.lightAttenuation[i],this.attenuation.x,this.attenuation.y,this.attenuation.z);gl.uniform3f(shader.lightLocation[i],this.location.x,this.location.y,this.location.z);gl.uniform3f(shader.lightDirection[i],this.direction.x,this.direction.y,this.direction.z);gl.uniform1f(shader.lightBeamWidth[i],this.beamWidth);gl.uniform1f(shader.lightCutOffAngle[i],this.cutOffAngle);gl.uniform1f(shader.lightRadius[i],this.radius)},recycle:function(){SpotLights.push(this)}};with(Fields){function SpotLight(executionContext){X3DLightNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.SpotLight)}SpotLight.prototype=$.extend(Object.create(X3DLightNode.prototype),{constructor:SpotLight,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"global",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"on",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"color",new SFColor(1,1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"intensity",new SFFloat(1)),new X3DFieldDefinition(X3DConstants.inputOutput,"ambientIntensity",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"attenuation",new SFVec3f(1,0,0)),new X3DFieldDefinition(X3DConstants.inputOutput,"location",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"direction",new SFVec3f(0,0,-1)),new X3DFieldDefinition(X3DConstants.inputOutput,"radius",new SFFloat(100)),new X3DFieldDefinition(X3DConstants.inputOutput,"beamWidth",new SFFloat(.785398)),new X3DFieldDefinition(X3DConstants.inputOutput,"cutOffAngle",new SFFloat(1.5708))]),getTypeName:function(){return"SpotLight"},getComponentName:function(){return"Lighting"},getContainerField:function(){return"children"},getLights:function(){return SpotLights}});return SpotLight}});define("cobweb/Components/Grouping/StaticGroup",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DChildNode","cobweb/Components/Grouping/X3DBoundedObject","cobweb/Components/Grouping/Group","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DChildNode,X3DBoundedObject,Group,X3DConstants){with(Fields){function StaticGroup(executionContext){X3DChildNode.call(this,executionContext.getBrowser(),executionContext);X3DBoundedObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.StaticGroup)}StaticGroup.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DBoundedObject.prototype,{constructor:StaticGroup,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.initializeOnly,"children",new MFNode)]),getTypeName:function(){return"StaticGroup"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DBoundedObject.prototype.initialize.call(this);this.group=new Group(this.getExecutionContext());this.children_.addFieldInterest(this.group.children_);this.group.children_=this.children_;this.group.setup();this.traverse=this.group.traverse.bind(this.group)}});return StaticGroup}});define("cobweb/Components/Grouping/Switch",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants","standard/Math/Geometry/Box3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGroupingNode,X3DCast,X3DConstants,Box3){with(Fields){function Switch(executionContext){X3DGroupingNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Switch);this.addAlias("choice",this.children_)}Switch.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:Switch,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"whichChoice",new SFInt32(-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Switch"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"},initialize:function(){X3DGroupingNode.prototype.initialize.call(this);this.whichChoice_.addInterest(this,"set_whichChoice__");this.set_whichChoice__()},getBBox:function(){if(this.bboxSize_.getValue().equals(this.defaultBBoxSize)){var boundedObject=X3DCast(X3DConstants.X3DBoundedObject,this.child);if(boundedObject)return boundedObject.getBBox();return new Box3}return new Box3(this.bboxSize_.getValue(),this.bboxCenter_.getValue())},set_whichChoice__:function(){this.set_cameraObjects__()},set_cameraObjects__:function(){this.child=this.getChild(this.whichChoice_.getValue());if(this.child&&this.child.getCameraObject)this.setCameraObject(this.child.getCameraObject());else this.setCameraObject(false)},traverse:function(type){if(this.child)this.child.traverse(type)}});return Switch}});define("cobweb/Components/Text/Text",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Rendering/X3DGeometryNode","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DGeometryNode,X3DCast,X3DConstants){with(Fields){function Text(executionContext){X3DGeometryNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Text)}Text.prototype=$.extend(Object.create(X3DGeometryNode.prototype),{constructor:Text,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"string",new MFString),new X3DFieldDefinition(X3DConstants.inputOutput,"length",new MFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"maxExtent",new SFFloat),new X3DFieldDefinition(X3DConstants.initializeOnly,"solid",new SFBool),new X3DFieldDefinition(X3DConstants.outputOnly,"origin",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"textBounds",new SFVec2f),new X3DFieldDefinition(X3DConstants.outputOnly,"lineBounds",new MFVec2f),new X3DFieldDefinition(X3DConstants.inputOutput,"fontStyle",new SFNode)]),getTypeName:function(){return"Text"},getComponentName:function(){return"Text"},getContainerField:function(){return"geometry"},initialize:function(){X3DGeometryNode.prototype.initialize.call(this);this.fontStyle_.addInterest(this,"set_fontStyle__");this.set_fontStyle__();this.eventsProcessed()},getLength:function(index){if(index<this.length_.length)return this.length_[index];return 0},set_live__:function(){X3DGeometryNode.prototype.set_live__.call(this);if(this.getExecutionContext().isLive().getValue()&&this.isLive().getValue())this.getBrowser().getBrowserOptions().PrimitiveQuality_.addInterest(this,"eventsProcessed");else this.getBrowser().getBrowserOptions().PrimitiveQuality_.removeInterest(this,"eventsProcessed")},set_fontStyle__:function(){if(this.fontStyleNode)this.fontStyleNode.removeInterest(this,"addNodeEvent");this.fontStyleNode=X3DCast(X3DConstants.X3DFontStyleNode,this.fontStyle_);if(!this.fontStyleNode)this.fontStyleNode=this.getBrowser().getDefaultFontStyle();this.fontStyleNode.addInterest(this,"addNodeEvent");this.textGeometry=this.fontStyleNode.getTextGeometry(this)},build:function(){this.textGeometry.update();this.textGeometry.build();this.setSolid(this.solid_.getValue())}});return Text}});define("cobweb/Components/Grouping/X3DTransformMatrix4DNode",["jquery","cobweb/Components/Grouping/X3DGroupingNode","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function($,X3DGroupingNode,X3DConstants,Vector3,Rotation4,Matrix4){function X3DTransformMatrix4DNode(browser,executionContext){X3DGroupingNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTransformMatrix4DNode);this.matrix=new Matrix4}X3DTransformMatrix4DNode.prototype=$.extend(Object.create(X3DGroupingNode.prototype),{constructor:X3DTransformMatrix4DNode,getBBox:function(){var bbox=X3DGroupingNode.prototype.getBBox.call(this);if(this.traverse===traverse)return bbox.multRight(this.matrix);return bbox},setTransform:function(t,r,s,so,c){if(t.equals(Vector3.Zero)&&r.equals(Rotation4.Identity)&&s.equals(Vector3.One)){this.matrix.identity();this.traverse=X3DGroupingNode.prototype.traverse}else{this.matrix.set(t,r,s,so,c);this.traverse=traverse}}});function traverse(type){var modelViewMatrix=this.getBrowser().getModelViewMatrix();modelViewMatrix.push();modelViewMatrix.multLeft(this.matrix);X3DGroupingNode.prototype.traverse.call(this,type);modelViewMatrix.pop()}return X3DTransformMatrix4DNode});define("cobweb/Components/Grouping/X3DTransformNode",["jquery","cobweb/Components/Grouping/X3DTransformMatrix4DNode","cobweb/Bits/X3DConstants"],function($,X3DTransformMatrix4DNode,X3DConstants){function X3DTransformNode(browser,executionContext){X3DTransformMatrix4DNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DTransformNode)}X3DTransformNode.prototype=$.extend(Object.create(X3DTransformMatrix4DNode.prototype),{constructor:X3DTransformNode,initialize:function(){X3DTransformMatrix4DNode.prototype.initialize.call(this);this.addInterest(this,"eventsProcessed");this.eventsProcessed()},eventsProcessed:function(){X3DTransformMatrix4DNode.prototype.eventsProcessed.call(this);this.setHidden(this.scale_.x===0||this.scale_.y===0||this.scale_.z===0);this.setTransform(this.translation_.getValue(),this.rotation_.getValue(),this.scale_.getValue(),this.scaleOrientation_.getValue(),this.center_.getValue())}});return X3DTransformNode});define("cobweb/Components/Grouping/Transform",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Grouping/X3DTransformNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DTransformNode,X3DConstants){with(Fields){function Transform(executionContext){X3DTransformNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.Transform)}Transform.prototype=$.extend(Object.create(X3DTransformNode.prototype),{constructor:Transform,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"translation",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"rotation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"scale",new SFVec3f(1,1,1)),new X3DFieldDefinition(X3DConstants.inputOutput,"scaleOrientation",new SFRotation),new X3DFieldDefinition(X3DConstants.inputOutput,"center",new SFVec3f),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxSize",new SFVec3f(-1,-1,-1)),new X3DFieldDefinition(X3DConstants.initializeOnly,"bboxCenter",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOnly,"addChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOnly,"removeChildren",new MFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"Transform"},getComponentName:function(){return"Grouping"},getContainerField:function(){return"children"}});return Transform}});define("cobweb/Components/Shape/TwoSidedMaterial",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Shape/X3DMaterialNode","cobweb/Bits/X3DConstants","standard/Math/Algorithm"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DMaterialNode,X3DConstants,Algorithm){with(Fields){function TwoSidedMaterial(executionContext){X3DMaterialNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.TwoSidedMaterial);this.diffuseColor=new Float32Array(3);this.specularColor=new Float32Array(3);this.emissiveColor=new Float32Array(3);this.backDiffuseColor=new Float32Array(3);this.backSpecularColor=new Float32Array(3);this.backEmissiveColor=new Float32Array(3)}TwoSidedMaterial.prototype=$.extend(Object.create(X3DMaterialNode.prototype),{constructor:TwoSidedMaterial,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"separateBackColor",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"ambientIntensity",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"diffuseColor",new SFColor(.8,.8,.8)),new X3DFieldDefinition(X3DConstants.inputOutput,"specularColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"emissiveColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"shininess",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"transparency",new SFFloat),new X3DFieldDefinition(X3DConstants.inputOutput,"backAmbientIntensity",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"backDiffuseColor",new SFColor(.8,.8,.8)),new X3DFieldDefinition(X3DConstants.inputOutput,"backSpecularColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"backEmissiveColor",new SFColor),new X3DFieldDefinition(X3DConstants.inputOutput,"backShininess",new SFFloat(.2)),new X3DFieldDefinition(X3DConstants.inputOutput,"backTransparency",new SFFloat)]),getTypeName:function(){return"TwoSidedMaterial"},getComponentName:function(){return"Shape"},getContainerField:function(){return"material"},initialize:function(){X3DMaterialNode.prototype.initialize.call(this);this.addChildren("transparent",new SFBool);this.ambientIntensity_.addInterest(this,"set_ambientIntensity__");this.diffuseColor_.addInterest(this,"set_diffuseColor__");this.specularColor_.addInterest(this,"set_specularColor__");this.emissiveColor_.addInterest(this,"set_emissiveColor__");this.shininess_.addInterest(this,"set_shininess__");this.transparency_.addInterest(this,"set_transparency__");this.backAmbientIntensity_.addInterest(this,"set_backAmbientIntensity__");this.backDiffuseColor_.addInterest(this,"set_backDiffuseColor__");this.backSpecularColor_.addInterest(this,"set_backSpecularColor__");this.backEmissiveColor_.addInterest(this,"set_backEmissiveColor__");this.backShininess_.addInterest(this,"set_backShininess__");this.backTransparency_.addInterest(this,"set_backTransparency__");this.set_ambientIntensity__();this.set_diffuseColor__();this.set_specularColor__();this.set_emissiveColor__();this.set_shininess__();this.set_transparency__();this.set_backAmbientIntensity__();this.set_backDiffuseColor__();this.set_backSpecularColor__();this.set_backEmissiveColor__();this.set_backShininess__();this.set_backTransparency__()},getSeparateBackColor:function(){return this.separateBackColor_.getValue()},set_ambientIntensity__:function(){this.ambientIntensity=Math.max(this.ambientIntensity_.getValue(),0)},set_diffuseColor__:function(){this.diffuseColor.set(this.diffuseColor_.getValue())},set_specularColor__:function(){this.specularColor.set(this.specularColor_.getValue())},set_emissiveColor__:function(){this.emissiveColor.set(this.emissiveColor_.getValue())},set_shininess__:function(){this.shininess=Algorithm.clamp(this.shininess_.getValue(),0,1)*128},set_transparency__:function(){this.transparency=Algorithm.clamp(this.transparency_.getValue(),0,1);this.set_transparent__()
},set_backAmbientIntensity__:function(){this.backAmbientIntensity=Math.max(this.backAmbientIntensity_.getValue(),0)},set_backDiffuseColor__:function(){this.backDiffuseColor.set(this.backDiffuseColor_.getValue())},set_backSpecularColor__:function(){this.backSpecularColor.set(this.backSpecularColor_.getValue())},set_backEmissiveColor__:function(){this.backEmissiveColor.set(this.backEmissiveColor_.getValue())},set_backShininess__:function(){this.backShininess=Algorithm.clamp(this.backShininess_.getValue(),0,1)*128},set_backTransparency__:function(){this.backTransparency=Algorithm.clamp(this.backTransparency_.getValue(),0,1);this.set_transparent__()},set_transparent__:function(){var transparent=this.transparency_.getValue()||this.backTransparency_.getValue();if(transparent!=this.transparent_.getValue())this.transparent_=transparent}});return TwoSidedMaterial}});define("cobweb/Components/Navigation/ViewpointGroup",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DChildNode","cobweb/Components/Navigation/X3DViewpointObject","cobweb/Components/EnvironmentalSensor/ProximitySensor","cobweb/Bits/X3DCast","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DChildNode,X3DViewpointObject,ProximitySensor,X3DCast,X3DConstants){with(Fields){function ViewpointGroup(executionContext){X3DChildNode.call(this,executionContext.getBrowser(),executionContext);X3DViewpointObject.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.ViewpointGroup);this.proximitySensor=new ProximitySensor(executionContext);this.viewpointObjects=[]}ViewpointGroup.prototype=$.extend(Object.create(X3DChildNode.prototype),X3DViewpointObject.prototype,{constructor:ViewpointGroup,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"displayed",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"description",new SFString),new X3DFieldDefinition(X3DConstants.inputOutput,"retainUserOffsets",new SFBool),new X3DFieldDefinition(X3DConstants.inputOutput,"size",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"center",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"children",new MFNode)]),getTypeName:function(){return"ViewpointGroup"},getComponentName:function(){return"Navigation"},getContainerField:function(){return"children"},initialize:function(){X3DChildNode.prototype.initialize.call(this);X3DViewpointObject.prototype.initialize.call(this);this.proximitySensor.setup();this.size_.addFieldInterest(this.proximitySensor.size_);this.center_.addFieldInterest(this.proximitySensor.center_);this.proximitySensor.isCameraObject_.addFieldInterest(this.isCameraObject_);this.proximitySensor.size_=this.size_;this.proximitySensor.center_=this.center_;this.displayed_.addInterest(this,"set_displayed__");this.size_.addInterest(this,"set_displayed__");this.children_.addInterest(this,"set_children__");this.set_displayed__();this.set_children__()},isActive:function(){return this.proximitySensor.isActive_.getValue()},set_displayed__:function(){var enabled=this.displayed_.getValue()&&!this.size_.getValue().equals(Vector3.Zero);this.proximitySensor.enabled_=enabled;if(enabled)this.traverse=traverse;else delete this.traverse},set_children__:function(){this.viewpointObjects.length=0;for(var i=0,length=this.children_.length;i<length;++i){var viewpointObject=X3DCast(X3DConstants.X3DViewpointObject,this.children_[i]);if(viewpointObject)this.viewpointObjects.push(viewpointObject)}},traverse:function(){}});function traverse(type){if(this.size_.getValue().equals(Vector3.Zero)){for(var i=0;i<this.viewpointObjects.length;++i)this.viewpointObjects[i].traverse(type)}else{this.proximitySensor.traverse(type);if(this.proximitySensor.isActive_.getValue()){for(var i=0;i<this.viewpointObjects.length;++i)this.viewpointObjects[i].traverse(type)}}}return ViewpointGroup}});define("cobweb/Components/EnvironmentalSensor/VisibilitySensor",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode","cobweb/Bits/TraverseType","cobweb/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Box3"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DEnvironmentalSensorNode,TraverseType,X3DConstants,Vector3,Matrix4,Box3){with(Fields){var infinity=new Vector3(-1,-1,-1);function VisibilitySensor(executionContext){X3DEnvironmentalSensorNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.VisibilitySensor);this.visible=false}VisibilitySensor.prototype=$.extend(Object.create(X3DEnvironmentalSensorNode.prototype),{constructor:VisibilitySensor,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.inputOutput,"enabled",new SFBool(true)),new X3DFieldDefinition(X3DConstants.inputOutput,"size",new SFVec3f),new X3DFieldDefinition(X3DConstants.inputOutput,"center",new SFVec3f),new X3DFieldDefinition(X3DConstants.outputOnly,"enterTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"exitTime",new SFTime),new X3DFieldDefinition(X3DConstants.outputOnly,"isActive",new SFBool)]),size:new Vector3(0,0,0),center:new Vector3(0,0,0),modelViewMatrix:new Matrix4,getTypeName:function(){return"VisibilitySensor"},getComponentName:function(){return"EnvironmentalSensor"},getContainerField:function(){return"children"},initialize:function(){X3DEnvironmentalSensorNode.prototype.initialize.call(this);this.enabled_.addInterest(this,"set_enabled___");this.set_enabled___()},set_enabled___:function(){this.setCameraObject(this.enabled_.getValue());if(this.enabled_.getValue())this.traverse=traverse;else delete this.traverse},update:function(){if(this.visible&&this.getTraversed()){if(!this.isActive_.getValue()){this.isActive_=true;this.enterTime_=this.getBrowser().getCurrentTime()}this.visible=false}else{if(this.isActive_.getValue()){this.isActive_=false;this.exitTime_=this.getBrowser().getCurrentTime()}}this.setTraversed(false)},traverse:function(){}});function traverse(type){switch(type){case TraverseType.CAMERA:{if(this.visible)return;if(this.size_.getValue().equals(infinity))this.visible=true;else{var viewVolume=this.getCurrentLayer().getViewVolume(),modelViewMatrix=this.getModelViewMatrix(type,this.modelViewMatrix),size=modelViewMatrix.multDirMatrix(this.size.assign(this.size_.getValue())),center=modelViewMatrix.multVecMatrix(this.center.assign(this.center_.getValue()));this.visible=viewVolume.intersectsSphere(size.abs()/2,center)}break}case TraverseType.DISPLAY:this.setTraversed(true);break}}return VisibilitySensor}});define("cobweb/Components/Core/X3DInfoNode",["jquery","cobweb/Components/Core/X3DChildNode","cobweb/Bits/X3DConstants"],function($,X3DChildNode,X3DConstants){function X3DInfoNode(browser,executionContext){X3DChildNode.call(this,browser,executionContext);this.addType(X3DConstants.X3DInfoNode)}X3DInfoNode.prototype=$.extend(Object.create(X3DChildNode.prototype),{constructor:X3DInfoNode});return X3DInfoNode});define("cobweb/Components/Core/WorldInfo",["jquery","cobweb/Fields","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Components/Core/X3DInfoNode","cobweb/Bits/X3DConstants"],function($,Fields,X3DFieldDefinition,FieldDefinitionArray,X3DInfoNode,X3DConstants){with(Fields){function WorldInfo(executionContext){X3DInfoNode.call(this,executionContext.getBrowser(),executionContext);this.addType(X3DConstants.WorldInfo)}WorldInfo.prototype=$.extend(Object.create(X3DInfoNode.prototype),{constructor:WorldInfo,fieldDefinitions:new FieldDefinitionArray([new X3DFieldDefinition(X3DConstants.inputOutput,"metadata",new SFNode),new X3DFieldDefinition(X3DConstants.initializeOnly,"title",new SFString),new X3DFieldDefinition(X3DConstants.initializeOnly,"info",new MFString)]),getTypeName:function(){return"WorldInfo"},getComponentName:function(){return"Core"},getContainerField:function(){return"children"}});return WorldInfo}});define("cobweb/Configuration/SupportedNodes",["cobweb/Components/Networking/Anchor","cobweb/Components/Shape/Appearance","cobweb/Components/Sound/AudioClip","cobweb/Components/EnvironmentalEffects/Background","cobweb/Components/Navigation/Billboard","cobweb/Components/Geometry3D/Box","cobweb/Components/Navigation/Collision","cobweb/Components/Rendering/Color","cobweb/Components/Interpolation/ColorInterpolator","cobweb/Components/Rendering/ColorRGBA","cobweb/Components/Shaders/ComposedShader","cobweb/Components/Geometry3D/Cone","cobweb/Components/Rendering/Coordinate","cobweb/Components/Interpolation/CoordinateInterpolator","cobweb/Components/Interpolation/CoordinateInterpolator2D","cobweb/Components/Geometry3D/Cylinder","cobweb/Components/PointingDeviceSensor/CylinderSensor","cobweb/Components/Lighting/DirectionalLight","cobweb/Components/Interpolation/EaseInEaseOut","cobweb/Components/Geometry3D/ElevationGrid","cobweb/Components/Geometry3D/Extrusion","cobweb/Components/EnvironmentalEffects/Fog","cobweb/Components/Text/FontStyle","cobweb/Components/Grouping/Group","cobweb/Components/Texturing/ImageTexture","cobweb/Components/Geometry3D/IndexedFaceSet","cobweb/Components/Rendering/IndexedLineSet","cobweb/Components/Networking/Inline","cobweb/Components/KeyDeviceSensor/KeySensor","cobweb/Components/Navigation/LOD","cobweb/Components/Layering/Layer","cobweb/Components/Layering/LayerSet","cobweb/Components/Shape/Material","cobweb/Components/Core/MetadataBoolean","cobweb/Components/Core/MetadataDouble","cobweb/Components/Core/MetadataFloat","cobweb/Components/Core/MetadataInteger","cobweb/Components/Core/MetadataSet","cobweb/Components/Core/MetadataString","cobweb/Components/Texturing/MovieTexture","cobweb/Components/Navigation/NavigationInfo","cobweb/Components/Rendering/Normal","cobweb/Components/Interpolation/NormalInterpolator","cobweb/Components/Interpolation/OrientationInterpolator","cobweb/Components/Navigation/OrthoViewpoint","cobweb/Components/Texturing/PixelTexture","cobweb/Components/PointingDeviceSensor/PlaneSensor","cobweb/Components/Lighting/PointLight","cobweb/Components/Rendering/PointSet","cobweb/Components/Interpolation/PositionInterpolator","cobweb/Components/Interpolation/PositionInterpolator2D","cobweb/Components/EnvironmentalSensor/ProximitySensor","cobweb/Components/Geometry2D/Rectangle2D","cobweb/Components/Interpolation/ScalarInterpolator","cobweb/Components/Scripting/Script","cobweb/Components/Shaders/ShaderPart","cobweb/Components/Shape/Shape","cobweb/Components/Sound/Sound","cobweb/Components/Geometry3D/Sphere","cobweb/Components/PointingDeviceSensor/SphereSensor","cobweb/Components/Lighting/SpotLight","cobweb/Components/Grouping/StaticGroup","cobweb/Components/Grouping/Switch","cobweb/Components/Text/Text","cobweb/Components/Texturing/TextureCoordinate","cobweb/Components/Texturing/TextureProperties","cobweb/Components/Texturing/TextureTransform","cobweb/Components/Time/TimeSensor","cobweb/Components/PointingDeviceSensor/TouchSensor","cobweb/Components/Grouping/Transform","cobweb/Components/Shape/TwoSidedMaterial","cobweb/Components/Navigation/Viewpoint","cobweb/Components/Navigation/ViewpointGroup","cobweb/Components/Layering/Viewport","cobweb/Components/EnvironmentalSensor/VisibilitySensor","cobweb/Components/Core/WorldInfo"],function(Anchor,Appearance,AudioClip,Background,Billboard,Box,Collision,Color,ColorInterpolator,ColorRGBA,ComposedShader,Cone,Coordinate,CoordinateInterpolator,CoordinateInterpolator2D,Cylinder,CylinderSensor,DirectionalLight,EaseInEaseOut,ElevationGrid,Extrusion,Fog,FontStyle,Group,ImageTexture,IndexedFaceSet,IndexedLineSet,Inline,KeySensor,LOD,Layer,LayerSet,Material,MetadataBoolean,MetadataDouble,MetadataFloat,MetadataInteger,MetadataSet,MetadataString,MovieTexture,NavigationInfo,Normal,NormalInterpolator,OrientationInterpolator,OrthoViewpoint,PixelTexture,PlaneSensor,PointLight,PointSet,PositionInterpolator,PositionInterpolator2D,ProximitySensor,Rectangle2D,ScalarInterpolator,Script,ShaderPart,Shape,Sound,Sphere,SphereSensor,SpotLight,StaticGroup,Switch,Text,TextureCoordinate,TextureProperties,TextureTransform,TimeSensor,TouchSensor,Transform,TwoSidedMaterial,Viewpoint,ViewpointGroup,Viewport,VisibilitySensor,WorldInfo){return{MetadataBool:MetadataBoolean,Anchor:Anchor,Appearance:Appearance,AudioClip:AudioClip,Background:Background,Billboard:Billboard,Box:Box,Collision:Collision,Color:Color,ColorInterpolator:ColorInterpolator,ColorRGBA:ColorRGBA,ComposedShader:ComposedShader,Cone:Cone,Coordinate:Coordinate,CoordinateInterpolator:CoordinateInterpolator,CoordinateInterpolator2D:CoordinateInterpolator2D,Cylinder:Cylinder,CylinderSensor:CylinderSensor,DirectionalLight:DirectionalLight,EaseInEaseOut:EaseInEaseOut,ElevationGrid:ElevationGrid,Extrusion:Extrusion,Fog:Fog,FontStyle:FontStyle,Group:Group,ImageTexture:ImageTexture,IndexedFaceSet:IndexedFaceSet,IndexedLineSet:IndexedLineSet,Inline:Inline,KeySensor:KeySensor,LOD:LOD,Layer:Layer,LayerSet:LayerSet,Material:Material,MetadataBoolean:MetadataBoolean,MetadataDouble:MetadataDouble,MetadataFloat:MetadataFloat,MetadataInteger:MetadataInteger,MetadataSet:MetadataSet,MetadataString:MetadataString,MovieTexture:MovieTexture,NavigationInfo:NavigationInfo,Normal:Normal,NormalInterpolator:NormalInterpolator,OrientationInterpolator:OrientationInterpolator,OrthoViewpoint:OrthoViewpoint,PixelTexture:PixelTexture,PlaneSensor:PlaneSensor,PointLight:PointLight,PointSet:PointSet,PositionInterpolator:PositionInterpolator,PositionInterpolator2D:PositionInterpolator2D,ProximitySensor:ProximitySensor,Rectangle2D:Rectangle2D,ScalarInterpolator:ScalarInterpolator,Script:Script,ShaderPart:ShaderPart,Shape:Shape,Sound:Sound,Sphere:Sphere,SphereSensor:SphereSensor,SpotLight:SpotLight,StaticGroup:StaticGroup,Switch:Switch,Text:Text,TextureCoordinate:TextureCoordinate,TextureProperties:TextureProperties,TextureTransform:TextureTransform,TimeSensor:TimeSensor,TouchSensor:TouchSensor,Transform:Transform,TwoSidedMaterial:TwoSidedMaterial,Viewpoint:Viewpoint,ViewpointGroup:ViewpointGroup,Viewport:Viewport,VisibilitySensor:VisibilitySensor,WorldInfo:WorldInfo}});define("cobweb/Execution/Scene",["cobweb/Execution/X3DScene"],function(X3DScene){function Scene(browser){X3DScene.call(this,browser,this)}Scene.prototype=$.extend(Object.create(X3DScene.prototype),{constructor:Scene,getTypeName:function(){return"Scene"}});return Scene});define("cobweb/Browser/X3DBrowser",["jquery","cobweb/Fields","cobweb/Browser/X3DBrowserContext","cobweb/Configuration/SupportedNodes","cobweb/Execution/Scene","cobweb/InputOutput/Loader","cobweb/Parser/XMLParser","cobweb/Parser/Parser","cobweb/Bits/X3DConstants"],function($,Fields,X3DBrowserContext,SupportedNodes,Scene,Loader,XMLParser,Parser,X3DConstants){with(Fields){function X3DBrowser(xml){X3DBrowserContext.call(this,xml);this.currentSpeed=0;this.currentFrameRate=0;this.description_="";this.supportedNodes=SupportedNodes;this.supportedComponents=undefined;this.supportedProfiles=undefined}X3DBrowser.prototype=$.extend(Object.create(X3DBrowserContext.prototype),{constructor:X3DBrowser,initialize:function(){X3DBrowserContext.prototype.initialize.call(this);var scene=this.createScene();this.replaceWorld(scene);var urlCharacters=this.getXML()[0].getAttribute("url");if(urlCharacters){var parser=new Parser(scene,"",true),url=new MFString;parser.setInput(urlCharacters);parser.mfstringValues(url);if(url.length)this.loadURL(url)}this.print("Welcome to "+this.name+" X3D Browser "+this.version+":\n"+"        Current Graphics Renderer\n"+"                Name: "+this.getVendor()+" "+this.getWebGLVersion()+"\n"+"                Shading language: "+this.getShadingLanguageVersion()+"\n"+"        Rendering Properties\n"+"                Texture units: "+this.getMaxTextureUnits()+" / "+this.getMaxCombinedTextureUnits()+"\n"+"                Max texture size: "+this.getMaxTextureSize()+" √ó "+this.getMaxTextureSize()+" pixel\n"+"                Max lights: 0\n"+"                Max vertex uniform vectors: "+this.getMaxVertexUniformVectors()+"\n"+"                Max fragment uniform vectors: "+this.getMaxFragmentUniformVectors()+"\n"+"                Max vertex attribs: "+this.getMaxVertexAttribs()+"\n"+"                Antialiased: "+this.getAntialiased()+"\n"+"                Color depth: "+this.getColorDepth()+" bits\n")},getName:function(){return this.name},getVersion:function(){return this.version},getCurrentSpeed:function(){return this.currentSpeed},getCurrentFrameRate:function(){return this.currentFrameRate},setDescription:function(value){this.description=value},getWorldURL:function(){return this.currentScene.worldURL},createScene:function(){var scene=new Scene(this);scene.setup();if(this.isExternal())return scene;scene.beginUpdate();return scene},replaceWorld:function(scene){if(this.getWorld()){this.isLive().removeFieldInterest(this.getExecutionContext().isLive());this.getExecutionContext().endUpdate();this.shutdown().processInterests()}this.getCanvas().stop(true,true).fadeOut(0);this.description="";if(!scene)scene=this.createScene();var id=performance.now();this.resetLoadCount();this.loadCount_.addFieldCallback("bindWorld"+id,this.bindWorld.bind(this,id));this.isLive().addFieldInterest(scene.isLive());if(this.isLive().getValue())scene.beginUpdate();else scene.endUpdate();this.setExecutionContext(scene);this.initialized().setValue(this.getCurrentTime())},bindWorld:function(id,value){if(value)return;this.loadCount_.removeFieldCallback("bindWorld"+id);setTimeout(function(){this.getWorld().bind();this.getCanvas().fadeIn(2e3)}.bind(this),0)},createVrmlFromString:function(vrmlSyntax){var rootNodes=new MFNode;rootNodes.setValue(this.createX3DFromString(vrmlSyntax).rootNodes);return rootNodes},createX3DFromString:function(x3dSyntax){var currentScene=this.currentScene,external=this.isExternal(),scene=new Loader(this.getWorld()).createX3DFromString(this.currentScene.getWorldURL(),x3dSyntax);if(!external){currentScene.isLive().addFieldInterest(scene.isLive());if(currentScene.isLive().getValue())scene.beginUpdate()}scene.setup();return scene},createVrmlFromURL:function(url,node,event){if(!(node instanceof SFNode))throw Error("Browser.createVrmlFromURL: node must be of type SFNode.");if(!node.getValue())throw Error("Browser.createVrmlFromURL: node IS NULL.");var field=node.getValue().getField(event);if(field.getType()!==X3DConstants.MFNode)throw Error("Browser.createVrmlFromURL: event named '"+event+"' must be of type MFNode.");var currentScene=this.currentScene,external=this.isExternal();new Loader(this.getWorld()).createX3DFromURL(url,function(scene){if(scene){if(!external){currentScene.isLive().addFieldInterest(scene.isLive());if(currentScene.isLive().getValue())scene.beginUpdate()}scene.setup();field.setValue(scene.rootNodes)}})},createX3DFromURL:function(url,event,node){if(arguments.length===3){return null}var currentScene=this.currentScene,external=this.isExternal(),scene=new Loader(this.getWorld()).createX3DFromURL(url);if(!external){currentScene.isLive().addFieldInterest(scene.isLive());if(currentScene.isLive().getValue())scene.beginUpdate()}scene.setup();return scene},loadURL:function(url,parameter){var id=this.addLoadCount();new Loader(this.getWorld()).createX3DFromURL(url,function(scene){if(scene)this.replaceWorld(scene);this.removeLoadCount(id)}.bind(this),function(fragment){try{this.currentScene.changeViewpoint(fragment)}catch(error){}this.removeLoadCount(id)}.bind(this))},getRenderingProperty:function(name){this.getRenderingProperties().getField(name).getValue()},addBrowserListener:function(callback,object){},removeBrowserListener:function(callback){},importDocument:function(dom){if(!dom)return;new XMLParser(this.currentScene,dom).parseIntoScene();this.currentScene.setup()},setBrowserOption:function(name,value){this.getBrowserOptions().getField(name).setValue(value)},getBrowserOption:function(name){return this.getBrowserOptions().getField(name).getValue()},firstViewpoint:function(){var activeLayer=this.getActiveLayer();if(activeLayer){var viewpoints=activeLayer.getUserViewpoints();if(viewpoints.length)this.bindViewpoint(viewpoints[0])}},previousViewpoint:function(){var activeLayer=this.getActiveLayer();if(activeLayer){var viewpoints=activeLayer.getUserViewpoints();if(viewpoints.length===0)return;var index=0;for(var i=0;i<viewpoints.length;++i){if(viewpoints[i].isBound_.getValue())break;++index}if(index<viewpoints.length){if(index===0)this.bindViewpoint(viewpoints[viewpoints.length-1]);else this.bindViewpoint(viewpoints[index-1])}else this.bindViewpoint(viewpoints[viewpoints.length-1])}},nextViewpoint:function(){var activeLayer=this.getActiveLayer();if(activeLayer){var viewpoints=activeLayer.getUserViewpoints();if(viewpoints.length===0)return;var index=0;for(var i=0;i<viewpoints.length;++i){if(viewpoints[i].isBound_.getValue())break;++index}if(index<viewpoints.length){if(index===viewpoints.length-1)this.bindViewpoint(viewpoints[0]);else this.bindViewpoint(viewpoints[index+1])}else this.bindViewpoint(viewpoints[0])}},lastViewpoint:function(){var activeLayer=this.getActiveLayer();if(activeLayer){var viewpoints=activeLayer.getUserViewpoints();if(viewpoints.length)this.bindViewpoint(viewpoints[viewpoints.length-1])}},changeViewpoint:function(name){try{this.currentScene.changeViewpoint(name)}catch(error){console.log(error.message)}},bindViewpoint:function(viewpoint){if(viewpoint.isBound_.getValue())viewpoint.transitionStart(null,viewpoint);else viewpoint.set_bind_=true},addRoute:function(fromNode,fromEventOut,toNode,toEventIn){this.currentScene.addRoute(fromNode,fromEventOut,toNode,toEventIn)},deleteRoute:function(fromNode,fromEventOut,toNode,toEventIn){try{this.currentScene.deleteRoute(this.currentScene.getRoute(fromNode,fromEventOut,toNode,toEventIn))}catch(error){console.log(error)}},print:function(){var string="";for(var i=0;i<arguments.length;++i)string+=arguments[i];console.log(string);$(".cobweb-console").append(string)},println:function(){var string="";for(var i=0;i<arguments.length;++i)string+=arguments[i];console.log(string);$(".cobweb-console").append(string)}});Object.defineProperty(X3DBrowser.prototype,"name",{get:function(){return"Cobweb X3D Browser"},enumerable:true,configurable:false});Object.defineProperty(X3DBrowser.prototype,"version",{get:function(){return"1.17"},enumerable:true,configurable:false});Object.defineProperty(X3DBrowser.prototype,"description",{get:function(){return this.description_},set:function(value){this.description_=value;this.getNotification().string_=value},enumerable:true,configurable:false});Object.defineProperty(X3DBrowser.prototype,"currentScene",{get:function(){return this.getScriptStack()[this.getScriptStack().length-1].getExecutionContext()},enumerable:true,configurable:false});return X3DBrowser}});define("cobweb/X3D",["jquery","cobweb/Error","cobweb/Basic/X3DFieldDefinition","cobweb/Basic/FieldDefinitionArray","cobweb/Basic/X3DField","cobweb/Basic/X3DArrayField","cobweb/Fields","cobweb/Browser/X3DBrowser","cobweb/Execution/X3DExecutionContext","cobweb/Execution/X3DScene","cobweb/Prototype/ExternProtoDeclarationArray","cobweb/Prototype/ProtoDeclarationArray","cobweb/Prototype/X3DExternProtoDeclaration","cobweb/Prototype/X3DProtoDeclaration","cobweb/Routing/RouteArray","cobweb/Routing/X3DRoute","cobweb/Bits/X3DConstants"],function($,Error,X3DFieldDefinition,FieldDefinitionArray,X3DField,X3DArrayField,Fields,X3DBrowser,X3DExecutionContext,X3DScene,ExternProtoDeclarationArray,ProtoDeclarationArray,X3DExternProtoDeclaration,X3DProtoDeclaration,RouteArray,X3DRoute,X3DConstants){if(!console)console={};if(!console.log)console.log=function(){};if(!console.info)console.info=console.log;if(!console.warn)console.warn=console.log;if(!console.error)console.error=console.log;function getBrowser(dom){return $(dom).data("browser")}function createBrowser(dom){dom=$(dom);var browser=new X3DBrowser(dom);dom.data("browser",browser);browser.setup();if(dom.attr("splashScreen")!=="false")browser.getCanvas().fadeOut(0);return browser}var initialized=false,callbacks=$.Deferred(),fallbacks=$.Deferred();function X3D(callback,fallback){if(typeof callback==="function")callbacks.done(callback);if(typeof fallback==="function")fallbacks.done(fallback);if(initialized)return;initialized=true;$(function(){var elements=$("X3D");try{$.map(elements,createBrowser);if(elements.length)callbacks.resolve(elements)}catch(error){Error.fallback(elements);fallbacks.resolve(elements,error)}})}$.extend(X3D,Fields,{getBrowser:getBrowser,createBrowser:createBrowser,X3DConstants:X3DConstants,X3DFieldDefinition:X3DFieldDefinition,FieldDefinitionArray:FieldDefinitionArray,X3DField:X3DField,X3DArrayField:X3DArrayField,X3DExecutionContext:X3DExecutionContext,X3DScene:X3DScene,ExternProtoDeclarationArray:ExternProtoDeclarationArray,ProtoDeclarationArray:ProtoDeclarationArray,X3DExterProtonDeclaration:X3DExternProtoDeclaration,X3DProtoDeclaration:X3DProtoDeclaration,RouteArray:RouteArray,X3DRoute:X3DRoute});return X3D});(function(){if(window.X3D===undefined){function X3D(callback,fallback){X3D.callbacks.push(callback);X3D.fallbacks.push(fallback)}X3D.callbacks=[];X3D.fallbacks=[];window.X3D=X3D;function fallback(error){require(["cobweb/Error"],function(Error){Error(error,window.X3D.fallbacks);delete window.X3D})}if(window.Proxy===undefined)return fallback("Proxy is not defined");require(["cobweb/X3D"],function(X3D){var callbacks=window.X3D.callbacks,fallbacks=window.X3D.fallbacks;window.X3D=X3D;X3D();for(var i=0;i<callbacks.length;++i)X3D(callbacks[i],fallbacks[i])},fallback)}})();define("cobweb.js",function(){})})();